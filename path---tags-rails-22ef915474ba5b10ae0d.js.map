{"version":3,"sources":["webpack:///path---tags-rails-22ef915474ba5b10ae0d.js","webpack:///./.cache/json/tags-rails.json"],"names":["webpackJsonp","475","module","exports","pathContext","postsByTag","excerpt","html","id","frontmatter","date","path","title","tags","category","tagName"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,aAAeC,aAAeC,QAAA,uJAAAC,KAAA,8kMAAAC,GAAA,yIAAAC,aAA+9MC,KAAA,aAAAC,KAAA,qDAAAC,MAAA,4BAAAC,MAAA,6BAAAC,SAAA,iBAAqLR,QAAA,0IAAAC,KAAA;AAAm69BC,GAAA,iHAAAC,aAA09UC,KAAA,aAAAC,KAAA,6BAAAC,MAAA,oDAAAC,MAAA,yBAAAC,SAAA,YAA4KR,QAAA,+KAAAC,KAAA;AAAomsDC,GAAA,oHAAAC,aAAm2BC,KAAA,aAAAC,KAAA,gCAAAC,MAAA,2BAAAC,MAAA,SAAAC,SAAA,WAAqIR,QAAA,yPAAAC,KAAA,ojvBAA2muBC,GAAA,oHAAAC,aAA6kDC,KAAA,aAAAC,KAAA,gCAAAC,MAAA,2BAAAC,MAAA,SAAAC,SAAA,WAAqIR,QAAA,mOAAAC,KAAA;AAAsukCC,GAAA,kHAAAC,aAAyvCC,KAAA,aAAAC,KAAA,gCAAAC,MAAA,2BAAAC,MAAA,SAAAC,SAAA,WAAmIC,QAAA","file":"path---tags-rails-22ef915474ba5b10ae0d.js","sourcesContent":["webpackJsonp([143014539023981],{\n\n/***/ 475:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"pathContext\":{\"postsByTag\":[{\"excerpt\":\"이 포스팅은  Justin Weiss의 블로그 포스팅 을 허가 아래 번역한 글입니다 본 번역물의 저작권은 따로 없으며 인용하실 때 출처를 밝혀주신다면 무척 고맙겠습니다 표현이 부족한 부분이나 오타를 발견하시면 댓글이나 트위터를 통해 알려주세요 Thom Parkin…\",\"html\":\"<ul>\\n<li><strong>이 포스팅은 <a href=\\\"https://www.justinweiss.com/articles/the-easiest-way-to-get-into-open-source/\\\">Justin Weiss의 블로그 포스팅</a>을 허가 아래 번역한 글입니다</strong></li>\\n<li><strong>본 번역물의 저작권은 따로 없으며 인용하실 때 출처를 밝혀주신다면 무척 고맙겠습니다</strong></li>\\n<li><strong>표현이 부족한 부분이나 오타를 발견하시면 댓글이나 트위터를 통해 알려주세요</strong></li>\\n</ul>\\n<hr>\\n<p>Thom Parkin이 <a href=\\\"http://www.justinweiss.com/blog/2014/10/28/how-to-go-beyond-documentation-and-learn-a-new-library/#comment-1657912979\\\">제 지난번 글에 아주 중요한 지적을 해 주었습니다.</a></p>\\n<blockquote>\\n<p>좋은 조언입니다. 그러나 당신은 아주 중요하고 결정적인 포인트를 하나 놓쳤어요. 지금 하고 있는 이야기는 오픈 소스에 관한 이야기이기 때문에 당신이 한번 어떤 기능이나 함수가 문서화가 잘 안되어있다는 것을 발견한다면, <strong>당신은 그 문서를 업데이트 하고 풀 리퀘스트(Pull Request)를 제출해야 합니다.</strong> 그렇게 전체 커뮤니티가 도움을 받게 되고 더불어 당신은 그런 참여를 통해 어느 정도의 \\\"코더 평판(coder cred)\\\"을 얻게 됩니다.</p>\\n</blockquote>\\n<p><strong>나는 Thom이 이 점을 언급해주어서 기뻤습니다. 이는 아주 중요한 것이기 때문입니다.</strong> 문서를 수정하는 것은 당신이 사용하고 좋아하는 프로젝트에 기여를 시작할 수 있는 가장 쉬운 방법입니다.</p>\\n<p>제가 Rails, Rubinus, Elixir에 처음 기여했던 것들은 모두 문서 수정이었습니다. 저는 작은 수정들을 가해왔습니다. 문장을 더 명확하게 하고, 코드를 직접 읽어야만 발견할 수 있는 부분들을 설명하는 작업을 하거나, 심지어 단지 포맷이 잘못된 부분을 수정하기도 했습니다. 이 모든 것들은 좀 커다란 오픈 소스 프로젝트들을 돕는 가장 빠르고 쉬운 방법들입니다. 비록 이 일들이 제가 프로젝트에 유일하게 기여한 것들이지만, 여전히 미래의 사용자들을 돕고 있습니다. 심지어 미래의 제 자신도요. 그게 바로 오픈소스죠(And that’s what open source is all about).</p>\\n<h2 id=\\\"왜-문서를-수정하는-것이-그렇게-좋은-방법인가\\\"><a href=\\\"#%EC%99%9C-%EB%AC%B8%EC%84%9C%EB%A5%BC-%EC%88%98%EC%A0%95%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B4-%EA%B7%B8%EB%A0%87%EA%B2%8C-%EC%A2%8B%EC%9D%80-%EB%B0%A9%EB%B2%95%EC%9D%B8%EA%B0%80\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>왜 문서를 수정하는 것이 그렇게 좋은 방법인가</h2>\\n<p>Rails같이 거대한 프로젝트에선 문서를 수정하는 것이 가장 부담이 덜 되는 기여 방법입니다.</p>\\n<ul>\\n<li><strong>당신은 버그를 수정하기 위해 프로젝트를 세팅할 필요가 없습니다.</strong> 당신은 그저 문서를 업데이트 하는 것이기 때문에 테스트를 돌리거나 앱을 돌릴 필요가 없습니다. 심지어 당신은 자신의 컴퓨터에 프로젝트를 클론할 필요도 없습니다 - Github에서 바로 수정할 수 있어요!</li>\\n<li><strong>관리자(Maintainer)가 당신의 풀 리퀘스트에 수정을 요청한다면, 보통 어법(wording)이나 취향 때문일 겁니다.</strong> 이런 변경점은 당신의 코드가 비판받는 것 보다 받아들이기 쉽습니다. 그리고 만들기도 쉽습니다. 왜냐면 당신은 테스트나 코드를 업데이트 할 필요가 없으니까요. 단지 단어들만 업데이트하면 됩니다.</li>\\n<li><strong>문서화(Documentation)는 프로젝트 관리자에게는 힘든 일입니다. 그래서 업데이트는 큰 도움이 됩니다.</strong> 종종 코드의 작성자들은 자신의 코드와 너무 밀접해 있어서, 어느 부분이 혼란스러운 부분인지 잘 이해하지 못합니다. 그들은 다른, 혹은 뉴비 개발자들이 어느 부분의 문서에 도움이 필요한지 말해주길 원합니다. 당신의 프로젝트를 초보자의 시점으로 보는 건 연습이 필요합니다. 모두가 그런 기술을 가진 것은 아니거든요.</li>\\n<li><strong>마지막으로, 당신은 프로젝트에 부담없는 변화를 주면서도 관리자와 관계를 형성할 수 있습니다.</strong> 당신은 프로젝트의 방향을 바꾸는 게 아닙니다. 예를 들면 당신이 전체 기능에 기여하는 것 처럼요. 그래서 당신의 변경점은 관리자가 리뷰하기 쉽고, 그들은 보통 당신에게 더 빠르게 답변 할 것입니다. 당신의 머지 요청은 \\\"이게 정말 좋은 생각일까요?\\\" 같은 말에 가로막히지 않을 것입니다.</li>\\n</ul>\\n<p>당신은 그 관계를 유지하면서 점차 신뢰받는 기여자로 보이기 시작할 것입니다. 당신의 풀 리퀘스트는 더 빠르게 리뷰될 것이고, 당신들이(당신과 관리자) 더 복잡한 기능 요청이나 버그 수정에 대해 자세하게 이야기를 나누기도 쉬워집니다.</p>\\n<p>당신의 첫 기여를 <strong>시작하기도 쉽고, 하기도 쉽고, 머지도 더 빠르게 되는</strong> 문서 수정으로 해 보시는 게 어떨까요?</p>\\n<h2 id=\\\"업데이트-된-문서에-다시-기여하는-방법\\\"><a href=\\\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EB%90%9C-%EB%AC%B8%EC%84%9C%EC%97%90-%EB%8B%A4%EC%8B%9C-%EA%B8%B0%EC%97%AC%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>업데이트 된 문서에 다시 기여하는 방법</h2>\\n<p>버그 수정과 마찬가지로 문서 업데이트에 기여하는 데는 유의할 점이 있습니다: <strong>둘 다 공통적으로 '잘못되었다고 느껴지는 것들(things that feel wrong)'에 많이 신경을 써야 한다는 점입니다.</strong> 당신은 주의를 기울여야 합니다.</p>\\n<p>보통 코드가 당신이 기대하던대로 동작하지 않을 때가 문서를 업데이트 해야 할 시기입니다. 만약 당신이 코드를 직접 수정하여 문제를 해결한다면, 마찬가지로 다른 사람들에게 이에 대해 알려야 할 겁니다. 혹은 당신이 읽고 있는 문서의 잘못된 형식이나 오타가 신경쓰일 수도 있습니다. 당신이 고치지 않는다면 누가 할까요?</p>\\n<p>당신이 어디를 변경하고 어떻게 말로 표현해야하는지 좋은 아이디어가 떠올랐다면, 그 부분을 변경하고 한번 Github에 풀 리퀘스트를 올려보세요.</p>\\n<p>만약 당신이 문서를 업데이트 하는 가장 좋은 방법을 계속 구상중이라면 Github에 이슈를 열어보세요. 이런 식으로요:</p>\\n<blockquote>\\n<p>\\\"저기요, 이건 제가 보기에 좀 헷갈리네요. 제가 이런 식으로 업데이트하는 걸 생각해 봤는데요: ... 어떻게 생각하세요? 제가 더 넣어야 할 내용이 있을까요?\\\"</p>\\n</blockquote>\\n<p>이렇게 당신은 모두를 만족시키는 표현법을 함께 제안할 수 있습니다.</p>\\n<p>마지막으로 당신이 답변을 얻지 못하더라도 주눅들지 마세요. 큰 프로젝트는 여러 일들이 진행됩니다. 그래서 당신의 기여는 그 사이 어딘가로 쏙 빠져버리기 쉽지요. <strong>일주일 안팎으로 당신이 아무런 답변을 듣지 못한다면, 관리자에게 다시 물어보세요.</strong></p>\\n<p>보통 당신이 라이브러리를 사용하게 되면 무엇보다 먼저 마주치는 것이 문서입니다. 그러므로 문서를 자세하고 명료하게 만드는 것은 중요합니다.</p>\\n<p>그러니 당신이 쓰는 코드가 혼란스러울 때나 직접 소스를 들여다 보아야 할 때, 다음 사람을 위해 보기 쉽게 만들어주세요. 간단한 업데이트를 작성하고 다시 기여하세요. 이것이 제가 알고있는 오픈 소스 기여자가 되는 가장 쉬운 방법입니다.</p>\\n<hr>\\n<h2 id=\\\"번역-후기\\\"><a href=\\\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>번역 후기</h2>\\n<p>첫 번역이라 부족한 점이 아주 많았습니다. 영어로 된 글을 읽는 것이 그래도 어느 정도는 읽을만 하다고 생각했는데, 다른 사람이 한글로 된 번역문을 읽으려면 훨씬 번역을 잘 해야하고, 우리말 문장도 매끄럽게 작성하도록 온 신경을 기울여야 한다는 점을 깨닫는 계기가 되었습니다.</p>\\n<p>사실 번역을 시작해보게 된 계기는 단순합니다. 본 글의 저자인 <a href=\\\"http://www.justinweiss.com\\\">Justin Weiss</a>의 블로그 포스팅들이 마음에 들어서 책(Practicing Rails)도 구매하고, 뉴스레터도 구독하면서 최근 뉴스레터의 내용들이 참 도움이 많이 된다고 생각하였습니다. 그래서 메일로 최근에 온 뉴스레터를 한글로 번역하여 공유해도 되겠냐고 물어보았지요.</p>\\n<p>그는 조만간 그 뉴스레터를 블로그로 포스팅할 예정이고 그 포스팅이 첫 번째로 공개되는 포스팅이었으면 한다고 답변을 주었습니다. 즉 아직은 올릴 수 없다는 말이겠지요. 메일을 조금 더 주고받다가 저는 그의 좋은 포스팅들 중 첫 번역을 이 글로 시작하기로 협의했습니다.</p>\\n<p>차차 Justin의 포스팅 이외에도 괜찮은 글들을 제가 번역할 기회가 주어진다면 조금씩 올려볼 예정입니다. 감사합니다.</p>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-12-19-the-easiest-way-to-get-into-open-source-kor/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-12-09\",\"path\":\"/posts/the-easiest-way-to-get-into-open-source-kor\",\"title\":\"[번역] 오픈 소스에 참여하는 가장 쉬운 방법\",\"tags\":[\"Translation\",\"Rails\",\"OSS\"],\"category\":\"Translation\"}},{\"excerpt\":\"본 포스팅은  루비 대림절 달력 을 위해 제작하였습니다 기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다 작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다 들어가며 아직 갓…\",\"html\":\"<ul>\\n<li><strong>본 포스팅은 <a href=\\\"http://ruby-korea.github.io/advent-calendar/\\\">루비 대림절 달력</a>을 위해 제작하였습니다</strong></li>\\n<li><strong>기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다</strong></li>\\n<li><strong>작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다</strong></li>\\n</ul>\\n<h2 id=\\\"들어가며\\\"><a href=\\\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>들어가며</h2>\\n<p>아직 갓 6개월 된 초보 개발자로서 이제 루비 온 레일즈(이하 레일즈)에 조금씩 익숙해지던 차에, 상사로부터 '하나미라는 프레임워크가 있으니 한번 리서치를 해 보세요' 라는 권유를 받았다. 그는 루비로 백엔드 서버들을 구축했지만 레일즈는 자신의 취향에 맞지 않다고 했고, 구조적으로도 하나미가 더 나아보인다고 이야기하였다.</p>\\n<p>그리고 하나미 공식 가이드를 쭉 읽어본 나에게는 혼돈과 절망만 남았다. 루비 뿐 아니라 웹 개발의 기초 지식이 부족해서 그런지 도저히 이게 어떻게 돌아가는건지도 모르겠고, 레일즈에 대입해서 이해할 수 있는 것도 아니라는 생각이 들었다.</p>\\n<p>다시 6개월을 다른 레일즈 프로젝트 제작, 리서치 작업을 하며 보내고 나니 회사에서는 본격적으로 레일즈 사용을 하지 않고 하나미를 사용하는 방향으로 가닥을 잡았다. 어쩌다가 레일즈라는 걸출한 웹 프레임워크를 두고 생소한 하나미라는 프레임워크를 사용하게 되었는지, 이번 기회를 통해 독자 분들의 관심을 이끄는 계기를 만들어보고자 한다.</p>\\n<h2 id=\\\"변화가-일고-있는-레일즈-커뮤니티\\\"><a href=\\\"#%EB%B3%80%ED%99%94%EA%B0%80-%EC%9D%BC%EA%B3%A0-%EC%9E%88%EB%8A%94-%EB%A0%88%EC%9D%BC%EC%A6%88-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>변화가 일고 있는 레일즈 커뮤니티</h2>\\n<p>레일즈는 2005년에 처음 소개 된 이후 빠르고 쉬운 웹 애플리케이션 개발을 위한 도구로써 많은 개발자들의 사랑을 받아왔다.</p>\\n<p>'프로그래머의 단짝 친구' 라고 소개할 정도로 쉽고 재미있는 언어인 루비를 기반으로 삼은 프레임워크이기도 하고, 꼭 루비 문법을 모두 꿰고 있어야 할 정도로 많은 지식을 알고 있지 않아도 금방 어지간한 웹 애플리케이션을 제작할 수 있다는 점이 주요 셀링 포인트라고 여겨진다.</p>\\n<p>소위 'Rails Magic' 덕분에 form에 변수를 할당하는 것으로 경로 설정이 알아서 되거나 스캐폴딩만 해도 신기하게 돌아가는 애플리케이션을 보며 감탄했던 적이 한두 번이 아니었다.</p>\\n<p>2016년 현재 레일즈는 버전 5까지 발매되었고, 더 많은 기능이 구현되어 있으며 커뮤니티는 많이 거대해졌다. 거대해진 레일즈 세계와 함께 그 음영을 느끼는 개발자들도 조금씩 늘어나게 되었다.</p>\\n<p>예를 들어 보통 레일즈 애플리케이션을 오래 개발해온 사람들은 애플리케이션의 규모가 커질수록 유지보수하는게 힘들어진다는 점을 지적하고 있는데, 이를 해결하기 위해 <strong>Fat model, Skinny controller</strong> 등의 방법론이 제시되고 있지만 '뭔가 문제가 있다'는 의견들은 끊임없이 제시되고 있다.</p>\\n<p>또한 DHH(David Heinemeier Hansson, 레일즈의 창시자)가 제시하고 있는 <a href=\\\"http://solnic.eu/2016/05/22/my-time-with-rails-is-up.html\\\">'Rails way'에 반감을 가진 사람들이 점차 늘어나고</a> 루비로 웹 개발을 하는 것에 대해 <a href=\\\"http://rwdtow.stdout.in/\\\">더 나은 방법을 찾는</a> 사람들이 점차 늘어나고 있다.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 599px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 131.3856427378965%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABe2AlTSxFMuUv/8QAGRABAAIDAAAAAAAAAAAAAAAAAQACEBEw/9oACAEBAAEFAqmqxODj/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQMBAT8BY//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABUQAQEAAAAAAAAAAAAAAAAAAAEw/9oACAEBAAY/Ain/xAAaEAADAQADAAAAAAAAAAAAAAAAAREQITFR/9oACAEBAAE/IYTxFLPKU5GXOpWf/9oADAMBAAIAAwAAABBv7vz/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EHDbIc//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxAp/8QAHhABAAICAQUAAAAAAAAAAAAAAQARITFBUWGBkaH/2gAIAQEAAT8QKn0nwj0BmUTlxMVEarzE8Q3EKIQbZTiXibZ3H3P/2Q=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"현재 레일즈 커뮤니티\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-f36a6.jpg\\\"\\n        srcset=\\\"/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-28fc4.jpg 198w,\\n/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-44f6c.jpg 395w,\\n/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-f36a6.jpg 599w\\\"\\n        sizes=\\\"(max-width: 599px) 100vw, 599px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<p><em>현재 레일즈 커뮤니티의 묘사 - 출처: <a href=\\\"http://railshurts.com/current_state\\\">http://railshurts.com/current_state</a></em></p>\\n<p>이러한 분위기 속에서 'Ruby way, not Rails' 를 표방하는 루비 기반 웹 프레임워크가 등장하였으니, 바로 이번에 소개할 <a href=\\\"hanamirb.org\\\">Hanami(하나미)</a>이다.</p>\\n<h2 id=\\\"하나미가-뭐죠\\\"><a href=\\\"#%ED%95%98%EB%82%98%EB%AF%B8%EA%B0%80-%EB%AD%90%EC%A3%A0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>하나미가 뭐죠?</h2>\\n<p>하나미는 이탈리아의 개발자 <a href=\\\"https://lucaguidi.com\\\">Luca Guidi</a> 가 개발한 루비 MVC 웹 프레임워크이다. 2014년에 Lotus라는 이름으로 처음 등장하였으나, IBM의 Louts 상표권과 엮이는 문제가 있어 지금의 이름으로 변경하게 되었다.</p>\\n<p>새로운 이름으로 <strong>하나미</strong>라는 이름을 쓰게 된 이유는 '꽃구경' 이라는 일본어 본래의 뜻에 걸맞게 함께 하는 커뮤니티의 중요성을 일깨운다는 점을 강조하기 위해서라고 한다. 루비의 창시자 Matz와(일본인이다) 루비 그 자체에 대한 찬사의 의미도 가지고 있다.</p>\\n<p>하나미의 특징을 몇 가지 소개하자면 먼저 최대한 루비라는 언어를 직접적으로 사용하는 방식으로 구현되어 있다는 점이다. 다만 이 때문에 레일즈를 습득하는데 루비 지식이 크게 필요하지 않은 것과 다르게 일정 수준의 루비 언어의 이해를 요구한다.</p>\\n<p>또한 Magic을 최대한 배제하고(하나미 Gitter 채팅방에서 혹은 몇몇 포스트에서 \\\"I'm now sick of rails magic!\\\" 이라고 주장하는 사람들이 많이 보인다) 개발자가 최대한 자신이 무엇을 하고 있는지 인지하면서 앱을 제작하도록 유도한다.</p>\\n<p>그리고 보통 Rails best practice 로 제시되는 요소들을 기본적으로 구현하고 있다.</p>\\n<ul>\\n<li>컨트롤러는 HTTP 콜만 다룬다 -> 액션에서 비지니스 로직을 분리하여 처리하기 위해 <code class=\\\"language-text\\\">Interactor</code> 라는 모듈이 있다</li>\\n<li>퍼시스턴스 로직과 도메인 로직을 분리한다 -> 하나미 모델은 기본적으로 도메인과 퍼시스턴스 레이어가 분리되어 있다</li>\\n<li>루비 객체를 만들어서 제대로 OOP를 한다 -> 하나미는 OOP 개념을 잘 지키기 위해 노력한다. 또한 모듈화도 굉장히 쉽다</li>\\n</ul>\\n<p>하나미 가이드 페이지 첫머리에서 제시하는 <a href=\\\"http://hanamirb.org/guides/#why-choose-hanami-\\\">'하나미를 선택하는 이유'</a> 를 가볍게 살펴보면 이렇게 말하고 있다.</p>\\n<ul>\\n<li>하나미는 가볍다 -> 상대적으로 짧은 코드, 웹 애플리케이션 개발에 필요한 필수적인 부분에 초점을 맞춤</li>\\n<li>하나미는 구조적으로 건전하다 -> 컨트롤러 액션은 각각의 클래스로 분리되어 있으며 테스트하기 용이하다</li>\\n<li>하나미는 스레드에 안전하다 -> (아직 이런 문제를 겪을만한 규모의 앱을 작성해본 적이 없어서 설명하기 어렵다)</li>\\n</ul>\\n<p>또한 하나미는 컨테이너 형태의 앱 구조를 기본적으로 제공한다. 덕분에 한 개의 프로젝트를 생성하여 API 서버와 웹 서버를 동시에 운용하는게 가능하다. 물론 레일즈로도 비슷한 구성을 할 수야 있겠지만 충돌 없는 구현을 위해 앱의 구조가 훨씬 복잡해질 가능성이 높다.</p>\\n<h2 id=\\\"만들어-볼까요\\\"><a href=\\\"#%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%BC%EA%B9%8C%EC%9A%94\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>만들어 볼까요</h2>\\n<p>글을 길게 써 보았지만, 개발자들에겐 장황한 글보다 코드 몇 줄을 보는 것이 훨씬 이해가 빠를 것이다. 하나미의 공식 가이드를 따라가면서 눈여겨 볼 점들을 소개하겠다.</p>\\n<h3 id=\\\"bookshelf-프로젝트-생성\\\"><a href=\\\"#bookshelf-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Bookshelf 프로젝트 생성</h3>\\n<p>이번에 만들어볼 애플리케이션(이하 앱)은 <code class=\\\"language-text\\\">Bookshelf</code> 라는 앱이다. 책의 제목과, 작가가 있고 이 책들의 리스트를 살펴보고 책을 추가할 수 있는 기능을 가지고 있다. 가이드에서 수정과 삭제는 다루고 있지 않아 조금 아쉬운 느낌이 들지만 기본적인 웹 개발(레일즈) 지식이 있다면 구현하는 것이 그렇게 어렵지는 않다.</p>\\n<p>기본적으로 루비 버전은 2.3+ 을 권장한다. 또한 데이터베이스는 sqlite3를 사용할 예정이다.</p>\\n<p>먼저 하나미로 프로젝트를 생성하기 위해서는 <code class=\\\"language-text\\\">gem install hanami</code> 로 하나미가 설치되어 있어야 한다. 그 다음에는 새 프로젝트를 생성해본다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ hanami new bookshelf</code></pre>\\n      </div>\\n<p>생성된 프로젝트의 폴더 구조를 살펴보면 다음과 같다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ tree -L 2\\n.\\n├── Gemfile\\n├── Rakefile\\n├── apps\\n│   └── web\\n├── config\\n│   ├── environment.rb\\n│   └── initializers\\n├── config.ru\\n├── db\\n│   ├── migrations\\n│   └── schema.sql\\n├── lib\\n│   ├── bookshelf\\n│   └── bookshelf.rb\\n├── public\\n└── spec\\n    ├── bookshelf\\n    ├── features_helper.rb\\n    ├── spec_helper.rb\\n    ├── support\\n    └── web</code></pre>\\n      </div>\\n<p>여기서 특이한 점은 <code class=\\\"language-text\\\">apps</code> 라는 폴더가 있다는 점인데 기본 컨테이너는 <code class=\\\"language-text\\\">web</code> 이지만 사용자가 웹 브라우저로 보는 애플리케이션 이외에 같은 데이터베이스를 공유하는 api 서버 등을 따로 만들고자 하면 제네레이터로 따로 컨테이너를 생성할 수 있다. 그러면 같은 데이터베이스 사용하는 별개의 앱을 따로 구축할 수 있다는 장점이 있다. (물론 라우팅은 다르겠지만.. 이 부분은 <code class=\\\"language-text\\\">mount</code> 옵션으로 처리할 수 있다) <a href=\\\"http://hanamirb.org/guides/getting-started/#hanami-architecture\\\">- 참고</a></p>\\n<p>각 앱들에는 별개의 설정 파일, 컨트롤러, 뷰, 라우트, 템플릿 파일 및 폴더가 있다.</p>\\n<p>테스트는 사용자가 원하는 어떤 형태로도 이용할 수 있다.(minitest or rspec) 하나미에서는 minitest를 기본으로 사용하며 capybara 젬도 사용한다. 이번 포스팅에서는 테스트를 구현하는 부분은 넘어가고자 한다. 테스팅이 궁금한 분들은 공식 가이드를 참조하시라.</p>\\n<h3 id=\\\"루트-페이지-만들기\\\"><a href=\\\"#%EB%A3%A8%ED%8A%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>루트 페이지 만들기</h3>\\n<p>라우팅은 각 앱의 <code class=\\\"language-text\\\">config/routes.rb</code> 파일에서 설정한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/config/routes.rb</span>\\nroot to<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'home#index'</span>\\n</code></pre>\\n      </div>\\n<p>그러면 home 컨트롤러의 index 액션을 실행해주기 위해 제네레이터로 액션을 생성해본다. 아직 하나미는 레일즈처럼 다양하고 세분화된 옵션의 CLI를 제공하진 않는다. 번거롭긴 하지만 개발에 큰 지장은 없다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate action web home#index\\n    create  spec/web/controllers/home/index_spec.rb\\n    create  apps/web/controllers/home/index.rb\\n    create  apps/web/views/home/index.rb\\n    create  apps/web/templates/home/index.html.erb\\n    create  spec/web/views/home/index_spec.rb\\n    insert  apps/web/config/routes.rb</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">action</code> 뒤에 있는 <code class=\\\"language-text\\\">web</code> 은 액션을 생성하고자 하는 컨테이너의 이름이다. 그 다음에 컨트롤러와 액션 이름을 적어주면 된다. 앱 구조가 단독 컨테이너 구조일 경우(<code class=\\\"language-text\\\">hanami new</code> 커맨드로 앱 생성시 <code class=\\\"language-text\\\">--arch=app</code> 옵션을 주어 단독 컨테이너 앱 생성도 가능하다)에는 바로 액션 이름만 작성해주어도 된다.</p>\\n<p>아쉬운 점은 매 액션마다 저 명령어를 작성해주어야 한다는 점이다. <code class=\\\"language-text\\\">hanami-scaffold</code> 라는 젬이 있지만 그닥 유지보수는 되지 않고 있어서 사용하는 것을 추천하지 않는다.</p>\\n<p>컨트롤러는 폴더에 불과하며 그 폴더에 속한 각각의 액션 파일에 컨트롤러가 정의되어 있는 형태이다. 또한 뷰는 템플릿 파일(레일즈의 views 폴더 안에 있는 템플릿들)과 뷰 파일(레일즈에 비유하자면 뷰 헬퍼와 비슷)로 구성되어있다. 지금은 템플릿 파일에 간단하게 제목을 추가해보도록 한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-markup\\\"><code class=\\\"language-markup\\\"># apps/web/templates/home/index.html.erb\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h1</span><span class=\\\"token punctuation\\\">></span></span>Bookshelf<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre>\\n      </div>\\n<p><em>(주의) 템플릿 파일이 변경될 때에는 서버를 재실행할 필요가 없지만, 컨트롤러 등의 루비 파일이 변경될 때에는 서버를 재실행해야 한다.</em></p>\\n<p>그리고 서버를 실행한 뒤 <code class=\\\"language-text\\\">localhost:2300</code> 으로 접속해보면 심플하지만 Bookshelf라는 글씨가 보이는 페이지를 마주할 수 있다.\\n(본 포스트에서는 빠른 진행을 위해 <code class=\\\"language-text\\\">application.html.erb</code> 파일을 미리 수정해두었다)</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami server</code></pre>\\n      </div>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 358px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 74.58100558659218%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y81R32tSYRg+/8tyumBjEkxd5TKZRRlHnU70HM/x1/RibmArF5UXDRbtz/CmwfyVJ4i6qP6CdhEEbRmIO4pCA9F25Y+n93xk0MVawS468PB+7/c97/M833c446QeNuMlzC1chsGkw8WpafCORVgXbLhy1Yo5kxkms+UX5jTQ3njfbJmHTj+FC5MGTOj04Cwk6DLPw87fhOHaBBxWGyrZDFKrq0gmE3A6neB5Hi6XCy6qbrf7N4iiSMJmTM/MkLAB3G0i3aAh+3U77tziEQgEEBRExGIxhmQigXg8DkmSEA6HIQgC44wRDAbh9/vJkAw8HnAyEaVQCB6PG4IoQJZkJpDJZLC5mcEDQjqdprRJrKXWEIlEWCpZlplJiGa1tWYejUbBabG1RiIhLQEjiSEskUE0FodIabWhYCCI5WUfVihxJBKFz+dFIpEk8xUK44Fxdhb2RQe4fD6PcrmMUqkMRVGolqh/gVKxiEpFQZGqdlYsFNhZ5SenQL2ivGTr/N4ecrkcnu/ugsM5f5x6VMeH/X30ej2cnHzHwcEhvh0fo/rlEEeqik6ng/fv3qJa/coG+v0+BoPBqeDevH6FJa8Xz3Z28PjRQ6TvbiCbzWLryRY27t3H9vZTrKdS+PjpMxMcDIcYjUangut2u2g0GgQV9XodzWYTtVoNqtpAq9WiqqLdblOyARPUhv545X95n7PEmKBGGtI1zsJY7FwT/tVf/u8FfwCkJLVg24iPyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"Bookshelf Title\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-8524e.png\\\"\\n        srcset=\\\"/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-dc079.png 198w,\\n/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-8524e.png 358w\\\"\\n        sizes=\\\"(max-width: 358px) 100vw, 358px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<h3 id=\\\"모델-구축하기\\\"><a href=\\\"#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>모델 구축하기</h3>\\n<p>본격적으로 책들을 저장하고 출력하기 위해 데이터베이스 마이그레이션을 진행해 보도록 한다. 먼저 마이그레이션 파일을 생성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate migration create_books</code></pre>\\n      </div>\\n<p>생성된 마이그레이션 파일은 이렇게 작성해 보았다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># db/migrations/20161203083239_create_books.rb</span>\\n<span class=\\\"token constant\\\">Hanami</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Model</span><span class=\\\"token punctuation\\\">.</span>migration <span class=\\\"token keyword\\\">do</span>\\n  change <span class=\\\"token keyword\\\">do</span>\\n    create_table <span class=\\\"token symbol\\\">:books</span> <span class=\\\"token keyword\\\">do</span>\\n      primary_key <span class=\\\"token symbol\\\">:id</span>\\n\\n      column <span class=\\\"token symbol\\\">:title</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token builtin\\\">String</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n      column <span class=\\\"token symbol\\\">:author</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token builtin\\\">String</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n\\n      column <span class=\\\"token symbol\\\">:created_at</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">DateTime</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n      column <span class=\\\"token symbol\\\">:updated_at</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">DateTime</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">primary_key</code> 가 반드시 <code class=\\\"language-text\\\">id</code> 일 필요는 없다. 또한 <code class=\\\"language-text\\\">String</code>, <code class=\\\"language-text\\\">DateTime</code> 은 루비 타입이다(루비 클래스). 반드시 루비 타입을 사용할 필요는 없고 <code class=\\\"language-text\\\">&quot;varchar(255)&quot;</code> 같이 데이터베이스 타입을 문자열로 직접 작성해주어도 된다.</p>\\n<p>마이그레이션 파일 작성이 완료되면 테이블을 생성해주는 명령어를 입력한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami db prepare\\n$ bundle exec hanami db migrate</code></pre>\\n      </div>\\n<p>그리고 <code class=\\\"language-text\\\">Book</code> 모델을 생성해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate model book\\n      create  lib/bookshelf/entities/book.rb\\n      create  lib/bookshelf/repositories/book_repository.rb\\n      create  spec/bookshelf/entities/book_spec.rb\\n      create  spec/bookshelf/repositories/book_repository_spec.rb</code></pre>\\n      </div>\\n<p>생성된 파일을 보면 조금 특이한 점을 볼 수 있는데 <code class=\\\"language-text\\\">entities</code> 폴더와 <code class=\\\"language-text\\\">repositories</code> 폴더가 따로 나뉘어져 있다는 점이다. <code class=\\\"language-text\\\">Entity</code> 는 도메인 객체로, 실제 데이터베이스 쿼리 등으로 추출된 자료 객체를 일컫는다. <code class=\\\"language-text\\\">Repository</code> 는 퍼시스턴스 계층과 <code class=\\\"language-text\\\">Entity</code> 를 이어주는 역할을 한다. 여기서 <code class=\\\"language-text\\\">Entity</code> 는 데이터베이스의 존재를 전혀 모르는 단순 루비 객체이며 테스트가 용이하고 가벼운 앱을 만드는데 도움이 된다.</p>\\n<p>실제 콘솔에서 레코드를 다루어보면 이런 방식으로 동작한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami console\\n&gt;&gt; repo = BookRepository.new\\n=&gt; #&lt;BookRepository:... &gt;\\n&gt;&gt; repo.all\\n=&gt; []\\n&gt;&gt; book = repo.create(title: &#39;TDD&#39;, author: &#39;Kent Beck&#39;)\\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;\\n&gt;&gt; repo.find(book.id)\\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">Repository</code> (이하 리퍼지토리)에서 제공되는 메서드로 데이터베이스에 <code class=\\\"language-text\\\">Entity</code> (이하 엔티티)를 조작할 수 있고, 엔티티에는 따로 속성 혹은 동작을 지정할 수 있다. 그래서 레일즈에서 사용하는 <code class=\\\"language-text\\\">scope</code> 나 커스텀 쿼리가 작성된 메서드 등은 리퍼지토리 클래스에 분리해 둘 수 있다.</p>\\n<h3 id=\\\"데이터를-표현하기\\\"><a href=\\\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>데이터를 표현하기</h3>\\n<p>임의로 몇 개의 <code class=\\\"language-text\\\">Book</code> 레코드를 생성해주고 리스트를 표현해보기 위해 새 컨트롤러 액션을 생성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate action web books#index</code></pre>\\n      </div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-markup\\\"><code class=\\\"language-markup\\\"># apps/web/templates/books/index.html.erb\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h2</span><span class=\\\"token punctuation\\\">></span></span>All books<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h2</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n&lt;% if books.any? %>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>div</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>books<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    &lt;% books.each do |book| %>\\n      <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>div</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>book<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h2</span><span class=\\\"token punctuation\\\">></span></span>&lt;%= book.title %><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h2</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>&lt;%= book.author %><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n      <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n    &lt;% end %>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n&lt;% else %>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>placeholder<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>There are no books yet.<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n&lt;% end %>\\n</code></pre>\\n      </div>\\n<p>여기서 <code class=\\\"language-text\\\">books</code> 는 어디서 온 것일까? 실제로 액션 부분은 이렇게 작성되어 있다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/controllers/books/index.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Controllers</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Index</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Action</span>\\n\\n    expose <span class=\\\"token symbol\\\">:books</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">call</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token variable\\\">@books</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BookRepository</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span>all\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">expose</code> 메서드의 사용은 하나미의 규칙으로, <code class=\\\"language-text\\\">expose</code> 로 지정한 변수만 템플릿으로 노출되며 그 변수는 <code class=\\\"language-text\\\">call</code> 메서드 안에 인스턴스 변수로 존재해야 한다.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 128.05194805194807%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAAC+0lEQVRIx61U/UtTURi+f0vq0n7oA0Q2P5L8ojLEocxtd03nvpztw2V/QBqmmRpYRjgrrIku06kUBEFQ6IhyZaap6Nb6oURJ3Jyi4rane44oaubHtQsP59z3nPc5z3PP+14mXnAc6fFCJKQJEXUmCqkJIkguZeNcRiYys7KQlp4BUWLSrkhMSkbM8ThEC2JxLFpAwYji4pCdeBYpF1MRkyCAuUCKxnIL9KVGWMwm6PU65IpzIRaLtyEvLw8KBQuhUISTp05DEHuCkjN5Egmyc3JwPusCLrNKyFg5dHo9R6SHwWBAaWkpnWs0GmjUGjoWFxdDJpNBLpeDVSjoSCCVysAolUoUKguRn59PTyQbCYHFYoHVaoXJaFwn42AoKYFWq4VarYZKpQLJZVkWEk4Uy+WqVAowZKGszAqj0QSz2QzjFSN0Wh10Oi2NEcuGEgOKioroISYuRubl5ddgMlug4AiTk1MglxbgqsUAxuPxYHJykmJqaoqCxDbiXq8XPp+Pvm9d2zone9ZjHjD4zw/T2+NEVdVNdHY50dXpwN2m++h29qCmuhp9vb2or2vAg2Yb3by2toZwOLwnGLd7EHa7HTbbQzja29DheIb2Dgfa7E/R43Si83k3Bt2fKCFJiEQieys8qBVCdiDLq6ur+D03h5mZGSwvL2NlZQWBQICOhCQUCm2SEXX7KnQN9KO27g4e2ZrRbGtBa+sTNDTUo+/Fy79s7ke2qXBhYQGLi0HMz89z8NPR7/cfWNU2QnJzxNZuz2GINgnHvo2iueUxrlfewPjEBA2SA7baPJTCVe7j//w1jbHxcc724jZlvBTuTNp6o7w6xcv1oGvAhaGhL3j7rh8jI6OI8LC6rbA3EkOh8JHsUsIgVzLT09OY44qbYHZ2FgEuxvsbvne5cKumBvW3a9F0rxGVFRV49frNodpt114mpbL+Nwlt1iUvhUtLS7RTSP/6/QFq90iEP3zf4Xa7MfR5CMPDX/Hh4yCCwSB/wn8t8L7ljXrbCb6kfwBgoxYXcTdGKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"Bookshelf list\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-3fe9a.png\\\"\\n        srcset=\\\"/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-54c53.png 198w,\\n/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-3fe9a.png 385w\\\"\\n        sizes=\\\"(max-width: 385px) 100vw, 385px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<h3 id=\\\"새로운-책을-등록하기\\\"><a href=\\\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%B1%85%EC%9D%84-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>새로운 책을 등록하기</h3>\\n<p>웹 페이지에서 새로운 책을 등록하기 위해서는 <code class=\\\"language-text\\\">new</code>, <code class=\\\"language-text\\\">create</code> 액션과 패러매터를 전달해 줄 <code class=\\\"language-text\\\">Form</code> 이 필요할 것이다. 먼저 <code class=\\\"language-text\\\">books#new</code>, <code class=\\\"language-text\\\">books#create</code> 액션을 생성해 준 뒤에 라우팅을 조금 깔끔하게 다듬어주도록 한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/config/routes.rb</span>\\nroot to<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'home#index'</span>\\nresources <span class=\\\"token symbol\\\">:books</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:index</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:new</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:create</span><span class=\\\"token punctuation\\\">]</span>\\n</code></pre>\\n      </div>\\n<p>하나미는 REST를 기본적으로 지원한다. 2번째 줄에서 사용 된 <code class=\\\"language-text\\\">resources</code> 는 보통 레일즈 라우트 파일에서 자주 보았던 그 <code class=\\\"language-text\\\">resources</code> 메서드처럼 사용하면 된다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami routes\\n        Name Method     Path           Action\\n\\n        root GET, HEAD  /              Web::Controllers::Home::Index\\n       books GET, HEAD  /books         Web::Controllers::Books::Index\\n    new_book GET, HEAD  /books/new     Web::Controllers::Books::New\\n       books POST       /books         Web::Controllers::Books::Create</code></pre>\\n      </div>\\n<p>다음은 <code class=\\\"language-text\\\">new</code> 템플릿에 폼 헬퍼(Form helper) 를 이용하여 간단한 폼을 작성해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-markup\\\"><code class=\\\"language-markup\\\"># apps/web/templates/books/new.html.erb\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h2</span><span class=\\\"token punctuation\\\">></span></span>Add book<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h2</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n&lt;%=\\n  form_for :book, routes.books_path do\\n    div class: 'input' do\\n      label      :title\\n      text_field :title\\n    end\\n\\n    div class: 'input' do\\n      label      :author\\n      text_field :author\\n    end\\n\\n    div class: 'controls' do\\n      submit 'Create Book'\\n    end\\n  end\\n%>\\n</code></pre>\\n      </div>\\n<p>폼 헬퍼의 구조가 레일즈의 <code class=\\\"language-text\\\">form_for</code> 헬퍼와는 사뭇 다르다. 간단하게 차이점을 이야기하자면 하나미의 <code class=\\\"language-text\\\">form_for</code> 는 레일즈의 <code class=\\\"language-text\\\">form_tag</code> 헬퍼에 가깝다고 생각하면 된다. <a href=\\\"http://hanamirb.org/guides/helpers/forms/#technical-notes\\\">하나미 가이드에 따르면</a> <code class=\\\"language-text\\\">form_for do |f|</code> 형식으로 작성하는 것은 올바른 ERB 템플릿이 아니며, 하나미의 폼 헬퍼는 템플릿 엔진에 의존하지 않고 사용할 수 있도록(어느 템플릿 엔진을 사용하던 같은 루비 코드를 사용하도록) 구성되어 있다.</p>\\n<p><code class=\\\"language-text\\\">routes.books_path</code> 는 라우팅 헬퍼이며 상기 라우팅 구조에 있는 이름을 사용하여 <code class=\\\"language-text\\\">routes</code> 뒤에 메서드 형식으로 붙여주면 자동으로 경로를 연결해준다.</p>\\n<p>책을 생성하기 위한 <code class=\\\"language-text\\\">create</code> 액션은 다음과 같이 작성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/controllers/books/create.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Controllers</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Create</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Action</span>\\n\\n    expose <span class=\\\"token symbol\\\">:book</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">call</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token variable\\\">@book</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BookRepository</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:book</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n\\n      redirect_to routes<span class=\\\"token punctuation\\\">.</span>books_path\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>이후 생성된 폼에 새로운 책을 등록해보니 문제없이 책이 생성되었다.</p>\\n<h3 id=\\\"유효성-검사\\\"><a href=\\\"#%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%82%AC\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>유효성 검사</h3>\\n<p>하나미는 유효성 검사를 모델이 아닌 컨트롤러 액션에서 처리한다. 물론 엔티티 클래스에 유효성 검사를 정의할 수 있지만, 유효성 검사는 입력 이후 가장 가까운 단계에서 이루어질 것을 권장하고 있다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/controllers/books/create.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Controllers</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Create</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Action</span>\\n\\n    expose <span class=\\\"token symbol\\\">:book</span>\\n\\n    params <span class=\\\"token keyword\\\">do</span>\\n      <span class=\\\"token function\\\">required</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:book</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>schema <span class=\\\"token keyword\\\">do</span>\\n        <span class=\\\"token function\\\">required</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:title</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filled</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:str?</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token function\\\">required</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:author</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filled</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:str?</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">call</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">if</span> params<span class=\\\"token punctuation\\\">.</span>valid<span class=\\\"token operator\\\">?</span>\\n        <span class=\\\"token variable\\\">@book</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BookRepository</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:book</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n\\n        redirect_to routes<span class=\\\"token punctuation\\\">.</span>books_path\\n      <span class=\\\"token keyword\\\">else</span>\\n        <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span>status <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">422</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">params</code> 로 시작하는 유효성 검사는 엔티티를 정의해놓은 것 같은 역할을 할 수 있겠다. 자세한 내용은 <a href=\\\"http://hanamirb.org/guides/actions/parameters/\\\">가이드</a>를 참고하면 손쉽게 작성할 수 있다.</p>\\n<p>만약 패러매터가 유효하지 않다면 HTTP 상태 코드 422(Unprocessable Entity)를 리턴하고, 그에 알맞는 뷰를 다시 표현해 주어야 한다. 현재 <code class=\\\"language-text\\\">create</code> 액션에는 아무런 템플릿도 작성되어있지 않고, 실제로는 <code class=\\\"language-text\\\">new</code> 템플릿을 그대로 사용하면 되기 때문에 뷰 파일에 알맞는 템플릿을 정의해주면 된다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/views/books/create.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Views</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Create</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">View</span>\\n    template <span class=\\\"token string\\\">'books/new'</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>지금까지 하나미를 통해 간단한 웹 애플리케이션을 개발하는 과정을 살펴보았다. 아주 기초적인 부분만 설명하였지만, 가이드를 살펴보고 하나미의 기능에 조금 더 익숙해진 뒤에는 github에 올라와 있는 몇몇 프로젝트 소스를 살펴보면서 하나미를 파악해보는 것을 추천한다.</p>\\n<p>개인적으로 <a href=\\\"https://github.com/bruz/bookshelf-delivery-example\\\">이 Github 저장소</a>를 방문해 보는 것을 추천한다. 하나미의 컨테이너 구조 및 컨트롤러 액션과 비지니스 로직을 구분하는 예를 잘 보여준 코드로 구성되어있다.(<code class=\\\"language-text\\\">lib</code> 폴더 안에 있는 <code class=\\\"language-text\\\">interactors</code> 폴더에 주목하라)</p>\\n<p>본 포스팅에 사용된 코드는 <a href=\\\"https://github.com/emaren84/hanami-introduction\\\">여기서</a> 확인해 볼 수 있다.</p>\\n<h2 id=\\\"결론\\\"><a href=\\\"#%EA%B2%B0%EB%A1%A0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>결론</h2>\\n<p>루비는 일반적 용도의 언어로써 충분히 완성도가 있는 언어이지만 상대적으로 다양한 분야에서 사용되는 파이썬에 비해 어느샌가 웹 개발에만 쓰이는 언어라는 선입견이 심어지게 되었다. 그리고 이러한 선입견의 중심엔 레일즈가 있다.</p>\\n<p>레일즈가 등장하고 루비라는 언어가 크게 알려지는 데 기여한 것은 사실이다. 하지만 이 세상에 특정 문제 해결을 위한 단 하나의 정답은 거의 없다. 루비라는 언어 자체도 하나의 문제를 해결 하는데 다양한 방법을 제시하는 언어이기도 하다.</p>\\n<p>하나미의 등장도 이런 맥락에서 바라볼 수 있다. 단순히 레일즈만이 루비로 웹 애플리케이션을 만드는 최고의 방법이 아니며, 하나미를 잘 활용하면 레일즈에 비해 유지보수가 쉽고, 더 성능이 좋은 웹 애플리케이션을 작성할 수도 있을 것이다.</p>\\n<p>물론 하나미는 나온지 얼마 되지 않은 프레임워크이고, 기능 구현이 레일즈에 비해 상대적으로 부족한 점도 있다. <strong>특히 문서화가 되어있지 않아 소스 코드를 이리저리 살펴보아야 하는 부분들이 아직 많이 있다는 점이 아쉽다.</strong> 하지만 충분한 발전 가능성을 지니고 있고, 진정 루비라는 언어로 프로그래밍을 하는 재미를 주는 것이 매력적이기 때문에 루비 언어 자체를 좋아하는 사람들이라면 한번 사용해 볼 것을 추천한다.</p>\\n<p>하나미의 정보를 더 얻고자 하는 분들에게는 다음의 링크를 살펴보면 된다.</p>\\n<ul>\\n<li><a href=\\\"http://hanamirb.org/guides/\\\">하나미 공식 가이드</a> + <a href=\\\"https://github.com/hanami/hanami\\\">소스 코드</a></li>\\n<li><a href=\\\"https://gitter.im/hanami/chat\\\">하나미 Gitter 채팅방</a></li>\\n<li><a href=\\\"https://github.com/davydovanton/awesome-hanami\\\">유용한 젬 및 링크 공유</a></li>\\n</ul>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-12-03-hanami-introduction/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-12-03\",\"path\":\"/posts/hanami-introduction\",\"title\":\"레일즈(Ruby on Rails)와는 또 다른 루비 웹 프레임워크, Hanami(하나미)\",\"tags\":[\"Ruby\",\"Rails\",\"Hanami\"],\"category\":\"Hanami\"}},{\"excerpt\":\"MealMeetUpTask 구현 이번엔 개별 구성원의 상태를 변경해주는 메서드를 작성해야 한다.\\n유저의 정보를 받고, 그 사람의 MealLog를 업데이트 해 주고, 마지막으로 MealMeetUpTask도 업데이트 해 주는 과정으로 이어질 것이다. Task - menu 작업을 하기에 앞서 작성해놓은 API…\",\"html\":\"<h2 id=\\\"mealmeetuptask-구현\\\"><a href=\\\"#mealmeetuptask-%EA%B5%AC%ED%98%84\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MealMeetUpTask 구현</h2>\\n<p>이번엔 개별 구성원의 상태를 변경해주는 메서드를 작성해야 한다.\\n유저의 정보를 받고, 그 사람의 MealLog를 업데이트 해 주고, 마지막으로 MealMeetUpTask도 업데이트 해 주는 과정으로 이어질 것이다.</p>\\n<h3 id=\\\"task---menu\\\"><a href=\\\"#task---menu\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Task - menu</h3>\\n<p>작업을 하기에 앞서 작성해놓은 API에 더 부족한 부분은 없는지 고려해보기로 하였다.\\n(지금도 충분히 미완성이지만) 여태까지의 구현은 대부분 이 명세서를 보고 똑같이 데이터가 들어오면 저장을 하고, 같은 형태로 자료를 내보내는 데 초점을 맞추고 있었기 때문이다.\\n하지만 명세서만 보고 맹목적으로 기능구현을 하다가 중복 처리 등을 놓치는 실수를 하게 되었으니 조심해야 한다.</p>\\n<p>메뉴를 등록하는 과정을 순서대로 구성해보면 이런 방식으로 이루어질 것이라 예상한다.</p>\\n<ol>\\n<li>패러미터의 유효성을 검사한다 -> 400 or 401에러</li>\\n<li>유효한 패러미터임이 확인되면 MeetUp을 조회한다</li>\\n<li>MeetUp에 해당 유저가 있는지 조회한다 -> 없다면 400에러</li>\\n<li>유저가 존재하면 MealLog와 Task를 업데이트한다.</li>\\n<li>업데이트한 데이터를 기반으로 리턴 데이터(JSON)를 어댑터로 내보낸다.</li>\\n</ol>\\n<p><em>과정을 떠올리면서 갑자기 생각난 것이 왠지 <code class=\\\"language-text\\\">meetup#create</code> 하면서 이미 등록된 User가 맴버로 들어갔을 때 해당 MeetUp에 연결되는 새로운 Log와 Task를 생성하고 연결해주는 작업을 제대로 수행했는지 잘 기억이 안난다. 나중에 확인해봐야겠다.</em></p>\\n<p>4번의 경우에는 테이블 구조가 생각보다 복잡하게 얽혀 있다는 점을 감안하여 User, Log, Task 테이블들을 <code class=\\\"language-text\\\">join</code> 한 다음 <code class=\\\"language-text\\\">user_id</code>, <code class=\\\"language-text\\\">meal_meet_up_id</code> 가 일치하는 Log, Task를 검색하고 갱신하도록 만들면 될 것이라고 생각한다.\\n지금이야 적은 데이터를 다루니까 굳이 테이블을 조인해가면서 검색할 필요가 없다고 여길 수도 있지만, 만약에 사용성이 있어서 한 유저가 여러번 사용을 한 다고 가정하면 한 유저가 각기 다른 MeetUp에 등록되는 일이 당연히 있을 것이다. 그 부분을 간과하지 않도록 노력해야겠다.</p>\\n<hr>\\n<p>먼저 패러미터의 유효성을 검사하는 부분을 생각하다 보니, 기존에 있던 패러미터 검사 메서드들은 패러미터를 두개씩 검사하였지만, 이번에는 검사할 패러미터가 늘어났다(3~4개).\\n거기다 메뉴를 추가하는 액션과 status만 업데이트하는 액션은 검사할 패러미터가 다르기에 하나의 <code class=\\\"language-text\\\">check_params</code> 메서드로 모든 조건을 만족할 수는 없게 되었다. 패러미터마다 일일이 <code class=\\\"language-text\\\">empty?</code> 를 넣어 확인해보고, 그걸 <code class=\\\"language-text\\\">and</code> 나 <code class=\\\"language-text\\\">or</code> 로 줄줄이 잇는 것은 꽤 복잡하고 불필요한 작업이다.</p>\\n<p>그런데 구현하면서 전보다 조금은 나은 형태로 검사를 할 수 있는 아이디어가 떠올랐다. 검사할 패러매터들을 전부 배열에 넣은 뒤에 경우에 따라 <code class=\\\"language-text\\\">any?</code> 혹은 <code class=\\\"language-text\\\">all?</code> 메서드를 사용하여 검사를 하는 것이다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># 기존 검사방법</span>\\n<span class=\\\"token keyword\\\">def</span> params_valid<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token operator\\\">!</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n        <span class=\\\"token operator\\\">!</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_ids</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> params_authorizable<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token operator\\\">!</span>email_invalid<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n        <span class=\\\"token operator\\\">!</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token comment\\\"># 새로운 검사방법</span>\\n<span class=\\\"token keyword\\\">def</span> params_valid<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token punctuation\\\">[</span>task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:price</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:menu</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>all<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">|</span>e<span class=\\\"token operator\\\">|</span> <span class=\\\"token operator\\\">!</span>e<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> params_authorizable<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token operator\\\">!</span>email_invalid<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token punctuation\\\">[</span>task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n        task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>all<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">|</span>e<span class=\\\"token operator\\\">|</span> <span class=\\\"token operator\\\">!</span>e<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>여러번 반복할 일을 많이 줄여서 조금이 더 깔끔한 코드가 작성되었다.</p>\\n<p>다음은 메뉴를 기록하고 Task의 상태를 업데이트 하기 위해 필요한 정보들을 조회하고, 정보가 존재하는지 찾아야한다.\\n해당 MeetUp을 찾는 것은 당연하고, User와 조합하여 찾는 Log, Task가 있는지 찾아야한다. 이 작업은 joins를 사용하면 될 것으로 생각하고, 콘솔에서 연습삼아 데이터 조회를 시도해보았다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">tasks = MealMeetUpTask.joins(:meal_meet_up, :meal_log) # has_many, belongs_to에 따라 단수, 복수 유의\\ntasks.where(meal_meet_ups: { id: 1}, meal_logs: { user_id: 4} ) # 자료추출 성공. 두 값에 모두 해당하는 task만 나온다.\\n\\nlogs = MealLogs.joins(:user, :meal_meet_up_tasks)\\nlogs.where(meal_meet_up_tasks: { meal_meet_up_id: 1 }, users: { id: 1 })</code></pre>\\n      </div>\\n<p>이런식으로 자료를 가져와서 기록하면 될 것으로 보인다. 예시로 작성해본 join은 저렇게 광범위하게 하기 보단, 특정 MeetUp, 특정 User를 찾도록 먼저 where를 입력한 뒤에 <code class=\\\"language-text\\\">joins</code> 를 사용하면 더욱 효과적일 것이다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">MealLog.where(user_id: 1).joins(:meal_meet_up_tasks).where(meal_meet_up_tasks: {meal_meet_up_id: 1})</code></pre>\\n      </div>\\n<hr>\\n<p>마지막 기록을 하고 잠시 작업을 손 못 대고 있다가 다시 시작하려니 개념을 많이 잊어버서 꽤 혼란스러웠다.\\n다시 복습삼아 노트에 적어보니 Log를 찾으려면 다음과 같은 생각들이 떠올랐다.</p>\\n<ul>\\n<li>Log와 Task는 1:1 관계이다</li>\\n<li>User와 MeetUp 정보만으로 Log와 Task를 찾는 과정이 조금 복잡하다</li>\\n</ul>\\n<p>일단 Log 모델에서 <code class=\\\"language-text\\\">has_many</code> 로 관계를 설정해 둔 것을 <code class=\\\"language-text\\\">has_one</code> 으로 변경하였다.\\nLog를 먼저 찾아야 할지 Task를 먼저 찾아야 할지가 문제인데 Log를 먼저 찾는 시나리오를 떠올려 보기로 했다.</p>\\n<ol>\\n<li>User1이 MeetUp1에 등록되어있다. MeetUp에 User1이 등록될 때 Log1, Task1을 생성하였다.</li>\\n<li>MealMeetUpTask 컨트롤러에서는 User1의 id와 MeetUp1의 id를 패러미터로 넘긴다.</li>\\n<li>여기서 User1이 가진 Log 중 Log의 Task를 조회한다. 어떻게 조회하냐면 Task의 meet<em>up</em>id가 1인 로그를 가져오는 것이다. Log-Task는 1:1 관계이기 때문에 그렇게 복잡하지 않다.</li>\\n<li>Log를 업데이트 하고 나면 연결된 Task를 업데이트한다.</li>\\n</ol>\\n<p>가정을 실험해 보기 위해 MeetUp을 두개 생성하고 같은 맴버들을 집어넣으려고 했는데 새 MeetUp에는 맴버가 한명도 들어가지 않는 오류가 발생해서 이를 먼저 해결해야겠다.</p>\\n<hr>\\n<h3 id=\\\"맴버-등록-버그-수정\\\"><a href=\\\"#%EB%A7%B4%EB%B2%84-%EB%93%B1%EB%A1%9D-%EB%B2%84%EA%B7%B8-%EC%88%98%EC%A0%95\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>맴버 등록 버그 수정</h3>\\n<ul>\\n<li>MeetUp를 여러 개 생성하고 나서 같은 맴버를 다른 MeetUp에 등록할 시 등록이 안된다.</li>\\n<li>MeetUp에 맴버를 등록할 때 만약에 해당 맴버가 없으면 User의 <code class=\\\"language-text\\\">init_member</code> 메서드로 연결되는데, 이 메서드는 단순히 전체 DB에서 중복되는 맴버가 있는지 검사하고 아예 없을때만 User를 새로 생성하는 역할을 한다.</li>\\n<li>문제를 해결하려면 DB에 같은 맴버가 있지만 다른 MeetUp에 등록할 시 처리를 따로 해 주어야겠다.</li>\\n</ul>\\n<p>모델 구조가 내가 생각하던 것 보다 복잡하다보니 문제 해결을 위한 아이디어가 바로 떠오르지 않는게 아쉽다. 유저를 등록할 때의 경우의 수를 다시 상정해보면</p>\\n<ul>\\n<li>Meetup과 member를 모두 처음 등록하는 경우: 문제 없음. 그냥 해당 MeetUp의 Task 명단에 맴버가 없으니 바로 새로운 User > Log > Task 생성</li>\\n<li>Meetup 한개에 Member가 추가 등록되는 경우: 문제 없음. DB에 등록되어 있지 않은 User면 똑같이 User > Log > Task 생성</li>\\n<li>MeetUp 갯수에 상관 없이 DB에 등록된 적 있는 User를 등록하려고 할 때: 이 때가 문제. 현재는 단순히 User가 존재하지 않으면 새로 생성하는것 까지만 한다.</li>\\n</ul>\\n<p>그럼 세번째 문제를 해결하기 위해 필요한 것은 <strong>User가 있는지 검사하고</strong>, <strong>있다면 해당 User가 MeetUp에 등록되어있는지 검사하고</strong>, <strong>MeetUp에 등록되어있지 않다면 해당 MeetUp과 연결되는 Log, Task를 생성</strong> 하는 과정일 것이다.</p>\\n<p>결국 User 모델을 조금 수정해주어서 해결할 수 있었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token comment\\\"># 새로운 맴버 등록시 필요한 일련의 과정들</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">if</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n      result <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">enroll_new_user</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">elsif</span> user <span class=\\\"token operator\\\">&amp;&amp;</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n      result <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">enroll_exist_user</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    result <span class=\\\"token comment\\\"># Admin 등록을 위해 user정보가 리턴되어야 함</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  <span class=\\\"token comment\\\"># DB에 기록되어있지 않은 맴버를 새로 생성</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">enroll_new_user</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  <span class=\\\"token comment\\\"># DB에 등록된 적 있는 맴버가 새로운 MeetUp에 등록되는 경우</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">enroll_exist_user</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token comment\\\"># 해당 user의 MeetUp등록 여부를 찾기 위해 Log > Task 연결하여 검색</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup_id<span class=\\\"token punctuation\\\">)</span>\\n    meal_logs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">joins</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:meal_meet_up_task</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">where</span><span class=\\\"token punctuation\\\">(</span>meal_meet_up_tasks<span class=\\\"token punctuation\\\">:</span>\\n                                              <span class=\\\"token punctuation\\\">{</span> meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup_id <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>MeetUp에 User가 등록되어있는 지 여부는 MeetUp에 속한 Task가 있는지 여부로 구분하였다. 맴버가 등록된 적이 없으면 MeetUp에 해당하는 Log, Task를 작성한 적이 없을 테니까.\\n수정해놓고 중간에 admin 등록하는 부분이 꼬이긴 했는데 해당 user를 반드시 리턴해주어야 그 정보로 admin을 등록하도록 설정해 두었기 때문이다.</p>\\n<p><code class=\\\"language-text\\\">find_enrolled_meetup</code> 메서드가 실제로 User 모델과는 관련이 좀 적어보이지만, 적어도 User에 등록된 Log를 가져오는 것 부터 시작하니 괜찮을 것이다.</p>\\n<h3 id=\\\"다시-task---menu\\\"><a href=\\\"#%EB%8B%A4%EC%8B%9C-task---menu\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>다시 Task - Menu</h3>\\n<p>버그를 수정하면서 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 을 만들어서 뜻밖의 밑작업이 완료되었으니 나머지는 실질적으로 메뉴 추가가 가능하도록 만들면 된다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># meet_up_tasks_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> menu\\n    <span class=\\\"token variable\\\">@meetup</span> <span class=\\\"token operator\\\">=</span> find_meetup\\n    <span class=\\\"token variable\\\">@meal_log</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update_menu</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">,</span> task_params<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_201</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">menu_response</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meal_log</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n<span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update_menu</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">,</span> user_info <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\"># 해당 MeetUp에 속하는 MealLog</span>\\n    user_log<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>menu_name<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:menu</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> price<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:price</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    user_log\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>그런데 이상하게 정보 업데이트가 되지 않는 문제가 있어서 확인해보니 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 의 결과가 배열로 리턴되는 것이었다. 어차피 나올 값은 하나밖에 없는데..\\n알고보니 결과를 검색할 때 <code class=\\\"language-text\\\">where</code> 를 사용하면 배열로 리턴되고, <code class=\\\"language-text\\\">find_by</code> 를 쓰면 검색 결과의 첫 번째 결과를 리턴한다고 한다. 막연하게 결과값이 하나만 나오는 건 알고 있었는데 이제 제대로 활용해야지.</p>\\n<p>결과값을 리턴하는 JSON을 만들 때 기존에는 해당하는 값을 일일이 DB에서 꺼내오는 방식의 메서드를 작성했었는데, 막상 '굳이 그럴 필요가 있나?' 라는 생각이 들었다. 멘토님은 '어떻게 구현하는게 좋은 설계일까?' 고민해보고 실제 상황이 닥치면 그 상황에 맞는 최적의 솔루션을 도출하는 연습이 필요하다고 조언해주셨다.</p>\\n<p>지금 당장은 이정도 검색을 한다고 부하가 걸리는 수준이 아니고 나중에 변화가 생길 수도 있는 점을 고려하여 기존 방식대로 DB에서 해당 값을 가져오는 방식을 택했다.</p>\\n<h3 id=\\\"api-명세-수정\\\"><a href=\\\"#api-%EB%AA%85%EC%84%B8-%EC%88%98%EC%A0%95\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>API 명세 수정</h3>\\n<p>야밤의 토론을 통해 API 명세가 좀 문제가 있다는 점을 깨달았다. 애초에 이메일을 패러미터로 받을 필요가 별로 없고, 메신저 종류와 <code class=\\\"language-text\\\">service_uid</code> 를 기본으로 받는 형태로 DB 구조와 현재 메서드를 전부 수정해야한다.</p>\\n<p>명세서는 수정하였고, DB는 딱히 수정하지 않고 내부 로직만 변경하여도 충분할 것 같다.</p>\\n<p>API를 좀 다듬어서 작성하고 나니 코드를 변경하는게 쉬워졌는데, 작성하는 코드에 일관성이 부여되기 때문이다.\\n패러미터의 유효성을 검사하는 부분과, MeetUp을 검색하는 메서드를 <code class=\\\"language-text\\\">application_controller</code> 하나에 두고 관리할 수 있게 되었다.\\n또한 <code class=\\\"language-text\\\">routes.rb</code> 에 미리 <code class=\\\"language-text\\\">format</code> 을 json으로 지정해두어서 일일이 <code class=\\\"language-text\\\">respond_to</code> 를 사용하지 않고 오류 경우의 수에 따라 에러 메세지를 각기 다르게 출력할 수 있도록 변경하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># application_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> find_meetup\\n    <span class=\\\"token variable\\\">@meetup</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealMeetUp</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>messenger_room_id<span class=\\\"token punctuation\\\">:</span>\\n                                 params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:data</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n\\n<span class=\\\"token comment\\\"># members_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n    <span class=\\\"token keyword\\\">def</span> check_meetup\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">!=</span> <span class=\\\"token string\\\">'created'</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot add members to this meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'there is no member to enroll'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>이런식으로 find_meetup은 어느 컨트롤러에서 호출하여 같은 결과값을 얻고, 경우의 수에 따라 다른 에러를 표시하도록 적용하였다.</p>\\n<h3 id=\\\"task---update\\\"><a href=\\\"#task---update\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Task - Update</h3>\\n<p>Update 액션은 menu를 만들 때 미리 작성해둔 메서드들 덕에 생각보다 금방 완성되었다.\\nUser 모델에 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 을 사용하면 해당 유저와 유저가 참여한 MeetUp에 맞는 MealLog를 가져온다. 거기에 바로 1:1로 연결되어있는 Task를 꺼내고, 그 Task를 업데이트 해주는 식으로 코드를 작성하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update_task_status</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">,</span> user_info <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    task_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_task_status</span><span class=\\\"token punctuation\\\">(</span>user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    task <span class=\\\"token operator\\\">=</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>meal_meet_up_task\\n    task<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    task\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"맴버-삭제-기능-추가\\\"><a href=\\\"#%EB%A7%B4%EB%B2%84-%EC%82%AD%EC%A0%9C-%EA%B8%B0%EB%8A%A5-%EC%B6%94%EA%B0%80\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>맴버 삭제 기능 추가</h2>\\n<p>처음에 미처 계획에 없었던 'MeetUp에 추가된 맴버를 삭제하는 기능'을 추가하기로 하였다.\\n어찌 보면 당연히 있어야 하는 기능인데 실수로 넣지 않았다고 생각하는 쪽이 빠를 수도 있겠다.</p>\\n<p>맴버를 MeetUp에서 삭제하는 것은 유저를 통채로 삭제할 필요는 없겠지만, 해당하는 MealLog, MeetUpTask는 삭제해줄 필요가 있겠다. 만약에 다시 등록할 때는 새로 만들어줘야 하는게 맞다고 생각하니까.</p>\\n<p>기존에 구현해 둔 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 을 사용하면 해당 MeetUp에 속해있는 MealLog가 리턴되니까 이 로그를 삭제하도록 하고, 로그에 연결된 Task도 자동으로 삭제되도록 조치해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/meal_log.rb</span>\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MealLog</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Base</span>\\n  has_one <span class=\\\"token symbol\\\">:meal_meet_up_task</span><span class=\\\"token punctuation\\\">,</span> dependent<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:destroy</span>\\n  belongs_to <span class=\\\"token symbol\\\">:user</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>맴버 삭제를 하기 전에 패러미터에 따라 고려해야 할 사항은 다음과 같다.</p>\\n<ul>\\n<li>해당하는 MeetUp이 존재하는가?</li>\\n<li>admin_uid가 입력되었는가? -> 오류(admin은 삭제 불가능)</li>\\n<li>삭제하고자 하는 맴버가 해당 MeetUp에 등록되어 있는가?</li>\\n</ul>\\n<p>위 조건을 모두 만족한다면 정상적으로 해당 유저의 MealLog, Task를 삭제해주면 될 것이다.</p>\\n<p>맴버를 추가할 때와 삭제할 때 한꺼번에 패러미터를 검사하는 메서드를 만들면 좋겠는데, 약간 차이가 있기 때문에 조금 비슷한 부분이 있더라도 따로 작성하게 되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># members_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> delete_member\\n    target_member <span class=\\\"token operator\\\">=</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s\\n    <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">delete_member</span><span class=\\\"token punctuation\\\">(</span>target_member<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_200</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">member_response</span><span class=\\\"token punctuation\\\">(</span>find_meetup<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token comment\\\"># ...</span>\\n    <span class=\\\"token keyword\\\">def</span> check_add_member\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">!=</span> <span class=\\\"token string\\\">'created'</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot add members to this meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'there is no member to enroll'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> check_delete_member\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      member_id <span class=\\\"token operator\\\">=</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>service_uid <span class=\\\"token operator\\\">==</span> member_id\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot delete admin member'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> <span class=\\\"token function\\\">get_members_list</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>member_id<span class=\\\"token punctuation\\\">)</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find the member_id in this meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n               status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n\\n<span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">delete_member</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    target_log <span class=\\\"token operator\\\">=</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    target_log<span class=\\\"token punctuation\\\">.</span>destroy\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>얼떨결에 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 메서드가 대부분의 문제를 손쉽게 해결해주었다. 단순하게 joins 구문만 적절하게 이용해 주었을 뿐인데. MealLog에 설정해둔 <code class=\\\"language-text\\\">dependency</code> 도 잘 작동하였다.</p>\\n<h2 id=\\\"입력받은-가격을-분배하기\\\"><a href=\\\"#%EC%9E%85%EB%A0%A5%EB%B0%9B%EC%9D%80-%EA%B0%80%EA%B2%A9%EC%9D%84-%EB%B6%84%EB%B0%B0%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>입력받은 가격을 분배하기</h2>\\n<p>이 앱의 제일 핵심기능인 'n빵 / 각자 입력하여 얼마를 내야 하는지 알리기' 기능이 여태까지 빠져 있었다.</p>\\n<ul>\\n<li>n빵 / 각자 입력을 나누는 스테이터스 코드</li>\\n<li>MeetUp의 total<em>price가 없으면 맴버의 메뉴 등록을 막기 (먼저 total</em>price가 등록되어있어야함)</li>\\n<li>모든 맴버가 가격 입력을 완료하면 MeetUp의 상태를 <code class=\\\"language-text\\\">completed</code> 로 변경</li>\\n</ul>\\n<p>이런 기능이 추가적으로 구현될 필요가 있는데 먼저 코드테이블에 자료를 입력하는 seed파일을 수정하여 price를 지우고 <code class=\\\"language-text\\\">price_avg</code>, <code class=\\\"language-text\\\">price_sep</code> 두 가지 상태로 나누었다.</p>\\n<p>그리고 MeetUp을 업데이트 할 때 <code class=\\\"language-text\\\">price_avg</code> 상태일 때만 N빵 가격을 계산해서 각각 유저들의 Log에 해당 가격을 입력하도록 만들어 두었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/meal_meet_up.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">update_status</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">,</span> meetup_status<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">if</span> meetup_status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'price_avg'</span>\\n      <span class=\\\"token function\\\">price_avg</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n      <span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">:</span> total_price<span class=\\\"token punctuation\\\">.</span>to_i<span class=\\\"token punctuation\\\">,</span>\\n             meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_meetup_status</span><span class=\\\"token punctuation\\\">(</span>meetup_status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">price_avg</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">)</span>\\n    avg_price <span class=\\\"token operator\\\">=</span> total_price <span class=\\\"token operator\\\">/</span> meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span>count\\n    meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">each</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>task<span class=\\\"token operator\\\">|</span>\\n      task<span class=\\\"token punctuation\\\">.</span>meal_log<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>price<span class=\\\"token punctuation\\\">:</span> avg_price<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>모든 맴버가 가격을 입력하도록 하는 메서드는 맴버가 상태를 업데이트 하는 메서드 마지막 부분에 따로 심어두었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/meal_meet_up_task.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> check_completed\\n    result <span class=\\\"token operator\\\">=</span> meal_meet_up<span class=\\\"token punctuation\\\">.</span>meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span>all<span class=\\\"token operator\\\">?</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>task<span class=\\\"token operator\\\">|</span>\\n      task<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'paid'</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    completed_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_meetup_status</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'completed'</span><span class=\\\"token punctuation\\\">)</span>\\n    meal_meet_up<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">:</span> completed_code<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">if</span> result\\n  <span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3 id=\\\"n빵-분배하고-난-뒤에-고려하지-못한-것들\\\"><a href=\\\"#n%EB%B9%B5-%EB%B6%84%EB%B0%B0%ED%95%98%EA%B3%A0-%EB%82%9C-%EB%92%A4%EC%97%90-%EA%B3%A0%EB%A0%A4%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%9C-%EA%B2%83%EB%93%A4\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>n빵 분배하고 난 뒤에 고려하지 못한 것들</h3>\\n<ul>\\n<li>MeetUp의 상태가 <code class=\\\"language-text\\\">price_avg</code> 일 때 개별 맴버들이 메뉴를 수정하는 것을 차단해야했다</li>\\n<li>맴버들이 가격만 수정하려고 하는데도 메뉴도 입력하라는 오류가 발생</li>\\n<li>상태 업데이트 없이 MeetUp의 현재 상태를 점검할 수 있도록 하는 API 추가</li>\\n</ul>\\n<p>점점 처리해야하는 에러 경우의 수들이 늘어나면서 rubocop에 걸리기가 쉬워지고 있다.\\n에러 처리도 파트별로 나누어야 할지, 더 쪼갤 수 있는 방법이 있을지 고민해보아야 할 것 같다.</p>\\n<p>위 두가지 버그성 문제들은 생각보다 간단하게 해결할 수 있었다. 첫 번째 문제와 두 번째 문제 모두 필터에서 걸러내는 경우의 수를 약간 조정해주는 정도로 해결되었고, 마지막 문제도 MeetUp을 그대로 조회하여 보여주기만 하면 되기 때문에 금방 처리하였다.</p>\\n<p>이후에는 새 맴버를 추가받지 못하도록 고려하는 타이밍이 언제 이루어져야 하는가에 대한 문제가 있었는데</p>\\n<ul>\\n<li>세팅이 끝났다는 커맨드를 직접 날리려서 처리하거나 (DB에 새로운 필드 추가)</li>\\n<li>맴버 추가가 잠기는 시점을 변경 (기존엔 MeetUp 상태가 'created'일 때만 맴버 추가 가능)</li>\\n</ul>\\n<p>조금 돌아가는 길이더라도 첫 번째가 깔끔하게 될 것이라 생각되어 새로운 필드 <code class=\\\"language-text\\\">member_fixed</code> 를 MeetUp 모델에 추가하고, 메서드 수정을 가하기로 했다.</p>\\n<ul>\\n<li>MeetUp 모델에 member_fixed (BOOL) 필드 추가</li>\\n<li>새 MeetUp 생성시 member_fixed (default false)</li>\\n<li>MeetUp 모델 Update시 member_fixed 값 확인하도록 수정 (없으면 에러)</li>\\n<li>맴버 등록 할 때 member_fixed가 true이면 에러 출력</li>\\n<li>맴버 삭제시엔 굳이 그 여부 확인 안해도 될듯</li>\\n</ul>\\n<p>이렇게 비교적 간단히 해결할 문제로 생각했으나 맴버가 변경되는 시점에 따라 자동으로 금액 재조정을 해 주어야 할지 이미 금액을 지불한 인원의 경우엔 상태를 어떻게 처리해야 할지 정책적인 부분을 고려할 필요가 있어서 생각보다 굉장히 복잡한 문제였다.</p>\\n<p>아마 초기에 기획, 설계 회의를 할 때 이 문제가 도마에 올랐었다가 얼렁뚱땅 미루어진 것 같았는데, 이번 작업에는 결국 수정을 포기하는 쪽으로 가기로 했다.</p>\\n<p>자잘한 버그를 잡으면서 또 뼈저리게 느낀건데 패러미터로 들어온 타입과(보통 String) 내가 처리하려고 하는 타입(예를 들면 Integer)이 다르면 형변환을 제때제때 해 주어야 하는 것을 잊으면 안되겠다. 자꾸 그런 부분에서 버그가 발생하고 있다.</p>\\n<p>또 발견된 버그는 총 금액보다 큰 값을 개별 맴버가 입력하려할 때 차단하는 수단이 없다는 점이다. 매번 발견되는 버그들에는 공통점이 있는데, 당장의 기능은 구현이 되어 있는데 유저가 프로그램 내부가 돌아가는 것을 고려하지 않고 자연스럽게 사용하다가 발생할 수 있는 모든 경우의 수를 전혀 고려하지 않고 있다는 점이다.</p>\\n<blockquote>\\n<p>음… 사실 그게 가장 고통스러우면서도 꼭 해야되는 부분입니다.\\n머리에 쥐날때까지 모든 케이스를 다 고려할 수 있는 훈련을 계속해야 고급 개발자가 될 수 있죠.</p>\\n</blockquote>\\n<p>팀원분이 이런 조언을 해주셨으니 기능 하나를 구현할 때 그로 인해 발생할 수 있는 경우의 수를 최대한 고려해보도록 노력해야겠다.</p>\\n<h2 id=\\\"meetup-상태-열람-show\\\"><a href=\\\"#meetup-%EC%83%81%ED%83%9C-%EC%97%B4%EB%9E%8C-show\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MeetUp 상태 열람 (Show)</h2>\\n<p>가격 분배 기능 구현 하면서 MeetUp의 상태를 열람하는 기능이 필요하다는 피드백이 있어 간단하게 구현을 했었다.\\n그런데 그 정도로는 부족하고 MeetUp이 있으면 관련된 모든 정보를 가져오도록 수정해야할 필요가 있었다.</p>\\n<p>또한 <code class=\\\"language-text\\\">paying_sep</code>, <code class=\\\"language-text\\\">paying_avg</code> 로 구분중이었던 지불 방법을 다른 필드로 분리해서 관리해야할 필요성도 발생하였다.</p>\\n<p>먼저 MeetUp 모델에 <code class=\\\"language-text\\\">pay_type</code> 컬럼을 추가하였다. 그리고 이번에는 CodeTable에 굳이 조회용 코드를 추가하지 않았는데, 이렇게 하는게 결국은 의미가 없다고 생각했기 때문이다.\\n애초에 입력값은 직접 String으로 받고, 검색도 그 String으로 하고, 저장만 id로 하고 있는건데 저장 부분에선 약간 효율적일 수 있겠으나 검색 부분엔 큰 차이가 없어보였기 떄문이다.</p>\\n<p><code class=\\\"language-text\\\">pay_type</code> 가 추가되면서 적어도 확실한건 MeetUp을 Update 하는 상태는 변경되어야 한다는 점이다. 그리고 status가 <code class=\\\"language-text\\\">paying</code> 일 때에는 반드시 <code class=\\\"language-text\\\">pay_type</code>가 있도록 만들어야겠다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># meal_meet_up_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n    <span class=\\\"token comment\\\"># 해당하는 meetup이 없거나 admin_uid가 불일치, pay_type이 올바르지 않으면 에러</span>\\n    <span class=\\\"token keyword\\\">def</span> check_meetup_update\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>service_uid <span class=\\\"token operator\\\">!=</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:admin_uid</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'invalid admin_uid'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">401</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'paying'</span> <span class=\\\"token operator\\\">||</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'paying'</span>\\n        validate_pay_type\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> validate_pay_type<span class=\\\"token operator\\\">?</span>\\n      <span class=\\\"token keyword\\\">unless</span> <span class=\\\"token string\\\">%w(n s)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:pay_type</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token function\\\">render_error_400</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'invalid pay type'</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>Show로 리턴하는 정보는 기본적으로 update시의 리턴+딸려있는 맴버들의 각종 정보이다. 그래서 먼저 update시의 리턴 정보를 가져온 다음에 필요한 정보를 덧붙이는 형태로 만들었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># meal_meet_up_helper.rb</span>\\n<span class=\\\"token comment\\\"># 컨트롤러가 너무 커져서 리턴용 json을 출력하는 메서드들을 다 헬퍼 모듈로 옮겼다.</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">response_json_show</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span>\\n    basic_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">response_json_update</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span>\\n    members_info <span class=\\\"token operator\\\">=</span> meetup<span class=\\\"token punctuation\\\">.</span>meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span>map <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>task<span class=\\\"token operator\\\">|</span>\\n      log <span class=\\\"token operator\\\">=</span> task<span class=\\\"token punctuation\\\">.</span>meal_log\\n      <span class=\\\"token punctuation\\\">{</span> member_uid<span class=\\\"token punctuation\\\">:</span> log<span class=\\\"token punctuation\\\">.</span>user<span class=\\\"token punctuation\\\">.</span>service_uid<span class=\\\"token punctuation\\\">,</span>\\n        menu<span class=\\\"token punctuation\\\">:</span> log<span class=\\\"token punctuation\\\">.</span>menu_name<span class=\\\"token punctuation\\\">,</span>\\n        price<span class=\\\"token punctuation\\\">:</span> log<span class=\\\"token punctuation\\\">.</span>price<span class=\\\"token punctuation\\\">,</span>\\n        status<span class=\\\"token punctuation\\\">:</span> task<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    basic_data<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:data</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>members_count<span class=\\\"token punctuation\\\">:</span> members_info<span class=\\\"token punctuation\\\">.</span>count<span class=\\\"token punctuation\\\">,</span>\\n                            members<span class=\\\"token punctuation\\\">:</span> members_info<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-08-10-easylunch-api-devlog-3/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-08-10\",\"path\":\"/posts/easylunch-api-devlog-3\",\"title\":\"Easylunch Api 서버 제작기 - 3\",\"tags\":[\"Rails\"],\"category\":\"Rails\"}},{\"excerpt\":\"Members 구현 이번엔 생성된   에 새로운 맴버를 추가하는 기능을 구현할 것이다.\\n필요한 메서드는    하나 뿐이라 생각보다 복잡하진 않을 것이라 생각된다. 먼저 Members 컨트롤러를 생성한다. 그리고 routes.rb 파일에 api 경로를 추가해준다. 텅텅 빈 Members 컨트롤러에는 기본적으로 들어갈 메서드들이 있다. Strong parameters 맴버들을 등록하기 위한 정보가 충분한지 검사 기본적인 약속 (email…\",\"html\":\"<h2 id=\\\"members-구현\\\"><a href=\\\"#members-%EA%B5%AC%ED%98%84\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Members 구현</h2>\\n<p>이번엔 생성된 <code class=\\\"language-text\\\">MealMeetUp</code> 에 새로운 맴버를 추가하는 기능을 구현할 것이다.\\n필요한 메서드는  <code class=\\\"language-text\\\">add_members</code> 하나 뿐이라 생각보다 복잡하진 않을 것이라 생각된다.</p>\\n<p>먼저 Members 컨트롤러를 생성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">rails g controller Members</code></pre>\\n      </div>\\n<p>그리고 routes.rb 파일에 api 경로를 추가해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"># routes.rb\\n# ...\\npost &#39;/members&#39; =&gt; &#39;members#add_member&#39;, defaults: { format: &#39;json&#39; }</code></pre>\\n      </div>\\n<p>텅텅 빈 Members 컨트롤러에는 기본적으로 들어갈 메서드들이 있다.</p>\\n<ul>\\n<li>Strong parameters</li>\\n<li>맴버들을 등록하기 위한 정보가 충분한지 검사</li>\\n<li>기본적인 약속 (email, messenger) 정보가 제대로 작성되어 있는지 검사</li>\\n<li>해당하는 <code class=\\\"language-text\\\">messenger_room_id</code> 의 검색</li>\\n</ul>\\n<p>사실 Strong parameters를 제외한 나머지 기능들은 기존에 <code class=\\\"language-text\\\">MealMeetUp</code> 을 구현할 때 만들었던 메서드들을 거의 그대로 써도 될 것이다.\\n하지만 미묘한 차이가 있어서 지금은 새로 작성하고 나중에 리팩토링 할 때 합치기로 마음먹었다.</p>\\n<p>작업을 하다보니 조금 애매하게 생각되는 부분이 '멤버를 추가하면 DB에 어떻게 기록이 되어야 할까?' 라는 부분이다.</p>\\n<ol>\\n<li>json으로 member_id를 받고, 그 아이디로 새로운 유저를 생성한다.</li>\\n<li>그 유저에 해당하는 UserMessenger, UserLog를 생성한다.</li>\\n<li>UserLog에 속하는 MealMeetUpTask를 생성한다.</li>\\n<li>MealMeetUpTask의 meal<em>meet</em>up<em>id(외부키)는 현재 등록할 meal</em>meet_up으로 지정해준다.</li>\\n</ol>\\n<p>이렇게 하면 될 것 같은데, User의 컬럼을 <code class=\\\"language-text\\\">id(기본키) / email</code> 로 지정해둔게 걸린다. 보통 메신저에서 제공하는 user의 고유 식별 정보를 넣는데 써야 할 것 같은데, 슬랙의 경우엔 이메일이 아닌 듯 하여 아예 컬럼명을 수정해야겠다.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 790px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 55.52977571539057%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACE0lEQVQoz2VT2W4TQRDM/38EIEQiQpInIgI2DwihSBGXLzlrO7733vXa673m8KYorw9Afij1zKinprq650xKCSE0sUGWpfC8IaJoAsftw7IesVhMEARDxHEIpZgnBaPcQ+3xd38mpcZ0+huj0Xf4vg/DeI3J5Jy44NkbmPNLxlcwzQbKDSAFBRQaea6QJAXSVFTrPFOQkoRFIWHbQ6oYIQxXGA5JPm7CDwbw/D48RtfvwfHmWOcSM6uD0eQDK/iCyfQjpvMac75ibtVZmbUjzMhelqCKAZW9Z0IfmQShK+SqRJLnWEUJzEETxsMV5p072MYn2I+EUcOsfYtlYG4JBaXnFaHvD/D09JJK29AKhILWG+iNQhoniIKIuSmKVCJfC2TrghAVtvutHZVCz/Uo12FDZiy5Rc+6WIQOiW2emYiXK4hEYLmM6FmKZwCKLyotd1Ed4tbDTKPbqWEwegHLuYblXtOPS67f0bcbuMEVHHZbsezVaskHHLiuRaXrimA7JQdUhDnljxv3GH+7QdCoI2zVsWh/PsL7dQd3NkBElZblotu9ZTynPQYJnkkk/ics2PZ1EGMxD7CyQ0SmS3hYWt5+7dKjpLqQJhkb16LCe6q1SbA5VbiOYs7hT7b/AWE0hWZ3dKmJzRGH0nZDXPITlNXM/Ut2JEyTGK3mW/R6F7CtH9WvkWJfhhAnl+T+p5ye7wj/AFtbOpuebKd7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"기존에 작성된 DB 다이어그램\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-ffc88.png\\\"\\n        srcset=\\\"/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-d16f8.png 198w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-f21b1.png 395w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-ffc88.png 790w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-81e7e.png 1185w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-14df9.png 1293w\\\"\\n        sizes=\\\"(max-width: 790px) 100vw, 790px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<hr>\\n<p>슬랙에 팀원들의 의견을 물으니 UserMessenger 테이블에 email컬럼을 넣고, User의 email은 service_uid등으로 바꾸는게 좋겠다는 의견을 받았다.</p>\\n<p>그렇게 생각하니 애매하게 보이던 맴버 추가 개념이 조금 명쾌해졌고, DB 컬럼을 먼저 수정해보기로 하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ChangeUserAndMessenger</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Migration</span>\\n  <span class=\\\"token keyword\\\">def</span> change\\n    rename_column <span class=\\\"token symbol\\\">:users</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:service_uid</span>\\n    add_column <span class=\\\"token symbol\\\">:user_messengers</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:messenger_user_email</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:string</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>다시 맴버 추가 과정을 구성한다면</p>\\n<ol>\\n<li>json으로 넘어온 member_ids에서 하나하나씩 유저를 추가한다.</li>\\n<li>유저에 해당하는 UserMessenger, UserLog를 생성한다. 만약 이메일이 있다면 이메일도 추가한다.(Optional)</li>\\n<li>UserLog에 속하는 MealMeetUpTask를 생성한다.</li>\\n<li>그리고 각 유저의 MealMeetUpTask는 현재 이용중인 MealMeetUp에 속하게 된다.</li>\\n</ol>\\n<p>조금 직관적인 느낌은 떨어지게 보인다. 바로 유저가 MealMeetUp이라는 그룹과 연결되는 것이 아니니까.\\n맴버 추가 과정을 하나의 메서드화하고, 리스폰스로 생성할 json도 메서드로 한번에 만들도록 하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MembersController</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ApplicationController</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">add_flow</span><span class=\\\"token punctuation\\\">(</span>member<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">)</span>\\n      user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member<span class=\\\"token punctuation\\\">)</span>\\n      user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                           messenger_code<span class=\\\"token punctuation\\\">:</span> load_messenger_code<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            task_status<span class=\\\"token punctuation\\\">:</span> init_task_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">add_user_response</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">{</span> data<span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token punctuation\\\">{</span> email<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>service_uid<span class=\\\"token punctuation\\\">,</span>\\n          messenger<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>messenger<span class=\\\"token punctuation\\\">.</span>value<span class=\\\"token punctuation\\\">,</span>\\n          messenger_room_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>messenger_room_id<span class=\\\"token punctuation\\\">,</span>\\n          member_ids<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token function\\\">get_members_list</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>사실 맨 밑의 member_ids는 좀 복잡하게 가져오더라도 맴버 추가에 성공한 id만 가져와야 하는게 맞을 것 같다.</p>\\n<p>실제로 실행을 시켜 보니 member_ids라는 패러매터를 아예 가져오지 못했는데, 이는 패러매터의 형식이 배열로 되어 있어서 그렇다. 배열로 된 패러매터를 가져올 때는 스트롱 패러매터에서 형식을 지정해 주어야 한다</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">params.permit(:id =&gt; [])</code></pre>\\n      </div>\\n<p>service<em>uid로 컬럼명을 수정하면서 생긴 오류들을 잡아주고 차근차근 진행하고 있다가 확실히 response의 `member</em>ids` 를 제대로 MealMeetUp에 엮여있는 유저들만 가져오는게 맞다는 생각이 들었다.\\n결국 가져와야 하는 것은</p>\\n<p><strong>MealMeetUp에 속한 Task들 -> 각 Task를 가지고 있는 MealLog -> MealLog를 소유하고 있는 User의 service_uid</strong> 인 것이다.\\nDB를 리셋하고 먼저 MealMeetUp을 하나 생성한 뒤에 유저 추가 과정을 거치니 잘 추가되었다.</p>\\n<p>커밋을 한 뒤에 멘토님이 코드 리뷰와 함께 조언들을 해 주셨다.</p>\\n<ul>\\n<li>Fat Model, Skinny Controller</li>\\n<li>컨트롤러는 최소한의 연결만 해주는 게 좋겠다.</li>\\n<li>패러미터의 여부를 체크하는 것을 굳이 본 메서드에서 할 필요가 없어 보인다. -> before_action 사용</li>\\n<li>member_ids의 유효성을 검사할 필요가 있다.</li>\\n<li>메서드 이름은 다른사람이 이름만 보아도 무엇을 하는 작업인지 알 수 있어야 한다</li>\\n<li>맴버 추가하는 일련의 과정을 담은 <code class=\\\"language-text\\\">add_flow</code> 메서드를 user모델에 정의해서 쓸 필요가 있겠다 (<code class=\\\"language-text\\\">init_member</code> 같은 이름으로)</li>\\n</ul>\\n<p>대개 리펙토링을 하면서 처리해야 하는 부분들이지만, 멤버 추가를 유저 모델에 정의하는 지금이라도 처리해야할 필요가 있다.\\n기존에 MealMeetUp을 만들 때 자동으로 어드민 유저를 생성하는데, 어드민 유저도 같은 방에 포함되는 유저로서 MealLog, Messenger, Task 등록 등의 작업을 해 주어야 한다고 생각하기 때문이다.</p>\\n<p>그런데 지금은 MealMeetUp 생성 당시 어드민 유저의 service<em>uid가 없기 때문에, 생성을 하자니 조금 애매한 부분이 있다.\\n먼저 떠오르는 생각으로는 MealMeetUp 생성만 하고 어드민은 따로 Members 추가 시에 지정하는 방법이 있겠다. 아니면 처음 MealMeetUp 생성때부터 어드민이 될 사람의 service</em>uid를 받아야 한다.</p>\\n<p><em>(추가)</em> 그냥 MealMeetUp 생성시에 어드민이 될 사람의 service_uid도 받는 방식으로 수정을 하기로 하였다.</p>\\n<p>그리고 맴버가 추가된 MealMeetUp의 상태도 변화시켜서, 추가적인 유저 입력을 막을 수 있어야한다. 지금 방식대로라면 계속 유저를 추가하는대로 새로운 유저를 집어넣고 있는데, 이는 제대로된 방법이 아니다. <em>(처리 완료)</em></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># members_controller.rb</span>\\n\\n<span class=\\\"token keyword\\\">def</span> add_member\\n    <span class=\\\"token variable\\\">@meetup</span> <span class=\\\"token operator\\\">=</span> find_meetup\\n    entry_members <span class=\\\"token operator\\\">=</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_ids</span><span class=\\\"token punctuation\\\">]</span>\\n    entry_members<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">each</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">|</span>member<span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>member<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\"># 맴버가 추가된 MeetUp은 상태를 변경해준다.</span>\\n    <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'paying'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">render_200</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">add_user_response</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"refactoring-1\\\"><a href=\\\"#refactoring-1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Refactoring (1)</h2>\\n<p>현재까지 개발한 부분을 adapter와 연동해보기 위해 조금 미진한 부분을 수정하고 허로쿠에 배포해보기로 하였다.\\n가장 우선적으로 수정해야겠다고 생각하는 부분이 처음 MealMeetUp 생성시 어드민도 <code class=\\\"language-text\\\">init_member</code> 를 해 주는 것인데, 맨 처음 MealMeetUp 생성을 구현했을 때 만든 부분에서 많은 수정을 해야겠다.</p>\\n<ul>\\n<li>MeetUp 생성시 먼저 메신저 종류, room_id만 써서 생성한다. (생성시엔 상태를 'created' 로 지정)</li>\\n<li>service<em>uid 로 user를 생성 `init</em>member` 메서드로 필요한 데이터를 다 같이 생성한다(MealLog, Messenger, Task)</li>\\n<li>생성 된 user가 어드민이 된다.</li>\\n</ul>\\n<p>먼저 <code class=\\\"language-text\\\">init_member</code> 메서드를 User모델로 옮기고 조금 추가적인 정보를 받도록 한다.\\n그리고 처음 MeetUp 생성시에 필요한 정보만 넣어서 일단 생성을 하고, 그 MeetUp과 어드민이 될 맴버를 연결한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># 새로운 맴버 등록시 필요한 일련의 과정들</span>\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token comment\\\"># 바로 user를 사용가능하도록 return</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n\\n<span class=\\\"token comment\\\"># models/meal_meet_up.rb</span>\\n<span class=\\\"token comment\\\"># 빈 MeetUp 생성</span>\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_meetup</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>messenger_code<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n            messenger_room_id<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n            meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'created'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n\\n<span class=\\\"token comment\\\"># controllers/meal_meet_up_controller.rb</span>\\n<span class=\\\"token keyword\\\">def</span> create\\n    <span class=\\\"token variable\\\">@admin</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_user_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">,</span>\\n                                <span class=\\\"token function\\\">load_messenger_code</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n                                <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_task</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'unpaid'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">update_additional_info</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@admin</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_201</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">response_json_create</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> update\\n    <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">:</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:total_price</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                    meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token function\\\">load_status_code</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_200</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">response_json_update</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>그리고 복잡하게 <code class=\\\"language-text\\\">if~else</code> 로 엮여있던 <code class=\\\"language-text\\\">create</code>, <code class=\\\"language-text\\\">update</code> 액션을 <code class=\\\"language-text\\\">members_controller</code> 에서 썼던 <code class=\\\"language-text\\\">before_action</code> 의 필터링을 적용하여 크게 다이어트 해 주었다.</p>\\n<p>처음에 MealMeetUp을 만들 땐 돌아만 가게 만드느라 억지로 해쉬를 자르고 붙이고 하는 작업을 했었는데, 실질적으로 필요한 요소들을 조금 더 고민하고 수정을 하니 실제로는 더 적은 양의 코드로도 작성이 가능하게 되었다.</p>\\n<p>하지만 코드를 작성하고 나서 실제 구동하여 테스트를 해보니 부족한 부분이 많았는데, 먼저 한번 유저를 추가하고 나면 더 추가하지 못하게 설계 한 부분이 미스였고, MealMeetUp도 중복 검사를 제대로 하지 못하고 있던 것이다.</p>\\n<p>전반적으로 처음 코드를 작성할 때 중복 처리에 대해 크게 고민을 하지 않고 만든게 원인이었다. 조금 더 신중하게 코드를 작성해야 했었는데..</p>\\n<p>특히 before<em>action을 너무 남용한 부분이 있었는데 `meal</em>meet<em>up#create` 만 해도 그냥 패러미터가 들어오자마자 무조건 MealMeetUp을 생성하도록 before</em>action을 하나 만들어 놓으니 나중에는 중복 검사를 할때 자꾸 '이미 만들어진 meetup' 이라는 오류를 내뿜게 되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MealMeetUpController</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ApplicationController</span>\\n  include <span class=\\\"token constant\\\">MealMeetUpHelper</span>\\n  before_action <span class=\\\"token symbol\\\">:check_params</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:create</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:update</span><span class=\\\"token punctuation\\\">]</span>\\n  before_action <span class=\\\"token symbol\\\">:check_meetup_update</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:update</span><span class=\\\"token punctuation\\\">]</span>\\n  before_action <span class=\\\"token symbol\\\">:check_meetup_create</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:create</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token comment\\\"># before_action :init_meetup, only: [:create]</span>\\n\\n  <span class=\\\"token keyword\\\">def</span> create\\n    init_meetup\\n    <span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>이렇게 수정하여 먼저 중복된 meetup이 있는지 확인을 하고, 없으면 생성을 하는 과정을 거치도록 수정하니 잘 작동하였다.\\n앞으로도 수정할 부분은 많이 있을 것이지만, 한줄 한줄 코드를 작성할 때 조금 더 과정에 대해 심혈을 기울여 생각할 필요성을 크게 느꼈다.</p>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-08-02-easylunch-api-devlog-2/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-08-02\",\"path\":\"/posts/easylunch-api-devlog-2\",\"title\":\"Easylunch Api 서버 제작기 - 2\",\"tags\":[\"Rails\"],\"category\":\"Rails\"}},{\"excerpt\":\"Clone repository 금방 하지 못했던 easylunch api 서버 프로젝트를 작성하기 시작했다.\\n프로젝트 생성과 Gem 세팅 등은 이미 되어 있어서 github에 있는 레포를 클론하였고\\nIssue #10 으로 분류되어 있어서   브랜치를 생성하였다.\\n이번에는 Bitbucket에서 작성했던 프로젝트와 다르게 development 브랜치를 두지 않고 이슈 브랜치에서 바로 master…\",\"html\":\"<h2 id=\\\"clone-repository\\\"><a href=\\\"#clone-repository\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Clone repository</h2>\\n<p>금방 하지 못했던 easylunch api 서버 프로젝트를 작성하기 시작했다.\\n프로젝트 생성과 Gem 세팅 등은 이미 되어 있어서 github에 있는 레포를 클론하였고\\nIssue #10 으로 분류되어 있어서 <code class=\\\"language-text\\\">ISS#10</code> 브랜치를 생성하였다.\\n이번에는 Bitbucket에서 작성했던 프로젝트와 다르게 development 브랜치를 두지 않고 이슈 브랜치에서 바로 master로 합치는 방식으로 진행하는가 보다.</p>\\n<h2 id=\\\"모델-작성\\\"><a href=\\\"#%EB%AA%A8%EB%8D%B8-%EC%9E%91%EC%84%B1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>모델 작성</h2>\\n<p>먼저 슬랙에 올라와 있던 모델 도면을 참고하여 모델을 작성하였다.\\n처음엔 별 생각 없이 모델 생성하면서 string이나 integer만 구분하여 각 컬럼을 입력하고 있었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">rails g model MealLog user_id:integer menu_name:string price:integer meal_time:datetime</code></pre>\\n      </div>\\n<p>이렇게 테이블을 작성하고 나서 모델에서 따로 <code class=\\\"language-text\\\">belongs_to</code> 와 <code class=\\\"language-text\\\">has_many</code> 를 입력해줄 생각이었다.\\n그러다 저번에 다른 튜토리얼에서 우연히 본 references를 이용할 생각이 뒤늦게 들어서 마이그레이션 파일을 변경해 주기로 했다.</p>\\n<p>마이그레이션 시 타입을 references로 지정해주면 model<em>id 생성과 함께 관계 설정을 해주는 코드(`belongs</em>to<code class=\\\"language-text\\\">/</code>has_many`)가 자동으로 삽입된다.\\n다만 이미 마이그레이션 파일이 작성된 뒤였기 때문에(실행은 하지 않음) 다음과 같이 마이그레이션 파일을 변경해주었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">CreateMealLogs</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Migration</span>\\n  <span class=\\\"token keyword\\\">def</span> change\\n    create_table <span class=\\\"token symbol\\\">:meal_logs</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>t<span class=\\\"token operator\\\">|</span>\\n      t<span class=\\\"token punctuation\\\">.</span>references <span class=\\\"token symbol\\\">:user</span>\\n      t<span class=\\\"token punctuation\\\">.</span>string <span class=\\\"token symbol\\\">:menu_name</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:price</span>\\n      t<span class=\\\"token punctuation\\\">.</span>datetime <span class=\\\"token symbol\\\">:meal_time</span>\\n\\n      t<span class=\\\"token punctuation\\\">.</span>timestamps null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    add_index <span class=\\\"token symbol\\\">:meal_logs</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:user_id</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>그리고 직접 관계를 맺어주는 것과 별개로 CodeTable때문에 외부 키를 입력해줄 필요가 있었다.\\n외부 키를 추가할 때는 마이그레이션 파일에 add<em>foreign</em>key 메서드를 사용해야 한다. 이 경우엔 미리 생성된 컬럼을 지정해주고 싶었기 때문에 다음과 같이 삽입해야 했다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">add_foreign_key :meal_meet_ups, :users, column: :admin_id</code></pre>\\n      </div>\\n<p>외부 키를 지정해주는 마이그레이션 파일은 다음과 같이 작성되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">CreateMealMeetUps</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Migration</span>\\n  <span class=\\\"token keyword\\\">def</span> change\\n    create_table <span class=\\\"token symbol\\\">:meal_meet_ups</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>t<span class=\\\"token operator\\\">|</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:total_price</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:messenger_code</span>\\n      t<span class=\\\"token punctuation\\\">.</span>string <span class=\\\"token symbol\\\">:messenger_room_id</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:admin_id</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:meetup_status</span>\\n\\n      t<span class=\\\"token punctuation\\\">.</span>timestamps null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    add_foreign_key <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:users</span><span class=\\\"token punctuation\\\">,</span> column<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:admin_id</span>\\n    add_foreign_key <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:code_tables</span><span class=\\\"token punctuation\\\">,</span> column<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:messenger_code</span>\\n    add_foreign_key <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:code_tables</span><span class=\\\"token punctuation\\\">,</span> column<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:meetup_status</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>다음은 MealMeetUp 생성과 변경을 처리하는 api 컨트롤러를 작성할 차례이다.</p>\\n<h2 id=\\\"컨트롤러-작성\\\"><a href=\\\"#%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EC%9E%91%EC%84%B1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>컨트롤러 작성</h2>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">rails g controller MealMeetUp create update</code></pre>\\n      </div>\\n<p>현재 시점에서 첫 번째로 구현하려는 기능은 MealMeetUp api이다. 새 MealMeetUp 생성과 수정을 구현할 예정인데\\njson으로만 데이터를 주고받을 예정이니 <code class=\\\"language-text\\\">routes.rb</code>에 디폴트 포맷을 지정해주기로 했다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"># routes.rb\\npost &#39;meal_meet_ups&#39;  =&gt; &#39;meal_meet_up#create&#39;, defaults: { format: &#39;json&#39; }\\npatch &#39;meal_meet_ups&#39; =&gt; &#39;meal_meet_up#update&#39;, defaults: { format: &#39;json&#39; }</code></pre>\\n      </div>\\n<p>그 다음에는 <a href=\\\"https://blog.8thlight.com/will-warner/2014/04/05/strong-parameters-in-rails.html\\\">Strong parameter</a>를 지정하기 위해 meetup_params 메서드를 작성했다.</p>\\n<p>입력받을 JSON은 다음과 같으므로 data 아래에 있는 나머지 키들을 전부 받을수 있는 값으로 설정해두었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"data\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"email\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"abc@example.com\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"messenger\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"slack\\\"</span><span class=\\\"token punctuation\\\">,</span> // 약속된 code\\n        <span class=\\\"token property\\\">\\\"messenger_room_id\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1459349928</span><span class=\\\"token punctuation\\\">,</span> // optional<span class=\\\"token punctuation\\\">,</span> 값을 얻을 수 없는 특정 메신저의 경우(ex- 카톡<span class=\\\"token punctuation\\\">)</span> api 서버에서 유저의 아이디 정보로 검색\\n        <span class=\\\"token property\\\">\\\"total_price\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">50000</span><span class=\\\"token punctuation\\\">,</span> // optional\\n        <span class=\\\"token property\\\">\\\"status\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"paying\\\"</span> // optional<span class=\\\"token punctuation\\\">,</span> 값이 주어지지 않을 경우 state machine으로 작동\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"mealmeetup-create\\\"><a href=\\\"#mealmeetup-create\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MealMeetUp Create</h2>\\n<p>이 JSON을 가지고(예로 작성된 JSON은 정보 변경시에 받는 것이고 생성 시에는 <code class=\\\"language-text\\\">total_price</code>와 <code class=\\\"language-text\\\">status</code>는 받지 않는다. 대신 <code class=\\\"language-text\\\">messenger_user_id</code>를 받는다) <code class=\\\"language-text\\\">create</code> 메서드가 작동한다면 어떤 과정으로 구동하게 될까 생각해 보았다.</p>\\n<ol>\\n<li>meetup_params를 한번 거쳐서 허가된 매개변수만 받는다.</li>\\n<li>\\n<p>받은 변수들의 유효성을 검사한다</p>\\n<ul>\\n<li><code class=\\\"language-text\\\">email</code>, <code class=\\\"language-text\\\">messenger_user_id</code> 같은 인증 정보가 누락된 경우: 401에러</li>\\n<li><code class=\\\"language-text\\\">messenger</code>, <code class=\\\"language-text\\\">messenger_room_id</code> 같이 방을 생성하기 위한 정보가 충분하지 않아 생성이 불가능할 때: 400에러</li>\\n</ul>\\n</li>\\n<li>\\n<p>유효성을 통과한 경우 먼저 User 객체 생성 + messenger_code 가져오기</p>\\n<ul>\\n<li>messenger 종류로 CodeTable에서 맞는 <code class=\\\"language-text\\\">messenger_code</code> 가져오기 (이 시점에서 seed 파일로 코드테이블을 작성해놓아야 할 필요성을 느꼈다. 더군다나 이런식으로 찾을거면 코드테이블을 작성하는 의미가 있나?)</li>\\n<li>email 주소로 새로운 유저 생성.</li>\\n</ul>\\n</li>\\n<li>\\n<p>MealMeetUp 생성</p>\\n<ul>\\n<li>앞선 과정에서 가져온 <code class=\\\"language-text\\\">messenger_code</code></li>\\n<li><code class=\\\"language-text\\\">messenger_room_id</code></li>\\n<li>앞서 생성된 user의 id를 <code class=\\\"language-text\\\">admin_id</code>로 지정</li>\\n<li>status는 null로 두고, null인 경우는 최초 생성인 것으로 간주하도록 하려고 했으나, 아무래도 \\\"​created\\\"라는 상태를 지정해 두는 것이 나아 보인다.</li>\\n</ul>\\n</li>\\n</ol>\\n<p>CodeTable을 작성하면서 한 가지 실수한 점이 있는데, 컬럼명에 'type'이라는 이름을 쓰면 레일즈에 기본적으로 정의되어있는 type과 충돌이 난다. 그래서 code_type으로 컬럼명을 변경하였다.</p>\\n<p>각각 코드가 무엇을 의미하는지는 code_table.rb에 주석으로 달기로 하였다.</p>\\n<p>한창 날코딩으로 작업을 하고, 얼렁뚱땅 create메서드를 작동시키는 것 까지는 성공했는데 돌이켜보니 DB 관계 설정을 하나도 해두지 않았다.\\n생성과 구상까지만 하고 몇일을 보내버려서 그런지 생각보다 머리에 잘 들어오지 않아 애먹고 있다.</p>\\n<p>매번 단순히 <code class=\\\"language-text\\\">has_many</code>, <code class=\\\"language-text\\\">belongs_to</code>정도만 남발하다가 본격적으로 직접 외부키로 관계를 맺어주려니 어렵게 느껴졌다. 이리저리 소스를 찾아서 구현해본 결과 이런 느낌으로 나온다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MealMeetUp</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Base</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_meet_up_logs</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_meet_up_tasks</span>\\n  belongs_to <span class=\\\"token symbol\\\">:admin</span><span class=\\\"token punctuation\\\">,</span> class_name<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'User'</span><span class=\\\"token punctuation\\\">,</span> foreign_key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'admin_id'</span>\\n  belongs_to <span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">,</span> class_name<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'CodeTable'</span><span class=\\\"token punctuation\\\">,</span> foreign_key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'messenger_code'</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">User</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Base</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> foreign_key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'admin_id'</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_logs</span>\\n  has_many <span class=\\\"token symbol\\\">:user_messengers</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>어느 클래스에 있는 값을 가져올지 <code class=\\\"language-text\\\">class_name</code>으로 지정해주고, 실제 어떤 메서드를 입력해서 가져올지(<code class=\\\"language-text\\\">:admin</code>), 어떤 외부키를 지정해 두었는지 등으로 설정할 수 있다.</p>\\n<p><code class=\\\"language-text\\\">create</code>메서드가 작동 자체는 잘 하는 것 같은데 루보캅에서 메서드가 너무 길다고 하니까 조금 아쉽게 느껴진다. 더 줄일 부분이 분명히 있는데 어느 부분을 손대야할지 잘 감이 안잡히는 느낌이 든다. 기준이 10줄인데 14줄로 작성되어 있으니..</p>\\n<p>인증 정보의 유효성 고려하다보니 깜빡한 것이, 이메일 유효성을 고려하지 않았다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">VALID_EMAIL_ADDRESS = /\\\\A[\\\\w+\\\\-.]+@[a-z\\\\d\\\\-.]+\\\\.[a-z]+\\\\z/i</code></pre>\\n      </div>\\n<p>M.Hartl의 튜토리얼에서 가져온 이 정규표현식으로 메서드를 만들어서 검증하기로 했다.</p>\\n<h2 id=\\\"mealmeetup-update\\\"><a href=\\\"#mealmeetup-update\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MealMeetUp Update</h2>\\n<p>업데이트는 두가지 속성이 더 추가되는데, <code class=\\\"language-text\\\">total_price</code>와 <code class=\\\"language-text\\\">status</code>이다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"data\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"email\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"abc@example.com\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"messenger\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"slack\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"messenger_room_id\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1459349928</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"total_price\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">50000</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"status\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"paying\\\"</span> // 현재까지 완료된 최종 상태\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>설마 했던 문제지만, 이번에도 create를 만들면서 별달리 다음 문제에 대해 고려를 안하다 보니까 리턴용 JSON 생성이 곤란하게 되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">meal_meet_up_json</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span> data<span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token punctuation\\\">{</span> email<span class=\\\"token punctuation\\\">:</span> data<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>email<span class=\\\"token punctuation\\\">,</span>\\n        messenger<span class=\\\"token punctuation\\\">:</span> data<span class=\\\"token punctuation\\\">.</span>messenger<span class=\\\"token punctuation\\\">,</span>\\n        messenger_room_id<span class=\\\"token punctuation\\\">:</span> data<span class=\\\"token punctuation\\\">.</span>messenger_room_id <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>그래서 생각하건데 아예 모든 값이 다 들어가도록 json을 만들고,  create메서드에서 리턴할때만 특정 키를 뺀 채로 만들면 될 거라는 생각이 든다.</p>\\n<p>공통적입 부분을 생각해보니, MealMeetUp 객체에 저장을 하기위해 추가적으로 들어가는 정보들을 조회하는 부분이 크게 중복된다. 그래서 이 기능도 나누어서 작성하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n    status <span class=\\\"token operator\\\">=</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'created'</span> <span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span>\\n    messenger_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n    status_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">if</span> status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'created'</span>\\n            <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n            <span class=\\\"token keyword\\\">else</span>\\n            <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n            <span class=\\\"token keyword\\\">end</span>\\n\\n    additional_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> admin_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">,</span> status_code<span class=\\\"token punctuation\\\">:</span> status_code <span class=\\\"token punctuation\\\">}</span>\\n\\n    params<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>additional_data<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>막상 이것도 더 쪼갤 수 있을 테지만.. status<em>code, messenger</em>code, admin_id 삽입까지 처리하였다.\\n마지막 줄에 최종적으로 원하는 데이터를 출력하는 부분이 애매한데, MeetUp 객체 생성/수정에 필요 없는 정보들이 너무 많았다. 그래서 조금 수정을 가했다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">params.merge(additional_data).reject { |key| [&#39;email&#39;, &#39;messenger&#39;, &#39;status&#39;, &#39;messenger_user_id&#39;].include?(key) }</code></pre>\\n      </div>\\n<p>거의 다 된거 같은게 갈수록 태산처럼 보인다. 이번에는 messenger<em>user</em>id가 UserMessenger 모델에 들어가야하는 값이라는걸 깨달았다. 당장 어디다 넣어야 할지도 모르겠는데.. 일단 <code class=\\\"language-text\\\">get_more_info</code> 메서드를 조금 수정하여 처음 생성하는 MealMeetUp일 경우 새로운 UserMessenger 객체를 생성하는 것 까지 진행했다.</p>\\n<p>지금까지 작업하여 돌아가기는 하지만 영 못마땅한 부분이 많다. 특히 반복적인 부분과 매끄럽게 보이지 않는 부분들이 너무 많은데, 본격적으로 수정을 하면 어디부터 손을 대야할지 해봐야 알 것이다. (루보캅 테스트 통과 못한 부분이 무려 22개)</p>\\n<p>루보캅에서 주로 걸리는 문제는 ABC(Assignment Branch Condition) 사이즈가 너무 크다는 것이다. 한번에 이해는 하기 힘들었지만 변수를 많이 선언하고, 조건을 많이 걸고, 얽힌 메서드가 많을 수록 점수가 올라가는 기분이 든다.</p>\\n<p>당장 위에 작성한 <code class=\\\"language-text\\\">get_more_info</code> 메서드만 해도 기준을 1.5배 초과하고 있다. 당장 저 메서드를 수정하려면 어떻게 해야할까? 저 메서드가 어떤 기능을 수행하는지 나누어 보자.</p>\\n<ul>\\n<li>status 패러미터를 가져와서 패러미터가 없으면 'created'를 부여한다.</li>\\n<li>messenger_code를 가져온다.</li>\\n<li>status_code를 가져온다.</li>\\n<li>status가 'created'이면 (즉 처음 MealMeetUp이 생성되는거면) 새로운 유저와 유저메신저 객체를 생성한다.</li>\\n<li>생성된 유저의 Id와 messenger<em>code, status</em>code를 새로운 해시(addtional_data)로 만든다.</li>\\n<li>기존의 패러미터에 addtional_data를 합친다.</li>\\n</ul>\\n<p>기능별로 하나하나 나눌 순 있다. 점점 메서드의 산이 되어가는 기분이지만..\\n먼저 걸리는 점은 새로운 유저 생성, 그다음은 스테이터스 패러미터, 마지막은 추가 해시 생성이다.\\n새로운 유저 생성 부분부터 분리해보자.</p>\\n<p>무작정 분리한건 좋은데 이 메서드들을 어떻게 합쳐야 할지 감이 오지 않는다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> fetch_params\\n    <span class=\\\"token variable\\\">@params</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_status</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span>\\n    status<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'created'</span> <span class=\\\"token punctuation\\\">:</span> status\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_status_code</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token variable\\\">@status_code</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_messenger_code</span><span class=\\\"token punctuation\\\">(</span>messenger<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token variable\\\">@messenger_code</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>messenger<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_user</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">if</span> status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'created'</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            messenger_user_id<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_user_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                            messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> status_code<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">)</span>\\n    additional_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> admin_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                        messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">,</span>\\n                        meetup_status<span class=\\\"token punctuation\\\">:</span> status_code <span class=\\\"token punctuation\\\">}</span>\\n\\n    params<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>additional_data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>reject <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>key<span class=\\\"token operator\\\">|</span>\\n    <span class=\\\"token string\\\">%w(email messenger status messenger_user_id)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>분명 get<em>more</em>info를 실행시키기 위해선 위에 정의해둔 메서드를 모두 쓸 필요가 있다.\\n생각해보면 굳이 인자를 받을 필요가 없는데..? params는 어디서든지 쓸 수 있으니까.\\n그 점에 착안하여 수정한 코드는 이렇다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> fetch_params\\n    <span class=\\\"token variable\\\">@params</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>load_user<span class=\\\"token punctuation\\\">,</span> load_messenger_code<span class=\\\"token punctuation\\\">,</span>\\n                            load_status_code<span class=\\\"token punctuation\\\">,</span> meetup_params<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_status\\n    params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'created'</span> <span class=\\\"token punctuation\\\">:</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_status_code\\n    <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span>load_status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_messenger_code\\n    <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_user\\n    params <span class=\\\"token operator\\\">=</span> meetup_params\\n    <span class=\\\"token keyword\\\">if</span> load_status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'created'</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token variable\\\">@user</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            messenger_user_id<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_user_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                            messenger_code<span class=\\\"token punctuation\\\">:</span> load_messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token variable\\\">@user</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> status_code<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">)</span>\\n    additional_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> admin_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                        messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">,</span>\\n                        meetup_status<span class=\\\"token punctuation\\\">:</span> status_code <span class=\\\"token punctuation\\\">}</span>\\n\\n    params<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>additional_data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>reject <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>key<span class=\\\"token operator\\\">|</span>\\n    <span class=\\\"token string\\\">%w(email messenger status messenger_user_id)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>다 수정했더니 이번엔 클래스가 너무 길단다. (104/100줄)\\n줄일 부분 중 가장 크게 눈에 띄는 부분은 if-else문이 여러번 있는 것이다.\\n아예 검증 자체를 처음부터 메서드화 + before_action을 적용하고, 검증을 통과한 녀석만 create, update가 실행되도록 만들려고 하였다.\\n하지만 그 검증 메서드도 점점 몸집이 불어나더니 통과를 못하는 문제가 발생하였고, 야매로 해결한 방법은 helper에다가 넣을 만한 메서드를 옮겨놓고 <code class=\\\"language-text\\\">include MealMeetUpHelper</code>를 삽입하는 것이었다.</p>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-07-24-easylunch-api-devlog/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-07-24\",\"path\":\"/posts/easylunch-api-devlog-1\",\"title\":\"Easylunch Api 서버 제작기 - 1\",\"tags\":[\"Rails\"],\"category\":\"Rails\"}}],\"tagName\":\"Rails\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---tags-rails-22ef915474ba5b10ae0d.js","module.exports = {\"pathContext\":{\"postsByTag\":[{\"excerpt\":\"이 포스팅은  Justin Weiss의 블로그 포스팅 을 허가 아래 번역한 글입니다 본 번역물의 저작권은 따로 없으며 인용하실 때 출처를 밝혀주신다면 무척 고맙겠습니다 표현이 부족한 부분이나 오타를 발견하시면 댓글이나 트위터를 통해 알려주세요 Thom Parkin…\",\"html\":\"<ul>\\n<li><strong>이 포스팅은 <a href=\\\"https://www.justinweiss.com/articles/the-easiest-way-to-get-into-open-source/\\\">Justin Weiss의 블로그 포스팅</a>을 허가 아래 번역한 글입니다</strong></li>\\n<li><strong>본 번역물의 저작권은 따로 없으며 인용하실 때 출처를 밝혀주신다면 무척 고맙겠습니다</strong></li>\\n<li><strong>표현이 부족한 부분이나 오타를 발견하시면 댓글이나 트위터를 통해 알려주세요</strong></li>\\n</ul>\\n<hr>\\n<p>Thom Parkin이 <a href=\\\"http://www.justinweiss.com/blog/2014/10/28/how-to-go-beyond-documentation-and-learn-a-new-library/#comment-1657912979\\\">제 지난번 글에 아주 중요한 지적을 해 주었습니다.</a></p>\\n<blockquote>\\n<p>좋은 조언입니다. 그러나 당신은 아주 중요하고 결정적인 포인트를 하나 놓쳤어요. 지금 하고 있는 이야기는 오픈 소스에 관한 이야기이기 때문에 당신이 한번 어떤 기능이나 함수가 문서화가 잘 안되어있다는 것을 발견한다면, <strong>당신은 그 문서를 업데이트 하고 풀 리퀘스트(Pull Request)를 제출해야 합니다.</strong> 그렇게 전체 커뮤니티가 도움을 받게 되고 더불어 당신은 그런 참여를 통해 어느 정도의 \\\"코더 평판(coder cred)\\\"을 얻게 됩니다.</p>\\n</blockquote>\\n<p><strong>나는 Thom이 이 점을 언급해주어서 기뻤습니다. 이는 아주 중요한 것이기 때문입니다.</strong> 문서를 수정하는 것은 당신이 사용하고 좋아하는 프로젝트에 기여를 시작할 수 있는 가장 쉬운 방법입니다.</p>\\n<p>제가 Rails, Rubinus, Elixir에 처음 기여했던 것들은 모두 문서 수정이었습니다. 저는 작은 수정들을 가해왔습니다. 문장을 더 명확하게 하고, 코드를 직접 읽어야만 발견할 수 있는 부분들을 설명하는 작업을 하거나, 심지어 단지 포맷이 잘못된 부분을 수정하기도 했습니다. 이 모든 것들은 좀 커다란 오픈 소스 프로젝트들을 돕는 가장 빠르고 쉬운 방법들입니다. 비록 이 일들이 제가 프로젝트에 유일하게 기여한 것들이지만, 여전히 미래의 사용자들을 돕고 있습니다. 심지어 미래의 제 자신도요. 그게 바로 오픈소스죠(And that’s what open source is all about).</p>\\n<h2 id=\\\"왜-문서를-수정하는-것이-그렇게-좋은-방법인가\\\"><a href=\\\"#%EC%99%9C-%EB%AC%B8%EC%84%9C%EB%A5%BC-%EC%88%98%EC%A0%95%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B4-%EA%B7%B8%EB%A0%87%EA%B2%8C-%EC%A2%8B%EC%9D%80-%EB%B0%A9%EB%B2%95%EC%9D%B8%EA%B0%80\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>왜 문서를 수정하는 것이 그렇게 좋은 방법인가</h2>\\n<p>Rails같이 거대한 프로젝트에선 문서를 수정하는 것이 가장 부담이 덜 되는 기여 방법입니다.</p>\\n<ul>\\n<li><strong>당신은 버그를 수정하기 위해 프로젝트를 세팅할 필요가 없습니다.</strong> 당신은 그저 문서를 업데이트 하는 것이기 때문에 테스트를 돌리거나 앱을 돌릴 필요가 없습니다. 심지어 당신은 자신의 컴퓨터에 프로젝트를 클론할 필요도 없습니다 - Github에서 바로 수정할 수 있어요!</li>\\n<li><strong>관리자(Maintainer)가 당신의 풀 리퀘스트에 수정을 요청한다면, 보통 어법(wording)이나 취향 때문일 겁니다.</strong> 이런 변경점은 당신의 코드가 비판받는 것 보다 받아들이기 쉽습니다. 그리고 만들기도 쉽습니다. 왜냐면 당신은 테스트나 코드를 업데이트 할 필요가 없으니까요. 단지 단어들만 업데이트하면 됩니다.</li>\\n<li><strong>문서화(Documentation)는 프로젝트 관리자에게는 힘든 일입니다. 그래서 업데이트는 큰 도움이 됩니다.</strong> 종종 코드의 작성자들은 자신의 코드와 너무 밀접해 있어서, 어느 부분이 혼란스러운 부분인지 잘 이해하지 못합니다. 그들은 다른, 혹은 뉴비 개발자들이 어느 부분의 문서에 도움이 필요한지 말해주길 원합니다. 당신의 프로젝트를 초보자의 시점으로 보는 건 연습이 필요합니다. 모두가 그런 기술을 가진 것은 아니거든요.</li>\\n<li><strong>마지막으로, 당신은 프로젝트에 부담없는 변화를 주면서도 관리자와 관계를 형성할 수 있습니다.</strong> 당신은 프로젝트의 방향을 바꾸는 게 아닙니다. 예를 들면 당신이 전체 기능에 기여하는 것 처럼요. 그래서 당신의 변경점은 관리자가 리뷰하기 쉽고, 그들은 보통 당신에게 더 빠르게 답변 할 것입니다. 당신의 머지 요청은 \\\"이게 정말 좋은 생각일까요?\\\" 같은 말에 가로막히지 않을 것입니다.</li>\\n</ul>\\n<p>당신은 그 관계를 유지하면서 점차 신뢰받는 기여자로 보이기 시작할 것입니다. 당신의 풀 리퀘스트는 더 빠르게 리뷰될 것이고, 당신들이(당신과 관리자) 더 복잡한 기능 요청이나 버그 수정에 대해 자세하게 이야기를 나누기도 쉬워집니다.</p>\\n<p>당신의 첫 기여를 <strong>시작하기도 쉽고, 하기도 쉽고, 머지도 더 빠르게 되는</strong> 문서 수정으로 해 보시는 게 어떨까요?</p>\\n<h2 id=\\\"업데이트-된-문서에-다시-기여하는-방법\\\"><a href=\\\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EB%90%9C-%EB%AC%B8%EC%84%9C%EC%97%90-%EB%8B%A4%EC%8B%9C-%EA%B8%B0%EC%97%AC%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>업데이트 된 문서에 다시 기여하는 방법</h2>\\n<p>버그 수정과 마찬가지로 문서 업데이트에 기여하는 데는 유의할 점이 있습니다: <strong>둘 다 공통적으로 '잘못되었다고 느껴지는 것들(things that feel wrong)'에 많이 신경을 써야 한다는 점입니다.</strong> 당신은 주의를 기울여야 합니다.</p>\\n<p>보통 코드가 당신이 기대하던대로 동작하지 않을 때가 문서를 업데이트 해야 할 시기입니다. 만약 당신이 코드를 직접 수정하여 문제를 해결한다면, 마찬가지로 다른 사람들에게 이에 대해 알려야 할 겁니다. 혹은 당신이 읽고 있는 문서의 잘못된 형식이나 오타가 신경쓰일 수도 있습니다. 당신이 고치지 않는다면 누가 할까요?</p>\\n<p>당신이 어디를 변경하고 어떻게 말로 표현해야하는지 좋은 아이디어가 떠올랐다면, 그 부분을 변경하고 한번 Github에 풀 리퀘스트를 올려보세요.</p>\\n<p>만약 당신이 문서를 업데이트 하는 가장 좋은 방법을 계속 구상중이라면 Github에 이슈를 열어보세요. 이런 식으로요:</p>\\n<blockquote>\\n<p>\\\"저기요, 이건 제가 보기에 좀 헷갈리네요. 제가 이런 식으로 업데이트하는 걸 생각해 봤는데요: ... 어떻게 생각하세요? 제가 더 넣어야 할 내용이 있을까요?\\\"</p>\\n</blockquote>\\n<p>이렇게 당신은 모두를 만족시키는 표현법을 함께 제안할 수 있습니다.</p>\\n<p>마지막으로 당신이 답변을 얻지 못하더라도 주눅들지 마세요. 큰 프로젝트는 여러 일들이 진행됩니다. 그래서 당신의 기여는 그 사이 어딘가로 쏙 빠져버리기 쉽지요. <strong>일주일 안팎으로 당신이 아무런 답변을 듣지 못한다면, 관리자에게 다시 물어보세요.</strong></p>\\n<p>보통 당신이 라이브러리를 사용하게 되면 무엇보다 먼저 마주치는 것이 문서입니다. 그러므로 문서를 자세하고 명료하게 만드는 것은 중요합니다.</p>\\n<p>그러니 당신이 쓰는 코드가 혼란스러울 때나 직접 소스를 들여다 보아야 할 때, 다음 사람을 위해 보기 쉽게 만들어주세요. 간단한 업데이트를 작성하고 다시 기여하세요. 이것이 제가 알고있는 오픈 소스 기여자가 되는 가장 쉬운 방법입니다.</p>\\n<hr>\\n<h2 id=\\\"번역-후기\\\"><a href=\\\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>번역 후기</h2>\\n<p>첫 번역이라 부족한 점이 아주 많았습니다. 영어로 된 글을 읽는 것이 그래도 어느 정도는 읽을만 하다고 생각했는데, 다른 사람이 한글로 된 번역문을 읽으려면 훨씬 번역을 잘 해야하고, 우리말 문장도 매끄럽게 작성하도록 온 신경을 기울여야 한다는 점을 깨닫는 계기가 되었습니다.</p>\\n<p>사실 번역을 시작해보게 된 계기는 단순합니다. 본 글의 저자인 <a href=\\\"http://www.justinweiss.com\\\">Justin Weiss</a>의 블로그 포스팅들이 마음에 들어서 책(Practicing Rails)도 구매하고, 뉴스레터도 구독하면서 최근 뉴스레터의 내용들이 참 도움이 많이 된다고 생각하였습니다. 그래서 메일로 최근에 온 뉴스레터를 한글로 번역하여 공유해도 되겠냐고 물어보았지요.</p>\\n<p>그는 조만간 그 뉴스레터를 블로그로 포스팅할 예정이고 그 포스팅이 첫 번째로 공개되는 포스팅이었으면 한다고 답변을 주었습니다. 즉 아직은 올릴 수 없다는 말이겠지요. 메일을 조금 더 주고받다가 저는 그의 좋은 포스팅들 중 첫 번역을 이 글로 시작하기로 협의했습니다.</p>\\n<p>차차 Justin의 포스팅 이외에도 괜찮은 글들을 제가 번역할 기회가 주어진다면 조금씩 올려볼 예정입니다. 감사합니다.</p>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-12-19-the-easiest-way-to-get-into-open-source-kor/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-12-09\",\"path\":\"/posts/the-easiest-way-to-get-into-open-source-kor\",\"title\":\"[번역] 오픈 소스에 참여하는 가장 쉬운 방법\",\"tags\":[\"Translation\",\"Rails\",\"OSS\"],\"category\":\"Translation\"}},{\"excerpt\":\"본 포스팅은  루비 대림절 달력 을 위해 제작하였습니다 기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다 작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다 들어가며 아직 갓…\",\"html\":\"<ul>\\n<li><strong>본 포스팅은 <a href=\\\"http://ruby-korea.github.io/advent-calendar/\\\">루비 대림절 달력</a>을 위해 제작하였습니다</strong></li>\\n<li><strong>기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다</strong></li>\\n<li><strong>작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다</strong></li>\\n</ul>\\n<h2 id=\\\"들어가며\\\"><a href=\\\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>들어가며</h2>\\n<p>아직 갓 6개월 된 초보 개발자로서 이제 루비 온 레일즈(이하 레일즈)에 조금씩 익숙해지던 차에, 상사로부터 '하나미라는 프레임워크가 있으니 한번 리서치를 해 보세요' 라는 권유를 받았다. 그는 루비로 백엔드 서버들을 구축했지만 레일즈는 자신의 취향에 맞지 않다고 했고, 구조적으로도 하나미가 더 나아보인다고 이야기하였다.</p>\\n<p>그리고 하나미 공식 가이드를 쭉 읽어본 나에게는 혼돈과 절망만 남았다. 루비 뿐 아니라 웹 개발의 기초 지식이 부족해서 그런지 도저히 이게 어떻게 돌아가는건지도 모르겠고, 레일즈에 대입해서 이해할 수 있는 것도 아니라는 생각이 들었다.</p>\\n<p>다시 6개월을 다른 레일즈 프로젝트 제작, 리서치 작업을 하며 보내고 나니 회사에서는 본격적으로 레일즈 사용을 하지 않고 하나미를 사용하는 방향으로 가닥을 잡았다. 어쩌다가 레일즈라는 걸출한 웹 프레임워크를 두고 생소한 하나미라는 프레임워크를 사용하게 되었는지, 이번 기회를 통해 독자 분들의 관심을 이끄는 계기를 만들어보고자 한다.</p>\\n<h2 id=\\\"변화가-일고-있는-레일즈-커뮤니티\\\"><a href=\\\"#%EB%B3%80%ED%99%94%EA%B0%80-%EC%9D%BC%EA%B3%A0-%EC%9E%88%EB%8A%94-%EB%A0%88%EC%9D%BC%EC%A6%88-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>변화가 일고 있는 레일즈 커뮤니티</h2>\\n<p>레일즈는 2005년에 처음 소개 된 이후 빠르고 쉬운 웹 애플리케이션 개발을 위한 도구로써 많은 개발자들의 사랑을 받아왔다.</p>\\n<p>'프로그래머의 단짝 친구' 라고 소개할 정도로 쉽고 재미있는 언어인 루비를 기반으로 삼은 프레임워크이기도 하고, 꼭 루비 문법을 모두 꿰고 있어야 할 정도로 많은 지식을 알고 있지 않아도 금방 어지간한 웹 애플리케이션을 제작할 수 있다는 점이 주요 셀링 포인트라고 여겨진다.</p>\\n<p>소위 'Rails Magic' 덕분에 form에 변수를 할당하는 것으로 경로 설정이 알아서 되거나 스캐폴딩만 해도 신기하게 돌아가는 애플리케이션을 보며 감탄했던 적이 한두 번이 아니었다.</p>\\n<p>2016년 현재 레일즈는 버전 5까지 발매되었고, 더 많은 기능이 구현되어 있으며 커뮤니티는 많이 거대해졌다. 거대해진 레일즈 세계와 함께 그 음영을 느끼는 개발자들도 조금씩 늘어나게 되었다.</p>\\n<p>예를 들어 보통 레일즈 애플리케이션을 오래 개발해온 사람들은 애플리케이션의 규모가 커질수록 유지보수하는게 힘들어진다는 점을 지적하고 있는데, 이를 해결하기 위해 <strong>Fat model, Skinny controller</strong> 등의 방법론이 제시되고 있지만 '뭔가 문제가 있다'는 의견들은 끊임없이 제시되고 있다.</p>\\n<p>또한 DHH(David Heinemeier Hansson, 레일즈의 창시자)가 제시하고 있는 <a href=\\\"http://solnic.eu/2016/05/22/my-time-with-rails-is-up.html\\\">'Rails way'에 반감을 가진 사람들이 점차 늘어나고</a> 루비로 웹 개발을 하는 것에 대해 <a href=\\\"http://rwdtow.stdout.in/\\\">더 나은 방법을 찾는</a> 사람들이 점차 늘어나고 있다.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 599px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 131.3856427378965%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABe2AlTSxFMuUv/8QAGRABAAIDAAAAAAAAAAAAAAAAAQACEBEw/9oACAEBAAEFAqmqxODj/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQMBAT8BY//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABUQAQEAAAAAAAAAAAAAAAAAAAEw/9oACAEBAAY/Ain/xAAaEAADAQADAAAAAAAAAAAAAAAAAREQITFR/9oACAEBAAE/IYTxFLPKU5GXOpWf/9oADAMBAAIAAwAAABBv7vz/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EHDbIc//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxAp/8QAHhABAAICAQUAAAAAAAAAAAAAAQARITFBUWGBkaH/2gAIAQEAAT8QKn0nwj0BmUTlxMVEarzE8Q3EKIQbZTiXibZ3H3P/2Q=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"현재 레일즈 커뮤니티\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-f36a6.jpg\\\"\\n        srcset=\\\"/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-28fc4.jpg 198w,\\n/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-44f6c.jpg 395w,\\n/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-f36a6.jpg 599w\\\"\\n        sizes=\\\"(max-width: 599px) 100vw, 599px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<p><em>현재 레일즈 커뮤니티의 묘사 - 출처: <a href=\\\"http://railshurts.com/current_state\\\">http://railshurts.com/current_state</a></em></p>\\n<p>이러한 분위기 속에서 'Ruby way, not Rails' 를 표방하는 루비 기반 웹 프레임워크가 등장하였으니, 바로 이번에 소개할 <a href=\\\"hanamirb.org\\\">Hanami(하나미)</a>이다.</p>\\n<h2 id=\\\"하나미가-뭐죠\\\"><a href=\\\"#%ED%95%98%EB%82%98%EB%AF%B8%EA%B0%80-%EB%AD%90%EC%A3%A0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>하나미가 뭐죠?</h2>\\n<p>하나미는 이탈리아의 개발자 <a href=\\\"https://lucaguidi.com\\\">Luca Guidi</a> 가 개발한 루비 MVC 웹 프레임워크이다. 2014년에 Lotus라는 이름으로 처음 등장하였으나, IBM의 Louts 상표권과 엮이는 문제가 있어 지금의 이름으로 변경하게 되었다.</p>\\n<p>새로운 이름으로 <strong>하나미</strong>라는 이름을 쓰게 된 이유는 '꽃구경' 이라는 일본어 본래의 뜻에 걸맞게 함께 하는 커뮤니티의 중요성을 일깨운다는 점을 강조하기 위해서라고 한다. 루비의 창시자 Matz와(일본인이다) 루비 그 자체에 대한 찬사의 의미도 가지고 있다.</p>\\n<p>하나미의 특징을 몇 가지 소개하자면 먼저 최대한 루비라는 언어를 직접적으로 사용하는 방식으로 구현되어 있다는 점이다. 다만 이 때문에 레일즈를 습득하는데 루비 지식이 크게 필요하지 않은 것과 다르게 일정 수준의 루비 언어의 이해를 요구한다.</p>\\n<p>또한 Magic을 최대한 배제하고(하나미 Gitter 채팅방에서 혹은 몇몇 포스트에서 \\\"I'm now sick of rails magic!\\\" 이라고 주장하는 사람들이 많이 보인다) 개발자가 최대한 자신이 무엇을 하고 있는지 인지하면서 앱을 제작하도록 유도한다.</p>\\n<p>그리고 보통 Rails best practice 로 제시되는 요소들을 기본적으로 구현하고 있다.</p>\\n<ul>\\n<li>컨트롤러는 HTTP 콜만 다룬다 -> 액션에서 비지니스 로직을 분리하여 처리하기 위해 <code class=\\\"language-text\\\">Interactor</code> 라는 모듈이 있다</li>\\n<li>퍼시스턴스 로직과 도메인 로직을 분리한다 -> 하나미 모델은 기본적으로 도메인과 퍼시스턴스 레이어가 분리되어 있다</li>\\n<li>루비 객체를 만들어서 제대로 OOP를 한다 -> 하나미는 OOP 개념을 잘 지키기 위해 노력한다. 또한 모듈화도 굉장히 쉽다</li>\\n</ul>\\n<p>하나미 가이드 페이지 첫머리에서 제시하는 <a href=\\\"http://hanamirb.org/guides/#why-choose-hanami-\\\">'하나미를 선택하는 이유'</a> 를 가볍게 살펴보면 이렇게 말하고 있다.</p>\\n<ul>\\n<li>하나미는 가볍다 -> 상대적으로 짧은 코드, 웹 애플리케이션 개발에 필요한 필수적인 부분에 초점을 맞춤</li>\\n<li>하나미는 구조적으로 건전하다 -> 컨트롤러 액션은 각각의 클래스로 분리되어 있으며 테스트하기 용이하다</li>\\n<li>하나미는 스레드에 안전하다 -> (아직 이런 문제를 겪을만한 규모의 앱을 작성해본 적이 없어서 설명하기 어렵다)</li>\\n</ul>\\n<p>또한 하나미는 컨테이너 형태의 앱 구조를 기본적으로 제공한다. 덕분에 한 개의 프로젝트를 생성하여 API 서버와 웹 서버를 동시에 운용하는게 가능하다. 물론 레일즈로도 비슷한 구성을 할 수야 있겠지만 충돌 없는 구현을 위해 앱의 구조가 훨씬 복잡해질 가능성이 높다.</p>\\n<h2 id=\\\"만들어-볼까요\\\"><a href=\\\"#%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%BC%EA%B9%8C%EC%9A%94\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>만들어 볼까요</h2>\\n<p>글을 길게 써 보았지만, 개발자들에겐 장황한 글보다 코드 몇 줄을 보는 것이 훨씬 이해가 빠를 것이다. 하나미의 공식 가이드를 따라가면서 눈여겨 볼 점들을 소개하겠다.</p>\\n<h3 id=\\\"bookshelf-프로젝트-생성\\\"><a href=\\\"#bookshelf-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Bookshelf 프로젝트 생성</h3>\\n<p>이번에 만들어볼 애플리케이션(이하 앱)은 <code class=\\\"language-text\\\">Bookshelf</code> 라는 앱이다. 책의 제목과, 작가가 있고 이 책들의 리스트를 살펴보고 책을 추가할 수 있는 기능을 가지고 있다. 가이드에서 수정과 삭제는 다루고 있지 않아 조금 아쉬운 느낌이 들지만 기본적인 웹 개발(레일즈) 지식이 있다면 구현하는 것이 그렇게 어렵지는 않다.</p>\\n<p>기본적으로 루비 버전은 2.3+ 을 권장한다. 또한 데이터베이스는 sqlite3를 사용할 예정이다.</p>\\n<p>먼저 하나미로 프로젝트를 생성하기 위해서는 <code class=\\\"language-text\\\">gem install hanami</code> 로 하나미가 설치되어 있어야 한다. 그 다음에는 새 프로젝트를 생성해본다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ hanami new bookshelf</code></pre>\\n      </div>\\n<p>생성된 프로젝트의 폴더 구조를 살펴보면 다음과 같다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ tree -L 2\\n.\\n├── Gemfile\\n├── Rakefile\\n├── apps\\n│   └── web\\n├── config\\n│   ├── environment.rb\\n│   └── initializers\\n├── config.ru\\n├── db\\n│   ├── migrations\\n│   └── schema.sql\\n├── lib\\n│   ├── bookshelf\\n│   └── bookshelf.rb\\n├── public\\n└── spec\\n    ├── bookshelf\\n    ├── features_helper.rb\\n    ├── spec_helper.rb\\n    ├── support\\n    └── web</code></pre>\\n      </div>\\n<p>여기서 특이한 점은 <code class=\\\"language-text\\\">apps</code> 라는 폴더가 있다는 점인데 기본 컨테이너는 <code class=\\\"language-text\\\">web</code> 이지만 사용자가 웹 브라우저로 보는 애플리케이션 이외에 같은 데이터베이스를 공유하는 api 서버 등을 따로 만들고자 하면 제네레이터로 따로 컨테이너를 생성할 수 있다. 그러면 같은 데이터베이스 사용하는 별개의 앱을 따로 구축할 수 있다는 장점이 있다. (물론 라우팅은 다르겠지만.. 이 부분은 <code class=\\\"language-text\\\">mount</code> 옵션으로 처리할 수 있다) <a href=\\\"http://hanamirb.org/guides/getting-started/#hanami-architecture\\\">- 참고</a></p>\\n<p>각 앱들에는 별개의 설정 파일, 컨트롤러, 뷰, 라우트, 템플릿 파일 및 폴더가 있다.</p>\\n<p>테스트는 사용자가 원하는 어떤 형태로도 이용할 수 있다.(minitest or rspec) 하나미에서는 minitest를 기본으로 사용하며 capybara 젬도 사용한다. 이번 포스팅에서는 테스트를 구현하는 부분은 넘어가고자 한다. 테스팅이 궁금한 분들은 공식 가이드를 참조하시라.</p>\\n<h3 id=\\\"루트-페이지-만들기\\\"><a href=\\\"#%EB%A3%A8%ED%8A%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>루트 페이지 만들기</h3>\\n<p>라우팅은 각 앱의 <code class=\\\"language-text\\\">config/routes.rb</code> 파일에서 설정한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/config/routes.rb</span>\\nroot to<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'home#index'</span>\\n</code></pre>\\n      </div>\\n<p>그러면 home 컨트롤러의 index 액션을 실행해주기 위해 제네레이터로 액션을 생성해본다. 아직 하나미는 레일즈처럼 다양하고 세분화된 옵션의 CLI를 제공하진 않는다. 번거롭긴 하지만 개발에 큰 지장은 없다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate action web home#index\\n    create  spec/web/controllers/home/index_spec.rb\\n    create  apps/web/controllers/home/index.rb\\n    create  apps/web/views/home/index.rb\\n    create  apps/web/templates/home/index.html.erb\\n    create  spec/web/views/home/index_spec.rb\\n    insert  apps/web/config/routes.rb</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">action</code> 뒤에 있는 <code class=\\\"language-text\\\">web</code> 은 액션을 생성하고자 하는 컨테이너의 이름이다. 그 다음에 컨트롤러와 액션 이름을 적어주면 된다. 앱 구조가 단독 컨테이너 구조일 경우(<code class=\\\"language-text\\\">hanami new</code> 커맨드로 앱 생성시 <code class=\\\"language-text\\\">--arch=app</code> 옵션을 주어 단독 컨테이너 앱 생성도 가능하다)에는 바로 액션 이름만 작성해주어도 된다.</p>\\n<p>아쉬운 점은 매 액션마다 저 명령어를 작성해주어야 한다는 점이다. <code class=\\\"language-text\\\">hanami-scaffold</code> 라는 젬이 있지만 그닥 유지보수는 되지 않고 있어서 사용하는 것을 추천하지 않는다.</p>\\n<p>컨트롤러는 폴더에 불과하며 그 폴더에 속한 각각의 액션 파일에 컨트롤러가 정의되어 있는 형태이다. 또한 뷰는 템플릿 파일(레일즈의 views 폴더 안에 있는 템플릿들)과 뷰 파일(레일즈에 비유하자면 뷰 헬퍼와 비슷)로 구성되어있다. 지금은 템플릿 파일에 간단하게 제목을 추가해보도록 한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-markup\\\"><code class=\\\"language-markup\\\"># apps/web/templates/home/index.html.erb\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h1</span><span class=\\\"token punctuation\\\">></span></span>Bookshelf<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre>\\n      </div>\\n<p><em>(주의) 템플릿 파일이 변경될 때에는 서버를 재실행할 필요가 없지만, 컨트롤러 등의 루비 파일이 변경될 때에는 서버를 재실행해야 한다.</em></p>\\n<p>그리고 서버를 실행한 뒤 <code class=\\\"language-text\\\">localhost:2300</code> 으로 접속해보면 심플하지만 Bookshelf라는 글씨가 보이는 페이지를 마주할 수 있다.\\n(본 포스트에서는 빠른 진행을 위해 <code class=\\\"language-text\\\">application.html.erb</code> 파일을 미리 수정해두었다)</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami server</code></pre>\\n      </div>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 358px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 74.58100558659218%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y81R32tSYRg+/8tyumBjEkxd5TKZRRlHnU70HM/x1/RibmArF5UXDRbtz/CmwfyVJ4i6qP6CdhEEbRmIO4pCA9F25Y+n93xk0MVawS468PB+7/c97/M833c446QeNuMlzC1chsGkw8WpafCORVgXbLhy1Yo5kxkms+UX5jTQ3njfbJmHTj+FC5MGTOj04Cwk6DLPw87fhOHaBBxWGyrZDFKrq0gmE3A6neB5Hi6XCy6qbrf7N4iiSMJmTM/MkLAB3G0i3aAh+3U77tziEQgEEBRExGIxhmQigXg8DkmSEA6HIQgC44wRDAbh9/vJkAw8HnAyEaVQCB6PG4IoQJZkJpDJZLC5mcEDQjqdprRJrKXWEIlEWCpZlplJiGa1tWYejUbBabG1RiIhLQEjiSEskUE0FodIabWhYCCI5WUfVihxJBKFz+dFIpEk8xUK44Fxdhb2RQe4fD6PcrmMUqkMRVGolqh/gVKxiEpFQZGqdlYsFNhZ5SenQL2ivGTr/N4ecrkcnu/ugsM5f5x6VMeH/X30ej2cnHzHwcEhvh0fo/rlEEeqik6ng/fv3qJa/coG+v0+BoPBqeDevH6FJa8Xz3Z28PjRQ6TvbiCbzWLryRY27t3H9vZTrKdS+PjpMxMcDIcYjUangut2u2g0GgQV9XodzWYTtVoNqtpAq9WiqqLdblOyARPUhv545X95n7PEmKBGGtI1zsJY7FwT/tVf/u8FfwCkJLVg24iPyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"Bookshelf Title\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-8524e.png\\\"\\n        srcset=\\\"/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-dc079.png 198w,\\n/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-8524e.png 358w\\\"\\n        sizes=\\\"(max-width: 358px) 100vw, 358px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<h3 id=\\\"모델-구축하기\\\"><a href=\\\"#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>모델 구축하기</h3>\\n<p>본격적으로 책들을 저장하고 출력하기 위해 데이터베이스 마이그레이션을 진행해 보도록 한다. 먼저 마이그레이션 파일을 생성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate migration create_books</code></pre>\\n      </div>\\n<p>생성된 마이그레이션 파일은 이렇게 작성해 보았다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># db/migrations/20161203083239_create_books.rb</span>\\n<span class=\\\"token constant\\\">Hanami</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Model</span><span class=\\\"token punctuation\\\">.</span>migration <span class=\\\"token keyword\\\">do</span>\\n  change <span class=\\\"token keyword\\\">do</span>\\n    create_table <span class=\\\"token symbol\\\">:books</span> <span class=\\\"token keyword\\\">do</span>\\n      primary_key <span class=\\\"token symbol\\\">:id</span>\\n\\n      column <span class=\\\"token symbol\\\">:title</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token builtin\\\">String</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n      column <span class=\\\"token symbol\\\">:author</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token builtin\\\">String</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n\\n      column <span class=\\\"token symbol\\\">:created_at</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">DateTime</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n      column <span class=\\\"token symbol\\\">:updated_at</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">DateTime</span><span class=\\\"token punctuation\\\">,</span> null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">primary_key</code> 가 반드시 <code class=\\\"language-text\\\">id</code> 일 필요는 없다. 또한 <code class=\\\"language-text\\\">String</code>, <code class=\\\"language-text\\\">DateTime</code> 은 루비 타입이다(루비 클래스). 반드시 루비 타입을 사용할 필요는 없고 <code class=\\\"language-text\\\">&quot;varchar(255)&quot;</code> 같이 데이터베이스 타입을 문자열로 직접 작성해주어도 된다.</p>\\n<p>마이그레이션 파일 작성이 완료되면 테이블을 생성해주는 명령어를 입력한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami db prepare\\n$ bundle exec hanami db migrate</code></pre>\\n      </div>\\n<p>그리고 <code class=\\\"language-text\\\">Book</code> 모델을 생성해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate model book\\n      create  lib/bookshelf/entities/book.rb\\n      create  lib/bookshelf/repositories/book_repository.rb\\n      create  spec/bookshelf/entities/book_spec.rb\\n      create  spec/bookshelf/repositories/book_repository_spec.rb</code></pre>\\n      </div>\\n<p>생성된 파일을 보면 조금 특이한 점을 볼 수 있는데 <code class=\\\"language-text\\\">entities</code> 폴더와 <code class=\\\"language-text\\\">repositories</code> 폴더가 따로 나뉘어져 있다는 점이다. <code class=\\\"language-text\\\">Entity</code> 는 도메인 객체로, 실제 데이터베이스 쿼리 등으로 추출된 자료 객체를 일컫는다. <code class=\\\"language-text\\\">Repository</code> 는 퍼시스턴스 계층과 <code class=\\\"language-text\\\">Entity</code> 를 이어주는 역할을 한다. 여기서 <code class=\\\"language-text\\\">Entity</code> 는 데이터베이스의 존재를 전혀 모르는 단순 루비 객체이며 테스트가 용이하고 가벼운 앱을 만드는데 도움이 된다.</p>\\n<p>실제 콘솔에서 레코드를 다루어보면 이런 방식으로 동작한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami console\\n&gt;&gt; repo = BookRepository.new\\n=&gt; #&lt;BookRepository:... &gt;\\n&gt;&gt; repo.all\\n=&gt; []\\n&gt;&gt; book = repo.create(title: &#39;TDD&#39;, author: &#39;Kent Beck&#39;)\\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;\\n&gt;&gt; repo.find(book.id)\\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">Repository</code> (이하 리퍼지토리)에서 제공되는 메서드로 데이터베이스에 <code class=\\\"language-text\\\">Entity</code> (이하 엔티티)를 조작할 수 있고, 엔티티에는 따로 속성 혹은 동작을 지정할 수 있다. 그래서 레일즈에서 사용하는 <code class=\\\"language-text\\\">scope</code> 나 커스텀 쿼리가 작성된 메서드 등은 리퍼지토리 클래스에 분리해 둘 수 있다.</p>\\n<h3 id=\\\"데이터를-표현하기\\\"><a href=\\\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>데이터를 표현하기</h3>\\n<p>임의로 몇 개의 <code class=\\\"language-text\\\">Book</code> 레코드를 생성해주고 리스트를 표현해보기 위해 새 컨트롤러 액션을 생성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami generate action web books#index</code></pre>\\n      </div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-markup\\\"><code class=\\\"language-markup\\\"># apps/web/templates/books/index.html.erb\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h2</span><span class=\\\"token punctuation\\\">></span></span>All books<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h2</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n&lt;% if books.any? %>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>div</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>books<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    &lt;% books.each do |book| %>\\n      <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>div</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>book<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h2</span><span class=\\\"token punctuation\\\">></span></span>&lt;%= book.title %><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h2</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>&lt;%= book.author %><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n      <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n    &lt;% end %>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n&lt;% else %>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>placeholder<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>There are no books yet.<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n&lt;% end %>\\n</code></pre>\\n      </div>\\n<p>여기서 <code class=\\\"language-text\\\">books</code> 는 어디서 온 것일까? 실제로 액션 부분은 이렇게 작성되어 있다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/controllers/books/index.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Controllers</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Index</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Action</span>\\n\\n    expose <span class=\\\"token symbol\\\">:books</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">call</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token variable\\\">@books</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BookRepository</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span>all\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">expose</code> 메서드의 사용은 하나미의 규칙으로, <code class=\\\"language-text\\\">expose</code> 로 지정한 변수만 템플릿으로 노출되며 그 변수는 <code class=\\\"language-text\\\">call</code> 메서드 안에 인스턴스 변수로 존재해야 한다.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 128.05194805194807%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAAC+0lEQVRIx61U/UtTURi+f0vq0n7oA0Q2P5L8ojLEocxtd03nvpztw2V/QBqmmRpYRjgrrIku06kUBEFQ6IhyZaap6Nb6oURJ3Jyi4rane44oaubHtQsP59z3nPc5z3PP+14mXnAc6fFCJKQJEXUmCqkJIkguZeNcRiYys7KQlp4BUWLSrkhMSkbM8ThEC2JxLFpAwYji4pCdeBYpF1MRkyCAuUCKxnIL9KVGWMwm6PU65IpzIRaLtyEvLw8KBQuhUISTp05DEHuCkjN5Egmyc3JwPusCLrNKyFg5dHo9R6SHwWBAaWkpnWs0GmjUGjoWFxdDJpNBLpeDVSjoSCCVysAolUoUKguRn59PTyQbCYHFYoHVaoXJaFwn42AoKYFWq4VarYZKpQLJZVkWEk4Uy+WqVAowZKGszAqj0QSz2QzjFSN0Wh10Oi2NEcuGEgOKioroISYuRubl5ddgMlug4AiTk1MglxbgqsUAxuPxYHJykmJqaoqCxDbiXq8XPp+Pvm9d2zone9ZjHjD4zw/T2+NEVdVNdHY50dXpwN2m++h29qCmuhp9vb2or2vAg2Yb3by2toZwOLwnGLd7EHa7HTbbQzja29DheIb2Dgfa7E/R43Si83k3Bt2fKCFJiEQieys8qBVCdiDLq6ur+D03h5mZGSwvL2NlZQWBQICOhCQUCm2SEXX7KnQN9KO27g4e2ZrRbGtBa+sTNDTUo+/Fy79s7ke2qXBhYQGLi0HMz89z8NPR7/cfWNU2QnJzxNZuz2GINgnHvo2iueUxrlfewPjEBA2SA7baPJTCVe7j//w1jbHxcc724jZlvBTuTNp6o7w6xcv1oGvAhaGhL3j7rh8jI6OI8LC6rbA3EkOh8JHsUsIgVzLT09OY44qbYHZ2FgEuxvsbvne5cKumBvW3a9F0rxGVFRV49frNodpt114mpbL+Nwlt1iUvhUtLS7RTSP/6/QFq90iEP3zf4Xa7MfR5CMPDX/Hh4yCCwSB/wn8t8L7ljXrbCb6kfwBgoxYXcTdGKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"Bookshelf list\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-3fe9a.png\\\"\\n        srcset=\\\"/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-54c53.png 198w,\\n/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-3fe9a.png 385w\\\"\\n        sizes=\\\"(max-width: 385px) 100vw, 385px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<h3 id=\\\"새로운-책을-등록하기\\\"><a href=\\\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%B1%85%EC%9D%84-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>새로운 책을 등록하기</h3>\\n<p>웹 페이지에서 새로운 책을 등록하기 위해서는 <code class=\\\"language-text\\\">new</code>, <code class=\\\"language-text\\\">create</code> 액션과 패러매터를 전달해 줄 <code class=\\\"language-text\\\">Form</code> 이 필요할 것이다. 먼저 <code class=\\\"language-text\\\">books#new</code>, <code class=\\\"language-text\\\">books#create</code> 액션을 생성해 준 뒤에 라우팅을 조금 깔끔하게 다듬어주도록 한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/config/routes.rb</span>\\nroot to<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'home#index'</span>\\nresources <span class=\\\"token symbol\\\">:books</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:index</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:new</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:create</span><span class=\\\"token punctuation\\\">]</span>\\n</code></pre>\\n      </div>\\n<p>하나미는 REST를 기본적으로 지원한다. 2번째 줄에서 사용 된 <code class=\\\"language-text\\\">resources</code> 는 보통 레일즈 라우트 파일에서 자주 보았던 그 <code class=\\\"language-text\\\">resources</code> 메서드처럼 사용하면 된다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">$ bundle exec hanami routes\\n        Name Method     Path           Action\\n\\n        root GET, HEAD  /              Web::Controllers::Home::Index\\n       books GET, HEAD  /books         Web::Controllers::Books::Index\\n    new_book GET, HEAD  /books/new     Web::Controllers::Books::New\\n       books POST       /books         Web::Controllers::Books::Create</code></pre>\\n      </div>\\n<p>다음은 <code class=\\\"language-text\\\">new</code> 템플릿에 폼 헬퍼(Form helper) 를 이용하여 간단한 폼을 작성해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-markup\\\"><code class=\\\"language-markup\\\"># apps/web/templates/books/new.html.erb\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>h2</span><span class=\\\"token punctuation\\\">></span></span>Add book<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>h2</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n&lt;%=\\n  form_for :book, routes.books_path do\\n    div class: 'input' do\\n      label      :title\\n      text_field :title\\n    end\\n\\n    div class: 'input' do\\n      label      :author\\n      text_field :author\\n    end\\n\\n    div class: 'controls' do\\n      submit 'Create Book'\\n    end\\n  end\\n%>\\n</code></pre>\\n      </div>\\n<p>폼 헬퍼의 구조가 레일즈의 <code class=\\\"language-text\\\">form_for</code> 헬퍼와는 사뭇 다르다. 간단하게 차이점을 이야기하자면 하나미의 <code class=\\\"language-text\\\">form_for</code> 는 레일즈의 <code class=\\\"language-text\\\">form_tag</code> 헬퍼에 가깝다고 생각하면 된다. <a href=\\\"http://hanamirb.org/guides/helpers/forms/#technical-notes\\\">하나미 가이드에 따르면</a> <code class=\\\"language-text\\\">form_for do |f|</code> 형식으로 작성하는 것은 올바른 ERB 템플릿이 아니며, 하나미의 폼 헬퍼는 템플릿 엔진에 의존하지 않고 사용할 수 있도록(어느 템플릿 엔진을 사용하던 같은 루비 코드를 사용하도록) 구성되어 있다.</p>\\n<p><code class=\\\"language-text\\\">routes.books_path</code> 는 라우팅 헬퍼이며 상기 라우팅 구조에 있는 이름을 사용하여 <code class=\\\"language-text\\\">routes</code> 뒤에 메서드 형식으로 붙여주면 자동으로 경로를 연결해준다.</p>\\n<p>책을 생성하기 위한 <code class=\\\"language-text\\\">create</code> 액션은 다음과 같이 작성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/controllers/books/create.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Controllers</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Create</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Action</span>\\n\\n    expose <span class=\\\"token symbol\\\">:book</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">call</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token variable\\\">@book</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BookRepository</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:book</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n\\n      redirect_to routes<span class=\\\"token punctuation\\\">.</span>books_path\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>이후 생성된 폼에 새로운 책을 등록해보니 문제없이 책이 생성되었다.</p>\\n<h3 id=\\\"유효성-검사\\\"><a href=\\\"#%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%82%AC\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>유효성 검사</h3>\\n<p>하나미는 유효성 검사를 모델이 아닌 컨트롤러 액션에서 처리한다. 물론 엔티티 클래스에 유효성 검사를 정의할 수 있지만, 유효성 검사는 입력 이후 가장 가까운 단계에서 이루어질 것을 권장하고 있다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/controllers/books/create.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Controllers</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Create</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Action</span>\\n\\n    expose <span class=\\\"token symbol\\\">:book</span>\\n\\n    params <span class=\\\"token keyword\\\">do</span>\\n      <span class=\\\"token function\\\">required</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:book</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>schema <span class=\\\"token keyword\\\">do</span>\\n        <span class=\\\"token function\\\">required</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:title</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filled</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:str?</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token function\\\">required</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:author</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filled</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:str?</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">call</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">if</span> params<span class=\\\"token punctuation\\\">.</span>valid<span class=\\\"token operator\\\">?</span>\\n        <span class=\\\"token variable\\\">@book</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BookRepository</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:book</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n\\n        redirect_to routes<span class=\\\"token punctuation\\\">.</span>books_path\\n      <span class=\\\"token keyword\\\">else</span>\\n        <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span>status <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">422</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">params</code> 로 시작하는 유효성 검사는 엔티티를 정의해놓은 것 같은 역할을 할 수 있겠다. 자세한 내용은 <a href=\\\"http://hanamirb.org/guides/actions/parameters/\\\">가이드</a>를 참고하면 손쉽게 작성할 수 있다.</p>\\n<p>만약 패러매터가 유효하지 않다면 HTTP 상태 코드 422(Unprocessable Entity)를 리턴하고, 그에 알맞는 뷰를 다시 표현해 주어야 한다. 현재 <code class=\\\"language-text\\\">create</code> 액션에는 아무런 템플릿도 작성되어있지 않고, 실제로는 <code class=\\\"language-text\\\">new</code> 템플릿을 그대로 사용하면 되기 때문에 뷰 파일에 알맞는 템플릿을 정의해주면 된다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># apps/web/views/books/create.rb</span>\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Views</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Books</span>\\n  <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Create</span>\\n    include <span class=\\\"token constant\\\">Web</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">View</span>\\n    template <span class=\\\"token string\\\">'books/new'</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>지금까지 하나미를 통해 간단한 웹 애플리케이션을 개발하는 과정을 살펴보았다. 아주 기초적인 부분만 설명하였지만, 가이드를 살펴보고 하나미의 기능에 조금 더 익숙해진 뒤에는 github에 올라와 있는 몇몇 프로젝트 소스를 살펴보면서 하나미를 파악해보는 것을 추천한다.</p>\\n<p>개인적으로 <a href=\\\"https://github.com/bruz/bookshelf-delivery-example\\\">이 Github 저장소</a>를 방문해 보는 것을 추천한다. 하나미의 컨테이너 구조 및 컨트롤러 액션과 비지니스 로직을 구분하는 예를 잘 보여준 코드로 구성되어있다.(<code class=\\\"language-text\\\">lib</code> 폴더 안에 있는 <code class=\\\"language-text\\\">interactors</code> 폴더에 주목하라)</p>\\n<p>본 포스팅에 사용된 코드는 <a href=\\\"https://github.com/emaren84/hanami-introduction\\\">여기서</a> 확인해 볼 수 있다.</p>\\n<h2 id=\\\"결론\\\"><a href=\\\"#%EA%B2%B0%EB%A1%A0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>결론</h2>\\n<p>루비는 일반적 용도의 언어로써 충분히 완성도가 있는 언어이지만 상대적으로 다양한 분야에서 사용되는 파이썬에 비해 어느샌가 웹 개발에만 쓰이는 언어라는 선입견이 심어지게 되었다. 그리고 이러한 선입견의 중심엔 레일즈가 있다.</p>\\n<p>레일즈가 등장하고 루비라는 언어가 크게 알려지는 데 기여한 것은 사실이다. 하지만 이 세상에 특정 문제 해결을 위한 단 하나의 정답은 거의 없다. 루비라는 언어 자체도 하나의 문제를 해결 하는데 다양한 방법을 제시하는 언어이기도 하다.</p>\\n<p>하나미의 등장도 이런 맥락에서 바라볼 수 있다. 단순히 레일즈만이 루비로 웹 애플리케이션을 만드는 최고의 방법이 아니며, 하나미를 잘 활용하면 레일즈에 비해 유지보수가 쉽고, 더 성능이 좋은 웹 애플리케이션을 작성할 수도 있을 것이다.</p>\\n<p>물론 하나미는 나온지 얼마 되지 않은 프레임워크이고, 기능 구현이 레일즈에 비해 상대적으로 부족한 점도 있다. <strong>특히 문서화가 되어있지 않아 소스 코드를 이리저리 살펴보아야 하는 부분들이 아직 많이 있다는 점이 아쉽다.</strong> 하지만 충분한 발전 가능성을 지니고 있고, 진정 루비라는 언어로 프로그래밍을 하는 재미를 주는 것이 매력적이기 때문에 루비 언어 자체를 좋아하는 사람들이라면 한번 사용해 볼 것을 추천한다.</p>\\n<p>하나미의 정보를 더 얻고자 하는 분들에게는 다음의 링크를 살펴보면 된다.</p>\\n<ul>\\n<li><a href=\\\"http://hanamirb.org/guides/\\\">하나미 공식 가이드</a> + <a href=\\\"https://github.com/hanami/hanami\\\">소스 코드</a></li>\\n<li><a href=\\\"https://gitter.im/hanami/chat\\\">하나미 Gitter 채팅방</a></li>\\n<li><a href=\\\"https://github.com/davydovanton/awesome-hanami\\\">유용한 젬 및 링크 공유</a></li>\\n</ul>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-12-03-hanami-introduction/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-12-03\",\"path\":\"/posts/hanami-introduction\",\"title\":\"레일즈(Ruby on Rails)와는 또 다른 루비 웹 프레임워크, Hanami(하나미)\",\"tags\":[\"Ruby\",\"Rails\",\"Hanami\"],\"category\":\"Hanami\"}},{\"excerpt\":\"MealMeetUpTask 구현 이번엔 개별 구성원의 상태를 변경해주는 메서드를 작성해야 한다.\\n유저의 정보를 받고, 그 사람의 MealLog를 업데이트 해 주고, 마지막으로 MealMeetUpTask도 업데이트 해 주는 과정으로 이어질 것이다. Task - menu 작업을 하기에 앞서 작성해놓은 API…\",\"html\":\"<h2 id=\\\"mealmeetuptask-구현\\\"><a href=\\\"#mealmeetuptask-%EA%B5%AC%ED%98%84\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MealMeetUpTask 구현</h2>\\n<p>이번엔 개별 구성원의 상태를 변경해주는 메서드를 작성해야 한다.\\n유저의 정보를 받고, 그 사람의 MealLog를 업데이트 해 주고, 마지막으로 MealMeetUpTask도 업데이트 해 주는 과정으로 이어질 것이다.</p>\\n<h3 id=\\\"task---menu\\\"><a href=\\\"#task---menu\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Task - menu</h3>\\n<p>작업을 하기에 앞서 작성해놓은 API에 더 부족한 부분은 없는지 고려해보기로 하였다.\\n(지금도 충분히 미완성이지만) 여태까지의 구현은 대부분 이 명세서를 보고 똑같이 데이터가 들어오면 저장을 하고, 같은 형태로 자료를 내보내는 데 초점을 맞추고 있었기 때문이다.\\n하지만 명세서만 보고 맹목적으로 기능구현을 하다가 중복 처리 등을 놓치는 실수를 하게 되었으니 조심해야 한다.</p>\\n<p>메뉴를 등록하는 과정을 순서대로 구성해보면 이런 방식으로 이루어질 것이라 예상한다.</p>\\n<ol>\\n<li>패러미터의 유효성을 검사한다 -> 400 or 401에러</li>\\n<li>유효한 패러미터임이 확인되면 MeetUp을 조회한다</li>\\n<li>MeetUp에 해당 유저가 있는지 조회한다 -> 없다면 400에러</li>\\n<li>유저가 존재하면 MealLog와 Task를 업데이트한다.</li>\\n<li>업데이트한 데이터를 기반으로 리턴 데이터(JSON)를 어댑터로 내보낸다.</li>\\n</ol>\\n<p><em>과정을 떠올리면서 갑자기 생각난 것이 왠지 <code class=\\\"language-text\\\">meetup#create</code> 하면서 이미 등록된 User가 맴버로 들어갔을 때 해당 MeetUp에 연결되는 새로운 Log와 Task를 생성하고 연결해주는 작업을 제대로 수행했는지 잘 기억이 안난다. 나중에 확인해봐야겠다.</em></p>\\n<p>4번의 경우에는 테이블 구조가 생각보다 복잡하게 얽혀 있다는 점을 감안하여 User, Log, Task 테이블들을 <code class=\\\"language-text\\\">join</code> 한 다음 <code class=\\\"language-text\\\">user_id</code>, <code class=\\\"language-text\\\">meal_meet_up_id</code> 가 일치하는 Log, Task를 검색하고 갱신하도록 만들면 될 것이라고 생각한다.\\n지금이야 적은 데이터를 다루니까 굳이 테이블을 조인해가면서 검색할 필요가 없다고 여길 수도 있지만, 만약에 사용성이 있어서 한 유저가 여러번 사용을 한 다고 가정하면 한 유저가 각기 다른 MeetUp에 등록되는 일이 당연히 있을 것이다. 그 부분을 간과하지 않도록 노력해야겠다.</p>\\n<hr>\\n<p>먼저 패러미터의 유효성을 검사하는 부분을 생각하다 보니, 기존에 있던 패러미터 검사 메서드들은 패러미터를 두개씩 검사하였지만, 이번에는 검사할 패러미터가 늘어났다(3~4개).\\n거기다 메뉴를 추가하는 액션과 status만 업데이트하는 액션은 검사할 패러미터가 다르기에 하나의 <code class=\\\"language-text\\\">check_params</code> 메서드로 모든 조건을 만족할 수는 없게 되었다. 패러미터마다 일일이 <code class=\\\"language-text\\\">empty?</code> 를 넣어 확인해보고, 그걸 <code class=\\\"language-text\\\">and</code> 나 <code class=\\\"language-text\\\">or</code> 로 줄줄이 잇는 것은 꽤 복잡하고 불필요한 작업이다.</p>\\n<p>그런데 구현하면서 전보다 조금은 나은 형태로 검사를 할 수 있는 아이디어가 떠올랐다. 검사할 패러매터들을 전부 배열에 넣은 뒤에 경우에 따라 <code class=\\\"language-text\\\">any?</code> 혹은 <code class=\\\"language-text\\\">all?</code> 메서드를 사용하여 검사를 하는 것이다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># 기존 검사방법</span>\\n<span class=\\\"token keyword\\\">def</span> params_valid<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token operator\\\">!</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n        <span class=\\\"token operator\\\">!</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_ids</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> params_authorizable<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token operator\\\">!</span>email_invalid<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n        <span class=\\\"token operator\\\">!</span>member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token comment\\\"># 새로운 검사방법</span>\\n<span class=\\\"token keyword\\\">def</span> params_valid<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token punctuation\\\">[</span>task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:price</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:menu</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>all<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">|</span>e<span class=\\\"token operator\\\">|</span> <span class=\\\"token operator\\\">!</span>e<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> params_authorizable<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token operator\\\">!</span>email_invalid<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token punctuation\\\">[</span>task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n        task_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>all<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">|</span>e<span class=\\\"token operator\\\">|</span> <span class=\\\"token operator\\\">!</span>e<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>여러번 반복할 일을 많이 줄여서 조금이 더 깔끔한 코드가 작성되었다.</p>\\n<p>다음은 메뉴를 기록하고 Task의 상태를 업데이트 하기 위해 필요한 정보들을 조회하고, 정보가 존재하는지 찾아야한다.\\n해당 MeetUp을 찾는 것은 당연하고, User와 조합하여 찾는 Log, Task가 있는지 찾아야한다. 이 작업은 joins를 사용하면 될 것으로 생각하고, 콘솔에서 연습삼아 데이터 조회를 시도해보았다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">tasks = MealMeetUpTask.joins(:meal_meet_up, :meal_log) # has_many, belongs_to에 따라 단수, 복수 유의\\ntasks.where(meal_meet_ups: { id: 1}, meal_logs: { user_id: 4} ) # 자료추출 성공. 두 값에 모두 해당하는 task만 나온다.\\n\\nlogs = MealLogs.joins(:user, :meal_meet_up_tasks)\\nlogs.where(meal_meet_up_tasks: { meal_meet_up_id: 1 }, users: { id: 1 })</code></pre>\\n      </div>\\n<p>이런식으로 자료를 가져와서 기록하면 될 것으로 보인다. 예시로 작성해본 join은 저렇게 광범위하게 하기 보단, 특정 MeetUp, 특정 User를 찾도록 먼저 where를 입력한 뒤에 <code class=\\\"language-text\\\">joins</code> 를 사용하면 더욱 효과적일 것이다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">MealLog.where(user_id: 1).joins(:meal_meet_up_tasks).where(meal_meet_up_tasks: {meal_meet_up_id: 1})</code></pre>\\n      </div>\\n<hr>\\n<p>마지막 기록을 하고 잠시 작업을 손 못 대고 있다가 다시 시작하려니 개념을 많이 잊어버서 꽤 혼란스러웠다.\\n다시 복습삼아 노트에 적어보니 Log를 찾으려면 다음과 같은 생각들이 떠올랐다.</p>\\n<ul>\\n<li>Log와 Task는 1:1 관계이다</li>\\n<li>User와 MeetUp 정보만으로 Log와 Task를 찾는 과정이 조금 복잡하다</li>\\n</ul>\\n<p>일단 Log 모델에서 <code class=\\\"language-text\\\">has_many</code> 로 관계를 설정해 둔 것을 <code class=\\\"language-text\\\">has_one</code> 으로 변경하였다.\\nLog를 먼저 찾아야 할지 Task를 먼저 찾아야 할지가 문제인데 Log를 먼저 찾는 시나리오를 떠올려 보기로 했다.</p>\\n<ol>\\n<li>User1이 MeetUp1에 등록되어있다. MeetUp에 User1이 등록될 때 Log1, Task1을 생성하였다.</li>\\n<li>MealMeetUpTask 컨트롤러에서는 User1의 id와 MeetUp1의 id를 패러미터로 넘긴다.</li>\\n<li>여기서 User1이 가진 Log 중 Log의 Task를 조회한다. 어떻게 조회하냐면 Task의 meet<em>up</em>id가 1인 로그를 가져오는 것이다. Log-Task는 1:1 관계이기 때문에 그렇게 복잡하지 않다.</li>\\n<li>Log를 업데이트 하고 나면 연결된 Task를 업데이트한다.</li>\\n</ol>\\n<p>가정을 실험해 보기 위해 MeetUp을 두개 생성하고 같은 맴버들을 집어넣으려고 했는데 새 MeetUp에는 맴버가 한명도 들어가지 않는 오류가 발생해서 이를 먼저 해결해야겠다.</p>\\n<hr>\\n<h3 id=\\\"맴버-등록-버그-수정\\\"><a href=\\\"#%EB%A7%B4%EB%B2%84-%EB%93%B1%EB%A1%9D-%EB%B2%84%EA%B7%B8-%EC%88%98%EC%A0%95\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>맴버 등록 버그 수정</h3>\\n<ul>\\n<li>MeetUp를 여러 개 생성하고 나서 같은 맴버를 다른 MeetUp에 등록할 시 등록이 안된다.</li>\\n<li>MeetUp에 맴버를 등록할 때 만약에 해당 맴버가 없으면 User의 <code class=\\\"language-text\\\">init_member</code> 메서드로 연결되는데, 이 메서드는 단순히 전체 DB에서 중복되는 맴버가 있는지 검사하고 아예 없을때만 User를 새로 생성하는 역할을 한다.</li>\\n<li>문제를 해결하려면 DB에 같은 맴버가 있지만 다른 MeetUp에 등록할 시 처리를 따로 해 주어야겠다.</li>\\n</ul>\\n<p>모델 구조가 내가 생각하던 것 보다 복잡하다보니 문제 해결을 위한 아이디어가 바로 떠오르지 않는게 아쉽다. 유저를 등록할 때의 경우의 수를 다시 상정해보면</p>\\n<ul>\\n<li>Meetup과 member를 모두 처음 등록하는 경우: 문제 없음. 그냥 해당 MeetUp의 Task 명단에 맴버가 없으니 바로 새로운 User > Log > Task 생성</li>\\n<li>Meetup 한개에 Member가 추가 등록되는 경우: 문제 없음. DB에 등록되어 있지 않은 User면 똑같이 User > Log > Task 생성</li>\\n<li>MeetUp 갯수에 상관 없이 DB에 등록된 적 있는 User를 등록하려고 할 때: 이 때가 문제. 현재는 단순히 User가 존재하지 않으면 새로 생성하는것 까지만 한다.</li>\\n</ul>\\n<p>그럼 세번째 문제를 해결하기 위해 필요한 것은 <strong>User가 있는지 검사하고</strong>, <strong>있다면 해당 User가 MeetUp에 등록되어있는지 검사하고</strong>, <strong>MeetUp에 등록되어있지 않다면 해당 MeetUp과 연결되는 Log, Task를 생성</strong> 하는 과정일 것이다.</p>\\n<p>결국 User 모델을 조금 수정해주어서 해결할 수 있었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token comment\\\"># 새로운 맴버 등록시 필요한 일련의 과정들</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">if</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n      result <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">enroll_new_user</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">elsif</span> user <span class=\\\"token operator\\\">&amp;&amp;</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n      result <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">enroll_exist_user</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    result <span class=\\\"token comment\\\"># Admin 등록을 위해 user정보가 리턴되어야 함</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  <span class=\\\"token comment\\\"># DB에 기록되어있지 않은 맴버를 새로 생성</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">enroll_new_user</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  <span class=\\\"token comment\\\"># DB에 등록된 적 있는 맴버가 새로운 MeetUp에 등록되는 경우</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">enroll_exist_user</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                          task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token comment\\\"># 해당 user의 MeetUp등록 여부를 찾기 위해 Log > Task 연결하여 검색</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup_id<span class=\\\"token punctuation\\\">)</span>\\n    meal_logs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">joins</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">:meal_meet_up_task</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">where</span><span class=\\\"token punctuation\\\">(</span>meal_meet_up_tasks<span class=\\\"token punctuation\\\">:</span>\\n                                              <span class=\\\"token punctuation\\\">{</span> meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup_id <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>MeetUp에 User가 등록되어있는 지 여부는 MeetUp에 속한 Task가 있는지 여부로 구분하였다. 맴버가 등록된 적이 없으면 MeetUp에 해당하는 Log, Task를 작성한 적이 없을 테니까.\\n수정해놓고 중간에 admin 등록하는 부분이 꼬이긴 했는데 해당 user를 반드시 리턴해주어야 그 정보로 admin을 등록하도록 설정해 두었기 때문이다.</p>\\n<p><code class=\\\"language-text\\\">find_enrolled_meetup</code> 메서드가 실제로 User 모델과는 관련이 좀 적어보이지만, 적어도 User에 등록된 Log를 가져오는 것 부터 시작하니 괜찮을 것이다.</p>\\n<h3 id=\\\"다시-task---menu\\\"><a href=\\\"#%EB%8B%A4%EC%8B%9C-task---menu\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>다시 Task - Menu</h3>\\n<p>버그를 수정하면서 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 을 만들어서 뜻밖의 밑작업이 완료되었으니 나머지는 실질적으로 메뉴 추가가 가능하도록 만들면 된다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># meet_up_tasks_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> menu\\n    <span class=\\\"token variable\\\">@meetup</span> <span class=\\\"token operator\\\">=</span> find_meetup\\n    <span class=\\\"token variable\\\">@meal_log</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update_menu</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">,</span> task_params<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_201</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">menu_response</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meal_log</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n<span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update_menu</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">,</span> user_info <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\"># 해당 MeetUp에 속하는 MealLog</span>\\n    user_log<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>menu_name<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:menu</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> price<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:price</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    user_log\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>그런데 이상하게 정보 업데이트가 되지 않는 문제가 있어서 확인해보니 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 의 결과가 배열로 리턴되는 것이었다. 어차피 나올 값은 하나밖에 없는데..\\n알고보니 결과를 검색할 때 <code class=\\\"language-text\\\">where</code> 를 사용하면 배열로 리턴되고, <code class=\\\"language-text\\\">find_by</code> 를 쓰면 검색 결과의 첫 번째 결과를 리턴한다고 한다. 막연하게 결과값이 하나만 나오는 건 알고 있었는데 이제 제대로 활용해야지.</p>\\n<p>결과값을 리턴하는 JSON을 만들 때 기존에는 해당하는 값을 일일이 DB에서 꺼내오는 방식의 메서드를 작성했었는데, 막상 '굳이 그럴 필요가 있나?' 라는 생각이 들었다. 멘토님은 '어떻게 구현하는게 좋은 설계일까?' 고민해보고 실제 상황이 닥치면 그 상황에 맞는 최적의 솔루션을 도출하는 연습이 필요하다고 조언해주셨다.</p>\\n<p>지금 당장은 이정도 검색을 한다고 부하가 걸리는 수준이 아니고 나중에 변화가 생길 수도 있는 점을 고려하여 기존 방식대로 DB에서 해당 값을 가져오는 방식을 택했다.</p>\\n<h3 id=\\\"api-명세-수정\\\"><a href=\\\"#api-%EB%AA%85%EC%84%B8-%EC%88%98%EC%A0%95\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>API 명세 수정</h3>\\n<p>야밤의 토론을 통해 API 명세가 좀 문제가 있다는 점을 깨달았다. 애초에 이메일을 패러미터로 받을 필요가 별로 없고, 메신저 종류와 <code class=\\\"language-text\\\">service_uid</code> 를 기본으로 받는 형태로 DB 구조와 현재 메서드를 전부 수정해야한다.</p>\\n<p>명세서는 수정하였고, DB는 딱히 수정하지 않고 내부 로직만 변경하여도 충분할 것 같다.</p>\\n<p>API를 좀 다듬어서 작성하고 나니 코드를 변경하는게 쉬워졌는데, 작성하는 코드에 일관성이 부여되기 때문이다.\\n패러미터의 유효성을 검사하는 부분과, MeetUp을 검색하는 메서드를 <code class=\\\"language-text\\\">application_controller</code> 하나에 두고 관리할 수 있게 되었다.\\n또한 <code class=\\\"language-text\\\">routes.rb</code> 에 미리 <code class=\\\"language-text\\\">format</code> 을 json으로 지정해두어서 일일이 <code class=\\\"language-text\\\">respond_to</code> 를 사용하지 않고 오류 경우의 수에 따라 에러 메세지를 각기 다르게 출력할 수 있도록 변경하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># application_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> find_meetup\\n    <span class=\\\"token variable\\\">@meetup</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealMeetUp</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>messenger_room_id<span class=\\\"token punctuation\\\">:</span>\\n                                 params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:data</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n\\n<span class=\\\"token comment\\\"># members_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n    <span class=\\\"token keyword\\\">def</span> check_meetup\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">!=</span> <span class=\\\"token string\\\">'created'</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot add members to this meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'there is no member to enroll'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>이런식으로 find_meetup은 어느 컨트롤러에서 호출하여 같은 결과값을 얻고, 경우의 수에 따라 다른 에러를 표시하도록 적용하였다.</p>\\n<h3 id=\\\"task---update\\\"><a href=\\\"#task---update\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Task - Update</h3>\\n<p>Update 액션은 menu를 만들 때 미리 작성해둔 메서드들 덕에 생각보다 금방 완성되었다.\\nUser 모델에 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 을 사용하면 해당 유저와 유저가 참여한 MeetUp에 맞는 MealLog를 가져온다. 거기에 바로 1:1로 연결되어있는 Task를 꺼내고, 그 Task를 업데이트 해주는 식으로 코드를 작성하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update_task_status</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">,</span> user_info <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    task_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_task_status</span><span class=\\\"token punctuation\\\">(</span>user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> user_info<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    task <span class=\\\"token operator\\\">=</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>meal_meet_up_task\\n    task<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    task\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"맴버-삭제-기능-추가\\\"><a href=\\\"#%EB%A7%B4%EB%B2%84-%EC%82%AD%EC%A0%9C-%EA%B8%B0%EB%8A%A5-%EC%B6%94%EA%B0%80\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>맴버 삭제 기능 추가</h2>\\n<p>처음에 미처 계획에 없었던 'MeetUp에 추가된 맴버를 삭제하는 기능'을 추가하기로 하였다.\\n어찌 보면 당연히 있어야 하는 기능인데 실수로 넣지 않았다고 생각하는 쪽이 빠를 수도 있겠다.</p>\\n<p>맴버를 MeetUp에서 삭제하는 것은 유저를 통채로 삭제할 필요는 없겠지만, 해당하는 MealLog, MeetUpTask는 삭제해줄 필요가 있겠다. 만약에 다시 등록할 때는 새로 만들어줘야 하는게 맞다고 생각하니까.</p>\\n<p>기존에 구현해 둔 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 을 사용하면 해당 MeetUp에 속해있는 MealLog가 리턴되니까 이 로그를 삭제하도록 하고, 로그에 연결된 Task도 자동으로 삭제되도록 조치해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/meal_log.rb</span>\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MealLog</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Base</span>\\n  has_one <span class=\\\"token symbol\\\">:meal_meet_up_task</span><span class=\\\"token punctuation\\\">,</span> dependent<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:destroy</span>\\n  belongs_to <span class=\\\"token symbol\\\">:user</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>맴버 삭제를 하기 전에 패러미터에 따라 고려해야 할 사항은 다음과 같다.</p>\\n<ul>\\n<li>해당하는 MeetUp이 존재하는가?</li>\\n<li>admin_uid가 입력되었는가? -> 오류(admin은 삭제 불가능)</li>\\n<li>삭제하고자 하는 맴버가 해당 MeetUp에 등록되어 있는가?</li>\\n</ul>\\n<p>위 조건을 모두 만족한다면 정상적으로 해당 유저의 MealLog, Task를 삭제해주면 될 것이다.</p>\\n<p>맴버를 추가할 때와 삭제할 때 한꺼번에 패러미터를 검사하는 메서드를 만들면 좋겠는데, 약간 차이가 있기 때문에 조금 비슷한 부분이 있더라도 따로 작성하게 되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># members_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> delete_member\\n    target_member <span class=\\\"token operator\\\">=</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s\\n    <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">delete_member</span><span class=\\\"token punctuation\\\">(</span>target_member<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_200</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">member_response</span><span class=\\\"token punctuation\\\">(</span>find_meetup<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token comment\\\"># ...</span>\\n    <span class=\\\"token keyword\\\">def</span> check_add_member\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">!=</span> <span class=\\\"token string\\\">'created'</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot add members to this meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'there is no member to enroll'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> check_delete_member\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      member_id <span class=\\\"token operator\\\">=</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>service_uid <span class=\\\"token operator\\\">==</span> member_id\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot delete admin member'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> <span class=\\\"token function\\\">get_members_list</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>member_id<span class=\\\"token punctuation\\\">)</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find the member_id in this meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n               status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n\\n<span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">delete_member</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    target_log <span class=\\\"token operator\\\">=</span> user<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_enrolled_meetup</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    target_log<span class=\\\"token punctuation\\\">.</span>destroy\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>얼떨결에 <code class=\\\"language-text\\\">find_enrolled_meetup</code> 메서드가 대부분의 문제를 손쉽게 해결해주었다. 단순하게 joins 구문만 적절하게 이용해 주었을 뿐인데. MealLog에 설정해둔 <code class=\\\"language-text\\\">dependency</code> 도 잘 작동하였다.</p>\\n<h2 id=\\\"입력받은-가격을-분배하기\\\"><a href=\\\"#%EC%9E%85%EB%A0%A5%EB%B0%9B%EC%9D%80-%EA%B0%80%EA%B2%A9%EC%9D%84-%EB%B6%84%EB%B0%B0%ED%95%98%EA%B8%B0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>입력받은 가격을 분배하기</h2>\\n<p>이 앱의 제일 핵심기능인 'n빵 / 각자 입력하여 얼마를 내야 하는지 알리기' 기능이 여태까지 빠져 있었다.</p>\\n<ul>\\n<li>n빵 / 각자 입력을 나누는 스테이터스 코드</li>\\n<li>MeetUp의 total<em>price가 없으면 맴버의 메뉴 등록을 막기 (먼저 total</em>price가 등록되어있어야함)</li>\\n<li>모든 맴버가 가격 입력을 완료하면 MeetUp의 상태를 <code class=\\\"language-text\\\">completed</code> 로 변경</li>\\n</ul>\\n<p>이런 기능이 추가적으로 구현될 필요가 있는데 먼저 코드테이블에 자료를 입력하는 seed파일을 수정하여 price를 지우고 <code class=\\\"language-text\\\">price_avg</code>, <code class=\\\"language-text\\\">price_sep</code> 두 가지 상태로 나누었다.</p>\\n<p>그리고 MeetUp을 업데이트 할 때 <code class=\\\"language-text\\\">price_avg</code> 상태일 때만 N빵 가격을 계산해서 각각 유저들의 Log에 해당 가격을 입력하도록 만들어 두었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/meal_meet_up.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">update_status</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">,</span> meetup_status<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">if</span> meetup_status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'price_avg'</span>\\n      <span class=\\\"token function\\\">price_avg</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n      <span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">:</span> total_price<span class=\\\"token punctuation\\\">.</span>to_i<span class=\\\"token punctuation\\\">,</span>\\n             meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_meetup_status</span><span class=\\\"token punctuation\\\">(</span>meetup_status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">price_avg</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">)</span>\\n    avg_price <span class=\\\"token operator\\\">=</span> total_price <span class=\\\"token operator\\\">/</span> meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span>count\\n    meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">each</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>task<span class=\\\"token operator\\\">|</span>\\n      task<span class=\\\"token punctuation\\\">.</span>meal_log<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>price<span class=\\\"token punctuation\\\">:</span> avg_price<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>모든 맴버가 가격을 입력하도록 하는 메서드는 맴버가 상태를 업데이트 하는 메서드 마지막 부분에 따로 심어두었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/meal_meet_up_task.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> check_completed\\n    result <span class=\\\"token operator\\\">=</span> meal_meet_up<span class=\\\"token punctuation\\\">.</span>meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span>all<span class=\\\"token operator\\\">?</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>task<span class=\\\"token operator\\\">|</span>\\n      task<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'paid'</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    completed_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_meetup_status</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'completed'</span><span class=\\\"token punctuation\\\">)</span>\\n    meal_meet_up<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">:</span> completed_code<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">if</span> result\\n  <span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h3 id=\\\"n빵-분배하고-난-뒤에-고려하지-못한-것들\\\"><a href=\\\"#n%EB%B9%B5-%EB%B6%84%EB%B0%B0%ED%95%98%EA%B3%A0-%EB%82%9C-%EB%92%A4%EC%97%90-%EA%B3%A0%EB%A0%A4%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%9C-%EA%B2%83%EB%93%A4\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>n빵 분배하고 난 뒤에 고려하지 못한 것들</h3>\\n<ul>\\n<li>MeetUp의 상태가 <code class=\\\"language-text\\\">price_avg</code> 일 때 개별 맴버들이 메뉴를 수정하는 것을 차단해야했다</li>\\n<li>맴버들이 가격만 수정하려고 하는데도 메뉴도 입력하라는 오류가 발생</li>\\n<li>상태 업데이트 없이 MeetUp의 현재 상태를 점검할 수 있도록 하는 API 추가</li>\\n</ul>\\n<p>점점 처리해야하는 에러 경우의 수들이 늘어나면서 rubocop에 걸리기가 쉬워지고 있다.\\n에러 처리도 파트별로 나누어야 할지, 더 쪼갤 수 있는 방법이 있을지 고민해보아야 할 것 같다.</p>\\n<p>위 두가지 버그성 문제들은 생각보다 간단하게 해결할 수 있었다. 첫 번째 문제와 두 번째 문제 모두 필터에서 걸러내는 경우의 수를 약간 조정해주는 정도로 해결되었고, 마지막 문제도 MeetUp을 그대로 조회하여 보여주기만 하면 되기 때문에 금방 처리하였다.</p>\\n<p>이후에는 새 맴버를 추가받지 못하도록 고려하는 타이밍이 언제 이루어져야 하는가에 대한 문제가 있었는데</p>\\n<ul>\\n<li>세팅이 끝났다는 커맨드를 직접 날리려서 처리하거나 (DB에 새로운 필드 추가)</li>\\n<li>맴버 추가가 잠기는 시점을 변경 (기존엔 MeetUp 상태가 'created'일 때만 맴버 추가 가능)</li>\\n</ul>\\n<p>조금 돌아가는 길이더라도 첫 번째가 깔끔하게 될 것이라 생각되어 새로운 필드 <code class=\\\"language-text\\\">member_fixed</code> 를 MeetUp 모델에 추가하고, 메서드 수정을 가하기로 했다.</p>\\n<ul>\\n<li>MeetUp 모델에 member_fixed (BOOL) 필드 추가</li>\\n<li>새 MeetUp 생성시 member_fixed (default false)</li>\\n<li>MeetUp 모델 Update시 member_fixed 값 확인하도록 수정 (없으면 에러)</li>\\n<li>맴버 등록 할 때 member_fixed가 true이면 에러 출력</li>\\n<li>맴버 삭제시엔 굳이 그 여부 확인 안해도 될듯</li>\\n</ul>\\n<p>이렇게 비교적 간단히 해결할 문제로 생각했으나 맴버가 변경되는 시점에 따라 자동으로 금액 재조정을 해 주어야 할지 이미 금액을 지불한 인원의 경우엔 상태를 어떻게 처리해야 할지 정책적인 부분을 고려할 필요가 있어서 생각보다 굉장히 복잡한 문제였다.</p>\\n<p>아마 초기에 기획, 설계 회의를 할 때 이 문제가 도마에 올랐었다가 얼렁뚱땅 미루어진 것 같았는데, 이번 작업에는 결국 수정을 포기하는 쪽으로 가기로 했다.</p>\\n<p>자잘한 버그를 잡으면서 또 뼈저리게 느낀건데 패러미터로 들어온 타입과(보통 String) 내가 처리하려고 하는 타입(예를 들면 Integer)이 다르면 형변환을 제때제때 해 주어야 하는 것을 잊으면 안되겠다. 자꾸 그런 부분에서 버그가 발생하고 있다.</p>\\n<p>또 발견된 버그는 총 금액보다 큰 값을 개별 맴버가 입력하려할 때 차단하는 수단이 없다는 점이다. 매번 발견되는 버그들에는 공통점이 있는데, 당장의 기능은 구현이 되어 있는데 유저가 프로그램 내부가 돌아가는 것을 고려하지 않고 자연스럽게 사용하다가 발생할 수 있는 모든 경우의 수를 전혀 고려하지 않고 있다는 점이다.</p>\\n<blockquote>\\n<p>음… 사실 그게 가장 고통스러우면서도 꼭 해야되는 부분입니다.\\n머리에 쥐날때까지 모든 케이스를 다 고려할 수 있는 훈련을 계속해야 고급 개발자가 될 수 있죠.</p>\\n</blockquote>\\n<p>팀원분이 이런 조언을 해주셨으니 기능 하나를 구현할 때 그로 인해 발생할 수 있는 경우의 수를 최대한 고려해보도록 노력해야겠다.</p>\\n<h2 id=\\\"meetup-상태-열람-show\\\"><a href=\\\"#meetup-%EC%83%81%ED%83%9C-%EC%97%B4%EB%9E%8C-show\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MeetUp 상태 열람 (Show)</h2>\\n<p>가격 분배 기능 구현 하면서 MeetUp의 상태를 열람하는 기능이 필요하다는 피드백이 있어 간단하게 구현을 했었다.\\n그런데 그 정도로는 부족하고 MeetUp이 있으면 관련된 모든 정보를 가져오도록 수정해야할 필요가 있었다.</p>\\n<p>또한 <code class=\\\"language-text\\\">paying_sep</code>, <code class=\\\"language-text\\\">paying_avg</code> 로 구분중이었던 지불 방법을 다른 필드로 분리해서 관리해야할 필요성도 발생하였다.</p>\\n<p>먼저 MeetUp 모델에 <code class=\\\"language-text\\\">pay_type</code> 컬럼을 추가하였다. 그리고 이번에는 CodeTable에 굳이 조회용 코드를 추가하지 않았는데, 이렇게 하는게 결국은 의미가 없다고 생각했기 때문이다.\\n애초에 입력값은 직접 String으로 받고, 검색도 그 String으로 하고, 저장만 id로 하고 있는건데 저장 부분에선 약간 효율적일 수 있겠으나 검색 부분엔 큰 차이가 없어보였기 떄문이다.</p>\\n<p><code class=\\\"language-text\\\">pay_type</code> 가 추가되면서 적어도 확실한건 MeetUp을 Update 하는 상태는 변경되어야 한다는 점이다. 그리고 status가 <code class=\\\"language-text\\\">paying</code> 일 때에는 반드시 <code class=\\\"language-text\\\">pay_type</code>가 있도록 만들어야겠다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># meal_meet_up_controller.rb</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n    <span class=\\\"token comment\\\"># 해당하는 meetup이 없거나 admin_uid가 불일치, pay_type이 올바르지 않으면 에러</span>\\n    <span class=\\\"token keyword\\\">def</span> check_meetup_update\\n      meetup <span class=\\\"token operator\\\">=</span> find_meetup\\n      <span class=\\\"token keyword\\\">if</span> meetup<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span>\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'cannot find meetup'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">400</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>service_uid <span class=\\\"token operator\\\">!=</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:admin_uid</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>to_s\\n        render json<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> error<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'invalid admin_uid'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">401</span>\\n      <span class=\\\"token keyword\\\">elsif</span> meetup<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'paying'</span> <span class=\\\"token operator\\\">||</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'paying'</span>\\n        validate_pay_type\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> validate_pay_type<span class=\\\"token operator\\\">?</span>\\n      <span class=\\\"token keyword\\\">unless</span> <span class=\\\"token string\\\">%w(n s)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:pay_type</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token function\\\">render_error_400</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'invalid pay type'</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>Show로 리턴하는 정보는 기본적으로 update시의 리턴+딸려있는 맴버들의 각종 정보이다. 그래서 먼저 update시의 리턴 정보를 가져온 다음에 필요한 정보를 덧붙이는 형태로 만들었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># meal_meet_up_helper.rb</span>\\n<span class=\\\"token comment\\\"># 컨트롤러가 너무 커져서 리턴용 json을 출력하는 메서드들을 다 헬퍼 모듈로 옮겼다.</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">response_json_show</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span>\\n    basic_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">response_json_update</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span>\\n    members_info <span class=\\\"token operator\\\">=</span> meetup<span class=\\\"token punctuation\\\">.</span>meal_meet_up_tasks<span class=\\\"token punctuation\\\">.</span>map <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>task<span class=\\\"token operator\\\">|</span>\\n      log <span class=\\\"token operator\\\">=</span> task<span class=\\\"token punctuation\\\">.</span>meal_log\\n      <span class=\\\"token punctuation\\\">{</span> member_uid<span class=\\\"token punctuation\\\">:</span> log<span class=\\\"token punctuation\\\">.</span>user<span class=\\\"token punctuation\\\">.</span>service_uid<span class=\\\"token punctuation\\\">,</span>\\n        menu<span class=\\\"token punctuation\\\">:</span> log<span class=\\\"token punctuation\\\">.</span>menu_name<span class=\\\"token punctuation\\\">,</span>\\n        price<span class=\\\"token punctuation\\\">:</span> log<span class=\\\"token punctuation\\\">.</span>price<span class=\\\"token punctuation\\\">,</span>\\n        status<span class=\\\"token punctuation\\\">:</span> task<span class=\\\"token punctuation\\\">.</span>status<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    basic_data<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:data</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>members_count<span class=\\\"token punctuation\\\">:</span> members_info<span class=\\\"token punctuation\\\">.</span>count<span class=\\\"token punctuation\\\">,</span>\\n                            members<span class=\\\"token punctuation\\\">:</span> members_info<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-08-10-easylunch-api-devlog-3/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-08-10\",\"path\":\"/posts/easylunch-api-devlog-3\",\"title\":\"Easylunch Api 서버 제작기 - 3\",\"tags\":[\"Rails\"],\"category\":\"Rails\"}},{\"excerpt\":\"Members 구현 이번엔 생성된   에 새로운 맴버를 추가하는 기능을 구현할 것이다.\\n필요한 메서드는    하나 뿐이라 생각보다 복잡하진 않을 것이라 생각된다. 먼저 Members 컨트롤러를 생성한다. 그리고 routes.rb 파일에 api 경로를 추가해준다. 텅텅 빈 Members 컨트롤러에는 기본적으로 들어갈 메서드들이 있다. Strong parameters 맴버들을 등록하기 위한 정보가 충분한지 검사 기본적인 약속 (email…\",\"html\":\"<h2 id=\\\"members-구현\\\"><a href=\\\"#members-%EA%B5%AC%ED%98%84\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Members 구현</h2>\\n<p>이번엔 생성된 <code class=\\\"language-text\\\">MealMeetUp</code> 에 새로운 맴버를 추가하는 기능을 구현할 것이다.\\n필요한 메서드는  <code class=\\\"language-text\\\">add_members</code> 하나 뿐이라 생각보다 복잡하진 않을 것이라 생각된다.</p>\\n<p>먼저 Members 컨트롤러를 생성한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">rails g controller Members</code></pre>\\n      </div>\\n<p>그리고 routes.rb 파일에 api 경로를 추가해준다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"># routes.rb\\n# ...\\npost &#39;/members&#39; =&gt; &#39;members#add_member&#39;, defaults: { format: &#39;json&#39; }</code></pre>\\n      </div>\\n<p>텅텅 빈 Members 컨트롤러에는 기본적으로 들어갈 메서드들이 있다.</p>\\n<ul>\\n<li>Strong parameters</li>\\n<li>맴버들을 등록하기 위한 정보가 충분한지 검사</li>\\n<li>기본적인 약속 (email, messenger) 정보가 제대로 작성되어 있는지 검사</li>\\n<li>해당하는 <code class=\\\"language-text\\\">messenger_room_id</code> 의 검색</li>\\n</ul>\\n<p>사실 Strong parameters를 제외한 나머지 기능들은 기존에 <code class=\\\"language-text\\\">MealMeetUp</code> 을 구현할 때 만들었던 메서드들을 거의 그대로 써도 될 것이다.\\n하지만 미묘한 차이가 있어서 지금은 새로 작성하고 나중에 리팩토링 할 때 합치기로 마음먹었다.</p>\\n<p>작업을 하다보니 조금 애매하게 생각되는 부분이 '멤버를 추가하면 DB에 어떻게 기록이 되어야 할까?' 라는 부분이다.</p>\\n<ol>\\n<li>json으로 member_id를 받고, 그 아이디로 새로운 유저를 생성한다.</li>\\n<li>그 유저에 해당하는 UserMessenger, UserLog를 생성한다.</li>\\n<li>UserLog에 속하는 MealMeetUpTask를 생성한다.</li>\\n<li>MealMeetUpTask의 meal<em>meet</em>up<em>id(외부키)는 현재 등록할 meal</em>meet_up으로 지정해준다.</li>\\n</ol>\\n<p>이렇게 하면 될 것 같은데, User의 컬럼을 <code class=\\\"language-text\\\">id(기본키) / email</code> 로 지정해둔게 걸린다. 보통 메신저에서 제공하는 user의 고유 식별 정보를 넣는데 써야 할 것 같은데, 슬랙의 경우엔 이메일이 아닌 듯 하여 아예 컬럼명을 수정해야겠다.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 790px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 55.52977571539057%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACE0lEQVQoz2VT2W4TQRDM/38EIEQiQpInIgI2DwihSBGXLzlrO7733vXa673m8KYorw9Afij1zKinprq650xKCSE0sUGWpfC8IaJoAsftw7IesVhMEARDxHEIpZgnBaPcQ+3xd38mpcZ0+huj0Xf4vg/DeI3J5Jy44NkbmPNLxlcwzQbKDSAFBRQaea6QJAXSVFTrPFOQkoRFIWHbQ6oYIQxXGA5JPm7CDwbw/D48RtfvwfHmWOcSM6uD0eQDK/iCyfQjpvMac75ibtVZmbUjzMhelqCKAZW9Z0IfmQShK+SqRJLnWEUJzEETxsMV5p072MYn2I+EUcOsfYtlYG4JBaXnFaHvD/D09JJK29AKhILWG+iNQhoniIKIuSmKVCJfC2TrghAVtvutHZVCz/Uo12FDZiy5Rc+6WIQOiW2emYiXK4hEYLmM6FmKZwCKLyotd1Ed4tbDTKPbqWEwegHLuYblXtOPS67f0bcbuMEVHHZbsezVaskHHLiuRaXrimA7JQdUhDnljxv3GH+7QdCoI2zVsWh/PsL7dQd3NkBElZblotu9ZTynPQYJnkkk/ics2PZ1EGMxD7CyQ0SmS3hYWt5+7dKjpLqQJhkb16LCe6q1SbA5VbiOYs7hT7b/AWE0hWZ3dKmJzRGH0nZDXPITlNXM/Ut2JEyTGK3mW/R6F7CtH9WvkWJfhhAnl+T+p5ye7wj/AFtbOpuebKd7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"기존에 작성된 DB 다이어그램\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-ffc88.png\\\"\\n        srcset=\\\"/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-d16f8.png 198w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-f21b1.png 395w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-ffc88.png 790w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-81e7e.png 1185w,\\n/static/2016-08-02-sc1-24c66a374eb8b785c331891b9eeaf950-14df9.png 1293w\\\"\\n        sizes=\\\"(max-width: 790px) 100vw, 790px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<hr>\\n<p>슬랙에 팀원들의 의견을 물으니 UserMessenger 테이블에 email컬럼을 넣고, User의 email은 service_uid등으로 바꾸는게 좋겠다는 의견을 받았다.</p>\\n<p>그렇게 생각하니 애매하게 보이던 맴버 추가 개념이 조금 명쾌해졌고, DB 컬럼을 먼저 수정해보기로 하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ChangeUserAndMessenger</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Migration</span>\\n  <span class=\\\"token keyword\\\">def</span> change\\n    rename_column <span class=\\\"token symbol\\\">:users</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:service_uid</span>\\n    add_column <span class=\\\"token symbol\\\">:user_messengers</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:messenger_user_email</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:string</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>다시 맴버 추가 과정을 구성한다면</p>\\n<ol>\\n<li>json으로 넘어온 member_ids에서 하나하나씩 유저를 추가한다.</li>\\n<li>유저에 해당하는 UserMessenger, UserLog를 생성한다. 만약 이메일이 있다면 이메일도 추가한다.(Optional)</li>\\n<li>UserLog에 속하는 MealMeetUpTask를 생성한다.</li>\\n<li>그리고 각 유저의 MealMeetUpTask는 현재 이용중인 MealMeetUp에 속하게 된다.</li>\\n</ol>\\n<p>조금 직관적인 느낌은 떨어지게 보인다. 바로 유저가 MealMeetUp이라는 그룹과 연결되는 것이 아니니까.\\n맴버 추가 과정을 하나의 메서드화하고, 리스폰스로 생성할 json도 메서드로 한번에 만들도록 하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MembersController</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ApplicationController</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n\\n <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">add_flow</span><span class=\\\"token punctuation\\\">(</span>member<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">)</span>\\n      user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member<span class=\\\"token punctuation\\\">)</span>\\n      user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                           messenger_code<span class=\\\"token punctuation\\\">:</span> load_messenger_code<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            task_status<span class=\\\"token punctuation\\\">:</span> init_task_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">add_user_response</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">{</span> data<span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token punctuation\\\">{</span> email<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>service_uid<span class=\\\"token punctuation\\\">,</span>\\n          messenger<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>messenger<span class=\\\"token punctuation\\\">.</span>value<span class=\\\"token punctuation\\\">,</span>\\n          messenger_room_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>messenger_room_id<span class=\\\"token punctuation\\\">,</span>\\n          member_ids<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token function\\\">get_members_list</span><span class=\\\"token punctuation\\\">(</span>meetup<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>사실 맨 밑의 member_ids는 좀 복잡하게 가져오더라도 맴버 추가에 성공한 id만 가져와야 하는게 맞을 것 같다.</p>\\n<p>실제로 실행을 시켜 보니 member_ids라는 패러매터를 아예 가져오지 못했는데, 이는 패러매터의 형식이 배열로 되어 있어서 그렇다. 배열로 된 패러매터를 가져올 때는 스트롱 패러매터에서 형식을 지정해 주어야 한다</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">params.permit(:id =&gt; [])</code></pre>\\n      </div>\\n<p>service<em>uid로 컬럼명을 수정하면서 생긴 오류들을 잡아주고 차근차근 진행하고 있다가 확실히 response의 `member</em>ids` 를 제대로 MealMeetUp에 엮여있는 유저들만 가져오는게 맞다는 생각이 들었다.\\n결국 가져와야 하는 것은</p>\\n<p><strong>MealMeetUp에 속한 Task들 -> 각 Task를 가지고 있는 MealLog -> MealLog를 소유하고 있는 User의 service_uid</strong> 인 것이다.\\nDB를 리셋하고 먼저 MealMeetUp을 하나 생성한 뒤에 유저 추가 과정을 거치니 잘 추가되었다.</p>\\n<p>커밋을 한 뒤에 멘토님이 코드 리뷰와 함께 조언들을 해 주셨다.</p>\\n<ul>\\n<li>Fat Model, Skinny Controller</li>\\n<li>컨트롤러는 최소한의 연결만 해주는 게 좋겠다.</li>\\n<li>패러미터의 여부를 체크하는 것을 굳이 본 메서드에서 할 필요가 없어 보인다. -> before_action 사용</li>\\n<li>member_ids의 유효성을 검사할 필요가 있다.</li>\\n<li>메서드 이름은 다른사람이 이름만 보아도 무엇을 하는 작업인지 알 수 있어야 한다</li>\\n<li>맴버 추가하는 일련의 과정을 담은 <code class=\\\"language-text\\\">add_flow</code> 메서드를 user모델에 정의해서 쓸 필요가 있겠다 (<code class=\\\"language-text\\\">init_member</code> 같은 이름으로)</li>\\n</ul>\\n<p>대개 리펙토링을 하면서 처리해야 하는 부분들이지만, 멤버 추가를 유저 모델에 정의하는 지금이라도 처리해야할 필요가 있다.\\n기존에 MealMeetUp을 만들 때 자동으로 어드민 유저를 생성하는데, 어드민 유저도 같은 방에 포함되는 유저로서 MealLog, Messenger, Task 등록 등의 작업을 해 주어야 한다고 생각하기 때문이다.</p>\\n<p>그런데 지금은 MealMeetUp 생성 당시 어드민 유저의 service<em>uid가 없기 때문에, 생성을 하자니 조금 애매한 부분이 있다.\\n먼저 떠오르는 생각으로는 MealMeetUp 생성만 하고 어드민은 따로 Members 추가 시에 지정하는 방법이 있겠다. 아니면 처음 MealMeetUp 생성때부터 어드민이 될 사람의 service</em>uid를 받아야 한다.</p>\\n<p><em>(추가)</em> 그냥 MealMeetUp 생성시에 어드민이 될 사람의 service_uid도 받는 방식으로 수정을 하기로 하였다.</p>\\n<p>그리고 맴버가 추가된 MealMeetUp의 상태도 변화시켜서, 추가적인 유저 입력을 막을 수 있어야한다. 지금 방식대로라면 계속 유저를 추가하는대로 새로운 유저를 집어넣고 있는데, 이는 제대로된 방법이 아니다. <em>(처리 완료)</em></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># members_controller.rb</span>\\n\\n<span class=\\\"token keyword\\\">def</span> add_member\\n    <span class=\\\"token variable\\\">@meetup</span> <span class=\\\"token operator\\\">=</span> find_meetup\\n    entry_members <span class=\\\"token operator\\\">=</span> member_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:member_ids</span><span class=\\\"token punctuation\\\">]</span>\\n    entry_members<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">each</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">|</span>member<span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>member<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\"># 맴버가 추가된 MeetUp은 상태를 변경해준다.</span>\\n    <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'paying'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n\\n    <span class=\\\"token function\\\">render_200</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">add_user_response</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"refactoring-1\\\"><a href=\\\"#refactoring-1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Refactoring (1)</h2>\\n<p>현재까지 개발한 부분을 adapter와 연동해보기 위해 조금 미진한 부분을 수정하고 허로쿠에 배포해보기로 하였다.\\n가장 우선적으로 수정해야겠다고 생각하는 부분이 처음 MealMeetUp 생성시 어드민도 <code class=\\\"language-text\\\">init_member</code> 를 해 주는 것인데, 맨 처음 MealMeetUp 생성을 구현했을 때 만든 부분에서 많은 수정을 해야겠다.</p>\\n<ul>\\n<li>MeetUp 생성시 먼저 메신저 종류, room_id만 써서 생성한다. (생성시엔 상태를 'created' 로 지정)</li>\\n<li>service<em>uid 로 user를 생성 `init</em>member` 메서드로 필요한 데이터를 다 같이 생성한다(MealLog, Messenger, Task)</li>\\n<li>생성 된 user가 어드민이 된다.</li>\\n</ul>\\n<p>먼저 <code class=\\\"language-text\\\">init_member</code> 메서드를 User모델로 옮기고 조금 추가적인 정보를 받도록 한다.\\n그리고 처음 MeetUp 생성시에 필요한 정보만 넣어서 일단 생성을 하고, 그 MeetUp과 어드민이 될 맴버를 연결한다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># models/user.rb</span>\\n<span class=\\\"token comment\\\"># 새로운 맴버 등록시 필요한 일련의 과정들</span>\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>member_uid<span class=\\\"token punctuation\\\">,</span> meetup<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>service_uid<span class=\\\"token punctuation\\\">:</span> member_uid<span class=\\\"token punctuation\\\">)</span>\\n    user_log <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">MealLog</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">MealMeetUpTask</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>meal_log_id<span class=\\\"token punctuation\\\">:</span> user_log<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            meal_meet_up_id<span class=\\\"token punctuation\\\">:</span> meetup<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            task_status<span class=\\\"token punctuation\\\">:</span> task_code<span class=\\\"token punctuation\\\">)</span>\\n    user <span class=\\\"token comment\\\"># 바로 user를 사용가능하도록 return</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n\\n<span class=\\\"token comment\\\"># models/meal_meet_up.rb</span>\\n<span class=\\\"token comment\\\"># 빈 MeetUp 생성</span>\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_meetup</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>messenger_code<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n            messenger_room_id<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_room_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n            meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'created'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n\\n<span class=\\\"token comment\\\"># controllers/meal_meet_up_controller.rb</span>\\n<span class=\\\"token keyword\\\">def</span> create\\n    <span class=\\\"token variable\\\">@admin</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">init_member</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_user_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">,</span>\\n                                <span class=\\\"token function\\\">load_messenger_code</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n                                <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_task</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'unpaid'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">update_additional_info</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@admin</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_201</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">response_json_create</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> update\\n    <span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>total_price<span class=\\\"token punctuation\\\">:</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:total_price</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                    meetup_status<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token function\\\">load_status_code</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token function\\\">render_200</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">response_json_update</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">@meetup</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>그리고 복잡하게 <code class=\\\"language-text\\\">if~else</code> 로 엮여있던 <code class=\\\"language-text\\\">create</code>, <code class=\\\"language-text\\\">update</code> 액션을 <code class=\\\"language-text\\\">members_controller</code> 에서 썼던 <code class=\\\"language-text\\\">before_action</code> 의 필터링을 적용하여 크게 다이어트 해 주었다.</p>\\n<p>처음에 MealMeetUp을 만들 땐 돌아만 가게 만드느라 억지로 해쉬를 자르고 붙이고 하는 작업을 했었는데, 실질적으로 필요한 요소들을 조금 더 고민하고 수정을 하니 실제로는 더 적은 양의 코드로도 작성이 가능하게 되었다.</p>\\n<p>하지만 코드를 작성하고 나서 실제 구동하여 테스트를 해보니 부족한 부분이 많았는데, 먼저 한번 유저를 추가하고 나면 더 추가하지 못하게 설계 한 부분이 미스였고, MealMeetUp도 중복 검사를 제대로 하지 못하고 있던 것이다.</p>\\n<p>전반적으로 처음 코드를 작성할 때 중복 처리에 대해 크게 고민을 하지 않고 만든게 원인이었다. 조금 더 신중하게 코드를 작성해야 했었는데..</p>\\n<p>특히 before<em>action을 너무 남용한 부분이 있었는데 `meal</em>meet<em>up#create` 만 해도 그냥 패러미터가 들어오자마자 무조건 MealMeetUp을 생성하도록 before</em>action을 하나 만들어 놓으니 나중에는 중복 검사를 할때 자꾸 '이미 만들어진 meetup' 이라는 오류를 내뿜게 되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MealMeetUpController</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ApplicationController</span>\\n  include <span class=\\\"token constant\\\">MealMeetUpHelper</span>\\n  before_action <span class=\\\"token symbol\\\">:check_params</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:create</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:update</span><span class=\\\"token punctuation\\\">]</span>\\n  before_action <span class=\\\"token symbol\\\">:check_meetup_update</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:update</span><span class=\\\"token punctuation\\\">]</span>\\n  before_action <span class=\\\"token symbol\\\">:check_meetup_create</span><span class=\\\"token punctuation\\\">,</span> only<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:create</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token comment\\\"># before_action :init_meetup, only: [:create]</span>\\n\\n  <span class=\\\"token keyword\\\">def</span> create\\n    init_meetup\\n    <span class=\\\"token comment\\\"># ...</span>\\n</code></pre>\\n      </div>\\n<p>이렇게 수정하여 먼저 중복된 meetup이 있는지 확인을 하고, 없으면 생성을 하는 과정을 거치도록 수정하니 잘 작동하였다.\\n앞으로도 수정할 부분은 많이 있을 것이지만, 한줄 한줄 코드를 작성할 때 조금 더 과정에 대해 심혈을 기울여 생각할 필요성을 크게 느꼈다.</p>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-08-02-easylunch-api-devlog-2/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-08-02\",\"path\":\"/posts/easylunch-api-devlog-2\",\"title\":\"Easylunch Api 서버 제작기 - 2\",\"tags\":[\"Rails\"],\"category\":\"Rails\"}},{\"excerpt\":\"Clone repository 금방 하지 못했던 easylunch api 서버 프로젝트를 작성하기 시작했다.\\n프로젝트 생성과 Gem 세팅 등은 이미 되어 있어서 github에 있는 레포를 클론하였고\\nIssue #10 으로 분류되어 있어서   브랜치를 생성하였다.\\n이번에는 Bitbucket에서 작성했던 프로젝트와 다르게 development 브랜치를 두지 않고 이슈 브랜치에서 바로 master…\",\"html\":\"<h2 id=\\\"clone-repository\\\"><a href=\\\"#clone-repository\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Clone repository</h2>\\n<p>금방 하지 못했던 easylunch api 서버 프로젝트를 작성하기 시작했다.\\n프로젝트 생성과 Gem 세팅 등은 이미 되어 있어서 github에 있는 레포를 클론하였고\\nIssue #10 으로 분류되어 있어서 <code class=\\\"language-text\\\">ISS#10</code> 브랜치를 생성하였다.\\n이번에는 Bitbucket에서 작성했던 프로젝트와 다르게 development 브랜치를 두지 않고 이슈 브랜치에서 바로 master로 합치는 방식으로 진행하는가 보다.</p>\\n<h2 id=\\\"모델-작성\\\"><a href=\\\"#%EB%AA%A8%EB%8D%B8-%EC%9E%91%EC%84%B1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>모델 작성</h2>\\n<p>먼저 슬랙에 올라와 있던 모델 도면을 참고하여 모델을 작성하였다.\\n처음엔 별 생각 없이 모델 생성하면서 string이나 integer만 구분하여 각 컬럼을 입력하고 있었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">rails g model MealLog user_id:integer menu_name:string price:integer meal_time:datetime</code></pre>\\n      </div>\\n<p>이렇게 테이블을 작성하고 나서 모델에서 따로 <code class=\\\"language-text\\\">belongs_to</code> 와 <code class=\\\"language-text\\\">has_many</code> 를 입력해줄 생각이었다.\\n그러다 저번에 다른 튜토리얼에서 우연히 본 references를 이용할 생각이 뒤늦게 들어서 마이그레이션 파일을 변경해 주기로 했다.</p>\\n<p>마이그레이션 시 타입을 references로 지정해주면 model<em>id 생성과 함께 관계 설정을 해주는 코드(`belongs</em>to<code class=\\\"language-text\\\">/</code>has_many`)가 자동으로 삽입된다.\\n다만 이미 마이그레이션 파일이 작성된 뒤였기 때문에(실행은 하지 않음) 다음과 같이 마이그레이션 파일을 변경해주었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">CreateMealLogs</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Migration</span>\\n  <span class=\\\"token keyword\\\">def</span> change\\n    create_table <span class=\\\"token symbol\\\">:meal_logs</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>t<span class=\\\"token operator\\\">|</span>\\n      t<span class=\\\"token punctuation\\\">.</span>references <span class=\\\"token symbol\\\">:user</span>\\n      t<span class=\\\"token punctuation\\\">.</span>string <span class=\\\"token symbol\\\">:menu_name</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:price</span>\\n      t<span class=\\\"token punctuation\\\">.</span>datetime <span class=\\\"token symbol\\\">:meal_time</span>\\n\\n      t<span class=\\\"token punctuation\\\">.</span>timestamps null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    add_index <span class=\\\"token symbol\\\">:meal_logs</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:user_id</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>그리고 직접 관계를 맺어주는 것과 별개로 CodeTable때문에 외부 키를 입력해줄 필요가 있었다.\\n외부 키를 추가할 때는 마이그레이션 파일에 add<em>foreign</em>key 메서드를 사용해야 한다. 이 경우엔 미리 생성된 컬럼을 지정해주고 싶었기 때문에 다음과 같이 삽입해야 했다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">add_foreign_key :meal_meet_ups, :users, column: :admin_id</code></pre>\\n      </div>\\n<p>외부 키를 지정해주는 마이그레이션 파일은 다음과 같이 작성되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">CreateMealMeetUps</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Migration</span>\\n  <span class=\\\"token keyword\\\">def</span> change\\n    create_table <span class=\\\"token symbol\\\">:meal_meet_ups</span> <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>t<span class=\\\"token operator\\\">|</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:total_price</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:messenger_code</span>\\n      t<span class=\\\"token punctuation\\\">.</span>string <span class=\\\"token symbol\\\">:messenger_room_id</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:admin_id</span>\\n      t<span class=\\\"token punctuation\\\">.</span>integer <span class=\\\"token symbol\\\">:meetup_status</span>\\n\\n      t<span class=\\\"token punctuation\\\">.</span>timestamps null<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">false</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    add_foreign_key <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:users</span><span class=\\\"token punctuation\\\">,</span> column<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:admin_id</span>\\n    add_foreign_key <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:code_tables</span><span class=\\\"token punctuation\\\">,</span> column<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:messenger_code</span>\\n    add_foreign_key <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">:code_tables</span><span class=\\\"token punctuation\\\">,</span> column<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token symbol\\\">:meetup_status</span>\\n  <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>다음은 MealMeetUp 생성과 변경을 처리하는 api 컨트롤러를 작성할 차례이다.</p>\\n<h2 id=\\\"컨트롤러-작성\\\"><a href=\\\"#%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EC%9E%91%EC%84%B1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>컨트롤러 작성</h2>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">rails g controller MealMeetUp create update</code></pre>\\n      </div>\\n<p>현재 시점에서 첫 번째로 구현하려는 기능은 MealMeetUp api이다. 새 MealMeetUp 생성과 수정을 구현할 예정인데\\njson으로만 데이터를 주고받을 예정이니 <code class=\\\"language-text\\\">routes.rb</code>에 디폴트 포맷을 지정해주기로 했다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"># routes.rb\\npost &#39;meal_meet_ups&#39;  =&gt; &#39;meal_meet_up#create&#39;, defaults: { format: &#39;json&#39; }\\npatch &#39;meal_meet_ups&#39; =&gt; &#39;meal_meet_up#update&#39;, defaults: { format: &#39;json&#39; }</code></pre>\\n      </div>\\n<p>그 다음에는 <a href=\\\"https://blog.8thlight.com/will-warner/2014/04/05/strong-parameters-in-rails.html\\\">Strong parameter</a>를 지정하기 위해 meetup_params 메서드를 작성했다.</p>\\n<p>입력받을 JSON은 다음과 같으므로 data 아래에 있는 나머지 키들을 전부 받을수 있는 값으로 설정해두었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"data\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"email\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"abc@example.com\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"messenger\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"slack\\\"</span><span class=\\\"token punctuation\\\">,</span> // 약속된 code\\n        <span class=\\\"token property\\\">\\\"messenger_room_id\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1459349928</span><span class=\\\"token punctuation\\\">,</span> // optional<span class=\\\"token punctuation\\\">,</span> 값을 얻을 수 없는 특정 메신저의 경우(ex- 카톡<span class=\\\"token punctuation\\\">)</span> api 서버에서 유저의 아이디 정보로 검색\\n        <span class=\\\"token property\\\">\\\"total_price\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">50000</span><span class=\\\"token punctuation\\\">,</span> // optional\\n        <span class=\\\"token property\\\">\\\"status\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"paying\\\"</span> // optional<span class=\\\"token punctuation\\\">,</span> 값이 주어지지 않을 경우 state machine으로 작동\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"mealmeetup-create\\\"><a href=\\\"#mealmeetup-create\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MealMeetUp Create</h2>\\n<p>이 JSON을 가지고(예로 작성된 JSON은 정보 변경시에 받는 것이고 생성 시에는 <code class=\\\"language-text\\\">total_price</code>와 <code class=\\\"language-text\\\">status</code>는 받지 않는다. 대신 <code class=\\\"language-text\\\">messenger_user_id</code>를 받는다) <code class=\\\"language-text\\\">create</code> 메서드가 작동한다면 어떤 과정으로 구동하게 될까 생각해 보았다.</p>\\n<ol>\\n<li>meetup_params를 한번 거쳐서 허가된 매개변수만 받는다.</li>\\n<li>\\n<p>받은 변수들의 유효성을 검사한다</p>\\n<ul>\\n<li><code class=\\\"language-text\\\">email</code>, <code class=\\\"language-text\\\">messenger_user_id</code> 같은 인증 정보가 누락된 경우: 401에러</li>\\n<li><code class=\\\"language-text\\\">messenger</code>, <code class=\\\"language-text\\\">messenger_room_id</code> 같이 방을 생성하기 위한 정보가 충분하지 않아 생성이 불가능할 때: 400에러</li>\\n</ul>\\n</li>\\n<li>\\n<p>유효성을 통과한 경우 먼저 User 객체 생성 + messenger_code 가져오기</p>\\n<ul>\\n<li>messenger 종류로 CodeTable에서 맞는 <code class=\\\"language-text\\\">messenger_code</code> 가져오기 (이 시점에서 seed 파일로 코드테이블을 작성해놓아야 할 필요성을 느꼈다. 더군다나 이런식으로 찾을거면 코드테이블을 작성하는 의미가 있나?)</li>\\n<li>email 주소로 새로운 유저 생성.</li>\\n</ul>\\n</li>\\n<li>\\n<p>MealMeetUp 생성</p>\\n<ul>\\n<li>앞선 과정에서 가져온 <code class=\\\"language-text\\\">messenger_code</code></li>\\n<li><code class=\\\"language-text\\\">messenger_room_id</code></li>\\n<li>앞서 생성된 user의 id를 <code class=\\\"language-text\\\">admin_id</code>로 지정</li>\\n<li>status는 null로 두고, null인 경우는 최초 생성인 것으로 간주하도록 하려고 했으나, 아무래도 \\\"​created\\\"라는 상태를 지정해 두는 것이 나아 보인다.</li>\\n</ul>\\n</li>\\n</ol>\\n<p>CodeTable을 작성하면서 한 가지 실수한 점이 있는데, 컬럼명에 'type'이라는 이름을 쓰면 레일즈에 기본적으로 정의되어있는 type과 충돌이 난다. 그래서 code_type으로 컬럼명을 변경하였다.</p>\\n<p>각각 코드가 무엇을 의미하는지는 code_table.rb에 주석으로 달기로 하였다.</p>\\n<p>한창 날코딩으로 작업을 하고, 얼렁뚱땅 create메서드를 작동시키는 것 까지는 성공했는데 돌이켜보니 DB 관계 설정을 하나도 해두지 않았다.\\n생성과 구상까지만 하고 몇일을 보내버려서 그런지 생각보다 머리에 잘 들어오지 않아 애먹고 있다.</p>\\n<p>매번 단순히 <code class=\\\"language-text\\\">has_many</code>, <code class=\\\"language-text\\\">belongs_to</code>정도만 남발하다가 본격적으로 직접 외부키로 관계를 맺어주려니 어렵게 느껴졌다. 이리저리 소스를 찾아서 구현해본 결과 이런 느낌으로 나온다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MealMeetUp</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Base</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_meet_up_logs</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_meet_up_tasks</span>\\n  belongs_to <span class=\\\"token symbol\\\">:admin</span><span class=\\\"token punctuation\\\">,</span> class_name<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'User'</span><span class=\\\"token punctuation\\\">,</span> foreign_key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'admin_id'</span>\\n  belongs_to <span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">,</span> class_name<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'CodeTable'</span><span class=\\\"token punctuation\\\">,</span> foreign_key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'messenger_code'</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">User</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">ActiveRecord</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token punctuation\\\">:</span><span class=\\\"token constant\\\">Base</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_meet_ups</span><span class=\\\"token punctuation\\\">,</span> foreign_key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'admin_id'</span>\\n  has_many <span class=\\\"token symbol\\\">:meal_logs</span>\\n  has_many <span class=\\\"token symbol\\\">:user_messengers</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>어느 클래스에 있는 값을 가져올지 <code class=\\\"language-text\\\">class_name</code>으로 지정해주고, 실제 어떤 메서드를 입력해서 가져올지(<code class=\\\"language-text\\\">:admin</code>), 어떤 외부키를 지정해 두었는지 등으로 설정할 수 있다.</p>\\n<p><code class=\\\"language-text\\\">create</code>메서드가 작동 자체는 잘 하는 것 같은데 루보캅에서 메서드가 너무 길다고 하니까 조금 아쉽게 느껴진다. 더 줄일 부분이 분명히 있는데 어느 부분을 손대야할지 잘 감이 안잡히는 느낌이 든다. 기준이 10줄인데 14줄로 작성되어 있으니..</p>\\n<p>인증 정보의 유효성 고려하다보니 깜빡한 것이, 이메일 유효성을 고려하지 않았다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">VALID_EMAIL_ADDRESS = /\\\\A[\\\\w+\\\\-.]+@[a-z\\\\d\\\\-.]+\\\\.[a-z]+\\\\z/i</code></pre>\\n      </div>\\n<p>M.Hartl의 튜토리얼에서 가져온 이 정규표현식으로 메서드를 만들어서 검증하기로 했다.</p>\\n<h2 id=\\\"mealmeetup-update\\\"><a href=\\\"#mealmeetup-update\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>MealMeetUp Update</h2>\\n<p>업데이트는 두가지 속성이 더 추가되는데, <code class=\\\"language-text\\\">total_price</code>와 <code class=\\\"language-text\\\">status</code>이다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"data\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"email\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"abc@example.com\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"messenger\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"slack\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"messenger_room_id\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1459349928</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"total_price\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">50000</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token property\\\">\\\"status\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"paying\\\"</span> // 현재까지 완료된 최종 상태\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>설마 했던 문제지만, 이번에도 create를 만들면서 별달리 다음 문제에 대해 고려를 안하다 보니까 리턴용 JSON 생성이 곤란하게 되었다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">meal_meet_up_json</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span> data<span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token punctuation\\\">{</span> email<span class=\\\"token punctuation\\\">:</span> data<span class=\\\"token punctuation\\\">.</span>admin<span class=\\\"token punctuation\\\">.</span>email<span class=\\\"token punctuation\\\">,</span>\\n        messenger<span class=\\\"token punctuation\\\">:</span> data<span class=\\\"token punctuation\\\">.</span>messenger<span class=\\\"token punctuation\\\">,</span>\\n        messenger_room_id<span class=\\\"token punctuation\\\">:</span> data<span class=\\\"token punctuation\\\">.</span>messenger_room_id <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>그래서 생각하건데 아예 모든 값이 다 들어가도록 json을 만들고,  create메서드에서 리턴할때만 특정 키를 뺀 채로 만들면 될 거라는 생각이 든다.</p>\\n<p>공통적입 부분을 생각해보니, MealMeetUp 객체에 저장을 하기위해 추가적으로 들어가는 정보들을 조회하는 부분이 크게 중복된다. 그래서 이 기능도 나누어서 작성하였다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span>\\n    status <span class=\\\"token operator\\\">=</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'created'</span> <span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span>\\n    messenger_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n    status_code <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n\\n    user <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">if</span> status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'created'</span>\\n            <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n            <span class=\\\"token keyword\\\">else</span>\\n            <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n            <span class=\\\"token keyword\\\">end</span>\\n\\n    additional_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> admin_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">,</span> status_code<span class=\\\"token punctuation\\\">:</span> status_code <span class=\\\"token punctuation\\\">}</span>\\n\\n    params<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>additional_data<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>막상 이것도 더 쪼갤 수 있을 테지만.. status<em>code, messenger</em>code, admin_id 삽입까지 처리하였다.\\n마지막 줄에 최종적으로 원하는 데이터를 출력하는 부분이 애매한데, MeetUp 객체 생성/수정에 필요 없는 정보들이 너무 많았다. 그래서 조금 수정을 가했다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">params.merge(additional_data).reject { |key| [&#39;email&#39;, &#39;messenger&#39;, &#39;status&#39;, &#39;messenger_user_id&#39;].include?(key) }</code></pre>\\n      </div>\\n<p>거의 다 된거 같은게 갈수록 태산처럼 보인다. 이번에는 messenger<em>user</em>id가 UserMessenger 모델에 들어가야하는 값이라는걸 깨달았다. 당장 어디다 넣어야 할지도 모르겠는데.. 일단 <code class=\\\"language-text\\\">get_more_info</code> 메서드를 조금 수정하여 처음 생성하는 MealMeetUp일 경우 새로운 UserMessenger 객체를 생성하는 것 까지 진행했다.</p>\\n<p>지금까지 작업하여 돌아가기는 하지만 영 못마땅한 부분이 많다. 특히 반복적인 부분과 매끄럽게 보이지 않는 부분들이 너무 많은데, 본격적으로 수정을 하면 어디부터 손을 대야할지 해봐야 알 것이다. (루보캅 테스트 통과 못한 부분이 무려 22개)</p>\\n<p>루보캅에서 주로 걸리는 문제는 ABC(Assignment Branch Condition) 사이즈가 너무 크다는 것이다. 한번에 이해는 하기 힘들었지만 변수를 많이 선언하고, 조건을 많이 걸고, 얽힌 메서드가 많을 수록 점수가 올라가는 기분이 든다.</p>\\n<p>당장 위에 작성한 <code class=\\\"language-text\\\">get_more_info</code> 메서드만 해도 기준을 1.5배 초과하고 있다. 당장 저 메서드를 수정하려면 어떻게 해야할까? 저 메서드가 어떤 기능을 수행하는지 나누어 보자.</p>\\n<ul>\\n<li>status 패러미터를 가져와서 패러미터가 없으면 'created'를 부여한다.</li>\\n<li>messenger_code를 가져온다.</li>\\n<li>status_code를 가져온다.</li>\\n<li>status가 'created'이면 (즉 처음 MealMeetUp이 생성되는거면) 새로운 유저와 유저메신저 객체를 생성한다.</li>\\n<li>생성된 유저의 Id와 messenger<em>code, status</em>code를 새로운 해시(addtional_data)로 만든다.</li>\\n<li>기존의 패러미터에 addtional_data를 합친다.</li>\\n</ul>\\n<p>기능별로 하나하나 나눌 순 있다. 점점 메서드의 산이 되어가는 기분이지만..\\n먼저 걸리는 점은 새로운 유저 생성, 그다음은 스테이터스 패러미터, 마지막은 추가 해시 생성이다.\\n새로운 유저 생성 부분부터 분리해보자.</p>\\n<p>무작정 분리한건 좋은데 이 메서드들을 어떻게 합쳐야 할지 감이 오지 않는다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> fetch_params\\n    <span class=\\\"token variable\\\">@params</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_status</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span>\\n    status<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'created'</span> <span class=\\\"token punctuation\\\">:</span> status\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_status_code</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token variable\\\">@status_code</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_messenger_code</span><span class=\\\"token punctuation\\\">(</span>messenger<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token variable\\\">@messenger_code</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>messenger<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">load_user</span><span class=\\\"token punctuation\\\">(</span>status<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">if</span> status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'created'</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            messenger_user_id<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_user_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                            messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> status_code<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">)</span>\\n    additional_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> admin_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                        messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">,</span>\\n                        meetup_status<span class=\\\"token punctuation\\\">:</span> status_code <span class=\\\"token punctuation\\\">}</span>\\n\\n    params<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>additional_data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>reject <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>key<span class=\\\"token operator\\\">|</span>\\n    <span class=\\\"token string\\\">%w(email messenger status messenger_user_id)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>분명 get<em>more</em>info를 실행시키기 위해선 위에 정의해둔 메서드를 모두 쓸 필요가 있다.\\n생각해보면 굳이 인자를 받을 필요가 없는데..? params는 어디서든지 쓸 수 있으니까.\\n그 점에 착안하여 수정한 코드는 이렇다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> fetch_params\\n    <span class=\\\"token variable\\\">@params</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>load_user<span class=\\\"token punctuation\\\">,</span> load_messenger_code<span class=\\\"token punctuation\\\">,</span>\\n                            load_status_code<span class=\\\"token punctuation\\\">,</span> meetup_params<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_status\\n    params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">nil</span><span class=\\\"token operator\\\">?</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">'created'</span> <span class=\\\"token punctuation\\\">:</span> meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:status</span><span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_status_code\\n    <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_status</span><span class=\\\"token punctuation\\\">(</span>load_status<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_messenger_code\\n    <span class=\\\"token constant\\\">CodeTable</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_messenger</span><span class=\\\"token punctuation\\\">(</span>meetup_params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>id\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> load_user\\n    params <span class=\\\"token operator\\\">=</span> meetup_params\\n    <span class=\\\"token keyword\\\">if</span> load_status <span class=\\\"token operator\\\">==</span> <span class=\\\"token string\\\">'created'</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token constant\\\">UserMessenger</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>user_id<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token variable\\\">@user</span><span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                            messenger_user_id<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:messenger_user_id</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n                            messenger_code<span class=\\\"token punctuation\\\">:</span> load_messenger_code<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n    <span class=\\\"token variable\\\">@user</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">User</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find_by</span><span class=\\\"token punctuation\\\">(</span>email<span class=\\\"token punctuation\\\">:</span> params<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:email</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token variable\\\">@user</span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">get_more_info</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">,</span> messenger_code<span class=\\\"token punctuation\\\">,</span> status_code<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">)</span>\\n    additional_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> admin_id<span class=\\\"token punctuation\\\">:</span> user<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">,</span>\\n                        messenger_code<span class=\\\"token punctuation\\\">:</span> messenger_code<span class=\\\"token punctuation\\\">,</span>\\n                        meetup_status<span class=\\\"token punctuation\\\">:</span> status_code <span class=\\\"token punctuation\\\">}</span>\\n\\n    params<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>additional_data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>reject <span class=\\\"token keyword\\\">do</span> <span class=\\\"token operator\\\">|</span>key<span class=\\\"token operator\\\">|</span>\\n    <span class=\\\"token string\\\">%w(email messenger status messenger_user_id)</span><span class=\\\"token punctuation\\\">.</span>include<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">.</span>to_s<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre>\\n      </div>\\n<p>다 수정했더니 이번엔 클래스가 너무 길단다. (104/100줄)\\n줄일 부분 중 가장 크게 눈에 띄는 부분은 if-else문이 여러번 있는 것이다.\\n아예 검증 자체를 처음부터 메서드화 + before_action을 적용하고, 검증을 통과한 녀석만 create, update가 실행되도록 만들려고 하였다.\\n하지만 그 검증 메서드도 점점 몸집이 불어나더니 통과를 못하는 문제가 발생하였고, 야매로 해결한 방법은 helper에다가 넣을 만한 메서드를 옮겨놓고 <code class=\\\"language-text\\\">include MealMeetUpHelper</code>를 삽입하는 것이었다.</p>\",\"id\":\"/home/circleci/repo/src/pages/posts/2016-07-24-easylunch-api-devlog/index.md absPath of file >>> MarkdownRemark\",\"frontmatter\":{\"date\":\"2016-07-24\",\"path\":\"/posts/easylunch-api-devlog-1\",\"title\":\"Easylunch Api 서버 제작기 - 1\",\"tags\":[\"Rails\"],\"category\":\"Rails\"}}],\"tagName\":\"Rails\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/tags-rails.json\n// module id = 475\n// module chunks = 143014539023981"],"sourceRoot":""}