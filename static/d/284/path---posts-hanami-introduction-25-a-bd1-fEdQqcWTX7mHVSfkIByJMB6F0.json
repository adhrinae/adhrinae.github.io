{"data":{"markdownRemark":{"html":"<ul>\n<li><strong>본 포스팅은 <a href=\"http://ruby-korea.github.io/advent-calendar/\">루비 대림절 달력</a>을 위해 제작하였습니다</strong></li>\n<li><strong>기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다</strong></li>\n<li><strong>작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다</strong></li>\n</ul>\n<h2 id=\"들어가며\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가며</h2>\n<p>아직 갓 6개월 된 초보 개발자로서 이제 루비 온 레일즈(이하 레일즈)에 조금씩 익숙해지던 차에, 상사로부터 '하나미라는 프레임워크가 있으니 한번 리서치를 해 보세요' 라는 권유를 받았다. 그는 루비로 백엔드 서버들을 구축했지만 레일즈는 자신의 취향에 맞지 않다고 했고, 구조적으로도 하나미가 더 나아보인다고 이야기하였다.</p>\n<p>그리고 하나미 공식 가이드를 쭉 읽어본 나에게는 혼돈과 절망만 남았다. 루비 뿐 아니라 웹 개발의 기초 지식이 부족해서 그런지 도저히 이게 어떻게 돌아가는건지도 모르겠고, 레일즈에 대입해서 이해할 수 있는 것도 아니라는 생각이 들었다.</p>\n<p>다시 6개월을 다른 레일즈 프로젝트 제작, 리서치 작업을 하며 보내고 나니 회사에서는 본격적으로 레일즈 사용을 하지 않고 하나미를 사용하는 방향으로 가닥을 잡았다. 어쩌다가 레일즈라는 걸출한 웹 프레임워크를 두고 생소한 하나미라는 프레임워크를 사용하게 되었는지, 이번 기회를 통해 독자 분들의 관심을 이끄는 계기를 만들어보고자 한다.</p>\n<h2 id=\"변화가-일고-있는-레일즈-커뮤니티\"><a href=\"#%EB%B3%80%ED%99%94%EA%B0%80-%EC%9D%BC%EA%B3%A0-%EC%9E%88%EB%8A%94-%EB%A0%88%EC%9D%BC%EC%A6%88-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>변화가 일고 있는 레일즈 커뮤니티</h2>\n<p>레일즈는 2005년에 처음 소개 된 이후 빠르고 쉬운 웹 애플리케이션 개발을 위한 도구로써 많은 개발자들의 사랑을 받아왔다.</p>\n<p>'프로그래머의 단짝 친구' 라고 소개할 정도로 쉽고 재미있는 언어인 루비를 기반으로 삼은 프레임워크이기도 하고, 꼭 루비 문법을 모두 꿰고 있어야 할 정도로 많은 지식을 알고 있지 않아도 금방 어지간한 웹 애플리케이션을 제작할 수 있다는 점이 주요 셀링 포인트라고 여겨진다.</p>\n<p>소위 'Rails Magic' 덕분에 form에 변수를 할당하는 것으로 경로 설정이 알아서 되거나 스캐폴딩만 해도 신기하게 돌아가는 애플리케이션을 보며 감탄했던 적이 한두 번이 아니었다.</p>\n<p>2016년 현재 레일즈는 버전 5까지 발매되었고, 더 많은 기능이 구현되어 있으며 커뮤니티는 많이 거대해졌다. 거대해진 레일즈 세계와 함께 그 음영을 느끼는 개발자들도 조금씩 늘어나게 되었다.</p>\n<p>예를 들어 보통 레일즈 애플리케이션을 오래 개발해온 사람들은 애플리케이션의 규모가 커질수록 유지보수하는게 힘들어진다는 점을 지적하고 있는데, 이를 해결하기 위해 <strong>Fat model, Skinny controller</strong> 등의 방법론이 제시되고 있지만 '뭔가 문제가 있다'는 의견들은 끊임없이 제시되고 있다.</p>\n<p>또한 DHH(David Heinemeier Hansson, 레일즈의 창시자)가 제시하고 있는 <a href=\"http://solnic.eu/2016/05/22/my-time-with-rails-is-up.html\">'Rails way'에 반감을 가진 사람들이 점차 늘어나고</a> 루비로 웹 개발을 하는 것에 대해 <a href=\"http://rwdtow.stdout.in/\">더 나은 방법을 찾는</a> 사람들이 점차 늘어나고 있다.</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 599px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 131.3856427378965%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB3UIJrU3hI5l//8QAGBAAAgMAAAAAAAAAAAAAAAAAAQIQETD/2gAIAQEAAQUCUUuJj//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAVEAEBAAAAAAAAAAAAAAAAAAABMP/aAAgBAQAGPwIp/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERECExUWH/2gAIAQEAAT8hhOki+DxSo2MuOBT/2gAMAwEAAgADAAAAEG/s/P/EABcRAQEBAQAAAAAAAAAAAAAAAAEAERD/2gAIAQMBAT8QcNshz//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/ECn/xAAdEAACAgIDAQAAAAAAAAAAAAAAARExIUFRgaGx/9oACAEBAAE/EFQ9LxD2VhM2xRFjSo7GqhXTWPoqTzJDRovG3LP/2Q=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"현재 레일즈 커뮤니티\"\n        title=\"\"\n        src=\"/static/f0f9a1c45e0435424b34e6518f9574d9/f36a6/2016-12-03-sc1.jpg\"\n        srcset=\"/static/f0f9a1c45e0435424b34e6518f9574d9/28fc4/2016-12-03-sc1.jpg 198w,\n/static/f0f9a1c45e0435424b34e6518f9574d9/44f6c/2016-12-03-sc1.jpg 395w,\n/static/f0f9a1c45e0435424b34e6518f9574d9/f36a6/2016-12-03-sc1.jpg 599w\"\n        sizes=\"(max-width: 599px) 100vw, 599px\"\n      />\n  </span></p>\n<p><em>현재 레일즈 커뮤니티의 묘사 - 출처: <a href=\"http://railshurts.com/current_state\">http://railshurts.com/current_state</a></em></p>\n<p>이러한 분위기 속에서 'Ruby way, not Rails' 를 표방하는 루비 기반 웹 프레임워크가 등장하였으니, 바로 이번에 소개할 <a href=\"hanamirb.org\">Hanami(하나미)</a>이다.</p>\n<h2 id=\"하나미가-뭐죠\"><a href=\"#%ED%95%98%EB%82%98%EB%AF%B8%EA%B0%80-%EB%AD%90%EC%A3%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하나미가 뭐죠?</h2>\n<p>하나미는 이탈리아의 개발자 <a href=\"https://lucaguidi.com\">Luca Guidi</a> 가 개발한 루비 MVC 웹 프레임워크이다. 2014년에 Lotus라는 이름으로 처음 등장하였으나, IBM의 Louts 상표권과 엮이는 문제가 있어 지금의 이름으로 변경하게 되었다.</p>\n<p>새로운 이름으로 <strong>하나미</strong>라는 이름을 쓰게 된 이유는 '꽃구경' 이라는 일본어 본래의 뜻에 걸맞게 함께 하는 커뮤니티의 중요성을 일깨운다는 점을 강조하기 위해서라고 한다. 루비의 창시자 Matz와(일본인이다) 루비 그 자체에 대한 찬사의 의미도 가지고 있다.</p>\n<p>하나미의 특징을 몇 가지 소개하자면 먼저 최대한 루비라는 언어를 직접적으로 사용하는 방식으로 구현되어 있다는 점이다. 다만 이 때문에 레일즈를 습득하는데 루비 지식이 크게 필요하지 않은 것과 다르게 일정 수준의 루비 언어의 이해를 요구한다.</p>\n<p>또한 Magic을 최대한 배제하고(하나미 Gitter 채팅방에서 혹은 몇몇 포스트에서 \"I'm now sick of rails magic!\" 이라고 주장하는 사람들이 많이 보인다) 개발자가 최대한 자신이 무엇을 하고 있는지 인지하면서 앱을 제작하도록 유도한다.</p>\n<p>그리고 보통 Rails best practice 로 제시되는 요소들을 기본적으로 구현하고 있다.</p>\n<ul>\n<li>컨트롤러는 HTTP 콜만 다룬다 -> 액션에서 비지니스 로직을 분리하여 처리하기 위해 <code class=\"language-text\">Interactor</code> 라는 모듈이 있다</li>\n<li>퍼시스턴스 로직과 도메인 로직을 분리한다 -> 하나미 모델은 기본적으로 도메인과 퍼시스턴스 레이어가 분리되어 있다</li>\n<li>루비 객체를 만들어서 제대로 OOP를 한다 -> 하나미는 OOP 개념을 잘 지키기 위해 노력한다. 또한 모듈화도 굉장히 쉽다</li>\n</ul>\n<p>하나미 가이드 페이지 첫머리에서 제시하는 <a href=\"http://hanamirb.org/guides/#why-choose-hanami-\">'하나미를 선택하는 이유'</a> 를 가볍게 살펴보면 이렇게 말하고 있다.</p>\n<ul>\n<li>하나미는 가볍다 -> 상대적으로 짧은 코드, 웹 애플리케이션 개발에 필요한 필수적인 부분에 초점을 맞춤</li>\n<li>하나미는 구조적으로 건전하다 -> 컨트롤러 액션은 각각의 클래스로 분리되어 있으며 테스트하기 용이하다</li>\n<li>하나미는 스레드에 안전하다 -> (아직 이런 문제를 겪을만한 규모의 앱을 작성해본 적이 없어서 설명하기 어렵다)</li>\n</ul>\n<p>또한 하나미는 컨테이너 형태의 앱 구조를 기본적으로 제공한다. 덕분에 한 개의 프로젝트를 생성하여 API 서버와 웹 서버를 동시에 운용하는게 가능하다. 물론 레일즈로도 비슷한 구성을 할 수야 있겠지만 충돌 없는 구현을 위해 앱의 구조가 훨씬 복잡해질 가능성이 높다.</p>\n<h2 id=\"만들어-볼까요\"><a href=\"#%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%BC%EA%B9%8C%EC%9A%94\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>만들어 볼까요</h2>\n<p>글을 길게 써 보았지만, 개발자들에겐 장황한 글보다 코드 몇 줄을 보는 것이 훨씬 이해가 빠를 것이다. 하나미의 공식 가이드를 따라가면서 눈여겨 볼 점들을 소개하겠다.</p>\n<h3 id=\"bookshelf-프로젝트-생성\"><a href=\"#bookshelf-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookshelf 프로젝트 생성</h3>\n<p>이번에 만들어볼 애플리케이션(이하 앱)은 <code class=\"language-text\">Bookshelf</code> 라는 앱이다. 책의 제목과, 작가가 있고 이 책들의 리스트를 살펴보고 책을 추가할 수 있는 기능을 가지고 있다. 가이드에서 수정과 삭제는 다루고 있지 않아 조금 아쉬운 느낌이 들지만 기본적인 웹 개발(레일즈) 지식이 있다면 구현하는 것이 그렇게 어렵지는 않다.</p>\n<p>기본적으로 루비 버전은 2.3+ 을 권장한다. 또한 데이터베이스는 sqlite3를 사용할 예정이다.</p>\n<p>먼저 하나미로 프로젝트를 생성하기 위해서는 <code class=\"language-text\">gem install hanami</code> 로 하나미가 설치되어 있어야 한다. 그 다음에는 새 프로젝트를 생성해본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ hanami new bookshelf</code></pre></div>\n<p>생성된 프로젝트의 폴더 구조를 살펴보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ tree -L 2\n.\n├── Gemfile\n├── Rakefile\n├── apps\n│   └── web\n├── config\n│   ├── environment.rb\n│   └── initializers\n├── config.ru\n├── db\n│   ├── migrations\n│   └── schema.sql\n├── lib\n│   ├── bookshelf\n│   └── bookshelf.rb\n├── public\n└── spec\n    ├── bookshelf\n    ├── features_helper.rb\n    ├── spec_helper.rb\n    ├── support\n    └── web</code></pre></div>\n<p>여기서 특이한 점은 <code class=\"language-text\">apps</code> 라는 폴더가 있다는 점인데 기본 컨테이너는 <code class=\"language-text\">web</code> 이지만 사용자가 웹 브라우저로 보는 애플리케이션 이외에 같은 데이터베이스를 공유하는 api 서버 등을 따로 만들고자 하면 제네레이터로 따로 컨테이너를 생성할 수 있다. 그러면 같은 데이터베이스 사용하는 별개의 앱을 따로 구축할 수 있다는 장점이 있다. (물론 라우팅은 다르겠지만.. 이 부분은 <code class=\"language-text\">mount</code> 옵션으로 처리할 수 있다) <a href=\"http://hanamirb.org/guides/getting-started/#hanami-architecture\">- 참고</a></p>\n<p>각 앱들에는 별개의 설정 파일, 컨트롤러, 뷰, 라우트, 템플릿 파일 및 폴더가 있다.</p>\n<p>테스트는 사용자가 원하는 어떤 형태로도 이용할 수 있다.(minitest or rspec) 하나미에서는 minitest를 기본으로 사용하며 capybara 젬도 사용한다. 이번 포스팅에서는 테스트를 구현하는 부분은 넘어가고자 한다. 테스팅이 궁금한 분들은 공식 가이드를 참조하시라.</p>\n<h3 id=\"루트-페이지-만들기\"><a href=\"#%EB%A3%A8%ED%8A%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>루트 페이지 만들기</h3>\n<p>라우팅은 각 앱의 <code class=\"language-text\">config/routes.rb</code> 파일에서 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/config/routes.rb</span>\nroot to<span class=\"token punctuation\">:</span> <span class=\"token string\">'home#index'</span></code></pre></div>\n<p>그러면 home 컨트롤러의 index 액션을 실행해주기 위해 제네레이터로 액션을 생성해본다. 아직 하나미는 레일즈처럼 다양하고 세분화된 옵션의 CLI를 제공하진 않는다. 번거롭긴 하지만 개발에 큰 지장은 없다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate action web home#index\n    create  spec/web/controllers/home/index_spec.rb\n    create  apps/web/controllers/home/index.rb\n    create  apps/web/views/home/index.rb\n    create  apps/web/templates/home/index.html.erb\n    create  spec/web/views/home/index_spec.rb\n    insert  apps/web/config/routes.rb</code></pre></div>\n<p><code class=\"language-text\">action</code> 뒤에 있는 <code class=\"language-text\">web</code> 은 액션을 생성하고자 하는 컨테이너의 이름이다. 그 다음에 컨트롤러와 액션 이름을 적어주면 된다. 앱 구조가 단독 컨테이너 구조일 경우(<code class=\"language-text\">hanami new</code> 커맨드로 앱 생성시 <code class=\"language-text\">--arch=app</code> 옵션을 주어 단독 컨테이너 앱 생성도 가능하다)에는 바로 액션 이름만 작성해주어도 된다.</p>\n<p>아쉬운 점은 매 액션마다 저 명령어를 작성해주어야 한다는 점이다. <code class=\"language-text\">hanami-scaffold</code> 라는 젬이 있지만 그닥 유지보수는 되지 않고 있어서 사용하는 것을 추천하지 않는다.</p>\n<p>컨트롤러는 폴더에 불과하며 그 폴더에 속한 각각의 액션 파일에 컨트롤러가 정의되어 있는 형태이다. 또한 뷰는 템플릿 파일(레일즈의 views 폴더 안에 있는 템플릿들)과 뷰 파일(레일즈에 비유하자면 뷰 헬퍼와 비슷)로 구성되어있다. 지금은 템플릿 파일에 간단하게 제목을 추가해보도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"># apps/web/templates/home/index.html.erb\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Bookshelf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><em>(주의) 템플릿 파일이 변경될 때에는 서버를 재실행할 필요가 없지만, 컨트롤러 등의 루비 파일이 변경될 때에는 서버를 재실행해야 한다.</em></p>\n<p>그리고 서버를 실행한 뒤 <code class=\"language-text\">localhost:2300</code> 으로 접속해보면 심플하지만 Bookshelf라는 글씨가 보이는 페이지를 마주할 수 있다.\n(본 포스트에서는 빠른 진행을 위해 <code class=\"language-text\">application.html.erb</code> 파일을 미리 수정해두었다)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami server</code></pre></div>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 358px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 74.58100558659218%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y81R32tSYRg+/8tyumBjEkxd5TKZRRlHnU70HM/x1/RibmArF5UXDRbtz/CmwfyVJ4i6qP6CdhEEbRmIO4pCA9F25Y+n93xk0MVawS468PB+7/c97/M833c446QeNuMlzC1chsGkw8WpafCORVgXbLhy1Yo5kxkms+UX5jTQ3njfbJmHTj+FC5MGTOj04Cwk6DLPw87fhOHaBBxWGyrZDFKrq0gmE3A6neB5Hi6XCy6qbrf7N4iiSMJmTM/MkLAB3G0i3aAh+3U77tziEQgEEBRExGIxhmQigXg8DkmSEA6HIQgC44wRDAbh9/vJkAw8HnAyEaVQCB6PG4IoQJZkJpDJZLC5mcEDQjqdprRJrKXWEIlEWCpZlplJiGa1tWYejUbBabG1RiIhLQEjiSEskUE0FodIabWhYCCI5WUfVihxJBKFz+dFIpEk8xUK44Fxdhb2RQe4fD6PcrmMUqkMRVGolqh/gVKxiEpFQZGqdlYsFNhZ5SenQL2ivGTr/N4ecrkcnu/ugsM5f5x6VMeH/X30ej2cnHzHwcEhvh0fo/rlEEeqik6ng/fv3qJa/coG+v0+BoPBqeDevH6FJa8Xz3Z28PjRQ6TvbiCbzWLryRY27t3H9vZTrKdS+PjpMxMcDIcYjUangut2u2g0GgQV9XodzWYTtVoNqtpAq9WiqqLdblOyARPUhv545X95n7PEmKBGGtI1zsJY7FwT/tVf/u8FfwCkJLVg24iPyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Bookshelf Title\"\n        title=\"\"\n        src=\"/static/3a065f050faf7e4f996a919b015fb34b/b5fef/2016-12-03-sc2.png\"\n        srcset=\"/static/3a065f050faf7e4f996a919b015fb34b/a17e6/2016-12-03-sc2.png 198w,\n/static/3a065f050faf7e4f996a919b015fb34b/b5fef/2016-12-03-sc2.png 358w\"\n        sizes=\"(max-width: 358px) 100vw, 358px\"\n      />\n  </span></p>\n<h3 id=\"모델-구축하기\"><a href=\"#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 구축하기</h3>\n<p>본격적으로 책들을 저장하고 출력하기 위해 데이터베이스 마이그레이션을 진행해 보도록 한다. 먼저 마이그레이션 파일을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate migration create_books</code></pre></div>\n<p>생성된 마이그레이션 파일은 이렇게 작성해 보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># db/migrations/20161203083239_create_books.rb</span>\n<span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Model</span><span class=\"token punctuation\">.</span>migration <span class=\"token keyword\">do</span>\n  change <span class=\"token keyword\">do</span>\n    create_table <span class=\"token symbol\">:books</span> <span class=\"token keyword\">do</span>\n      primary_key <span class=\"token symbol\">:id</span>\n\n      column <span class=\"token symbol\">:title</span><span class=\"token punctuation\">,</span>  <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:author</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n\n      column <span class=\"token symbol\">:created_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:updated_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">primary_key</code> 가 반드시 <code class=\"language-text\">id</code> 일 필요는 없다. 또한 <code class=\"language-text\">String</code>, <code class=\"language-text\">DateTime</code> 은 루비 타입이다(루비 클래스). 반드시 루비 타입을 사용할 필요는 없고 <code class=\"language-text\">&quot;varchar(255)&quot;</code> 같이 데이터베이스 타입을 문자열로 직접 작성해주어도 된다.</p>\n<p>마이그레이션 파일 작성이 완료되면 테이블을 생성해주는 명령어를 입력한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami db prepare\n$ bundle exec hanami db migrate</code></pre></div>\n<p>그리고 <code class=\"language-text\">Book</code> 모델을 생성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate model book\n      create  lib/bookshelf/entities/book.rb\n      create  lib/bookshelf/repositories/book_repository.rb\n      create  spec/bookshelf/entities/book_spec.rb\n      create  spec/bookshelf/repositories/book_repository_spec.rb</code></pre></div>\n<p>생성된 파일을 보면 조금 특이한 점을 볼 수 있는데 <code class=\"language-text\">entities</code> 폴더와 <code class=\"language-text\">repositories</code> 폴더가 따로 나뉘어져 있다는 점이다. <code class=\"language-text\">Entity</code> 는 도메인 객체로, 실제 데이터베이스 쿼리 등으로 추출된 자료 객체를 일컫는다. <code class=\"language-text\">Repository</code> 는 퍼시스턴스 계층과 <code class=\"language-text\">Entity</code> 를 이어주는 역할을 한다. 여기서 <code class=\"language-text\">Entity</code> 는 데이터베이스의 존재를 전혀 모르는 단순 루비 객체이며 테스트가 용이하고 가벼운 앱을 만드는데 도움이 된다.</p>\n<p>실제 콘솔에서 레코드를 다루어보면 이런 방식으로 동작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami console\n&gt;&gt; repo = BookRepository.new\n=&gt; #&lt;BookRepository:... &gt;\n&gt;&gt; repo.all\n=&gt; []\n&gt;&gt; book = repo.create(title: &#39;TDD&#39;, author: &#39;Kent Beck&#39;)\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;\n&gt;&gt; repo.find(book.id)\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;</code></pre></div>\n<p><code class=\"language-text\">Repository</code> (이하 리퍼지토리)에서 제공되는 메서드로 데이터베이스에 <code class=\"language-text\">Entity</code> (이하 엔티티)를 조작할 수 있고, 엔티티에는 따로 속성 혹은 동작을 지정할 수 있다. 그래서 레일즈에서 사용하는 <code class=\"language-text\">scope</code> 나 커스텀 쿼리가 작성된 메서드 등은 리퍼지토리 클래스에 분리해 둘 수 있다.</p>\n<h3 id=\"데이터를-표현하기\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터를 표현하기</h3>\n<p>임의로 몇 개의 <code class=\"language-text\">Book</code> 레코드를 생성해주고 리스트를 표현해보기 위해 새 컨트롤러 액션을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate action web books#index</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"># apps/web/templates/books/index.html.erb\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>All books<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\n&lt;% if books.any? %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>books<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    &lt;% books.each do |book| %>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>book<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>&lt;%= book.title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>&lt;%= book.author %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    &lt;% end %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n&lt;% else %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>placeholder<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>There are no books yet.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n&lt;% end %></code></pre></div>\n<p>여기서 <code class=\"language-text\">books</code> 는 어디서 온 것일까? 실제로 액션 부분은 이렇게 작성되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/controllers/books/index.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Index</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    expose <span class=\"token symbol\">:books</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@books</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span>all\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">expose</code> 메서드의 사용은 하나미의 규칙으로, <code class=\"language-text\">expose</code> 로 지정한 변수만 템플릿으로 노출되며 그 변수는 <code class=\"language-text\">call</code> 메서드 안에 인스턴스 변수로 존재해야 한다.</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 385px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 128.05194805194807%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAAC+0lEQVRIx61U/UtTURi+f0vq0n7oA0Q2P5L8ojLEocxtd03nvpztw2V/QBqmmRpYRjgrrIku06kUBEFQ6IhyZaap6Nb6oURJ3Jyi4rane44oaubHtQsP59z3nPc5z3PP+14mXnAc6fFCJKQJEXUmCqkJIkguZeNcRiYys7KQlp4BUWLSrkhMSkbM8ThEC2JxLFpAwYji4pCdeBYpF1MRkyCAuUCKxnIL9KVGWMwm6PU65IpzIRaLtyEvLw8KBQuhUISTp05DEHuCkjN5Egmyc3JwPusCLrNKyFg5dHo9R6SHwWBAaWkpnWs0GmjUGjoWFxdDJpNBLpeDVSjoSCCVysAolUoUKguRn59PTyQbCYHFYoHVaoXJaFwn42AoKYFWq4VarYZKpQLJZVkWEk4Uy+WqVAowZKGszAqj0QSz2QzjFSN0Wh10Oi2NEcuGEgOKioroISYuRubl5ddgMlug4AiTk1MglxbgqsUAxuPxYHJykmJqaoqCxDbiXq8XPp+Pvm9d2zone9ZjHjD4zw/T2+NEVdVNdHY50dXpwN2m++h29qCmuhp9vb2or2vAg2Yb3by2toZwOLwnGLd7EHa7HTbbQzja29DheIb2Dgfa7E/R43Si83k3Bt2fKCFJiEQieys8qBVCdiDLq6ur+D03h5mZGSwvL2NlZQWBQICOhCQUCm2SEXX7KnQN9KO27g4e2ZrRbGtBa+sTNDTUo+/Fy79s7ke2qXBhYQGLi0HMz89z8NPR7/cfWNU2QnJzxNZuz2GINgnHvo2iueUxrlfewPjEBA2SA7baPJTCVe7j//w1jbHxcc724jZlvBTuTNp6o7w6xcv1oGvAhaGhL3j7rh8jI6OI8LC6rbA3EkOh8JHsUsIgVzLT09OY44qbYHZ2FgEuxvsbvne5cKumBvW3a9F0rxGVFRV49frNodpt114mpbL+Nwlt1iUvhUtLS7RTSP/6/QFq90iEP3zf4Xa7MfR5CMPDX/Hh4yCCwSB/wn8t8L7ljXrbCb6kfwBgoxYXcTdGKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Bookshelf list\"\n        title=\"\"\n        src=\"/static/58eb0336ccd6468d50eb76c6d049377e/c96ac/2016-12-03-sc3.png\"\n        srcset=\"/static/58eb0336ccd6468d50eb76c6d049377e/d63a6/2016-12-03-sc3.png 198w,\n/static/58eb0336ccd6468d50eb76c6d049377e/c96ac/2016-12-03-sc3.png 385w\"\n        sizes=\"(max-width: 385px) 100vw, 385px\"\n      />\n  </span></p>\n<h3 id=\"새로운-책을-등록하기\"><a href=\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%B1%85%EC%9D%84-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>새로운 책을 등록하기</h3>\n<p>웹 페이지에서 새로운 책을 등록하기 위해서는 <code class=\"language-text\">new</code>, <code class=\"language-text\">create</code> 액션과 패러매터를 전달해 줄 <code class=\"language-text\">Form</code> 이 필요할 것이다. 먼저 <code class=\"language-text\">books#new</code>, <code class=\"language-text\">books#create</code> 액션을 생성해 준 뒤에 라우팅을 조금 깔끔하게 다듬어주도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/config/routes.rb</span>\nroot to<span class=\"token punctuation\">:</span> <span class=\"token string\">'home#index'</span>\nresources <span class=\"token symbol\">:books</span><span class=\"token punctuation\">,</span> only<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token symbol\">:index</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:new</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:create</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>하나미는 REST를 기본적으로 지원한다. 2번째 줄에서 사용 된 <code class=\"language-text\">resources</code> 는 보통 레일즈 라우트 파일에서 자주 보았던 그 <code class=\"language-text\">resources</code> 메서드처럼 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami routes\n        Name Method     Path           Action\n\n        root GET, HEAD  /              Web::Controllers::Home::Index\n       books GET, HEAD  /books         Web::Controllers::Books::Index\n    new_book GET, HEAD  /books/new     Web::Controllers::Books::New\n       books POST       /books         Web::Controllers::Books::Create</code></pre></div>\n<p>다음은 <code class=\"language-text\">new</code> 템플릿에 폼 헬퍼(Form helper) 를 이용하여 간단한 폼을 작성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"># apps/web/templates/books/new.html.erb\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Add book<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\n&lt;%=\n  form_for :book, routes.books_path do\n    div class: 'input' do\n      label      :title\n      text_field :title\n    end\n\n    div class: 'input' do\n      label      :author\n      text_field :author\n    end\n\n    div class: 'controls' do\n      submit 'Create Book'\n    end\n  end\n%></code></pre></div>\n<p>폼 헬퍼의 구조가 레일즈의 <code class=\"language-text\">form_for</code> 헬퍼와는 사뭇 다르다. 간단하게 차이점을 이야기하자면 하나미의 <code class=\"language-text\">form_for</code> 는 레일즈의 <code class=\"language-text\">form_tag</code> 헬퍼에 가깝다고 생각하면 된다. <a href=\"http://hanamirb.org/guides/helpers/forms/#technical-notes\">하나미 가이드에 따르면</a> <code class=\"language-text\">form_for do |f|</code> 형식으로 작성하는 것은 올바른 ERB 템플릿이 아니며, 하나미의 폼 헬퍼는 템플릿 엔진에 의존하지 않고 사용할 수 있도록(어느 템플릿 엔진을 사용하던 같은 루비 코드를 사용하도록) 구성되어 있다.</p>\n<p><code class=\"language-text\">routes.books_path</code> 는 라우팅 헬퍼이며 상기 라우팅 구조에 있는 이름을 사용하여 <code class=\"language-text\">routes</code> 뒤에 메서드 형식으로 붙여주면 자동으로 경로를 연결해준다.</p>\n<p>책을 생성하기 위한 <code class=\"language-text\">create</code> 액션은 다음과 같이 작성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/controllers/books/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    expose <span class=\"token symbol\">:book</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@book</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:book</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n      redirect_to routes<span class=\"token punctuation\">.</span>books_path\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이후 생성된 폼에 새로운 책을 등록해보니 문제없이 책이 생성되었다.</p>\n<h3 id=\"유효성-검사\"><a href=\"#%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%82%AC\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유효성 검사</h3>\n<p>하나미는 유효성 검사를 모델이 아닌 컨트롤러 액션에서 처리한다. 물론 엔티티 클래스에 유효성 검사를 정의할 수 있지만, 유효성 검사는 입력 이후 가장 가까운 단계에서 이루어질 것을 권장하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/controllers/books/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    expose <span class=\"token symbol\">:book</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:book</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:title</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:author</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n        <span class=\"token variable\">@book</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:book</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n        redirect_to routes<span class=\"token punctuation\">.</span>books_path\n      <span class=\"token keyword\">else</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token number\">422</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">params</code> 로 시작하는 유효성 검사는 엔티티를 정의해놓은 것 같은 역할을 할 수 있겠다. 자세한 내용은 <a href=\"http://hanamirb.org/guides/actions/parameters/\">가이드</a>를 참고하면 손쉽게 작성할 수 있다.</p>\n<p>만약 패러매터가 유효하지 않다면 HTTP 상태 코드 422(Unprocessable Entity)를 리턴하고, 그에 알맞는 뷰를 다시 표현해 주어야 한다. 현재 <code class=\"language-text\">create</code> 액션에는 아무런 템플릿도 작성되어있지 않고, 실제로는 <code class=\"language-text\">new</code> 템플릿을 그대로 사용하면 되기 때문에 뷰 파일에 알맞는 템플릿을 정의해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/views/books/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Views</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">View</span>\n    template <span class=\"token string\">'books/new'</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>지금까지 하나미를 통해 간단한 웹 애플리케이션을 개발하는 과정을 살펴보았다. 아주 기초적인 부분만 설명하였지만, 가이드를 살펴보고 하나미의 기능에 조금 더 익숙해진 뒤에는 github에 올라와 있는 몇몇 프로젝트 소스를 살펴보면서 하나미를 파악해보는 것을 추천한다.</p>\n<p>개인적으로 <a href=\"https://github.com/bruz/bookshelf-delivery-example\">이 Github 저장소</a>를 방문해 보는 것을 추천한다. 하나미의 컨테이너 구조 및 컨트롤러 액션과 비지니스 로직을 구분하는 예를 잘 보여준 코드로 구성되어있다.(<code class=\"language-text\">lib</code> 폴더 안에 있는 <code class=\"language-text\">interactors</code> 폴더에 주목하라)</p>\n<p>본 포스팅에 사용된 코드는 <a href=\"https://github.com/emaren84/hanami-introduction\">여기서</a> 확인해 볼 수 있다.</p>\n<h2 id=\"결론\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>루비는 일반적 용도의 언어로써 충분히 완성도가 있는 언어이지만 상대적으로 다양한 분야에서 사용되는 파이썬에 비해 어느샌가 웹 개발에만 쓰이는 언어라는 선입견이 심어지게 되었다. 그리고 이러한 선입견의 중심엔 레일즈가 있다.</p>\n<p>레일즈가 등장하고 루비라는 언어가 크게 알려지는 데 기여한 것은 사실이다. 하지만 이 세상에 특정 문제 해결을 위한 단 하나의 정답은 거의 없다. 루비라는 언어 자체도 하나의 문제를 해결 하는데 다양한 방법을 제시하는 언어이기도 하다.</p>\n<p>하나미의 등장도 이런 맥락에서 바라볼 수 있다. 단순히 레일즈만이 루비로 웹 애플리케이션을 만드는 최고의 방법이 아니며, 하나미를 잘 활용하면 레일즈에 비해 유지보수가 쉽고, 더 성능이 좋은 웹 애플리케이션을 작성할 수도 있을 것이다.</p>\n<p>물론 하나미는 나온지 얼마 되지 않은 프레임워크이고, 기능 구현이 레일즈에 비해 상대적으로 부족한 점도 있다. <strong>특히 문서화가 되어있지 않아 소스 코드를 이리저리 살펴보아야 하는 부분들이 아직 많이 있다는 점이 아쉽다.</strong> 하지만 충분한 발전 가능성을 지니고 있고, 진정 루비라는 언어로 프로그래밍을 하는 재미를 주는 것이 매력적이기 때문에 루비 언어 자체를 좋아하는 사람들이라면 한번 사용해 볼 것을 추천한다.</p>\n<p>하나미의 정보를 더 얻고자 하는 분들에게는 다음의 링크를 살펴보면 된다.</p>\n<ul>\n<li><a href=\"http://hanamirb.org/guides/\">하나미 공식 가이드</a> + <a href=\"https://github.com/hanami/hanami\">소스 코드</a></li>\n<li><a href=\"https://gitter.im/hanami/chat\">하나미 Gitter 채팅방</a></li>\n<li><a href=\"https://github.com/davydovanton/awesome-hanami\">유용한 젬 및 링크 공유</a></li>\n</ul>","excerpt":"본 포스팅은  루비 대림절 달력 을 위해 제작하였습니다 기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다 작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다 들어가며 아직 갓…","frontmatter":{"date":"2016/12/03","path":"/posts/hanami-introduction","title":"레일즈(Ruby on Rails)와는 또 다른 루비 웹 프레임워크, Hanami(하나미)","tags":["Ruby","Rails","Hanami"],"coverImageUrl":null,"description":null}},"site":{"siteMetadata":{"siteUrl":"https://adhrinae.github.io"}}},"pageContext":{}}