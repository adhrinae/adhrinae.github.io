{"pageContext":{"postsByTag":[{"excerpt":"이 글의 원문은  Michał Konarski…","html":"<ul>\n<li>이 글의 원문은 <a href=\"http://mjk.space/how-to-avoid-inheritance-in-ruby/\">Michał Konarski</a>가 작성하였습니다.</li>\n<li>번역 실수 및 용어 사용의 지적 등은 언제나 환영합니다.</li>\n</ul>\n<hr>\n<p>상속이 왜 문제가 될까요? 예를 하나 들어드리겠습니다.</p>\n<p>여러분의 고객이 '교통 상황 시뮬레이터'를 만들어달라고 요청했다고 해보죠. 고객은 몇몇 자동차가 움직이는 모습을 실험해보고 싶어합니다. 만약 루비같은 객체지향 언어를 사용한다면 먼저 모든 로직과 속성을 담고 있는 모델 클래스를 떠올리게 됩니다. 이렇게요.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 136px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.73529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABlUlEQVQoz62SyU4CQRRF8bNc+AGu/BDWim4YNiQaV67QsDFqHIgyis2ktHHCCIgM3dD0wKAoIsqgkFRSz6oGGhJXJnRy0q9e7r016qJCYEY3pS/IuQZZ7tTebIhzm0Ocx0BY+Q9h3mMIcm6LI26f05KvpaipAXUQW0VQupKKTOmIE0yMhxoK9VBvmPeuaoE3MmuQ2kXIvmb6BJSppRFXz6HCR16Db3Ao3+CR0Cwg7p1TNVRLPVJbhEj+1DwOlNhlpSvDMAzn6lnM3J3hQ+YAn0SOsevCiYP3AczEGLV3X4zh3FsWUy31KN8yCfRZJleoBaZfnjBZBfiuvGBZN4NxzQj2IztYN6ywuW8D/aIeyCRANVRLPaU/gRK7JLYEIDP26VZG2yEGFFce1DpZTqh1ohRHqeojGh0N+ffEtgAR3mfSAm/lS9MnNMkhK1D5KQ/oUSrw3K+qdbU/qClV0h9plI4CX8R7nvePL8WfccyT97jDCkEbYWtEtBBQYYWAVo97ms4WLTC7zuT2ghrWRmha71pX6zR0v7xe4phLYWhMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Vehicle Class\"\n        title=\"\"\n        src=\"/static/2e83a320a96db4a01c9b4553157907f6/9805c/2017-07-16-sc1.png\"\n        srcset=\"/static/2e83a320a96db4a01c9b4553157907f6/9805c/2017-07-16-sc1.png 136w\"\n        sizes=\"(max-width: 136px) 100vw, 136px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>완성된 결과물을 고객에게 보여주었습니다. 다 괜찮았는데 이제 고객이 자동차가 '승용차' 혹은 '트럭' 으로 나뉘었으면 좋겠다고 합니다. 이런 경우 두 차종은 최소한 일부 행동을 공유하고 있있는데다, 코드를 반복해서 작성하는 것도 별로 내키지 않습니다. 문제 없어요! 상속을 활용하면 되죠! 지금 마주친 경우는 아주 적절한 '-이다(is-a)' 관계입니다. 안 될 것 있나요?</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 424px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.443396226415096%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAB30lEQVQoz2NgQAMn7h9mBNFH7+23OvPoRMvll+drrr29XHvpxfmaUw+PNR25u1cOLH93PyMDMeDEnaMsIPr0w+PNP/9//3/h8fn/J24d+3/j9fX/X/9//n/83iFXkPzhG/uZsRpw7P4Bhr1XtjP8//8fzAfSTCD6zJPjcWcfnrp7+PrBS8dvHTl79Mbhy2cenrx19tlxA2R1IH3bz25kOPnoMMP2K2tQzAZ5AWQrSCGLlp0sM7cQu7CilqwQSFJaWVyYW4hNSF5XHCwPVYfpygXnOtgqp2dxWLkbi1r7GAmYu+sLCEsIcAOluICYDU05B0hcTl2Kx9LTQMA52FrQKcBa5NjvNazdm8vYJu2tZmK48PTs7TMPTp44cfvomcsvLp688OzsidNPD+tAvcPYPq2F4cqbCwxrD6wE88Hh+/ho4OXnF64Cg+T4MWBwnHt05vTFp+fOHri1I4jh7/8//2++ufn/7P0z/18B4bPfT/8fu3vAAaRx68kNcC8xMjIyHLx0EMw/9eBY0c//P/7ffnfr/8lbJ/7f/3z//1sgPHxnbyFQ8uiU04+OtwNxJzBmO08+ONKx7+Y2eZBGoI3wpLHp4lIGoBow/9Cd3RbAJDTx7OMTYH1ANgh37b6+yRwAIIsHylqv15gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Vehicle with inheritance\"\n        title=\"\"\n        src=\"/static/fa7f9df8054d6743399cc2574b2c80e3/11014/2017-07-16-sc2.png\"\n        srcset=\"/static/fa7f9df8054d6743399cc2574b2c80e3/20168/2017-07-16-sc2.png 198w,\n/static/fa7f9df8054d6743399cc2574b2c80e3/b3d3b/2017-07-16-sc2.png 395w,\n/static/fa7f9df8054d6743399cc2574b2c80e3/11014/2017-07-16-sc2.png 424w\"\n        sizes=\"(max-width: 424px) 100vw, 424px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>고객은 결과물에 또 만족했지만, 또 다른 추가사항을 요구했습니다. 이 자동차들이 다른 종류의 엔진을 탑재했으면 한다고 합니다. 예를 들어 석유 엔진과 전기 엔진으로요. 다시 한번 상속을 사용해서 문제를 해결해보겠습니다!</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 562px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACUUlEQVQoz6VSS2sTURSeJhXbjVECYrXQ1C5cZNOdIiio1F1EEFy70aJVpOBGhFr9AW7agiBBMAYj2DTapHnPjJn3TCaZmbwzySSTZJz0IYIiZlG9zqRuWrLzwOXc+z0O595zIWhAvPywNGTmcM5vFzT+DSUT74zlEzq8O5xbPWZyS74XQ4O8EF6H+5lsIhCtEFYddCwAAKuJ0Ro6nvsiAapCArpKAUkTeqyOnjQ5U6ODtoWu41ZKRf7VSu4vejCmzztH55/POaP5jxNhcc3xcPGu88z01MggLVZL7t8g5chRvsNcTYpRF15BXakKfHnm+qXhg8b7T2YPYVXkClpIurAS4jI8M3A5fMTkUrUEBLEqYTEPRA29oO9qoLRdBO1eC0h6tgfLoX43SDFmwWXEsmeK2SRd2FW+10FhMw9avSYg6+hZk2OauMXssP+4ua/pE2mVebROBJ4mstEFscvfTm9hwyueZYjtYBCtpvo6uo0eljYzd+KZ6ELg8+oi32LnpR3u+N5tE4MH9V8Rq/ptsBwc9ybdkykl4oiVAjasGbMbQ5jywu6J/E967D3pHvHzntHiL27ME3/liEhrp5FayE5pSRu/jTvcwZVJWodPoWrQBglaxlfaKoIoE/nd+KEAqZt9zKucR+yIIMHHgfytAkQ9czPT5m6Vd0p9rNDNg2yHf80o5DNJEwEiwH/EtgAYhfJC6Rb9gGvQ60QFe2vkCNcir3EqdY+WiRBZxb2sQm1wLeocq5IXDcOGiTF1MmT4ZukGdoOS8bDx6U3sE9Mg5v4CEGx46+zImFIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Vehicle with even more inheritance\"\n        title=\"\"\n        src=\"/static/ea0481feb5f8dca30a8d25a48403b0b1/7f0b2/2017-07-16-sc3.png\"\n        srcset=\"/static/ea0481feb5f8dca30a8d25a48403b0b1/8c8bd/2017-07-16-sc3.png 198w,\n/static/ea0481feb5f8dca30a8d25a48403b0b1/e07aa/2017-07-16-sc3.png 395w,\n/static/ea0481feb5f8dca30a8d25a48403b0b1/7f0b2/2017-07-16-sc3.png 562w\"\n        sizes=\"(max-width: 562px) 100vw, 562px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>여러분의 고객은 '지금은' 아주 행복합니다. 하지만 또 세분화를 요구한다면 어떻게 될까요? 전용차라던가, 경찰차라던가, 소방트럭이나 앰뷸런스 등 이보다 더 많은 세분화를 요구한다면? 우리의 상속 트리는 점점 커지고 복잡해지게 됩니다. 반복되는 코드를 줄이는 대신에 결국 같은 로직을 여러군데 복사-붙여넣기 하게 될 것입니다. 심지어 <a href=\"https://en.wikipedia.org/wiki/Combinatorial_explosion\">위키피디아에도</a> 이 현상이 기재되어 있습니다.</p>\n<p>위에서 말씀드린 사례는 제가 가볍게 지어낸 경우가 아닙니다. 저는 전문 개발자로 일하면서 오래된 코드에 새로운 기능이나 행동을 추가하려 할 때마다 이런 상황을 여러 번 접했습니다. 특히 여러분이 레일즈를 사용하면서 더 자주 접하실\n수 있습니다. <code class=\"language-text\">ApplicationRecord</code> 나 <code class=\"language-text\">ApplicationController</code> 를 상속하도록 강제하는 경우가 많기 때문입니다.</p>\n<p>상속이 발생하는 코드를 예로 보여드리겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Vehicle</span>\n  <span class=\"token keyword\">def</span> run\n    refill\n    load\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Vehicle</span>\n  <span class=\"token keyword\">def</span> load\n    <span class=\"token comment\"># 승객을 싣는다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Truck</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Vehicle</span>\n  <span class=\"token keyword\">def</span> load\n    <span class=\"token comment\"># 화물을 싣는다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PetrolCar</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Car</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 연료를 채운다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ElectricCar</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Car</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 전지를 충전한다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PetrolTruck</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Truck</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 연료를 채운다 (반복되는 코드!)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ElectricTruck</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Truck</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 전지를 충전한다 (반복되는 코드!)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이 코드를 더 낫게 만들 수 있을까요? 가능합니다.</p>\n<h2 id=\"아마도-믹스인mixin을-쓰면\"><a href=\"#%EC%95%84%EB%A7%88%EB%8F%84-%EB%AF%B9%EC%8A%A4%EC%9D%B8mixin%EC%9D%84-%EC%93%B0%EB%A9%B4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>아마도 믹스인(Mixin)을 쓰면?</h2>\n<p>수 많은 루비 프로그래머들이 상속이 문제를 해결할 수 없다고 깨닫는 순간, 가장 먼저 떠오르는 해결책은 믹스인일 겁니다. 믹스인이 뭘까요? 기본적으로 메서드들이 정의된 모듈을 클래스에 포함하여 그 클래스의 일부로 사용하는 기법입니다. 우리는 간단히 공통된 로직을 추출하여 코드의 재사용을 피할 수 있습니다. </p>\n<p>믹스인을 사용하면 코드가 어떻게 바뀔까요? 먼저 <code class=\"language-text\">include</code> 하게 될 모듈을 만들겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token constant\">Vehicle</span>\n  <span class=\"token keyword\">def</span> run\n    refill\n    load\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Truck</span>\n  <span class=\"token keyword\">def</span> load\n    <span class=\"token comment\"># 화물을 싣는다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Car</span>\n  <span class=\"token keyword\">def</span> load\n    <span class=\"token comment\"># 승객을 싣는다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">ElectricEngine</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 전지를 충전한다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">PetrolEngine</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 연료를 채운다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>그리고 믹스인할 대상이 되는 클래스를 만듭니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">PetrolCar</span>\n  include <span class=\"token constant\">Vehicle</span>\n  include <span class=\"token constant\">Car</span>\n  include <span class=\"token constant\">PetrolEngine</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ElectricCar</span>\n  include <span class=\"token constant\">Vehicle</span>\n  include <span class=\"token constant\">Car</span>\n  include <span class=\"token constant\">ElectricEngine</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PetrolTruck</span>\n  include <span class=\"token constant\">Vehicle</span>\n  include <span class=\"token constant\">Truck</span>\n  include <span class=\"token constant\">PetrolEngine</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ElectricTruck</span>\n  include <span class=\"token constant\">Vehicle</span>\n  include <span class=\"token constant\">Truck</span>\n  include <span class=\"token constant\">ElectricEngine</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>좀 보기 좋습니다. 코드가 반복되지도 않았고, 새로운 종류의 특성을 넣어서 어떤 종류의 차량이라도 만들어낼 수 있게 되었습니다. 게다가 차량이 어떤 기능을 가지고 있는지도 눈에 잘 들어옵니다.</p>\n<p>하지만 여전히 문제가 남아있습니다. 클래스를 살펴보면 포함된 행동들이 어떻게 사용되는지 명확하지 않습니다. 믹스인으로 새로운 메서드들이 추가되었지만 이 메서드들이 무엇을 하는지, 클래스가 어떻게 메서드와 영향을 주고받는지, 실행되는 과정은 어떻게 되는지 바로 파악할 수 없습니다. 만에 하나 같은 이름을 가지고 있는 두 모듈을 가져와 사용한다면 문제가 발생하게 됩니다. 한 모듈이 다른 모듈에 있는 메서드를 '조용히' 가져와서 사용하게 되겠지요. 상속 할 클래스가 늘어나면서 생기는 문제와 비슷한 방식으로 코드가 엉망이 되기 시작합니다.</p>\n<p>믹스인은 확실히 좋은 사용처가 있기 때문에 그렇게 나쁜 방법은 아닙니다. 제 의견으로는 로깅, 인증, 유효성 검사 등 클래스의\n메타행위(meta behavior)를 정의할 때는 아주 잘 동작한다고 생각합니다. 믹스인은 코드를 깔끔하고 작은 규모로 유지할 수 있다는 명확한 장점이 있습니다. 여러분이 모듈에 정의되어 있는 구현을 믿고 있고, 서로 다른 로직을 무너뜨리지 않는 지점을 파악하고 있는 한 괜찮습니다. 기억하셔야 할 점은 이는 단지 <strong>루비가 은연중에 다중 상속을 구현하는 방법</strong>에 불과하다는 점입니다.</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">In OOP there’s this thing to prefer composition over inheritance. And in Ruby people constantly forget that modules == multiple inheritance</p>&mdash; Piotr Solnica (@_solnic_) <a href=\"https://twitter.com/_solnic_/status/623224611212251136\">July 20, 2015</a></blockquote>\n<script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>이 문제를 개선할 수 있을까요? Yes, we can!</p>\n<h2 id=\"조합\"><a href=\"#%EC%A1%B0%ED%95%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>조합</h2>\n<p>조합은 저도 오래전에 알고 있었지만 최근에야 사용하기 시작한 용어입니다. 단지 조합을 충분히 편하게 사용할만큼 좋다는 <em>느낌을 받지 못했습니다.</em> 그러던 어느 날 Sandi Metz의 <a href=\"https://www.youtube.com/watch?v=OMPfEXIlTVE\">'Nothing is Something'</a> 이라는 아주 환상적인 발표를 보게 되었습니다. 다른 것 보다 그녀는 조합에 대해 이야기하면서 제가 예를 들었던 문제(교통 상황 시뮬레이터)를 풀어냈습니다.</p>\n<p>조합은 어떤 방식으로 동작할까요? 클래스 사이에 <strong>같은</strong> 행위를 공유하려 하기보다, 어떤 요소가 <strong>다른</strong>지 알아낸 뒤에 이름을 붙이고, 개별 클래스로 추출해낸 뒤에 마지막에 하나의 객체로 합치는 방식으로  동작하게 됩니다.</p>\n<p>상속이 '-이다(is-a)' 관계를 나타낸다면 조합은 '-를 가지고 있다(has-a)' 관계를 나타냅니다. 그러므로 조합을 활용하기 위해서 문제의 구조를 바꾸어야 합니다. 우리의 차량은 더 이상 전기자동차가 아니라, 전기 엔진을 가진 자동차 입니다(Our vehicle <strong>is not</strong> an electric vehicle anymore but rather it <strong>has</strong> an electric engine). 트럭은 그냥 트럭이 아니고 자동차가 트럭의 몸체를 가진 것입니다(It <strong>is not</strong> a truck but it <strong>has</strong> a truck body). 이렇게 우리는 두 가지 개념을 잡아냈습니다. 바로 <strong>엔진</strong> 과 <strong>몸체</strong> 입니다.</p>\n<p>우리의 애플리케이션은 이제 아래와 같은 모습이 되었습니다. 엔진과 몸체 컨셉을 구현한 뒤에 <code class=\"language-text\">Vehicle</code> 클래스 안에 엔진과 몸체가 들어갈 자리를 마련했습니다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 373px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 76.67560321715818%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADhElEQVQ4y5WU34sbVRTHJ10CEfwPBNEHX8UX8UVsUV9EQQVXiw9aLOiT0LqwYhfUsrD1qSLaBREfLNqyKD5I3UXbJrv5NZlkJpP5sROT+T2ZH8nm90w26e4kc7x3dIW+CL1w+N5zBj5z7nfOXIJ4gAUAsVaUybLchdVmFy7IPbiI9hfq3uLjDN9/mrhOfrV0o3ztoZ+oa6kt5tsUHdxJ1e7tpu5av6R+JL9J3Sxvpm6UN9Hz75ZOwFUt4OrOEdCNXhyVv7rQngGU5ck6UdJz51ibtmtOla/ZjFTWShKlkhJtliVUwyGiul7QMq+dAGv69FdK6oxytVYry1puuqK2qvLQLzWCDwnaolY7URsavQbIgyak2TTskNuQFbKgjVVo9hvgHNlAGYXzGHZ+42wiX/c/EF24iuKK6MEXUgc2uNbiy+2yd4aoWORHxqEOYps/Er3aXPBqC8HFwS5wjurHyrCJgPl3T3wsiO09UnQgX7PCXVpb7FX1Y8EIgJKDVdzhijnVQbBb4b4ziCRvAPX2CCR3AKI9iHjbmKu+jDs8h4HLCEhKPYpVx1DgHaDqXcjQGoitGRTr4zWCaVErxqGKAKOw4UJ0m5Th910RcqwDygFEgt2Zq2PcYTEGfr+9eaqszp5SR/C8MoDTzT6cQfvTch9e+JM5eDTu0DhEb7DbYd2dRqzWBVpuA2+iTlEu2DbqEAML8ZH3O/zS/84WbZVWrKkBgseHvMtFSCEOlwecix4/18bKfx6KHXbp4eeuLD22/EPyxbVK8qXLXPKJt28mU89uJB9/ffNUDIw9dNQQdRPtew40ugeAFfkaCY58n4fEI0SC1afXRWumsJrPs6ovCuaUk5xjPS8N3yMY6x8PRbsfotNGBd6NbmX4iFX8SI09bN/nIV6SG0rDBUBRcCBbNdBwdwGvUsO/jD/KReyRaPdmcgdCTvfDHBoHrDgXbO9ec1DHwHcw7OXPzibKcrAuWEe/ccZsC+nPNWO6xZmzW7tC/1WiYpJrIxiAOjZAnzhgTT00yF0wkeqBA1pgQg8OAP1R72PgK2tvJaim/zWt+EVGDe6WG6MMrQR3kA1Umuu9SeTV9DMIus60yE/oVvESbRUuVcx8rAzOcd0qfZ6Vbz95cuS6O5ecCQDT7OHhRmECSoHRZp8SD3bbmIl/b5urvDXbY1R/h9UmfzDKeIczDnNZcfjG37JmJTRNQVyIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Composition in action\"\n        title=\"\"\n        src=\"/static/b6caad80a0028f7518410ecd07b25a64/a1aef/2017-07-16-sc4.png\"\n        srcset=\"/static/b6caad80a0028f7518410ecd07b25a64/c12ac/2017-07-16-sc4.png 198w,\n/static/b6caad80a0028f7518410ecd07b25a64/a1aef/2017-07-16-sc4.png 373w\"\n        sizes=\"(max-width: 373px) 100vw, 373px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>실제 코드는 어떻게 될까요? 핵심 클래스부터 살펴보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Vehicle</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@engine</span> <span class=\"token operator\">=</span> engine\n    <span class=\"token variable\">@body</span> <span class=\"token operator\">=</span> body\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> run\n    <span class=\"token variable\">@engine</span><span class=\"token punctuation\">.</span>refill\n    <span class=\"token variable\">@body</span><span class=\"token punctuation\">.</span>load\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이제 우리는 컨셉에 맞는 구현을 한 뒤에 <code class=\"language-text\">Vehicle</code> 객체에 주입하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ElectricEngine</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 전지를 충전한다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PetrolEngine</span>\n  <span class=\"token keyword\">def</span> refill\n    <span class=\"token comment\"># 연료를 채운다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TruckBody</span>\n  <span class=\"token keyword\">def</span> load\n    <span class=\"token comment\"># 화물을 싣는다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CarBody</span>\n  <span class=\"token keyword\">def</span> load\n    <span class=\"token comment\"># 승객을 싣는다</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>마지막으로 모두 한 곳에 넣으면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">petrol_car <span class=\"token operator\">=</span> <span class=\"token constant\">Vehicle</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">:</span> <span class=\"token constant\">PetrolEngine</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token constant\">CarBody</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\nelectric_car <span class=\"token operator\">=</span> <span class=\"token constant\">Vehicle</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">:</span> <span class=\"token constant\">ElectricEngine</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token constant\">CarBody</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\npetrol_truck <span class=\"token operator\">=</span> <span class=\"token constant\">Vehicle</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">:</span> <span class=\"token constant\">PetrolEngine</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token constant\">TruckBody</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\nelectric_truck <span class=\"token operator\">=</span> <span class=\"token constant\">Vehicle</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">:</span> <span class=\"token constant\">ElectricEngine</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token constant\">TruckBody</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이 접근방식은 많은 이점이 있습니다. <code class=\"language-text\">Vehicle</code> 클래스가 외부 로직을 사용하는 방식은 첫 눈에 명확하게 들어옵니다. 이름이 꼬이는 문제도 없습니다. 각각의 클래스는 정확히 한 가지 일을 하고 있습니다(<a href=\"https://ko.wikipedia.org/wiki/%EB%8B%A8%EC%9D%BC_%EC%B1%85%EC%9E%84_%EC%9B%90%EC%B9%99\">단일 책임 원칙</a>을 만족합니다). 그래서 이 클래스들이 자신에게 주어진 일을 얼마나 제대로 하는지 확인하는 테스트를 쉽게 할 수 있습니다.</p>\n<p>우리는 높은 응집력(관련있는 로직을 같이 두는 것)을 달성하면서 동시에 결합도(클래스의 의존성을 낮게 만드는 것)는 낮추었습니다. 이제 인터페이스 전체를 바꾸지 않는 한, 고객의 요구에 걱정하지 않고 코드에 사용되는 엔진이나 몸체를 바꿀 수 있습니다.</p>\n<p>조합 기법에도 문제점이 있을까요? 물론 있습니다. 이 방식은 코드를 더 길게 쓰도록 합니다. 특히 모든 의존성들을 최종 객체에 주입하게 될 때 눈에 띄게 길어집니다. 여러분은 추가적인 보일러플레이트(여기서는 코드를 생산해내는 템플릿 함수)를 만들어서 참조 위치를 저장하고, 어디에 위임을 할지 설정하며 정확한 실행 흐름을 제어할 수 있도록 만들어야 합니다. 문제의 처방전으로 여러분은 여러 가지 <a href=\"https://en.wikipedia.org/wiki/Creational_pattern\">제작 패턴</a>을 활용할 수 있습니다. 팩토리(Factory)나 빌더(Builder) 처럼요.</p>\n<p>제가 조합을 활용하려고 할 때 제일 어려웠던 점은 제 사고 방식을 조합을 응용하기에 알맞는 방식으로 고치는 것이었습니다. 예상밖으로 <strong>Go</strong> 언어를 가지고 놀 때 많은 도움을 받았습니다. 이 프로그래밍 언어는 상속을 받지 않도록 설계되어 있지만 객체지향 방식으로 코드를 작성할 수 있게 되어있습니다. 또한 프로그래머들에게 조합을 사용하도록 권장하는 기능들이 담겨있습니다. (역주: <a href=\"http://hackthology.com/object-oriented-inheritance-in-go.html\">이 글</a>이 Go 언어에서 조합을 사용하는 예를 보여주는 좋은 글로 보입니다) 제가 Go를 조금 가지고 놀다가 갑자기 조합을 사용하는데 훨씬 익숙해졌다는 사실을 깨달았습니다. 다음 포스팅에 이 이야기를 자세히 쓰고자 합니다.</p>\n<h2 id=\"결론\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>저는 여러분께 코드를 구축하는 세 가지 다른 접근 방식을 보여드렸습니다. 상속, 믹스인, 조합 말씀입니다. <strong>상속</strong>은 많은 프로그래머들의 첫 번째 선택지이지만, 저에게는 심하게 과용되고 코드를 복잡하게 만드는데다 유지보수도 힘들게 만들었습니다. <strong>믹스인</strong>은 더 똑똑하고 강력한 대체제로 보이지만 사실은 다중 상속의 한 방법에 불과하고 코드의 복잡도를 늘릴 수도 있습니다. <strong>조합</strong>은 코드 양은 제일 길어지겠지만 클래스 사이에 의존성을 관리하는데 가장 직관적이며 깔끔한 접근방식을 가지고 있습니다. 조합은 코드를 작고 분리된 조각으로 유지하며 테스트하기도 쉽습니다. 그래서 제가 가장 선호하는 방법입니다.</p>\n<p>객체 지향 프로그래밍은 일부 프로그래머들이 다른 프로그래머들이 처한 문제를 조금 더 쉽게 해결하도록 돕고자 만든 하나의 협약에 지나지 않는다는 점을 잊으시면 안됩니다. 규약에 얽매이지 마세요. 여러분이 처한 상황에 가장 잘 맞는 해결책을 선택하세요.</p>\n<p>그리고 마지막으로, 이 말을 새겨두시기 바랍니다.</p>\n<blockquote>\n<p>객체 지향 소프트웨어를 설계하는 일은 어렵다. 그리고 재사용 가능한 객체 지향 소프트웨어를 설계하는 일은 훨씬 더 어렵다. - Gang of Four</p>\n</blockquote>\n<p>이 말을 경험을 통해 알게 되실 겁니다.</p>\n<h2 id=\"원문의-참고-자료\"><a href=\"#%EC%9B%90%EB%AC%B8%EC%9D%98-%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원문의 참고 자료</h2>\n<ul>\n<li>RailsConf 2015 - Nothing is Something</li>\n<li><a href=\"https://learnrubythehardway.org/book/ex44.html\">https://learnrubythehardway.org/book/ex44.html</a></li>\n<li><a href=\"https://robots.thoughtbot.com/reusable-oo-inheritance\">https://robots.thoughtbot.com/reusable-oo-inheritance</a></li>\n<li><a href=\"https://www.thoughtworks.com/insights/blog/composition-vs-inheritance-how-choose\">https://www.thoughtworks.com/insights/blog/composition-vs-inheritance-how-choose</a></li>\n</ul>\n<hr>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>어느정도 일상과 공부와 번역 등의 밸런스가 틀이 잡혀가면서 한달에 한 개 정도 포스팅하는 방향으로 굳어지고 있나봅니다. 적어도 한달에 두어개는 작성하고 싶은데.. 좋은 글은 매일 탐독하고 있지만 제대로 써먹지 못하면서 알려봤자 뭐가 좋나? 라는 생각이 들 때도 있습니다.</p>\n<p>이전에 의존성 주입에 관한 글을 번역했을 때도 그렇지만 조합 패턴은 루비를 사용하면서, 혹은 자바스크립트를 사용하면서도 아주 중요한 패턴 중 하나라고 생각합니다. 반드시 자유자재로 다루고 싶은 패턴이긴 한데 '평범하게' 레일즈를 사용하게 되면 아마 쉽게 익숙해지긴 힘든 패턴이라 생각합니다. 그래서 개인적으로 루비로 API 백엔드를 구축하는 토이 프로젝트를 하시게 된다면 하나미(hanamirb)를 이용해서 만들어보시는걸 강력하게 권장하고 싶습니다. 레일즈는 구조 특성상 이런 형태의 조합을 사용하기 쉽지 않다고 생각하기 때문입니다. (<code class=\"language-text\">ActiveSupport::Concern</code>, <code class=\"language-text\">Single Inheritance Table</code> 등)</p>\n<p>자바스크립트에서 조합을 사용하는 것을 권장하는 글도 최근에 읽고 큰 감명을 받았는데, 한번 살펴보시길 권하면서 링크를 남깁니다.</p>\n<ul>\n<li><a href=\"https://developers.caffeina.com/object-composition-patterns-in-javascript-4853898bb9d0\">https://developers.caffeina.com/object-composition-patterns-in-javascript-4853898bb9d0</a></li>\n<li><a href=\"https://medium.com/javascript-scene/the-two-pillars-of-javascript-ee6f3281e7f3\">https://medium.com/javascript-scene/the-two-pillars-of-javascript-ee6f3281e7f3</a></li>\n</ul>","id":"e46fab0f-d42c-5e34-9b29-30d95c186a72","frontmatter":{"date":"2017-07-16","path":"/posts/how-to-avoid-inheritance-in-ruby-kor","title":"[번역] 루비에서 상속을 피하는 방법","tags":["Ruby","OOP","Translation"],"category":"Translation"}},{"excerpt":"Hanamirb + Vue.js 시리즈 목차 API 서버 로그인 & 회원가입 페이지 가계부 페이지 업데이트 BCrypt 관련 설명 수정 (2017-05-02) 들어가며 하나미 정식 버전이 지난 4월 6일에 발표되었습니다. 기존에 레일즈에 여러모로 아쉬움을 느끼고 있던 해외의 루비 개발자들은 많은 관심을 가지고 있나봅니다. 제가 처음 하나미를 접했을 때 버전이 0.7.2였는데 어느새 1.0.…","html":"<p><strong>Hanamirb + Vue.js 시리즈 목차</strong></p>\n<ol>\n<li>\n<p><a href=\"/posts/hanami-vuejs-moneybook-api-server\">API 서버</a></p>\n</li>\n<li>\n<p><a href=\"/posts/hanami-vuejs-moneybook-frontend-1\">로그인 &#x26; 회원가입 페이지</a></p>\n</li>\n<li>\n<p><a href=\"/posts/hanami-vuejs-moneybook-frontend-2\">가계부 페이지</a></p>\n</li>\n</ol>\n<hr>\n<p><strong>업데이트</strong></p>\n<ul>\n<li>BCrypt 관련 설명 수정 (2017-05-02)</li>\n</ul>\n<hr>\n<h2 id=\"들어가며\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가며</h2>\n<p>하나미 정식 버전이 지난 4월 6일에 발표되었습니다. 기존에 레일즈에 여러모로 아쉬움을 느끼고 있던 해외의 루비 개발자들은 많은 관심을 가지고 있나봅니다. 제가 처음 하나미를 접했을 때 버전이 0.7.2였는데 어느새 1.0.0 버전이 발매되었고, 아직도 쓰고있다보니 감개무량합니다.</p>\n<p>요즘 프론트엔드 JS 프레임워크에 많은 관심을 가지고 ReactJS, Vue.js를 공부하고 있는데, 간단히 배운 내용을 적용해볼 겸 간단 가계부를 구현해보도록 하겠습니다. 백엔드 JSON API 서버는 하나미로 구현하고, 프론트엔드는 Vue.js로 구현하는 과정을 보여드리겠습니다.</p>\n<p>최대한 간단히 설명해드리려 노력하겠지만, 기존에 루비로 웹 개발을 해보신분이 이해하시기 쉬울 겁니다. 사실 JSON API 서버는 어떤 언어나 프레임워크로 제공해도 되니까요 :) 구현방법에 약간씩 차이가 있을 뿐이지 제가 보여드리는 정도의 앱은 그렇게 어렵지 않게 작성하실 수 있으리라 봅니다.</p>\n<h2 id=\"애플리케이션의-기본-구성\"><a href=\"#%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>애플리케이션의 기본 구성</h2>\n<p>처음에는 더욱 간단한 To-Do List(할일 관리) 를 구현하려고 했는데, 그러면 하나미를 다루는 부분이 너무 영양가가 없어질 것 같아서 가계부 형식의 앱으로 만들고, 다음의 기능을 구상해 보았습니다.</p>\n<ul>\n<li>\n<p>회원 등록 및 인증</p>\n<ul>\n<li>이메일과 비밀번호로 회원 가입</li>\n<li>JWT로 인증 (토큰은 LocalStorage에 저장)</li>\n</ul>\n</li>\n<li>\n<p>사용금액, 내용 입력</p>\n<ul>\n<li>수입은 녹색, 지출은 빨강색으로 표시</li>\n<li>각 아이템을 클릭하면 바로 수정 가능, 삭제 버튼을 누르면 삭제</li>\n</ul>\n</li>\n<li>수입, 지출을 필터링하여 보기</li>\n<li>가장 최신 레코드 30개를 처음에 불러온 뒤, 화면에 보이는 마지막 내역까지 스크롤 하게 되면 추가로 자료 가져오기</li>\n</ul>\n<p>이 정도의 기능을 구현해볼 예정입니다. 막상 하려니 쉽진 않겠지만 차근차근 진행해보겠습니다.</p>\n<h2 id=\"하나미-프로젝트-생성\"><a href=\"#%ED%95%98%EB%82%98%EB%AF%B8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하나미 프로젝트 생성</h2>\n<p>너무나 당연하지만 하나미를 사용하기 위해서는 개발 환경에 루비가 세팅되어 있어야 합니다. 아직 루비가 설치되어있지 않은 경우에는 <a href=\"https://gorails.com/setup/\">GoRails의 설치 가이드</a>를 따라하시면 되겠습니다. 그 다음에 하나미 젬을 설치하시면 됩니다. 이번 강좌에서는 <strong>루비 2.4.1</strong>, <strong>하나미 1.0.0</strong> 버전을 기준으로 프로젝트를 생성하겠습니다.</p>\n<p>먼저 하나미 젬을 설치합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gem install hanami</code></pre></div>\n<p>설치 된 이후에 프로젝트는 원하시는 이름으로 설치하시면 됩니다. 하나미는 SQLite, MySQL, PostgreSQL 등을 지원하지만, 기본적으로 PostgreSQL을 권장합니다. 또한 테스팅 프레임워크도 처음 프로젝트를 설정할 때 Minitest, RSpec 중에서 고르실 수 있습니다. 제가 아직 RSpec은 커녕 TDD를 잘 못하기 때문에 Minitest로 진행해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">hanami new moneybook-api --database=postgres --test=minitest</code></pre></div>\n<p>생성된 프로젝트에서 젬파일을 살펴보시면 꽤 간단합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Gemfile</span>\nsource <span class=\"token string\">'https://rubygems.org'</span>\n\ngem <span class=\"token string\">'rake'</span>\ngem <span class=\"token string\">'hanami'</span><span class=\"token punctuation\">,</span>       <span class=\"token string\">'~> 1.0'</span>\ngem <span class=\"token string\">'hanami-model'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'~> 1.0'</span>\n\ngem <span class=\"token string\">'pg'</span>\n\ngroup <span class=\"token symbol\">:development</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># Code reloading</span>\n  <span class=\"token comment\"># See: http://hanamirb.org/guides/projects/code-reloading</span>\n  gem <span class=\"token string\">'shotgun'</span>\n<span class=\"token keyword\">end</span>\n\ngroup <span class=\"token symbol\">:test</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:development</span> <span class=\"token keyword\">do</span>\n  gem <span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'~> 2.0'</span>\n<span class=\"token keyword\">end</span>\n\ngroup <span class=\"token symbol\">:test</span> <span class=\"token keyword\">do</span>\n  gem <span class=\"token string\">'minitest'</span>\n  gem <span class=\"token string\">'capybara'</span>\n<span class=\"token keyword\">end</span>\n\ngroup <span class=\"token symbol\">:production</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># gem 'puma'</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이 중에서 <code class=\"language-text\">capybara</code> 젬은 뷰 테스트 용이기 떄문에 이번 프로젝트에선 굳이 없어도 됩니다. 앞으로 젬이 더 추가될테지만 필요에 따라 추가하기로 하고, <code class=\"language-text\">bundle install</code> 커맨드로 필요한 젬을 설치해두겠습니다.</p>\n<p>참고로 PostgreSQL을 이용하시려면 <code class=\"language-text\">.env</code> 파일에서 계정 설정을 해주셔야 합니다. SQLite를 이용하신다면 파일로 관리되기 때문에 계정 설정을 해 주실 필요는 없습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># .env.development\nDATABASE_URL=&quot;postgresql://username:password@localhost/moneybook_api_development&quot;</code></pre></div>\n<h2 id=\"사용자-인증-구현\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 인증 구현</h2>\n<p>기존의 웹 페이지는 서버에서 인증 관련 정보를 들고, 세션을 이용하여 인증 상태를 유지하고 요청을 하는 경우가 많았습니다. 하지만 모바일 애플리케이션이나, 많은 인스턴스를 올려서 인증을 관리하는 경우 세션 기반 인증은 유연한 대응이 어렵습니다. JWT라는 개념을 이용하면 세션 기반 인증의 단점을 극복하고 사용자 인증을 적용할 수 있습니다.</p>\n<p>JWT 인증이 무엇인지 궁금하시다면 다음의 링크를 읽어보시길 바랍니다.</p>\n<ul>\n<li><a href=\"https://velopert.com/2389\">JSON Web Token 소개 및 구조 - velopert</a></li>\n<li><a href=\"http://bcho.tistory.com/999\">REST JWT 소개 - 조대협</a></li>\n<li><a href=\"https://jwt.io/introduction/\">Introduction to JSON Web Tokens</a></li>\n</ul>\n<p>인증에 필요한 젬을 추가한 뒤, 사용자 정보를 기록하는 모델을 생성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Gemfile</span>\n<span class=\"token comment\"># ...</span>\ngem <span class=\"token string\">'bcrypt'</span>\ngem <span class=\"token string\">'jwt'</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p><code class=\"language-text\">bcrypt</code> 젬은 비밀번호 생성에 특화된 단방향 해시 함수를 지원합니다.<br>\n간단한 사용법을 알려드리면 <code class=\"language-text\">BCrypt::Password.create(&#39;password&#39;)</code> 로 해시 다이제스트를 생성하고, <code class=\"language-text\">BCrypt::Password.new(digest)</code> 로 해시 다이제스트가 본래 비밀번호와 일치하는지 검사합니다.</p>\n<p>너무나 당연하면서 중요한 이야기지만 웹 개발자로서 복잡한 보안 알고리즘을 직접 구현하면 관리 및 취약점을 파악하기가 어렵기 때문에 차라리 <code class=\"language-text\">bcrypt</code> 처럼 검증된 라이브러리를 사용하시길 추천합니다. 비슷한 예로 Rails에서 사용자 인증과 관련한 부분은 되도록이면 Devise 젬을 사용하길 권장하는 것 처럼요.</p>\n<p>패스워드 저장 매커니즘에 대해 <a href=\"http://d2.naver.com/helloworld/318732\">이 글</a>을 읽어보시길 추천합니다.</p>\n<h3 id=\"사용자-모델-생성\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%AA%A8%EB%8D%B8-%EC%83%9D%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 모델 생성</h3>\n<p>먼저 사용자 정보를 저장하기 위한 모델을 생성하겠습니다. 간단히 이메일과 패스워드를 저장하는 테이블을 만들면 되겠네요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle exec hanami generate model user</code></pre></div>\n<p>앞으로 모든 하나미 커맨드 앞에는 <code class=\"language-text\">bundle exec</code>  이 붙을 예정입니다. 앞으로 하나미를 자주 쓰게 되면 <code class=\"language-text\">bashrc</code> 나  <code class=\"language-text\">zshrc</code> 에 alias 지정을 해 두는걸 추천합니다.</p>\n<p>그리고 레일즈와 비슷하게 <code class=\"language-text\">db/migrations</code> 폴더에 마이그레이션 파일이 있습니다. 어떤 컬럼에 어떤 정보가 들어가게 될 지 작성해주어야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># db/migration/2017***_create_users.rb</span>\n<span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Model</span><span class=\"token punctuation\">.</span>migration <span class=\"token keyword\">do</span>\n  change <span class=\"token keyword\">do</span>\n    create_table <span class=\"token symbol\">:users</span> <span class=\"token keyword\">do</span>\n      primary_key <span class=\"token symbol\">:id</span>\n\n      column <span class=\"token symbol\">:email</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:password_digest</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n\n      column <span class=\"token symbol\">:created_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:updated_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>방법에 따라서는 이메일 컬럼만 있어도 충분히 JWT 인증을 구현할 수 있다는데 아직 잘 모르겠습니다. 이제 테이블 생성을 위해 마이그레이션을 실행하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle exec hanami db create # 먼저 데이터베이스 생성부터\nbundle exec hanami db migrate</code></pre></div>\n<h3 id=\"사용자-등록-액션\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%93%B1%EB%A1%9D-%EC%95%A1%EC%85%98\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 등록 액션</h3>\n<p>이제 사용자를 등록하는 액션을 생성하겠습니다. 이후에 JWT 인증하는 과정을 덧붙일 예정입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle exec hanami generate action api auth#sign_in --skip-view\nbundle exec hanami generate action api auth#sign_up --skip-view</code></pre></div>\n<p>action 뒤에 <code class=\"language-text\">api\u001d</code> 는 제가 사용할 앱 이름입니다. 기본값은 web으로 되어 있지만, <a href=\"http://hanamirb.org/guides/command-line/generators/\">하나미 가이드의 Command Line 부분을 참고하시면</a> 다른 앱을 생성하거나 삭제하는 등 액션을 실행할 수 있습니다.</p>\n<p><code class=\"language-text\">--skip-view</code> 는 뷰와 관련된 템플릿 파일이나 뷰 클래스 및 테스트를 생성하지 않는 커맨드입니다. 우리는 하나미를 순순히 API 서버로 사용할 것이기 때문에 미리 입력해주어야 불필요한 파일을 만들지 않게 됩니다.</p>\n<p>라우팅 파일의 내용도 변경해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/config/routes.rb</span>\npost <span class=\"token string\">'/auth/sign_in'</span><span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">:</span> <span class=\"token string\">'auth#sign_in'</span>\npost <span class=\"token string\">'/auth/sign_up'</span><span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">:</span> <span class=\"token string\">'auth#sign_up'</span></code></pre></div>\n<p>사용자를 등록하는 과정은 JWT랑은 관련이 없습니다. 단순히 이메일, 비밀번호, 비밀번호 확인을 하는 패러매터를 전달 받은 뒤, 유효성 검사에 성공하면 비밀번호를 암호화하여 데이터베이스에 저장하면 됩니다.</p>\n<p>우리는 JSON API 서버를 만들고 있기 때문에 애플리케이션의 <code class=\"language-text\">body_parsers</code> 나 <code class=\"language-text\">default_request_format</code> 등의 설정을 바꾸어 주어야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/application.rb</span>\n<span class=\"token comment\"># From Line 90</span>\n      <span class=\"token comment\"># Default format for the requests that don't specify an HTTP_ACCEPT header</span>\n      <span class=\"token comment\"># Argument: A symbol representation of a mime type, defaults to :html</span>\n      <span class=\"token comment\">#</span>\n      default_request_format <span class=\"token symbol\">:json</span>\n\n      <span class=\"token comment\"># Default format for responses that don't consider the request format</span>\n      <span class=\"token comment\"># Argument: A symbol representation of a mime type, defaults to :html</span>\n      <span class=\"token comment\">#</span>\n      default_response_format <span class=\"token symbol\">:json</span>\n\n      <span class=\"token comment\"># HTTP Body parsers</span>\n      <span class=\"token comment\"># Parse non GET responses body for a specific mime type</span>\n      <span class=\"token comment\"># Argument: Symbol, which represent the format of the mime type</span>\n      <span class=\"token comment\">#             (only `:json` is supported)</span>\n      <span class=\"token comment\">#           Object, the parser</span>\n      <span class=\"token comment\">#</span>\n      body_parsers <span class=\"token symbol\">:json</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>이제 안정적으로 기능을 구현하기 위해 테스트를 작성하겠습니다. 테스트 파일은 <code class=\"language-text\">spec/</code> 폴더에 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># spec/api/controllers/auth/sign_up_spec.rb</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'spec_helper'</span>\nrequire_relative <span class=\"token string\">'../../../../apps/api/controllers/auth/sign_up'</span>\n\ndescribe <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Auth</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">SignUp</span> <span class=\"token keyword\">do</span>\n  <span class=\"token function\">let</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Auth</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">SignUp</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">let</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span>\n      user<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        email<span class=\"token punctuation\">:</span> <span class=\"token string\">\"foo@bar.com\"</span><span class=\"token punctuation\">,</span>\n        password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">,</span>\n        password_confirmation<span class=\"token punctuation\">:</span> <span class=\"token string\">\"secret\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  describe <span class=\"token string\">'with valid params'</span> <span class=\"token keyword\">do</span>\n    it <span class=\"token string\">'is successful'</span> <span class=\"token keyword\">do</span>\n      response <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      response<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>must_equal <span class=\"token number\">201</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n\n  describe <span class=\"token string\">'with invalid params'</span> <span class=\"token keyword\">do</span>\n    it <span class=\"token string\">'returns 422'</span> <span class=\"token keyword\">do</span>\n      response <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      response<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>must_equal <span class=\"token number\">422</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>먼저 유효성 검사부터 만들겠습니다. 하나미의 유효성 검사는 모델에서 수행하는 게 아니라 각 액션에서 수행합니다. (공통된 유효성 검사를 모듈화할 수도 있습니다)</p>\n<p><strong>작성되는 코드는 모두 테스트를 먼저 작성하고 진행하지만, 글에서 모두 보여드리지 않겠습니다. 자세한 내용은 <a href=\"https://github.com/emaren84/moneybook_api\">Github에 올라와 있는 소스코드</a>를 살펴봐 주세요.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/auth/sign_up.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Auth</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">SignUp</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    <span class=\"token constant\">VALID_EMAIL_REGEX</span> <span class=\"token operator\">=</span> <span class=\"token regex\">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:email</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">,</span> format<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">VALID_EMAIL_REGEX</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>confirmation\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      halt <span class=\"token number\">422</span> <span class=\"token keyword\">unless</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">halt</code> 메서드는 인자로 받은 스테이터스 번호와 메세지를 리턴합니다. 메세지는 생략 가능합니다. 이제 올바른 패러매터가 들어왔으면  사용자를 등록하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># same file</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Auth</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">SignUp</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    <span class=\"token constant\">VALID_EMAIL_REGEX</span> <span class=\"token operator\">=</span> <span class=\"token regex\">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:email</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">,</span> format<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">VALID_EMAIL_REGEX</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>confirmation\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>interactor<span class=\"token punctuation\">:</span> <span class=\"token constant\">UserSignUp</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@interactor</span> <span class=\"token operator\">=</span> interactor\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      halt <span class=\"token number\">422</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Invalid Parameters'</span> <span class=\"token keyword\">unless</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n\n      result <span class=\"token operator\">=</span> <span class=\"token variable\">@interactor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>call\n      status <span class=\"token number\">201</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>show_info<span class=\"token punctuation\">.</span>to_json\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>뭔가 이상한 녀석이 나왔습니다. interactor라뇨? 인터렉터(Interactor)는 하나미에서 제공하는 모듈인데, 보통 다양한 비지니스 처리 로직을 분리하는 용도 혹은 재사용 가능한 비지니스 로직을 API, Web 같이 서로 다른 앱에서도 공유할 수 있도록 만들어졌습니다. <code class=\"language-text\">lib/interactor</code> 에 해당 클래스명으로 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># lib/interactor/user_sign_up.rb</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">\"hanami/interactor\"</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">\"bcrypt\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSignUp</span>\n  include <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Interactor</span>\n  include <span class=\"token constant\">BCrypt</span>\n\n  expose <span class=\"token symbol\">:user</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>user_attr<span class=\"token punctuation\">,</span> encryptor<span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">,</span> repo<span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@user_attr</span> <span class=\"token operator\">=</span> user_attr\n    <span class=\"token variable\">@encryptor</span> <span class=\"token operator\">=</span> encryptor <span class=\"token operator\">||</span> <span class=\"token constant\">BCrypt</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Password</span>\n    <span class=\"token variable\">@repo</span> <span class=\"token operator\">=</span> repo <span class=\"token operator\">||</span> <span class=\"token constant\">UserRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span>\n  <span class=\"token class-name\">end</span>\n\n  <span class=\"token keyword\">def</span> call\n    safe_user <span class=\"token operator\">=</span> <span class=\"token function\">encrypt_user</span><span class=\"token punctuation\">(</span>user_attr<span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">@repo</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>safe_user<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">private</span>\n\n  attr_reader <span class=\"token symbol\">:user_attr</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">encrypt_user</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> <span class=\"token variable\">@encryptor</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">[</span><span class=\"token symbol\">:password</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">{</span> email<span class=\"token punctuation\">:</span> user_attr<span class=\"token punctuation\">[</span><span class=\"token symbol\">:email</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> password_digest<span class=\"token punctuation\">:</span> password <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>눈여겨 보실점은 <code class=\"language-text\">expose</code> 밖에 없고 나머지는 일반적인 사용자 등록 로직으로 구성되어 있습니다. 인터렉터는 해당 클래스의 객체를 생성하고 <code class=\"language-text\">call</code> 메서드로 연산을 수행하는데, 그 결과값을 <code class=\"language-text\">expose</code> 로 내보내야 합니다. 참고로 <code class=\"language-text\">expose</code> 로 내보내려는 값은 인스턴스 변수여야 합니다. 여기서는 <code class=\"language-text\">@user</code> 가 되겠네요. 내보낸 결과물은 메서드처럼 <code class=\"language-text\">.user</code> 로 가져올 수 있습니다.</p>\n<p>그런데 액션 부분에 <code class=\"language-text\">result.user.show_info.to_json</code>  이라고 되어있는 부분이 있습니다. <code class=\"language-text\">to_json</code> 은 리턴값이 JSON이어야 되니까 그렇다 치고, <code class=\"language-text\">show_info</code> 는 어디에 있는 녀석일까요? 방금까지 우리는 사용자를 생성했습니다. 그리고 생성된 결과값이 User Entity(엔티티)인데, 엔티티에 메서드를 정의하여 원하는 정보를 가공하여 보여줄 수 있도록 만든 것입니다. 콘솔에서 한번 확인해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle exec hanami console</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[2] pry(main)&gt; UserRepository.new.create(email: &#39;foo@baz.com&#39;, password_digest: &#39;some secret&#39;)\n[moneybook_api] [INFO] [2017-04-22 14:06:37 +0900] (0.003739s) INSERT INTO &quot;users&quot; (&quot;email&quot;, &quot;password_digest&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (&#39;foo@baz.com&#39;, &#39;some secret&#39;, &#39;2017-04-22 05:06:37.222355+0000&#39;, &#39;2017-04-22 05:06:37.222355+0000&#39;) RETURNING &quot;id&quot;, &quot;email&quot;, &quot;password_digest&quot;, &quot;created_at&quot;, &quot;updated_at&quot;\n=&gt; #&lt;User:0x007fb6a6c49348\n @attributes=\n  {:id=&gt;3, :email=&gt;&quot;foo@baz.com&quot;, :password_digest=&gt;&quot;some secret&quot;, :created_at=&gt;2017-04-22 05:06:37 UTC, :updated_at=&gt;2017-04-22 05:06:37 UTC}&gt;</code></pre></div>\n<p>저렇게 임의의 사용자를 생성하니 User 엔티티가 리턴된 것을 볼 수 있습니다. Repository가 뭐고, Entity가 무엇인지는 <a href=\"https://emaren84.github.io/blog/archivers/hanami-introduction#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\">제가 전에 작성한 하나미 소개 포스트를 참고해주세요.</a></p>\n<p>엔티티 클래스 파일의 위치는 <code class=\"language-text\">lib/moneybook_api/entities</code> 입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># lib/moneybook_api/entities/user.rb</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Entity</span>\n  <span class=\"token keyword\">def</span> show_info\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>to_h<span class=\"token punctuation\">.</span>tap <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>attributes<span class=\"token operator\">|</span> attributes<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:password_digest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이렇게 하여 사용자 생성 후 리턴 값에는 패스워드를 뺸 나머지 정보만 보이게 됩니다.</p>\n<h3 id=\"토큰-생성하기\"><a href=\"#%ED%86%A0%ED%81%B0-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 생성하기</h3>\n<p>이제부터가 본격적인 JWT 인증을 구현하는 부분입니다. 생성한 사용자가 로그인을 시도하고 요청한 이메일과 비밀번호가 맞다면 우리는 인증 토큰을 생성하여 돌려주게 되고, 사용자는 매번 로그인 할 필요 없이 그 토큰을 가지고 (유효기간이 만료할 때 까지) 자유로이 앱을 사용할 수 있게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/controllers/auth/sign_in.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Auth</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">SignIn</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    <span class=\"token constant\">VALID_EMAIL_REGEX</span> <span class=\"token operator\">=</span> <span class=\"token regex\">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:email</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">,</span> format<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">VALID_EMAIL_REGEX</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      halt <span class=\"token number\">422</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Invalid Parameters'</span> <span class=\"token keyword\">unless</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n      email <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:email</span><span class=\"token punctuation\">)</span>\n      password <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:user</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:password</span><span class=\"token punctuation\">)</span>\n\n      user <span class=\"token operator\">=</span> <span class=\"token constant\">UserRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">find_by_email</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">if</span> user <span class=\"token operator\">&amp;&amp;</span> user<span class=\"token punctuation\">.</span>valid_password<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>\n        token <span class=\"token operator\">=</span> <span class=\"token constant\">JwtIssuer</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n\n        status <span class=\"token number\">201</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">.</span>to_json\n      <span class=\"token keyword\">else</span>\n        halt <span class=\"token number\">401</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Authentication Failed'</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>유효성 검사를 하는 부분은 회원 등록 하는 액션에서도 적어놓았기 때문에 쉽게 알아보실 수 있을겁니다. 바로 아래에 <code class=\"language-text\">params.get</code> 이라는 메서드는 <code class=\"language-text\">Hash#dig</code> 메서드와 비슷한 용도를 가지고 있는데 <code class=\"language-text\">params[:user][:email]</code> 같이 값을 검색하려다가 <code class=\"language-text\">params[:user]</code> 가 <code class=\"language-text\">nil</code> 인 경우 <code class=\"language-text\">NoMethodError</code> 에러가 발생하는 일을 방지해줍니다. 대신 <code class=\"language-text\">nil</code> 을 리턴합니다.</p>\n<p><code class=\"language-text\">find_by_email</code> 같은 메서드는 레일즈를 하시는 분들이 보기엔 아주 친숙할겁니다. 하지만 우리는 이 메서드를 직접 구현해야 합니다. 레일즈로 개발하면서 느끼는 마법은 하나미에서는 일어나지 않습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># lib/moneybook_api/repositories/user_repository.rb</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserRepository</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Repository</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">find_by_email</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n    users<span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">:</span> email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">as</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:entity</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>one\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><strong>모든 하나미의 쿼리 메서드는 private 입니다. 콘솔에서 바로 테스트 할 수 없습니다.</strong> 테스트를 작성하거나, 원하는 쿼리를 메서드로 정의한 뒤에 콘솔에서 돌려봐야 합니다.</p>\n<p><code class=\"language-text\">users</code> 는 리퍼지토리와 연결되어있는 테이블명을 나타내는 규약입니다. 만약 <code class=\"language-text\">BookRepository</code> 에서 <code class=\"language-text\">books</code> 라는 테이블의 내용을 가져오게 된다면 우리는 <code class=\"language-text\">books.</code> 로 시작하는 메서드를 작성하게 됩니다. 자세한 내용은 하나미 모델의 구현체인 <a href=\"http://rom-rb.org\">ROM</a>의 문서를 참고하시는게 좋습니다.</p>\n<p>레일즈를 개발하는 분들은 보통 쿼리의 결과가 각 모델의 객체로 나오기 때문에 이후에 각 엔티티마다 메서드를 바로 사용할 수 있을겁니다. 하지만 하나미에서는 <code class=\"language-text\">as(:entity)</code> 옵션을 적용해주지 않으면 결과물이 단순한 <code class=\"language-text\">ROM::Struct</code> 객체를 리턴하거나. <code class=\"language-text\">ROM::Relation</code> 객체를 리턴하는 경우가 많습니다.</p>\n<p><code class=\"language-text\">Struct</code> 객체는 Hash처럼 되어있어서, 쿼리의 결과 레코드를 그대로 쓰는 건 가능하지만 엔티티에 정의해놓은 메서드를 사용할 수 없습니다. <code class=\"language-text\">Relation</code> 객체는 쿼리를 아직 실행하기 전에 ROM에서 쿼리를 준비해 놓는 객체입니다. 이 객체에 <code class=\"language-text\">to_a</code> 나 <code class=\"language-text\">each</code> 같은 메서드를 사용해서 자료를 가공할 때 쿼리를 실행하고, 그 때 엔티티를 다룰 수 있습니다.</p>\n<p>지금은 간단한 쿼리라서 <code class=\"language-text\">.as(:entity)</code> 부분을 빼도 결과값을 맨 앞 한개만 출력하라는 <code class=\"language-text\">one</code> 메서드 때문에 바로 User 엔티티가 출력될겁니다. 이후에 더 복잡한 쿼리를 작성하게 되는 일이 있을 때 제가 말씀드린 내용이 도움이 되었으면 좋겠습니다.</p>\n<p><code class=\"language-text\">user.valid_password?</code> 메서드는 <code class=\"language-text\">BCrypt</code> 젬을 이용하여 암호화했던 비밀번호를 해독하고, 맞는지 확인하는 역할을 합니다.</p>\n<p><code class=\"language-text\">JwtIssuer</code> 클래스는 라이브러리로 활용하기 위해 <code class=\"language-text\">lib/moneybook_api/services</code> 폴더에 작성했습니다. 여기에 작성해 두면 다른 앱이나 액션에서 자유롭게 사용할 수 있기 때문입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># lib/moneybook_api/services</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtIssuer</span>\n  <span class=\"token constant\">DEFAULT_EXPIRE_TIME</span> <span class=\"token operator\">=</span> <span class=\"token number\">86400</span> <span class=\"token comment\"># 24 hours</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">,</span> exp <span class=\"token operator\">=</span> <span class=\"token builtin\">Time</span><span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">.</span>to_i <span class=\"token operator\">+</span> <span class=\"token constant\">DEFAULT_EXPIRE_TIME</span><span class=\"token punctuation\">)</span>\n    payload <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> user_id<span class=\"token punctuation\">:</span> user_id<span class=\"token punctuation\">,</span> iss<span class=\"token punctuation\">:</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_ISSUER'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> exp<span class=\"token punctuation\">:</span> exp <span class=\"token punctuation\">}</span>\n    token <span class=\"token operator\">=</span> <span class=\"token constant\">JWT</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">,</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_SECRET'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HS256'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span> auth_token<span class=\"token punctuation\">:</span> token <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token constant\">JWT</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">,</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_SECRET'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>코드의 내용은 <a href=\"https://github.com/jwt/ruby-jwt/blob/master/README.md#algorithms-and-usage\">JWT 젬의 사용법을 따라</a> 우리가 필요한 부분을 캡슐화한 정도입니다. 토큰 생성 시점에서 24시간의 기한을 주었고, <code class=\"language-text\">iss</code> 옵션은 발행자 옵션인데, 임의로 <code class=\"language-text\">localhost</code> 로 지정해두었습니다. <code class=\"language-text\">ENV[&#39;JWT_SECRET&#39;]</code> 같이 지정되어있는 환경변수를 가져오는 방법은 프로젝트 폴더에 <code class=\"language-text\">.env.development</code> 같이 되어있는 파일에다 작성는 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># .env.development\n# ...\nJWT_SECRET=&quot;some secret&quot;\n# ...</code></pre></div>\n<p>비밀번호 토큰은 여러분이 원하는대로 만든 다음에, <code class=\"language-text\">Base64</code> 나 <code class=\"language-text\">Digest</code> 클래스를 활용하여 암호화하시길 추천합니다.</p>\n<p>인코딩에 성공하면 컨트롤러 액션은 201 스테이터스와 함께 토큰 JSON을 리턴하게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -X POST -H &quot;Content-Type: application/json&quot; -H &quot;Accept: application/json&quot; -d &#39;{ &quot;user&quot;: { &quot;email&quot;: &quot;foo@bar.com&quot;, &quot;foo&quot;: &quot;cherryblossom&quot; } }&#39; &quot;http://localhost:2300/api/auth/sign_in&quot;\n=&gt;\n{\n  &quot;auth_token&quot;: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo0LCJpc3MiOiJsb2NhbGhvc3QiLCJleHAiOjE0OTI5NjM2NTV9.38-CWKZkOuWD_idEOhv1gAret6_qG_ue7kk0iPftJ_M&quot;\n}</code></pre></div>\n<p>이제 사용자가 매 요청을 할 때마다 이 토큰이 유효한지 검사하는 부분을 만들어야 하는데, 가계부 기록 작성과 관련된 API를 구현한 뒤에 마저 만들어 보겠습니다.</p>\n<h2 id=\"가계부-api-만들기\"><a href=\"#%EA%B0%80%EA%B3%84%EB%B6%80-api-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가계부 API 만들기</h2>\n<p>가계부 API는 간단한 REST 형식으로 만들 예정입니다.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">정의</th>\n<th align=\"center\">내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">/records (GET)</td>\n<td align=\"center\">모든 레코드를 가져온다</td>\n</tr>\n<tr>\n<td align=\"center\">/records (POST)</td>\n<td align=\"center\">레코드를 생성한다</td>\n</tr>\n<tr>\n<td align=\"center\">/records/:record_id (PATCH)</td>\n<td align=\"center\">해당 레코드를 수정한다</td>\n</tr>\n<tr>\n<td align=\"center\">/records/:record_id(DELETE)</td>\n<td align=\"center\">해당 레코드를 삭제한다</td>\n</tr>\n</tbody>\n</table>\n<p>RESTful API 라면 보통 사용자가 가지고 있는 레코드를 표현해야 하니까 URL 어딘가에 <code class=\"language-text\">user_id</code> 같은게 있어야 할 것 처럼 보입니다. 하지만 우리가 구현하고자 하는 서버에는 필요가 없습니다. JWT 토큰을 HTTP 헤더에 추가하여 요청을 하면, 서버가 토큰을 해석하여 <code class=\"language-text\">user_id</code> 를 찾아내고 그 값을 기반으로 특정 사용자의 레코드를 검색하게 됩니다.</p>\n<h3 id=\"모델-생성--라우팅\"><a href=\"#%EB%AA%A8%EB%8D%B8-%EC%83%9D%EC%84%B1--%EB%9D%BC%EC%9A%B0%ED%8C%85\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 생성 &#x26; 라우팅</h3>\n<p>일단 레코드 모델과 레코드를 생성하는 액션을 만들고 나서, 토큰 인증 과정을 덧붙이도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle exec hanami generate model record</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># db/migrations/2017**_create_records.rb</span>\n<span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Model</span><span class=\"token punctuation\">.</span>migration <span class=\"token keyword\">do</span>\n  change <span class=\"token keyword\">do</span>\n    create_table <span class=\"token symbol\">:records</span> <span class=\"token keyword\">do</span>\n      primary_key <span class=\"token symbol\">:id</span>\n      foreign_key <span class=\"token symbol\">:user_id</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:users</span><span class=\"token punctuation\">,</span> on_delete<span class=\"token punctuation\">:</span> <span class=\"token symbol\">:cascade</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n\n      column <span class=\"token symbol\">:amount</span><span class=\"token punctuation\">,</span>      <span class=\"token builtin\">Integer</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:description</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">String</span>\n\n      column <span class=\"token symbol\">:created_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:updated_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>외부 키는 컬럼 이름과, 연결해 줄 테이블 이름을 지정해줍니다. 나머지 뒤에 있는 요소들은 <a href=\"http://hanamirb.org/guides/migrations/create-table/\">공식 문서에 자세한 설명이 있으니</a> 참조바랍니다. 그리고 마이그레이션을 실행하면 됩니다.</p>\n<p>그 다음에 액션을 생성하고 라우트를 지정하겠습니다. 다른 <code class=\"language-text\">records</code> 관련 액션을 미리 생성해두셔도 상관 없습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bundle exec hanami generate action api records#create --skip-view</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/config/routes.rb</span>\n<span class=\"token comment\"># ...</span>\nresources <span class=\"token symbol\">:records</span><span class=\"token punctuation\">,</span> only<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token symbol\">:index</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:create</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:update</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:destroy</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>이 부분은 레일즈의 자동 라우팅과 아주 유사합니다. 라우팅이 어떻게 구성되었는지 확인하시려면 <code class=\"language-text\">bundle exec hanami routes</code> 커맨드를 실행하시면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    Name Method     Path                           Action\n\n         POST       /api/auth/sign_in    Api::Controllers::Auth::SignIn\n         POST       /api/auth/sign_up    Api::Controllers::Auth::SignUp\n records GET, HEAD  /api/records         Api::Controllers::Records::Index\n records POST       /api/records         Api::Controllers::Records::Create\n  record PATCH      /api/records/:id     Api::Controllers::Records::Update\n  record DELETE     /api/records/:id     Api::Controllers::Records::Destroy</code></pre></div>\n<h3 id=\"레코드-생성\"><a href=\"#%EB%A0%88%EC%BD%94%EB%93%9C-%EC%83%9D%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레코드 생성</h3>\n<p>이제 세부 로직을 구현할 준비가 끝났으니 레코드 생성을 해 보겠습니다. 지금은 임의의 사용자를 지정하여 레코드를 생성하려 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/records/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Records</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:record</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:amount</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:int?</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">optional</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:description</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      halt <span class=\"token number\">422</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Invalid Parameters'</span> <span class=\"token keyword\">unless</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n      user <span class=\"token operator\">=</span> <span class=\"token constant\">UserRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span>first\n      amount <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:record</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:amount</span><span class=\"token punctuation\">)</span>\n      description <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:record</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:description</span><span class=\"token punctuation\">)</span>\n\n      record <span class=\"token operator\">=</span> <span class=\"token constant\">RecordRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>\n        user_id<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n        amount<span class=\"token punctuation\">:</span> amount<span class=\"token punctuation\">,</span>\n        description<span class=\"token punctuation\">:</span> description\n      <span class=\"token punctuation\">)</span>\n\n      status <span class=\"token number\">201</span><span class=\"token punctuation\">,</span> record<span class=\"token punctuation\">.</span>to_json\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>패러매터가 유효하면 레코드를 생성하고 그 정보를 JSON으로 리턴하는 간단한 내용의 코드입니다. 이제 패러매터의 유효성은 둘째치고 모든 액션에 앞서 토큰의 유효성을 검사하는 모듈이 필요합니다. 이 파일을 어디에 정의하고 어떻게 사용하는지 <a href=\"http://hanamirb.org/guides/actions/share-code/\">가이드에 잘 설명이 되어있는데</a>, 가이드의 내용을 활용하여 만들어보겠습니다.</p>\n<h3 id=\"토큰-인증\"><a href=\"#%ED%86%A0%ED%81%B0-%EC%9D%B8%EC%A6%9D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 인증</h3>\n<p>컨트롤러에 공통적으로 사용되는 모듈은 해당 앱의 <code class=\"language-text\">/controllers</code> 폴더에다 바로 작성하면 됩니다. 그리고 모든 컨트롤러 액션에 공통적으로 사용하고자 하면 <code class=\"language-text\">application.rb</code> 파일을 수정해야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/authentication.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span>\n  <span class=\"token keyword\">module</span> <span class=\"token constant\">Authentication</span>\n    <span class=\"token keyword\">module</span> <span class=\"token constant\">Skip</span>\n      <span class=\"token keyword\">def</span> authenticate<span class=\"token operator\">!</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">included</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span>\n      action<span class=\"token punctuation\">.</span>class_eval <span class=\"token keyword\">do</span>\n        before <span class=\"token symbol\">:authenticate!</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">private</span>\n\n    <span class=\"token keyword\">def</span> authenticate<span class=\"token operator\">!</span>\n      halt <span class=\"token number\">401</span> <span class=\"token keyword\">unless</span> authenticated<span class=\"token operator\">?</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> authenticated<span class=\"token operator\">?</span>\n      <span class=\"token operator\">!</span><span class=\"token operator\">!</span>current_user\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> current_user\n      user_id <span class=\"token operator\">=</span> validate_token <span class=\"token operator\">?</span> validate_token<span class=\"token punctuation\">[</span><span class=\"token string\">'user_id'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span>\n      <span class=\"token constant\">UserRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> validate_token\n      token_header <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">get_header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HTTP_AUTHORIZATION'</span><span class=\"token punctuation\">)</span>\n      token <span class=\"token operator\">=</span> token_header<span class=\"token punctuation\">.</span><span class=\"token function\">gsub</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/^Bearer\\s/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">begin</span>\n        <span class=\"token constant\">JwtIssuer</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">rescue</span>\n        <span class=\"token keyword\">nil</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>몇 가지 이상한 녀석들이 나왔습니다. 일단 <code class=\"language-text\">included</code> 메서드는 모듈이 특정 모듈이나 클래스에 <code class=\"language-text\">include</code> 될 때 실행되는 훅(Hook)과 같은 메서드입니다. 인자 <code class=\"language-text\">action</code> 은 이 모듈을 불러온 액션을 뜻합니다. 그리고 <code class=\"language-text\">class_eval</code> 은 해당 클래스에 블락의 내용을 추가로 작성해주는 메서드라고 이해하시면 됩니다. 즉 이 모듈을 불러오는 클래스는 <code class=\"language-text\">before :authenticate!</code> 라는 코드 라인이 추가되는겁니다. <code class=\"language-text\">before</code> 는 레일즈의 <code class=\"language-text\">before_action</code> 처럼 해당 액션을 실행하기 전에 먼저 실행되는 메서드를 정의합니다.</p>\n<p>마지막으로 <code class=\"language-text\">request</code> 는 <code class=\"language-text\">Rack::Request</code> 에 정의되어 있는 객체입니다 <a href=\"http://hanamirb.org/guides/actions/request-and-response/\">가이드에 간단한 사용법이 있지만</a> 더 자세한 사용법을 보시려면 <a href=\"http://www.rubydoc.info/gems/rack/Rack/Request\">직접 문서를 보셔야 합니다</a>.</p>\n<p>사용자는 발급받은 토큰을 매 HTTP 헤더에 실어서 보내야 합니다. 그 형식은 <code class=\"language-text\">Authorization =&gt; Bearer {token}</code> 이 되도록 지정했습니다.</p>\n<p>이제 애플리케이션 설정 파일에서 이 모듈을 공통적으로 불러오게 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/application.rb</span>\n<span class=\"token comment\"># ...</span>\nrequire_relative <span class=\"token string\">'./controllers/authentication'</span>\n<span class=\"token comment\"># ...</span>\n      controller<span class=\"token punctuation\">.</span>prepare <span class=\"token keyword\">do</span>\n        include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Authentication</span> <span class=\"token comment\"># included in all the actions</span>\n      <span class=\"token keyword\">end</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>약 260번째 줄 부근에 해당 코드가 있습니다. 모든 컨트롤러 액션에 이 블록 안의 코드가 추가됩니다. 맨 윗줄에 <code class=\"language-text\">require_relative</code> 로 파일을 불러오는 걸 잊어버리시면 안됩니다.</p>\n<p>그 다음 <code class=\"language-text\">records#create</code> 액션의 코드를 수정해줍시다. 한 줄이면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/records/create.rb</span>\n<span class=\"token comment\"># ...</span>\nuser <span class=\"token operator\">=</span> current_user\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>테스트를 잘 작성해오셨다면 전혀 뜬금없이 회원 가입, 로그인 액션에서 오류가 납니다. 인증 토큰을 요구할 필요가 없는 액션에서도 토큰을 요구하고 있기 때문입니다. 하지만 위에 인증을 스킵할 수 있도록 오버라이드용 메서드를 정의해 두었으니 <code class=\"language-text\">Api::Authentication::Skip</code> 모듈을 불러오기만 하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/auth/sign_up.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Auth</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">SignUp</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Authentication</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Skip</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<h3 id=\"나머지-액션들-작성\"><a href=\"#%EB%82%98%EB%A8%B8%EC%A7%80-%EC%95%A1%EC%85%98%EB%93%A4-%EC%9E%91%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>나머지 액션들 작성</h3>\n<p>이제 레코드를 만들고, 인증하는 과정을 만들었으니 나머지 액션들은 비교적 간단합니다. 간단하게 작성한 코드를 참고해주세요.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/records/index.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Records</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Index</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">:</span> <span class=\"token constant\">RecordRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@repo</span> <span class=\"token operator\">=</span> repository\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      status <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> get_records<span class=\"token punctuation\">.</span>to_json\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">private</span>\n\n    attr_reader <span class=\"token symbol\">:repo</span>\n\n    <span class=\"token keyword\">def</span> get_records\n      records <span class=\"token operator\">=</span> repo<span class=\"token punctuation\">.</span><span class=\"token function\">by_user</span><span class=\"token punctuation\">(</span>current_user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>map <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>record<span class=\"token operator\">|</span> record<span class=\"token punctuation\">.</span>to_h <span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>tap <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>hash<span class=\"token operator\">|</span>\n        hash<span class=\"token punctuation\">.</span><span class=\"token function\">store</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:records</span><span class=\"token punctuation\">,</span> records<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">by_user</code> 메서드는 <code class=\"language-text\">RecordRepository</code> 에 정의되어 있습니다. 사실 레일즈 사용자분들이라면 모델에 <code class=\"language-text\">has_many</code> 같은 메서드를 사용하여 1:N 관계를 정의하는 경우가 보편적일텐데요. 하나미도 <a href=\"http://hanamirb.org/guides/models/associations/\">최근에 그런 기능을 지원하기 시작헀지만</a> 아직 실험적인 기능이기 때문에 직접 구현했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># lib/moneybook_api/repositories/record_repository.rb</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">RecordRepository</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Repository</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">by_user</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n    records<span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이후의 결과물은 완성된 Hash나 Array가 아니라 <code class=\"language-text\">Enumerator</code> 같은 객체라서 원하는 결과물을 반복 메서드를 사용하여 다양하게 다룰 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">require_relative <span class=\"token string\">'./set_record'</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Records</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Update</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n    include <span class=\"token constant\">SetRecord</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:record</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:amount</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:int?</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">optional</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:description</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">:</span> <span class=\"token constant\">RecordRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@repo</span> <span class=\"token operator\">=</span> repository\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      halt <span class=\"token number\">422</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Invalid Parameters'</span> <span class=\"token keyword\">unless</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n\n      <span class=\"token keyword\">begin</span>\n        updated_record <span class=\"token operator\">=</span> repo<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:record</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        status <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> updated_record<span class=\"token punctuation\">.</span>to_h<span class=\"token punctuation\">.</span>to_json\n      <span class=\"token keyword\">rescue</span>\n        status <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> error<span class=\"token punctuation\">:</span> <span class=\"token string\">'There was a problem during the process'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>to_json\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">private</span>\n\n    attr_reader <span class=\"token symbol\">:repo</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:record</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">SetRecord</code> 모듈도 <a href=\"http://hanamirb.org/guides/actions/share-code/\">공식 가이드의 내용</a>을 참고하여 만들었습니다. Update와 Destroy 액션에서 공통적으로 레코드를 찾는 과정이 필요한데, 모듈에다 구현해두고 여러 액션에서 재활용할 수 있도록 만든겁니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/records/set_record.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Records</span>\n  <span class=\"token keyword\">module</span> <span class=\"token constant\">SetRecord</span>\n    <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">included</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span>\n      action<span class=\"token punctuation\">.</span>class_eval <span class=\"token keyword\">do</span>\n        before <span class=\"token symbol\">:set_record</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">private</span>\n\n    <span class=\"token keyword\">def</span> set_record\n      <span class=\"token variable\">@record</span> <span class=\"token operator\">=</span> <span class=\"token constant\">RecordRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:id</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      halt <span class=\"token number\">404</span> <span class=\"token keyword\">unless</span> <span class=\"token variable\">@record</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/api/controllers/records/destroy.rb</span>\nrequire_relative <span class=\"token string\">'./set_record'</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Records</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Destroy</span>\n    include <span class=\"token constant\">Api</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n    include <span class=\"token constant\">SetRecord</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">:</span> <span class=\"token constant\">RecordRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@repo</span> <span class=\"token operator\">=</span> repository\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">begin</span>\n        repo<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n        status <span class=\"token number\">204</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> success<span class=\"token punctuation\">:</span> <span class=\"token string\">'Successfully Removed'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>to_json\n      <span class=\"token keyword\">rescue</span>\n        status <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> error<span class=\"token punctuation\">:</span> <span class=\"token string\">'There is a problem during the process'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>to_json\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">private</span>\n\n    attr_reader <span class=\"token symbol\">:repo</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:record</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>축하합니다. 여러분은 하나미로 간단 API 서버를 가독성 높고 모듈화하기 용이한 루비 코드로 작성하였습니다.</p>\n<hr>\n<p>사실 더 개선할 부분들은 많습니다. 예를 들면 Interactor 를 활용한 로직 분리, 명확한 의존성 주입으로 테스트 효율 높이기 + 더 짜임새 있는 테스트 작성 등을 고려해야겠지요. 마침 <a href=\"https://github.com/nickgnd/hanami-jwt-example\">비슷한 내용의 예제 코드가 아주아주 높은 퀄리티로 작성되어 있어서</a> 이번 튜토리얼을 구현해보면서 기본 개념을 익히신 다음에, 다른 예제를 참고하시면 큰 도움이 될 것이라 생각합니다.</p>\n<ul>\n<li>Source Code: <a href=\"https://github.com/emaren84/moneybook_api\">Github</a></li>\n</ul>","id":"2db95595-bdf5-5caf-8ed4-42ba2c4f9835","frontmatter":{"date":"2017-04-27","path":"/posts/hanami-vuejs-moneybook-api-server","title":"Hanamirb + Vue.js 로 간단 가계부 구현 (API 서버 편)","tags":["Ruby","Hanami","Vue.js"],"category":"Hanami"}},{"excerpt":"기존에  Learn Vue.js 2  강좌를 보면서 Form 제출에 대한 프로젝트를 레일즈로 작성하는 부분까지 따라했었는데, 이번에 다시 익혀보면서 백엔드 구축을 하나미로 작성해보았다. 그 과정에서 webpack을 밑바닥부터 설정하는 에피소드를 참고하여 하나미를 기반으로 설정해 보았다. application.rb…","html":"<p>기존에 <a href=\"https://laracasts.com/series/learn-vue-2-step-by-step/\">Learn Vue.js 2</a> 강좌를 보면서 Form 제출에 대한 프로젝트를 레일즈로 작성하는 부분까지 따라했었는데, 이번에 다시 익혀보면서 백엔드 구축을 하나미로 작성해보았다. 그 과정에서 webpack을 밑바닥부터 설정하는 에피소드를 참고하여 하나미를 기반으로 설정해 보았다.</p>\n<h2 id=\"applicationrb-설정하기\"><a href=\"#applicationrb-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>application.rb 설정하기</h2>\n<p>프로젝트를 작성하고 레일즈로 작성해놓았던 코드도 옮기고 한 건 좋은데 제대로 돌아가는 게 하나도 없었다. 브라우저 콘솔에 나타난 에러를 가만히 들여다보니 Content Security Policy를 미리 설정해둘 필요가 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># application.rb</span>\n<span class=\"token comment\"># ...</span>\n      security<span class=\"token punctuation\">.</span>content_security_policy <span class=\"token string\">%{\n        form-action 'self';\n        frame-ancestors 'self';\n        base-uri 'self';\n        default-src 'none';\n        script-src 'self' 'unsafe-inline' 'unsafe-eval' https:;\n        connect-src 'self';\n        img-src 'self' https: data:;\n        style-src 'self' 'unsafe-inline' https:;\n        font-src 'self';\n        object-src 'none';\n        plugin-types application/pdf;\n        child-src 'self';\n        frame-src 'self';\n        media-src 'self'\n      }</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p><code class=\"language-text\">script-src</code> 부분에 주목해야한다. <code class=\"language-text\">unsafe-inline</code> 뿐 아니라 <code class=\"language-text\">unsafe-eval</code> 도 추가해주어야 한다. 그리고 애셋을 하나미에서 컴파일하지 않도록 설정해주어야 한다. 그렇지 않으면 자동적으로 하나미가 컴파일되지 않은 파일을 <code class=\"language-text\">public</code> 폴더로 옮겨버린다. 나중에 다시 설정하는 법을 찾을 수 있을지 모르겠지만 <code class=\"language-text\">fingerprint</code> 도 사용하지 않도록 체크해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">    <span class=\"token comment\">##</span>\n    <span class=\"token comment\"># DEVELOPMENT</span>\n    <span class=\"token comment\">#</span>\n    configure <span class=\"token symbol\">:development</span> <span class=\"token keyword\">do</span>\n      <span class=\"token comment\"># Don't handle exceptions, render the stack trace</span>\n      handle_exceptions <span class=\"token keyword\">false</span>\n\n      assets <span class=\"token keyword\">do</span>\n        compile <span class=\"token keyword\">false</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n\t<span class=\"token comment\"># ...</span>\n\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\"># PRODUCTION</span>\n    <span class=\"token comment\">#</span>\n    configure <span class=\"token symbol\">:production</span> <span class=\"token keyword\">do</span>\n      <span class=\"token comment\"># scheme 'https'</span>\n      <span class=\"token comment\"># host   'example.org'</span>\n      <span class=\"token comment\"># port   443</span>\n\n      assets <span class=\"token keyword\">do</span>\n        <span class=\"token comment\"># Don't compile static assets in production mode (eg. Sass, ES6)</span>\n        <span class=\"token comment\">#</span>\n        <span class=\"token comment\"># See: http://www.rubydoc.info/gems/hanami-assets#Configuration</span>\n        compile <span class=\"token keyword\">false</span>\n        \n        <span class=\"token comment\"># Use fingerprint file name for asset paths</span>\n        <span class=\"token comment\">#</span>\n        <span class=\"token comment\"># See: http://hanamirb.org/guides/assets/overview</span>\n        fingerprint <span class=\"token keyword\">false</span>\n        \n        <span class=\"token comment\"># ...</span></code></pre></div>\n<h2 id=\"yarn-init\"><a href=\"#yarn-init\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yarn init</h2>\n<p>현재로서 <code class=\"language-text\">npm</code> 보다 <code class=\"language-text\">yarn</code> 이 더 나아보이니까 한번 적용해보았다. 이번 프로젝트와 관련된 모듈들은 다음의 커맨드로 설치하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 필수 모듈\n$ yarn add axios vue\n\n# 개발용 모듈\n$ yarn add webpack babel-core babel-loader babel-preset-es2015 --dev</code></pre></div>\n<h2 id=\"webpack-설정-파일-생성\"><a href=\"#webpack-%EC%84%A4%EC%A0%95-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>webpack 설정 파일 생성</h2>\n<p>다음은 webpack을 설정하는 파일을 작성할 차례이다. 처음엔 아주 간단한 부분만 작성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\n<span class=\"token keyword\">const</span> webpack <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./apps/web/assets/javascript/app.js'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 타겟 파일 지정</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n  \tpath<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/public/assets'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 번들된 파일 저장 위치, path 모듈을 불러와야한다.</span>\n  \tfilename<span class=\"token punctuation\">:</span> <span class=\"token string\">'app.js'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// bundle.js를 많이 쓰는 경향이 있는데 이번엔 app.js로 지정</span>\n  \tpublicPath<span class=\"token punctuation\">:</span> <span class=\"token string\">'./public'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 설정을 해 주고 <code class=\"language-text\">app.js</code> 파일이 엔트리 포인트가 되도록 각 모듈 사이의 <code class=\"language-text\">import</code> 나 <code class=\"language-text\">export</code> 를 지정해준다.</p>\n<p>번들된 파일을 생성하기 위해선 다음 커맨드를 입력해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node_modules/.bin/webpack --hide-modules\n# 계속 변화를 감지하기 위한 커맨드는 다음과 같다.\n$ node_modules/.bin/webpack --hide-modules --watch</code></pre></div>\n<p>하지만 저 커맨드를 굳이 매번 입력해 줄 필요는 없다. <code class=\"language-text\">package.json</code> 파일에 스크립트를 설정해줄 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">// package.json\n<span class=\"token punctuation\">{</span>\n  // ...\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"webpack\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=development webpack --hide-modules\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=development webpack --hide-modules --watch\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=production webpack --hide-modules\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">NODE_ENV</code> 에 대해서는 나중에 살펴 볼 것이다.</p>\n<p>하나미의 <code class=\"language-text\">application.html.erb</code> 파일에서는 <code class=\"language-text\">javascript</code> 뷰 헬퍼로 자바스크립트 파일을 불러오는데, body  태그 마지막에 불러오도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token comment\">&lt;!-- ... --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      &lt;%= yield %>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    &lt;%= javascript 'app' %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- ... --></span></code></pre></div>\n<p>대신 css 파일은 수동으로 옮겨주어야 할 것이다. <code class=\"language-text\">scss</code> 같은 preprocessing이 필요한 파일들은 어떻게 처리하는지 아직 실험해보지 못했다. 어차피 전부 webpack으로 해결할 수 있다.</p>\n<p>하지만 막상 번들된 파일을 불러와도 크롬에서 에러를 뿜으면서 랜더링이 되지 않았다. 왜인지 살펴보니 뷰의 모든 구성요소를 컴포넌트로 만들지 않고(Runtime-only), 기존에 작성한 html에 속성을 적용하려면(Full version) <a href=\"https://kr.vuejs.org/v2/guide/installation.html#Runtime-Compiler-vs-Runtime-only\">별도의 설정</a>을 해 주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  resolve<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    alias<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'vue$'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'vue/dist/vue.esm.js'</span> <span class=\"token comment\">// 'vue/dist/vue.common.js'  webpack 1용 입니다</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 생각하던대로 작동한다. 나중에 다른 프로젝트에서 Vue 컴포넌트로만 빌드를 하게 되면 이 설정은 입력할 필요가 없을 것이다.</p>\n<h2 id=\"환경-변수-관리\"><a href=\"#%ED%99%98%EA%B2%BD-%EB%B3%80%EC%88%98-%EA%B4%80%EB%A6%AC\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경 변수 관리</h2>\n<p>윗부분에서 <code class=\"language-text\">NODE_ENV</code> 와 관련된 스크립트를 언급했는데, 프로덕션 모드에서는 번들된 패키지를 더 압축해주고, 프로덕션 모드임을 지정해주는 설정이 가능하다. 별도로 패키지를 설정해 줄 필요는 없고, webpack 설정 파일 제일 아랫부분에 스크립트를 더 추가해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>optimize<span class=\"token punctuation\">.</span>UglifyJsPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      sourceMap<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      compress<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        warnings<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>DefinePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'process_env'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'\"production\"'</span> <span class=\"token comment\">// 오타가 아니고 따옴표 안에 겹따옴표 들어가는거 맞다</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"babel-적용하기\"><a href=\"#babel-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>babel 적용하기</h2>\n<p>최신 버전 크롬은 ES6 문법 대부분을 지원하기 때문에 별 신경을 쓰지 않아도 되곘지만.. 그래도 바벨을 적용해두는게 좋을 것이다. </p>\n<p>위에서 필요한 모듈은 설치되어있으니 <code class=\"language-text\">.babelrc</code> 파일부터 지정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">// .babelrc\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"es2015\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 바벨에서 제공하는 <a href=\"http://babeljs.io/docs/setup/#installation\">공식 문서를 따라</a> webpack 설정 파일에 다음 코드를 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n      \ttest<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n      \texclude<span class=\"token punctuation\">:</span> <span class=\"token regex\">/node_modules/</span><span class=\"token punctuation\">,</span>\n      \tloader<span class=\"token punctuation\">:</span> <span class=\"token string\">\"babel-loader\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제부터 webpack을 실행하면 바벨로 변환된 결과물이 나온다.</p>\n<h2 id=\"라이브러리-나누어서-적용하기\"><a href=\"#%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EB%82%98%EB%88%84%EC%96%B4%EC%84%9C-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>라이브러리 나누어서 적용하기</h2>\n<p>만약에 내가 자바스크립트 파일을 작성하다가 아주 일부분만 수정하고 다시 빌드를 해야하는 일이 있다고 할 때 계속 시간을 잡아먹는게 상당히 짜증날 것이다. 일단 기본적인 라이브러리는 내용이 변할 일이 없기 때문에 별도로 합쳐지도록 적용하고, 내가 실제로 작성하는 파일만 변화가 있을 때 다시 번들되도록 만들면 많은 시간을 단축할 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    app<span class=\"token punctuation\">:</span> <span class=\"token string\">'./apps/web/assets/javascripts/app.js'</span><span class=\"token punctuation\">,</span>\n    vendor<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'vue'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'axios'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/public/assets'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'[name].js'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// entry에 지정된 name(app, vendor)로 번들된 파일이 생성된다.</span>\n    publicPath<span class=\"token punctuation\">:</span> <span class=\"token string\">'./public'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>optimize<span class=\"token punctuation\">.</span>CommonsChunckPlugin</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">'vendor'</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// vendor 파일 덩어리를 따로 보관하고 캐싱한다.</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이러고 나서 빌드를 마치고 나면 <code class=\"language-text\">public/assets</code> 폴더에는 <code class=\"language-text\">app.js</code>, <code class=\"language-text\">vendor.js</code> 두 개의 파일이 생성된다. 당연하게 레이아웃 페이지에서 <code class=\"language-text\">vendor.js</code> 파일도 로딩해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token comment\">&lt;!-- ... --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      &lt;%= yield %>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    &lt;%= javascript 'vendor', 'app' %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- ... --></span></code></pre></div>\n<h2 id=\"css-파일도-관리하자\"><a href=\"#css-%ED%8C%8C%EC%9D%BC%EB%8F%84-%EA%B4%80%EB%A6%AC%ED%95%98%EC%9E%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSS 파일도 관리하자</h2>\n<p>이래저래 잘 작동하길래 슬슬 코드를 올려볼까 했더니 CSS 파일이 문제가 되었다. 물론 CSS 파일의 내용은 몇 줄 없지만, 매번 내용을 수정한 다음에 일일이 파일을 <code class=\"language-text\">public</code> 폴더로 옮기는건 아주 비효율적이다. 당연히 webpack이 CSS 파일도 모아줄 수 있다.</p>\n<p>먼저 필요한 모듈을 설치한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ yarn add css-loader extract-text-webpack-plugin --dev</code></pre></div>\n<p>그리고 설정파일에 CSS 관련 모듈 규칙과 플러그인을 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\n<span class=\"token keyword\">const</span> ExtractTextPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'extract-text-webpack-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token comment\">// ...</span>\n      <span class=\"token punctuation\">{</span>\n        test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.css$/</span><span class=\"token punctuation\">,</span>\n        loader<span class=\"token punctuation\">:</span> ExtractTextPlugin<span class=\"token punctuation\">.</span><span class=\"token function\">extract</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          use<span class=\"token punctuation\">:</span> <span class=\"token string\">'css-loader'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExtractTextPlugin</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styles.css'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 원하는 이름으로 지정</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>이후 webpack을 실행하면 <code class=\"language-text\">public/assets</code> 폴더에 <code class=\"language-text\">styles.css</code> 파일이 추가된다. 나머지는 레이아웃 파일에서 이 파일을 불러오도록 만들면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    &lt;%= stylesheet 'https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.min.css' %>\n    &lt;%= stylesheet 'styles' %>\n    <span class=\"token comment\">&lt;!-- ... --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>위 내용을 기반으로 작성한 간단한 프로젝트는 <a href=\"https://github.com/emaren84/hanami-webpack-config-example\">Github</a>에 업로드 되어있다.</p>","id":"276d5934-965f-54ce-8049-cebed0c02c6b","frontmatter":{"date":"2017-04-09","path":"/posts/hanami-webpack-config","title":"하나미 프로젝트에서 webpack 설정하기","tags":["Ruby","Hanami","Javascript","Webpack"],"category":"Webpack"}},{"excerpt":"본 포스트는  Aaron Patterson 의  포스트 의 번역본입니다. 기본적인 루비 및 레일즈 지식을 가지고 있는 독자 대상의 글입니다. 피드백은 언제나 환영합니다. 저는 콘솔 디버거입니다  (역주1: 원 제목의 'puts debuggerer'를 의역하였습니다. 루비의 puts는 전달받은 인자를 표준 출력(stdout)해주는 메서드입니다. 이후에도 puts debugging…","html":"<ul>\n<li>본 포스트는 <a href=\"https://twitter.com/tenderlove\">Aaron Patterson</a>의 <a href=\"https://tenderlovemaking.com/2016/02/05/i-am-a-puts-debuggerer.html\">포스트</a>의 번역본입니다.</li>\n<li>기본적인 루비 및 레일즈 지식을 가지고 있는 독자 대상의 글입니다.</li>\n<li>피드백은 언제나 환영합니다.</li>\n</ul>\n<hr>\n<p>저는 콘솔 디버거입니다 <em>(역주1: 원 제목의 'puts debuggerer'를 의역하였습니다. 루비의 puts는 전달받은 인자를 표준 출력(stdout)해주는 메서드입니다. 이후에도 puts debugging은 모두 콘솔 디버깅으로 번역하겠습니다)</em>. 진짜 디버거( <code class=\"language-text\">pry</code> , <code class=\"language-text\">byebug</code> 등)를 사용하는 사람들을 폄하하고자 이 이야기를 하는게 아닙니다. 진짜 디버거는 아주 좋다고 생각하지만, 저는 하나라도 제대로 배울 시간을 들이지 못했습니다. 매번 한 개라도 써보려고 하다가 결국엔 한동안 사용하지 않고, 다시 사용방법을 배워야만 합니다. 어쨌든, 이번 기회에 여러분에게 콘솔 디버깅을 할 때 사용하는 트릭을 좀 알려드리고자 합니다. 저는 이 트릭들을 무언가가 어떻게 작동하는지 이해가 되지 않을때나 작동 원리를 더 알고싶을 때 사용합니다. 아래에 이야기하게 될 대부분의 것들은 <em>절대로</em> 최선의 방법(best practice)가 아니며 여러분들은 디버깅 세션이 끝나면 절대 이 코드들을 남겨두어선 안됩니다. 그러나 여러분이 <strong>무엇을 디버깅하던지</strong> 아주 유용하다고 생각합니다. 정말로 뭐든지요. 전역 변수, 메서드 재정의, 조건문 추가, 불러오기 경로 수정, 몽키 패칭, 콜 스택 출력 등 <strong>뭐든지요</strong>.</p>\n<p>저는 이 포스트에서 최대한 실제 접하는 예시들을 보여드리고 싶었습니다. 하지만 대부분의 예시들은 제가 레일즈의 보안 이슈를 디버깅하려고 할 때 나온 것들이라서, 이 코드의 테크닉은 재활용하셔도 좋지만 <strong>코드 전체를 그대로 쓰시면 안됩니다.</strong> 제가 디버깅하려는 코드들은 정상적으로 동작하지 않습니다. 거기다 이 코드를 사용하시는걸 원치도 않습니다.</p>\n<p>매 섹션에 제가 겪었던 문제들을 제목으로 적어두었으며, 내용 부분에 제가 사용한 해결책을 적어두었습니다.</p>\n<h2 id=\"어디에-문제가-있는진-알겠는데-어떻게-거기까지-가야할지-모르겠다\"><a href=\"#%EC%96%B4%EB%94%94%EC%97%90-%EB%AC%B8%EC%A0%9C%EA%B0%80-%EC%9E%88%EB%8A%94%EC%A7%84-%EC%95%8C%EA%B2%A0%EB%8A%94%EB%8D%B0-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B1%B0%EA%B8%B0%EA%B9%8C%EC%A7%80-%EA%B0%80%EC%95%BC%ED%95%A0%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어디에 문제가 있는진 알겠는데, 어떻게 거기까지 가야할지 모르겠다</h2>\n<p>가끔 저는 문제가 어딨는지는 알지만 어떻게 그 부분까지 가는지 모르는 이슈들을 디버깅할 때가 있습니다. 이럴 때마다 저는 <code class=\"language-text\">puts caller</code> 를 넣어서 콜 스택을 끄집어냅니다.</p>\n<p>예를 들어 제가 이런 코드를 작성했다고 칩시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">LOOKUP</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">Hash</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>h<span class=\"token punctuation\">,</span> k<span class=\"token operator\">|</span> h<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Type</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span> <span class=\"token keyword\">unless</span> k<span class=\"token punctuation\">.</span>blank<span class=\"token operator\">?</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 저는 기본 블록이 어떻게 호출되는지 알고 싶을 때 이렇게 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">LOOKUP</span>\t\t<span class=\"token operator\">=</span> <span class=\"token builtin\">Hash</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>h<span class=\"token punctuation\">,</span> k<span class=\"token operator\">|</span>\n  puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n  puts caller\n  puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n  h<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Type</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span> <span class=\"token keyword\">unless</span> k<span class=\"token punctuation\">.</span>blank<span class=\"token operator\">?</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 코드는 90개의 해시 태그를 출력하고 콜 스택을 출력한 뒤에, 나머지 90개의 해시 태그를 출력할 겁니다. 해시 태그는 여러번 호출될 때를 대비해서 콜 스택을 쉽게 구분하기 위해 넣어두었습니다. 참고로 이걸 \"해시 태그\"라고 부르는건 여러분을 골려주려고 그러는 겁니다.</p>\n<p>저는 이 방법을 꽤 자주 사용하기 때문에 Vim 단축키를 지정해두었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot; puts the caller\nnnoremap &lt;leader&gt;wtf oputs &quot;#&quot; * 90&lt;c-m&gt;puts caller&lt;c-m&gt;puts &quot;#&quot; * 90&lt;esc&gt;</code></pre></div>\n<p>이렇게 하면 <code class=\"language-text\">&lt;leader&gt;wtf</code> 키 조합으로 커서가 있는 위치 바로 밑에 디버깅 코드를 삽입합니다.</p>\n<h3 id=\"콜-스택을-한-번만-출력하고-싶어\"><a href=\"#%EC%BD%9C-%EC%8A%A4%ED%83%9D%EC%9D%84-%ED%95%9C-%EB%B2%88%EB%A7%8C-%EC%B6%9C%EB%A0%A5%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%96%B4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>콜 스택을 한 번만 출력하고 싶어</h3>\n<p>그냥 콜 스택을 출력한 뒤에 <code class=\"language-text\">exit!</code> 를 사용하거나, <code class=\"language-text\">raise</code> 를 호출하세요. <code class=\"language-text\">raise</code> 는 예외를 출력할거고, 어쨌든 콜 스택을 볼 수 있을겁니다.</p>\n<h3 id=\"콜-스택을-특정-경우에만-보고-싶어\"><a href=\"#%EC%BD%9C-%EC%8A%A4%ED%83%9D%EC%9D%84-%ED%8A%B9%EC%A0%95-%EA%B2%BD%EC%9A%B0%EC%97%90%EB%A7%8C-%EB%B3%B4%EA%B3%A0-%EC%8B%B6%EC%96%B4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>콜 스택을 특정 경우에만 보고 싶어</h3>\n<p>이건 그냥 디버깅 코드니까 여러분이 하고싶은대로 하시면 됩니다. 예를 들어 제가 해시에 무언가를 추가할 때마다 콜 스택을 호출하고 싶다고 한다면, 이렇게 하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">LOOKUP</span>\t\t<span class=\"token operator\">=</span> <span class=\"token builtin\">Hash</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>h<span class=\"token punctuation\">,</span> k<span class=\"token operator\">|</span>\n  <span class=\"token keyword\">unless</span> k<span class=\"token punctuation\">.</span>blank<span class=\"token operator\">?</span>\n    puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n    puts caller\n    puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n    h<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Type</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>어차피 전 이 코드를 없애버릴거니까 어떤 이상한 조건문도 마음대로 추가할 수 있지요!</p>\n<h2 id=\"메서드를-호출했는데-이게-어디에-있는건지-모르겠다\"><a href=\"#%EB%A9%94%EC%84%9C%EB%93%9C%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%96%88%EB%8A%94%EB%8D%B0-%EC%9D%B4%EA%B2%8C-%EC%96%B4%EB%94%94%EC%97%90-%EC%9E%88%EB%8A%94%EA%B1%B4%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메서드를 호출했는데, 이게 어디에 있는건지 모르겠다</h2>\n<p>메서드를 호출했는데 그 메서드가 어디에 구현되어있는지 모를 때, 저는 <code class=\"language-text\">source_location</code> 메서드와 함께 <code class=\"language-text\">method</code> 메서드를 사용합니다. 예를 들어 (레일즈) 컨트롤러 안에 있는 액션이 <code class=\"language-text\">render</code> 메서드를 호출하고 있을 때, 저는 그 메서드를 어디서 호출하는지 알고 싶었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  render params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:id</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>위의 코드를 이렇게 바꿔보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  p <span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:render</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>source_location\n  render params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:id</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>호출해보도록 하지요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl http://localhost:3000/users/xxxx</code></pre></div>\n<p>그러면 로그에는 이렇게 출력됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Processing by UsersController#show as */*\n  Parameters: {&quot;id&quot;=&gt;&quot;xxxx&quot;}\n[&quot;/Users/aaron/git/rails/actionpack/lib/action_controller/metal/instrumentation.rb&quot;, 40]\nCompleted 500 Internal Server Error in 35ms (ActiveRecord: 0.0ms)</code></pre></div>\n<p>이제 저는 <code class=\"language-text\">render</code> 메서드가 <a href=\"https://github.com/rails/rails/blob/6fcc3c47eb363d0d3753ee284de2fbc68df03194/actionpack/lib/action_controller/metal/instrumentation.rb#L40\">instrumentation.rb 파일의 40번째 줄</a>에 있다는 것을 알게 되었습니다.</p>\n<h2 id=\"code-classlanguage-textsupercode-메서드를-호출했는데-그게-어디에-있는건지-모르겠다\"><a href=\"#code-classlanguage-textsupercode-%EB%A9%94%EC%84%9C%EB%93%9C%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%96%88%EB%8A%94%EB%8D%B0-%EA%B7%B8%EA%B2%8C-%EC%96%B4%EB%94%94%EC%97%90-%EC%9E%88%EB%8A%94%EA%B1%B4%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">super</code> 메서드를 호출했는데 그게 어디에 있는건지 모르겠다</h2>\n<p><code class=\"language-text\">render</code> 메서드가 <a href=\"https://github.com/rails/rails/blob/6fcc3c47eb363d0d3753ee284de2fbc68df03194/actionpack/lib/action_controller/metal/instrumentation.rb#L43\">super를 호출한다는 걸</a> 알게 되었습니다만, 저는 그게 어디에 구현되어있는지 모릅니다. 이 경우에 <code class=\"language-text\">method</code> 의 리턴 값에 <code class=\"language-text\">super_method</code> 를 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  p <span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:render</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>source_location\n  render params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:id</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>위의 코드를 이렇게 바꿉니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  p <span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:render</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>super_method<span class=\"token punctuation\">.</span>source_location\n  redner params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:id</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>같은 요청을 해 보면 이런 결과를 얻을 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Processing by UsersController#show as */*\n  Parameters: {&quot;id&quot;=&gt;&quot;xxxx&quot;}\n[&quot;/Users/aaron/git/rails/actionpack/lib/action_controller/metal/rendering.rb&quot;, 34]\nCompleted 500 Internal Server Error in 34ms (ActiveRecord: 0.0ms)</code></pre></div>\n<p>이제야 <code class=\"language-text\">super</code> 가 <a href=\"https://github.com/rails/rails/blob/6fcc3c47eb363d0d3753ee284de2fbc68df03194/actionpack/lib/action_controller/metal/rendering.rb#L34\">여기로 가는 게</a> 보입니다. 이 메서드는 마찬가지로 <code class=\"language-text\">super</code> 를 호출하지만, 그냥 위의 작업을 반복하여(아니면 그냥 loop를 쓰면 됩니다!) 제가 진짜 알아보고자 하는 메서드를 찾을 수 있습니다.</p>\n<h2 id=\"code-classlanguage-textmethodcode-메서드의-구현체를-찾고자-한다면\"><a href=\"#code-classlanguage-textmethodcode-%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EA%B5%AC%ED%98%84%EC%B2%B4%EB%A5%BC-%EC%B0%BE%EA%B3%A0%EC%9E%90-%ED%95%9C%EB%8B%A4%EB%A9%B4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">method</code> 메서드의 구현체를 찾고자 한다면?</h2>\n<p>때때로 <code class=\"language-text\">method</code> 를 이용한 트릭이 작동하지 않을 때가 있습니다. 제가 알아보려는 객체가 자신만의 <code class=\"language-text\">method</code> 메서드를 구현하고 있기 때문입니다. 예를 들어 저는 <code class=\"language-text\">request</code> 객체에 <code class=\"language-text\">headers</code> 메서드가 구현된 위치를 찾고자 할 때 이런 코드를 사용했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  p request<span class=\"token punctuation\">.</span><span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:headers</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>source_location\n  <span class=\"token variable\">@users</span> <span class=\"token operator\">=</span> <span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>all\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>제가 요청을 보내면 이런 에러가 뜹니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ArgumentError (wrong number of arguments (given 1, expected 0)):\n  app/controllers/users_controller.rb:5:in `index&#39;</code></pre></div>\n<p>이 경우는 <code class=\"language-text\">request</code> 객체가 자신만의 <code class=\"language-text\">method</code> 를 따로 구현하고 있기 때문입니다. <code class=\"language-text\">headers</code>  메서드를 찾아내기 위해 메서드를 <code class=\"language-text\">Kernel</code> 로부터 분리하고 <code class=\"language-text\">request</code> 객체에 다시 바인드 한 뒤 실행해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  method <span class=\"token operator\">=</span> <span class=\"token constant\">Kernal</span><span class=\"token punctuation\">.</span><span class=\"token function\">instance_method</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:method</span><span class=\"token punctuation\">)</span>\n  p method<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:headers</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>source_location\n  <span class=\"token variable\">@users</span> <span class=\"token operator\">=</span> <span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>all\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>요청을 다시 해보면 결과가 다르게 나옵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Processing by UsersController#index as */*\n[&quot;/Users/aaron/git/rails/actionpack/lib/action_dispatch/http/request.rb&quot;, 201]</code></pre></div>\n<p>이제서야 <code class=\"language-text\">headers</code> 메서드가 <a href=\"https://github.com/rails/rails/blob/6fcc3c47eb363d0d3753ee284de2fbc68df03194/actionpack/lib/action_dispatch/http/request.rb#L201\">여기에</a> 구현되어 있다는 것을 발견했습니다.</p>\n<p>심지어 <code class=\"language-text\">method</code> 메서드의 구현체를 찾을 수도 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> index\n  method <span class=\"token operator\">=</span> <span class=\"token constant\">Kernal</span><span class=\"token punctuation\">.</span><span class=\"token function\">instance_method</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:method</span><span class=\"token punctuation\">)</span>\n  p method<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:method</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>source_location\n  <span class=\"token variable\">@users</span> <span class=\"token operator\">=</span> <span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>all\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2 id=\"또-뭔가-호출했는데-이게-어딨는지-모르겠다\"><a href=\"#%EB%98%90-%EB%AD%94%EA%B0%80-%ED%98%B8%EC%B6%9C%ED%96%88%EB%8A%94%EB%8D%B0-%EC%9D%B4%EA%B2%8C-%EC%96%B4%EB%94%A8%EB%8A%94%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(또) 뭔가 호출했는데 이게 어딨는지 모르겠다</h2>\n<p>가끔 당장 사용하고 있는 메서드가 실제로는 문제의 본질이 아닐 수 있습니다. 그래서 <code class=\"language-text\">method</code> 메서드를 사용하는 트릭은 별 도움이 안될 겁니다. 이럴 때엔 저는 <code class=\"language-text\">TracePoint</code> 라고 하는 더 큰 추적기(a larger hammer)를 사용합니다. <code class=\"language-text\">render</code> 메서드로부터 호출 된 <em>모든</em> 메서드의 리스트를 추출하기 위해 다시 한번 예를 들어보겠습니다. 리스트에 보이는 메서드들은 <code class=\"language-text\">render</code> 메서드가 직접 호출한 것은 아니지만 어딘가로부터 호출 된 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># GET /users</span>\n<span class=\"token comment\"># GET /users.json</span>\n<span class=\"token keyword\">def</span> index\n  <span class=\"token variable\">@users</span> <span class=\"token operator\">=</span> <span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>all\n  tp <span class=\"token operator\">=</span> <span class=\"token constant\">TracePoint</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:call</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>x<span class=\"token operator\">|</span>\n    p x\n  <span class=\"token keyword\">end</span>\n  tp<span class=\"token punctuation\">.</span>enable\n  render <span class=\"token string\">'index'</span>\n<span class=\"token keyword\">ensure</span>\n  tp<span class=\"token punctuation\">.</span>disable\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>저기 위치한 <code class=\"language-text\">TracePoint</code> 는 모든 \"호출(<code class=\"language-text\">:call</code>)\" 이벤트마다 작동하고, 블록은 메서드 이름과 호출된 위치를 출력할 것입니다. 여기서 \"호출\" 이라 함은 루비 메서드가 호출되는 경우를 말합니다(C 메서드는 제외). 만약 C 메서드가 호출되는 것을 보고 싶으시다면 <code class=\"language-text\">:c_call</code> 을 사용하세요. 이 예시는 <em>엄청난 양의</em> 결과가 출력될겁니다. 저는 호출될 메서드가 꽤 적거나, 도대체 어디부터 찾아봐야 할지 모를 때 이 방법을 사용합니다.</p>\n<h2 id=\"예외가-일어나는-것은-알겠지만-어디서-발생하는지-모르겠다\"><a href=\"#%EC%98%88%EC%99%B8%EA%B0%80-%EC%9D%BC%EC%96%B4%EB%82%98%EB%8A%94-%EA%B2%83%EC%9D%80-%EC%95%8C%EA%B2%A0%EC%A7%80%EB%A7%8C-%EC%96%B4%EB%94%94%EC%84%9C-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외가 일어나는 것은 알겠지만, 어디서 발생하는지 모르겠다</h2>\n<p>예외가 발생할 때 <em>실제로</em> 어디서 예외가 발생했는지 모를 때가 있습니다. 이 예시는 레일즈 3.0.0을 기준으로 작성되었지만(참고로 이 문제는 수정되었습니다), 일단 이런 코드가 있다고 해보죠.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">ActiveRecord</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Base</span><span class=\"token punctuation\">.</span>logger <span class=\"token operator\">=</span> <span class=\"token constant\">Logger</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token variable\">$stdout</span>\n<span class=\"token constant\">User</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span>execute <span class=\"token string\">\"oh no!\"</span></code></pre></div>\n<p>SQL은 작동하지 않을 테고, 예외가 일어날 겁니다. 그렇다면 예외가 어떻게 발생하는지 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  SQL (0.1ms)  oh no!\nSQLite3::SQLException: near &quot;oh&quot;: syntax error: oh no!\nactiverecord-3.0.0/lib/active_record/connection_adapters/abstract_adapter.rb:202:in `rescue in log&#39;: SQLite3::SQLException: near &quot;oh&quot;: syntax error: oh no! (ActiveRecord::StatementInvalid)\n\tfrom activerecord-3.0.0/lib/active_record/connection_adapters/abstract_adapter.rb:194:in `log&#39;\n\tfrom activerecord-3.0.0/lib/active_record/connection_adapters/sqlite_adapter.rb:135:in `execute&#39;\n\tfrom test.rb:6:in `&lt;top (required)&gt;&#39;\n\tfrom railties-3.0.0/lib/rails/commands/runner.rb:48:in `eval&#39;\n\tfrom railties-3.0.0/lib/rails/commands/runner.rb:48:in `&lt;top (required)&gt;&#39;\n\tfrom railties-3.0.0/lib/rails/commands.rb:39:in `require&#39;\n\tfrom railties-3.0.0/lib/rails/commands.rb:39:in `&lt;top (required)&gt;&#39;\n\tfrom script/rails:6:in `require&#39;\n\tfrom script/rails:6:in `&lt;main&gt;&#39;</code></pre></div>\n<p>여러분이 추적 내역(backtrace) 을 읽어보셨다면 <em>(역주2: backtrace하면 역추적 이라는 말이 직역하기는 좋지만, 보통 루비에서 backtrace를 떠올릴 때 콘솔에 뜨는 십수 줄의 추적 내역이 연상될 때가 많아서 추적 내역으로 번역하였습니다)</em>, 예외가 <a href=\"https://github.com/rails/rails/blob/9891ca8/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L202\">abstract_adapter.rb의 202번째 줄</a>에서 발생했다는 것을 알 수 있습니다. 그러나 이 코드는 <a href=\"https://github.com/rails/rails/blob/9891ca8/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L199-L202\">예외가 발생한 상황에서 다시 예외를 일으키도록</a> 되어있는게 보일 겁니다. 그렇다면 실제로는 어디서 예외가 일어난 걸까요? 정답을 찾기 위해 <code class=\"language-text\">puts</code> 를 사용하거나 루비의 <code class=\"language-text\">-d</code> 플래그를 사용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[aaron@TC okokok (master)]$ bundle exec ruby -d script/rails runner test.rb</code></pre></div>\n<p><code class=\"language-text\">-d</code> 플래그는 경고를 활성화하고 모든 예외 발생을 출력합니다. 네, 실제로는 엄청나게 많은 양의 결과물이 출력되겠지요. 그러나 끝부분을 살펴보시면 이렇게 되어있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Exception `NameError&#39; at activesupport-3.0.0/lib/active_support/core_ext/module/remove_method.rb:3 - method `_validators&#39; not defined in Class\nException `SQLite3::SQLException&#39; at sqlite3-1.3.11/lib/sqlite3/database.rb:91 - near &quot;oh&quot;: syntax error\nException `SQLite3::SQLException&#39; at activesupport-3.0.0/lib/active_support/notifications/instrumenter.rb:24 - near &quot;oh&quot;: syntax error\n  SQL (0.1ms)  oh no!\nSQLite3::SQLException: near &quot;oh&quot;: syntax error: oh no!\nException `ActiveRecord::StatementInvalid&#39; at activerecord-3.0.0/lib/active_record/connection_adapters/abstract_adapter.rb:202 - SQLite3::SQLException: near &quot;oh&quot;: syntax error: oh no!\nException `ActiveRecord::StatementInvalid&#39; at railties-3.0.0/lib/rails/commands/runner.rb:48 - SQLite3::SQLException: near &quot;oh&quot;: syntax error: oh no!\nactiverecord-3.0.0/lib/active_record/connection_adapters/abstract_adapter.rb:202:in `rescue in log&#39;: SQLite3::SQLException: near &quot;oh&quot;: syntax error: oh no! (ActiveRecord::StatementInvalid)\n\tfrom activerecord-3.0.0/lib/active_record/connection_adapters/abstract_adapter.rb:194:in `log&#39;\n\tfrom activerecord-3.0.0/lib/active_record/connection_adapters/sqlite_adapter.rb:135:in `execute&#39;\n\tfrom test.rb:6:in `&lt;top (required)&gt;&#39;\n\tfrom railties-3.0.0/lib/rails/commands/runner.rb:48:in `eval&#39;\n\tfrom railties-3.0.0/lib/rails/commands/runner.rb:48:in `&lt;top (required)&gt;&#39;\n\tfrom railties-3.0.0/lib/rails/commands.rb:39:in `require&#39;\n\tfrom railties-3.0.0/lib/rails/commands.rb:39:in `&lt;top (required)&gt;&#39;\n\tfrom script/rails:6:in `require&#39;\n\tfrom script/rails:6:in `&lt;main&gt;&#39;</code></pre></div>\n<p>실제 예외는 여기서 발생했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Exception `SQLite3::SQLException&#39; at sqlite3-1.3.11/lib/sqlite3/database.rb:91 - near &quot;oh&quot;: syntax error</code></pre></div>\n<p>그리고 여기서 다시 예외가 일어났지요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Exception `SQLite3::SQLException&#39; at activesupport-3.0.0/lib/active_support/notifications/instrumenter.rb:24 - near &quot;oh&quot;: syntax error</code></pre></div>\n<p>예외가 발생할 때 래핑된 뒤 다시 예외가 발생하는 경우에는 <em>반드시</em> 본래의 추적 내역을 노출해야 합니다. 그러므로 이 경우는 명백히 버그지만, 실제로 버그는 고쳐졌으며, 우리는 언젠가 또 이런 경우가 발생했을 때 해결하는 법을 알게 되었습니다.</p>\n<h3 id=\"커맨드-라인-도구를-code-classlanguage-text-dcode-플래그와-함께-사용하여-실행\"><a href=\"#%EC%BB%A4%EB%A7%A8%EB%93%9C-%EB%9D%BC%EC%9D%B8-%EB%8F%84%EA%B5%AC%EB%A5%BC-code-classlanguage-text-dcode-%ED%94%8C%EB%9E%98%EA%B7%B8%EC%99%80-%ED%95%A8%EA%BB%98-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-%EC%8B%A4%ED%96%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커맨드 라인 도구를 <code class=\"language-text\">-d</code> 플래그와 함께 사용하여 실행</h3>\n<p>위의 기술을 RSpec 테스트에 적용하고 싶으시다면 이렇게 하시면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ruby -d -S rspec</code></pre></div>\n<h3 id=\"code-classlanguage-text-dcode-플래그는-사용하고-싶은데-프로세스를-실행하는-방법을-모르겠다\"><a href=\"#code-classlanguage-text-dcode-%ED%94%8C%EB%9E%98%EA%B7%B8%EB%8A%94-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%9D%80%EB%8D%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EB%A5%BC-%EC%8B%A4%ED%96%89%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95%EC%9D%84-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">-d</code> 플래그는 사용하고 싶은데 프로세스를 실행하는 방법을 모르겠다</h3>\n<p>Rake 테스트 작업은 기본적으로 <a href=\"https://github.com/ruby/rake/blob/3c4fe3e25e5ab6b052f9e81bc2920ca4b4fc1094/lib/rake/testtask.rb#L105\">서브 프로세스 안에서 당신의 테스트를 실행합니다</a>. 말인 즉슨 <code class=\"language-text\">ruby -d -S rake</code> 같은 커맨드를 입력해도 서브 프로세스 안에 있는 여러분의 테스트에는 플래그가 적용되지 않는다는 뜻입니다. 이 경우 저는 <code class=\"language-text\">RUBYOPT</code> 환경 변수를 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[aaron@TC okokok (master)]$ RUBYOPT=-d bundle exec rake test</code></pre></div>\n<p><code class=\"language-text\">RUBYOPT</code> 환경 변수는 쉘에서 실행된 모든 루비 프로그램에 적용되고, 심지어 rake로부터 호출 된 서브 쉘에도 적용됩니다. 이를 응용하면 <code class=\"language-text\">rspec</code> 커맨드를 이렇게 다시 써볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ RUBYOPT=-d rspec</code></pre></div>\n<h2 id=\"이-객체는-어디에서-온-걸까\"><a href=\"#%EC%9D%B4-%EA%B0%9D%EC%B2%B4%EB%8A%94-%EC%96%B4%EB%94%94%EC%97%90%EC%84%9C-%EC%98%A8-%EA%B1%B8%EA%B9%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이 객체는 어디에서 온 걸까?</h2>\n<p>보통은 콜 스택을 출력하여 객체가 어디에서 왔는지 찾습니다. 하지만 가끔 객체가 콜 스택 바깥에 위치한 경우도 있습니다. 이럴 때는 객체가 어디에서 호출된 건지 찾기 힘듭니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> foo\n  x <span class=\"token operator\">=</span> baz\n  bar x\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> bar x\n  puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n  puts caller\n  puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n  p x\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> baz<span class=\"token punctuation\">;</span> zot<span class=\"token punctuation\">;</span>\t\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">def</span> zot<span class=\"token punctuation\">;</span> <span class=\"token builtin\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span>\t<span class=\"token class-name\">end</span>\n\nfoo</code></pre></div>\n<p>이전에 \"어디에 문제가 있는진 알겠는데, 어떻게 거기까지 가야할지 모르겠다\" 파트에서 <code class=\"language-text\">caller</code> 를 사용하는 방법, \"wtf  트릭\" <em>(역주3: 글쓴이는 해당 방법을 소개할 때 Vim 단축키를 <code class=\"language-text\">&lt;leader&gt;wtf</code> 으로 설정하였습니다. 그래서 이를 \"wtf trick\"으로 명명한 것으로 보입니다)</em>을 보여드렸습니다.  여기서 저는 <code class=\"language-text\">x</code> 라는 값이 어떻게 할당되었는지 신경쓰였는데요, <code class=\"language-text\">foo</code> 메서드를 따라가다보면 <code class=\"language-text\">baz</code> 메서드에서 값을 가져오는 것을 볼 수 있습니다. 거대한 코드 베이스에서는 형제 트리에서 모든 호출과 로직을 따라가는게 아주 어렵습니다(코드를 자료구조의 그래프라고 생각한다면, <code class=\"language-text\">foo</code> 메서드는 두 개의 자손이 있는 겁니다. <code class=\"language-text\">baz</code> 와 <code class=\"language-text\">bar</code> 이죠. 그래서 <code class=\"language-text\">baz</code>가 <code class=\"language-text\">bar</code> 의 형제라고 여길 수 있습니다). 저는 게으르기 때문에 객체가 어디서 왔는지 찾기 위해 모든 메서드를 뒤지고 싶지 않았습니다. 그래서 저는 루비의 객체 할당 추적기(object allocation tracer)를 사용하는걸 좋아합니다. 루비의 할당 추적기는 루비 2.1버전부터 사용할 수 있습니다(확실한 것은 아닙니다). 제가 이 방법을 사용할 때는 가능한 빨리 <code class=\"language-text\">require</code> 한 뒤에 활성화합니다. 그러면 제가 찾고자 하는 할당 위치를 찾을 수 있지요.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'objspace'</span>\n<span class=\"token constant\">ObjectSpace</span><span class=\"token punctuation\">.</span>trace_object_allocations_start\n\n<span class=\"token keyword\">def</span> foo\n  x <span class=\"token operator\">=</span> baz\n  bar x\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> bar x\n  p <span class=\"token constant\">ObjectSpace</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocation_sourcefile</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token constant\">ObjectSpace</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocation_sourceline</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> baz<span class=\"token punctuation\">;</span> zot<span class=\"token punctuation\">;</span>\t\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">def</span> zot<span class=\"token punctuation\">;</span> <span class=\"token builtin\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span>\t<span class=\"token class-name\">end</span>\n\nfoo</code></pre></div>\n<p>프로그램을 실행하면 이런 결과를 얻습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[aaron@TC tlm.com (master)]$ ruby x.rb\n{&quot;x.rb&quot;=&gt;14}\n[aaron@TC tlm.com (master)]$</code></pre></div>\n<p><code class=\"language-text\">x</code> 객체가 해당 파일의 14번째 줄에 있다는 것을 알게 되었습니다. 그러면 해당 라인으로 가서 \"wtf 트릭\" 을 반복하거나 프로그램에 무슨 문제가 있는지 발견할 때 까지 이 방법을 반복합니다.</p>\n<p>저는 보통 객체 추적을 가능한 빠르게 시작합니다. 제 객체가 어디에 할당되었는지 모르니까요. 이런 추적은 프로그램의 속도를 떨어뜨리지만, 디버깅 중에는 신경쓸 필요가 없습니다.</p>\n<h2 id=\"나는-code-classlanguage-textrequirecode-를-진짜-진짜-빨리-하고-싶어\"><a href=\"#%EB%82%98%EB%8A%94-code-classlanguage-textrequirecode-%EB%A5%BC-%EC%A7%84%EC%A7%9C-%EC%A7%84%EC%A7%9C-%EB%B9%A8%EB%A6%AC-%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%96%B4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>나는 <code class=\"language-text\">require</code> 를 진짜 진짜 빨리 하고 싶어</h2>\n<p>바로 위에 보여드린 기술은 오로지 객체가 <code class=\"language-text\">trace_object_allocations_start</code> 메서드가 호출되고 난 뒤에 할당된 이후의 정보만 제공합니다. 파일이 <code class=\"language-text\">require</code> 되는 순간에 객체가 할당되어서, 도대체 무슨 파일이고 <em>어디에 있는지</em> 모를 때가 있습니다. 그래서  프레임워크 안에 있는 어떤 파일이라도 로드되기 전에 코드를 좀 실행시킬 필요가 있습니다. 이럴 때 저는 <code class=\"language-text\">-r</code> 플래그를 사용한 뒤 스크립트를 작성합니다.</p>\n<p>우리가 <code class=\"language-text\">User::BLACKLISTED_CLASS_METHODS</code> 의 할당 위치를 찾는 코드를 작성했다고 칩시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'active_record'</span>\n\n<span class=\"token constant\">AciveRecord</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Base</span><span class=\"token punctuation\">.</span>establish_connection adapter<span class=\"token punctuation\">:</span> <span class=\"token string\">'sqlite3'</span><span class=\"token punctuation\">,</span> databse<span class=\"token punctuation\">:</span> <span class=\"token string\">':memory:'</span>\n\n<span class=\"token constant\">ActiveRecord</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Base</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span>instance_eval <span class=\"token keyword\">do</span>\n  create_table <span class=\"token symbol\">:users</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">ActiveRecord</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Base</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">end</span>\np <span class=\"token constant\">ObjectSpace</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocation_sourcefile</span><span class=\"token punctuation\">(</span><span class=\"token constant\">User</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">BLACKLISTED_CLASS_METHODS</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token constant\">ObjectSpace</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocation_sourceline</span><span class=\"token punctuation\">(</span><span class=\"token constant\">User</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">BLACKLISTED_CLASS_METHODS</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>그런데 우리는 이 어떤 파일이 이 상수를 할당했는지 모르고, 찾는 방법을 떠올리고 싶지도 않을 때가 있습니다(네, 이건 좀 억지로 꾸며낸 경우입니다). 이럴 때 <code class=\"language-text\">y.rb</code> 라는 파일을 작성해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'objspace'</span>\n<span class=\"token constant\">ObjectSpace</span><span class=\"token punctuation\">.</span>trace_object_allocations_start</code></pre></div>\n<p>그리고 저는 루비의 커맨드 라인 인자를 넣어서 이 파일을 실행할 때 바로 <code class=\"language-text\">require</code> 하도록 만들었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[aaron@TC tlm.com (master)]$ ruby -I. -ry x.rb\n{&quot;/Users/aaron/.rbenv/versions/ruby-trunk/lib/ruby/gems/2.4.0/gems/activerecord-5.0.0.beta1/lib/active_record/attribute_methods.rb&quot;=&gt;35}\n[aaron@TC tlm.com (master)]$</code></pre></div>\n<p>인자들을 찬찬히 살펴보면 <code class=\"language-text\">-I.</code> 는 \". 를 불러오기 경로로 추가하고\", <code class=\"language-text\">-ry</code> 는 <code class=\"language-text\">require &#39;y&#39;</code> 와 같으며, 이후에 <code class=\"language-text\">x.rb</code> 를 실행하는 겁니다. 그러니 <code class=\"language-text\">.</code> 가 불러오기 경로로 추가되었고, <code class=\"language-text\">x.rb</code> 가 실행되기도 전에 <code class=\"language-text\">y.rb</code> 파일이 <code class=\"language-text\">require</code> 되었습니다. 그 결과로 <code class=\"language-text\">BLACKLISTED_CLASS_METHODS</code> 가 <code class=\"language-text\">attribute_methods.rb</code> 의 35번째 줄에 에 할당되어 있다는 사실을 알 수 있습니다. 만약 서브 프로세스 안에서 실행되는 코드에 이 기술을 적용하고자 한다면 <code class=\"language-text\">RUBYOPT</code> 를 함께 쓰면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ RUBYOPT=&#39;-I. -ry&#39; rake test</code></pre></div>\n<h2 id=\"객체가-어딘가에서-수정되었는데mutated-그-위치를-모르겠다\"><a href=\"#%EA%B0%9D%EC%B2%B4%EA%B0%80-%EC%96%B4%EB%94%98%EA%B0%80%EC%97%90%EC%84%9C-%EC%88%98%EC%A0%95%EB%90%98%EC%97%88%EB%8A%94%EB%8D%B0mutated-%EA%B7%B8-%EC%9C%84%EC%B9%98%EB%A5%BC-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>객체가 어딘가에서 수정되었는데(mutated), 그 위치를 모르겠다</h2>\n<p>객체를 살펴보다 보면 이게 수정되고 있다는건 알겠는데, 어디서 수정되고 있는 지 모를 때가 있습니다. 이 때는 객체에 <code class=\"language-text\">freeze</code> 를 호출한 뒤에, 테스트를 실행해보고, 어디서 예외가 발생하는지 살펴보면 됩니다. 그 예로, 제가 <a href=\"https://github.com/rails/rails/blob/38b5af6595338cb2212980062d9aaf51241878cc/activesupport/lib/active_support/concurrency/share_lock.rb#L28\">어디에서 특정 변수가 수정되는지 알고 싶을 때</a>가 있습니다. 코드를 살펴보니 이 변수가 수정된다는 것은 알고 있었지만, 어디서부터 수정이 일어나는지 알지 못했습니다. 그래서 코드를 이렇게 수정해봤습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> initialize\n  <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token variable\">@cv</span> <span class=\"token operator\">=</span> new_cond\n\n  <span class=\"token variable\">@sharing</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">Hash</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token variable\">@sharing</span><span class=\"token punctuation\">.</span>freeze\n  <span class=\"token variable\">@waiting</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">@exclusive_thread</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span>\n  <span class=\"token variable\">@exclusive_depth</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>그리고 나서 레일즈 서버를 실행하면 예외가 발생하며 추적 내역이 보여집니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">active_support/concurrency/share_lock.rb:151:in `delete&#39;: can&#39;t modify frozen Hash (RuntimeError)\n\tfrom active_support/concurrency/share_lock.rb:151:in `yield_shares&#39;\n\tfrom active_support/concurrency/share_lock.rb:79:in `block in stop_exclusive&#39;</code></pre></div>\n<p>이제 처음에 수정이 발생한 곳을 발견했습니다. 만약 이 부분이 여러분이 찾고자 하는 부분이 아니라면 작성해둔 <code class=\"language-text\">freeze</code> 를 삭제한 뒤에 내역을 따라가서 수정된 부분 이후에 다시 덧붙이면 됩니다.</p>\n<h2 id=\"교착-상태deadlock에-빠졌는데-어디서-문제가-생겼는지-모르겠다\"><a href=\"#%EA%B5%90%EC%B0%A9-%EC%83%81%ED%83%9Cdeadlock%EC%97%90-%EB%B9%A0%EC%A1%8C%EB%8A%94%EB%8D%B0-%EC%96%B4%EB%94%94%EC%84%9C-%EB%AC%B8%EC%A0%9C%EA%B0%80-%EC%83%9D%EA%B2%BC%EB%8A%94%EC%A7%80-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>교착 상태(deadlock)에 빠졌는데, 어디서 문제가 생겼는지 모르겠다</h2>\n<p>저에게 스레드와 관련된 이슈가 발생했고, 문제를 어디에서 해결해야할 지 몰랐을 때, 저는 살아있는 스레드를 검사해보기 위해 코드를 좀 추가했습니다. 예를 들어 저는 <a href=\"https://github.com/rails/rails/issues/23503\">이 이슈를 디버깅하고 있었습니다</a>. 애플리케이션 서버가 막혀있는데, 대체 어디서 문제가 발생했는지 몰랐습니다. 그래서 어디서 스레드가 막혀있는지 찾기 위해 <code class=\"language-text\">x.rb</code> 라는 파일을 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token function\">trap</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:INFO</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">Thread</span><span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>t<span class=\"token operator\">|</span>\n    puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n    p t\n    puts t<span class=\"token punctuation\">.</span>backtrace\n    puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 앱 서버를 이렇게 실행했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ruby -I. -rx bin/rails s</code></pre></div>\n<p>이제 앱 서버가 막혔을 때, 컨트롤+T 키를 누르면(죄송하지만 OS X에서만 작동합니다, 리눅스에서는 <code class=\"language-text\">kill</code> 을 사용해야 합니다), 모든 스레드의 추적 내역을 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">##########################################################################################\n#&lt;Thread:0x007f90bc07cb38 run&gt;\nomglolwut/x.rb:7:in `backtrace&#39;\nomglolwut/x.rb:7:in `block (2 levels) in &lt;top (required)&gt;&#39;\nomglolwut/x.rb:4:in `each&#39;\nomglolwut/x.rb:4:in `block in &lt;top (required)&gt;&#39;\ngems/puma-2.16.0/lib/rack/handler/puma.rb:43:in `join&#39;\ngems/puma-2.16.0/lib/rack/handler/puma.rb:43:in `run&#39;\ngems/rack-2.0.0.alpha/lib/rack/server.rb:296:in `start&#39;\nrails/commands/server.rb:78:in `start&#39;\nrails/commands/commands_tasks.rb:90:in `block in server&#39;\nrails/commands/commands_tasks.rb:85:in `tap&#39;\nrails/commands/commands_tasks.rb:85:in `server&#39;\nrails/commands/commands_tasks.rb:49:in `run_command!&#39;\nrails/command.rb:20:in `run&#39;\nrails/commands.rb:19:in `&lt;top (required)&gt;&#39;\nbin/rails:4:in `require&#39;\nbin/rails:4:in `&lt;main&gt;&#39;\n##########################################################################################\n##########################################################################################\n#&lt;Thread:0x007f90bef3b668@/Users/aaron/.rbenv/versions/ruby-trunk/lib/ruby/gems/2.4.0/gems/puma-2.16.0/lib/puma/reactor.rb:136 sleep&gt;\nlib/puma/reactor.rb:29:in `select&#39;\nlib/puma/reactor.rb:29:in `run_internal&#39;\nlib/puma/reactor.rb:138:in `block in run_in_thread&#39;\n##########################################################################################\n##########################################################################################\n#&lt;Thread:0x007f90bef3b500@/Users/aaron/.rbenv/versions/ruby-trunk/lib/ruby/gems/2.4.0/gems/puma-2.16.0/lib/puma/thread_pool.rb:216 sleep&gt;\nlib/puma/thread_pool.rb:219:in `sleep&#39;\nlib/puma/thread_pool.rb:219:in `block in start!&#39;\n##########################################################################################\n##########################################################################################\n#&lt;Thread:0x007f90bef3b3c0@/Users/aaron/.rbenv/versions/ruby-trunk/lib/ruby/gems/2.4.0/gems/puma-2.16.0/lib/puma/thread_pool.rb:187 sleep&gt;\nlib/puma/thread_pool.rb:190:in `sleep&#39;\nlib/puma/thread_pool.rb:190:in `block in start!&#39;\n##########################################################################################\n##########################################################################################\n#&lt;Thread:0x007f90bef3b258@/Users/aaron/.rbenv/versions/ruby-trunk/lib/ruby/gems/2.4.0/gems/puma-2.16.0/lib/puma/server.rb:296 sleep&gt;\nlib/puma/server.rb:322:in `select&#39;\nlib/puma/server.rb:322:in `handle_servers&#39;\nlib/puma/server.rb:296:in `block in run&#39;\n##########################################################################################\n##########################################################################################\n#&lt;Thread:0x007f90c1ef9a08@/Users/aaron/.rbenv/versions/ruby-trunk/lib/ruby/gems/2.4.0/gems/puma-2.16.0/lib/puma/thread_pool.rb:61 sleep&gt;\nlib/ruby/2.4.0/monitor.rb:111:in `sleep&#39;\nlib/ruby/2.4.0/monitor.rb:111:in `wait&#39;\nlib/ruby/2.4.0/monitor.rb:111:in `wait&#39;\nlib/ruby/2.4.0/monitor.rb:132:in `wait_until&#39;\naction_dispatch/http/response.rb:170:in `block in await_commit&#39;\nlib/ruby/2.4.0/monitor.rb:214:in `mon_synchronize&#39;\naction_dispatch/http/response.rb:169:in `await_commit&#39;\naction_controller/metal/live.rb:270:in `process&#39;\naction_controller/metal.rb:193:in `dispatch&#39;\naction_controller/metal.rb:265:in `dispatch&#39;\naction_dispatch/routing/route_set.rb:50:in `dispatch&#39;\naction_dispatch/routing/route_set.rb:32:in `serve&#39;\n##########################################################################################\n##########################################################################################\n#&lt;Thread:0x007f90bd1d5f38@/Users/aaron/git/rails/actionpack/lib/action_controller/metal/live.rb:279 sleep&gt;\nlib/ruby/2.4.0/monitor.rb:111:in `sleep&#39;\nlib/ruby/2.4.0/monitor.rb:111:in `wait&#39;\nlib/ruby/2.4.0/monitor.rb:111:in `wait&#39;\nlib/ruby/2.4.0/monitor.rb:123:in `wait_while&#39;\nactive_support/concurrency/share_lock.rb:57:in `block (2 levels) in start_exclusive&#39;\nactive_support/concurrency/share_lock.rb:154:in `yield_shares&#39;\nactive_support/concurrency/share_lock.rb:56:in `block in start_exclusive&#39;\nlib/ruby/2.4.0/monitor.rb:214:in `mon_synchronize&#39;\nactive_support/concurrency/share_lock.rb:51:in `start_exclusive&#39;\nactive_support/concurrency/share_lock.rb:113:in `exclusive&#39;\nactive_support/dependencies/interlock.rb:12:in `loading&#39;\nactive_support/dependencies.rb:37:in `load_interlock&#39;\nactive_support/dependencies.rb:369:in `require_or_load&#39;\nactive_support/dependencies.rb:529:in `load_missing_constant&#39;\nactive_support/dependencies.rb:212:in `const_missing&#39;\nactive_support/dependencies.rb:561:in `load_missing_constant&#39;\nactive_support/dependencies.rb:212:in `const_missing&#39;\napp/controllers/users_controller.rb:9:in `index&#39;\n##########################################################################################</code></pre></div>\n<p>가독성을 위해 결과물을 조금 잘라냈습니다만, 여러분은 이제 각각의 스레드가 무엇을 하는지 볼 수 있습니다. 그리고 어느 스레드 두 개가 교착 상태에 빠졌는지 쉽게 발견할 수 있습니다(정답은 마지막 두 개입니다).</p>\n<h2 id=\"특정한-시간에만-언제-메서드가-실행되는지-알고-싶다\"><a href=\"#%ED%8A%B9%EC%A0%95%ED%95%9C-%EC%8B%9C%EA%B0%84%EC%97%90%EB%A7%8C-%EC%96%B8%EC%A0%9C-%EB%A9%94%EC%84%9C%EB%93%9C%EA%B0%80-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94%EC%A7%80-%EC%95%8C%EA%B3%A0-%EC%8B%B6%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>특정한 시간에만 언제 메서드가 실행되는지 알고 싶다</h2>\n<p>일정 시간 뒤에 메서드가 언제 실행되었는지 알고 싶을 때가 있습니다. 저는 애플리케이션이 <em>구동된 뒤에</em>  <code class=\"language-text\">start_exclusive</code> 메서드가 언제 호출되는지 알고 싶었습니다. 이럴 때 위에 보여드린 <code class=\"language-text\">trap</code> 트릭과 전역 변수를 조합하여 해결했습니다.</p>\n<p>먼저 <code class=\"language-text\">start_exclusive</code> 를 이렇게 수정했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token function\">start_exclusive</span><span class=\"token punctuation\">(</span>purpose<span class=\"token punctuation\">:</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">,</span> compatible<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> no_wait<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token variable\">$foo</span>\n    puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n    puts caller\n    puts <span class=\"token string\">\"#\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">90</span>\n  <span class=\"token keyword\">end</span>\n  <span class=\"token comment\"># ..</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>그리고 <code class=\"language-text\">x.rb</code> 라는 파일을 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token function\">trap</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:INFO</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  puts <span class=\"token string\">\"turning on debugging!\"</span>\n  <span class=\"token variable\">$foo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 앱 서버를 구동하고 모든 요소가 준비되면 컨트롤+T를 눌러서 제 전역 변수를 <code class=\"language-text\">true</code> 로 바꿉니다. 그리고 로그 메세지들을 살펴볼 수 있게 됩니다.</p>\n<h2 id=\"끝\"><a href=\"#%EB%81%9D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>끝</h2>\n<p>이게 제가 지금 생각해 낼 수 있는 방법의 전부입니다. 그리고 <a href=\"http://www.schneems.com/2016/01/25/ruby-debugging-magic-cheat-sheet.html\">Richard의 puts 디버깅에 관한 글도 읽어보세요</a>. 좋은 하루 되시길. 끝.</p>\n<hr>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>간만에 엄청나게 긴 양의 글을 번역했습니다. 그래도 맘 잡고 하니 생각보다 오래 걸리지도 않고, 초벌번역의 퀄리티도 조금씩 올라가고 있다고 느끼고 있습니다.</p>\n<p>이번에 소개해 드린 글은 콘솔에 디버깅 하는 방법을 소개하는 글입니다. 보통은 디버깅 툴로 <code class=\"language-text\">byebug</code>, <code class=\"language-text\">pry-byebug</code> 등을 사용하실 겁니다. 저도 어지간한 디버깅을 그렇게 처리하고 있지만.. 본문의 내용처럼 좀 깊은 부분을 들여다볼 때는 일일히 깊숙하게 파고들기 힘들 때가 많습니다. 좀 더 자신이 사용하고 있는 코드의 깊은 부분을 들여보고자 할 때 아주 유용한 테크닉이 될 것이라 생각합니다.</p>\n<p>번역된 챕터 제목들의 말투가 조금 이상하다고 느끼실텐데, 들어가는 글에서 원 저자가 '어차피 블로그 포스트니까 신경 안쓰고 말투를 편하게 한다'는 식으로 쓰여있길래 그 느낌을 가능한 한 살려서 작성해보았습니다.</p>\n<p>글을 읽다 보면 레일즈같은 거대한 오픈 소스에 기여하는 분들은 '어떻게 이 방대한 코드를 다 고려하면서 개발을 하는걸까?' 하는 생각에 더욱 존경심이 들더군요. 레일즈 뿐 아니라 다른 오픈소스 프레임웍들도 마찬가지입니다. 언젠가는 오픈소스에 기여했다는 족적을 꼭 남겨 보고 싶습니다.</p>\n<p>현재 Hanami 기반으로 개발을 하고 있다보니 문서화가 덜 되어 '소스를 까볼' 일이 많은데 이런 기술을 더 유용하게 사용해볼 수 있겠습니다. 이 글을 보는 다른 분들은 어떻게 '프로그램의 소스를 살펴 보시는지' 궁금하기도 하고, 더 유용한 디버깅 팁이 있는지도 궁금해집니다.</p>","id":"dc2bc774-6734-5c06-9f56-746f96b89c5e","frontmatter":{"date":"2017-03-19","path":"/posts/i-am-a-puts-debuggerer-kor","title":"[번역] 나는 'puts' 디버거다","tags":["Ruby","Debugging","Translation"],"category":"Translation"}},{"excerpt":"이 포스팅은  Piotr Solnica 의  글 을 번역한 것입니다 번역 내용에 대한 조언 및 의견은 언제나 작성자에게 큰 도움이 됩니다 저는 우리 루비스트들이 의존성 주입(Dependency Injection)에 대해 요즘은 어떻게 생각하는지 궁금해졌습니다. 제가 기억하는 한 의존성 주입에 대한 몇몇 토론은 대부분 자바로 인해 굳혀진 개념(post-java-trauma…","html":"<ul>\n<li><strong>이 포스팅은 <a href=\"https://twitter.com/_solnic_\">Piotr Solnica</a>의 <a href=\"http://solnic.eu/2013/12/17/the-world-needs-another-post-about-dependency-injection-in-ruby.html\">글</a>을 번역한 것입니다</strong></li>\n<li><strong>번역 내용에 대한 조언 및 의견은 언제나 작성자에게 큰 도움이 됩니다</strong></li>\n</ul>\n<hr>\n<p>저는 우리 루비스트들이 의존성 주입(Dependency Injection)에 대해 요즘은 어떻게 생각하는지 궁금해졌습니다. 제가 기억하는 한 의존성 주입에 대한 몇몇 토론은 대부분 자바로 인해 굳혀진 개념(post-java-trauma)을 비판하는 내용이었습니다. 이 글을 작성하기까지 오랜 시간동안 머리속으로 생각만 하고 있었지만, 이 주제가 아마도.. 알려져 있다는 것을 알고 있었습니다. 그래서 글을 작성하기 전에 구글에 검색을 해 보기로 마음먹었지요. 구글에 \"ruby dependency injection\"을 입력하면 이런 결과를 얻었습니다:</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 580px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 69.13793103448276%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKklEQVQ4y3VTiZKiQAzl//dr9jdmBl3EW+5DkQZUoLnxbRodC8exq14lXZCXl3QiGXYIe7eB5TgIggCmacGyLDiuC9dxkWUZ8jwf8NNP0wxVkUHzU/z5e4K8iSHlvMT5nOKScZR5Nvx4uaSDFSjLElVVDajrergLNE0zoOtaXPIGslEiPFWQMDodC9EJAgpsmxZt2z4IBKEgKIpiwPV6HWLu5nEk8aEnCNvUQsUtsG2FgpoUdHh3rvc4ga4nHoL0/UGcvRthO3dhbn1oKw++zaiP1FfDg771sFu7CI8JeFWAF5xI+pck0ncGcSzLgDyRoagK1IWK5WoJzdhBXZG/XWK5EXcNtmuDxRE450LOk9InwjQtwViKJM4JHDFZnnfUCjxAb/BS9riZT4RihCaqieXag6wYUBY2pnT/t9DJ1yHPNlgbNFa+iQM7PPp7Hb3MD4VnRFGIJGGkNCAcSWWIYxggDA/Y773BT7N0mEXxeOPHeSFkUY7FmsGwEhr0E0z7BM2M4e85DX2NiDVw7AKWWVDykborficMKPuOHsEjJZq5g+la0G2dElCJB6FwjziJiUwMfor23tC3JV9OOY5+jDik0oMzjl6C0E9w8CL4TojAjwb/nGRIWAaeVqOSfyF0XR/qfIX5fInpdAZVIX+2hqIs8Pk1wcenjC95itV6A1N3kERnMTTve5jTLjNavyhiNxszlDTEFaEsaZh5PmxS33cU09OG9aMVvNn/HCEucTH4uRcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"2017 02 04 sc1\"\n        title=\"\"\n        src=\"/static/9dcb9be1a8d06e20a0c943b7fe6c9637/9c10f/2017-02-04-sc1.png\"\n        srcset=\"/static/9dcb9be1a8d06e20a0c943b7fe6c9637/0ca6d/2017-02-04-sc1.png 198w,\n/static/9dcb9be1a8d06e20a0c943b7fe6c9637/45e8e/2017-02-04-sc1.png 395w,\n/static/9dcb9be1a8d06e20a0c943b7fe6c9637/9c10f/2017-02-04-sc1.png 580w\"\n        sizes=\"(max-width: 580px) 100vw, 580px\"\n      />\n    </span>\n  </span>\n  </p>\n<p><em>역주: 이 글은 2013년 12월에 작성되었으며, 현재 같은 검색어로 검색하면 결과물의 순서 및 노출되는 글이 다릅니다.</em></p>\n<p>저는 <a href=\"http://david.heinemeierhansson.com/2012/dependency-injection-is-not-a-virtue.html\">DHH(David Heinmeier Hansson, Ruby on Rails의 창시자)의 블로그</a>로 들어가 글을 다시 읽어보았습니다. 그 글에 대해 희미한 기억만 남아있었기 때문입니다. 그리고 나서야 저는 세상이 루비의 의존성 주입에 대한 다른 글이 필요하다는 것을 깨달았습니다. 왜 그럴까요? 대개 저 글을 읽고 많은 루비스트들이 루비의 의존성 주입에 대해 잘못된 인식을 가질 우려가 있기 때문입니다. 또한 의존성 주입이 뭔지 배워보고자 하는 사람들은 DHH의 블로그 글을 발견할테고, 루비에서의 의존성 주입이 \"필요 없다\" 라는 크게 잘못된 생각을 가질 수 있습니다. 네, 정말로 걱정되는 부분입니다.</p>\n<p>제가 이 글의 제목을 \"루비의 의존성 주입\"이라고 작성한 이유는 <strong>\"루비의\"</strong> 라는 부분이 꽤 중요하기 때문입니다. 루비의 의존성 주입은 아주 직관적인 실체를 가지고 있으며 여러가지 장점을 가지고 있습니다.</p>\n<p>아, 간단히 정리하자면:</p>\n<p>여러분은 루비의 의존성 주입을 사용하기 위해 어떠한 외부 라이브러리도 쓸 필요가 없습니다.</p>\n<p>여러분은 루비의 의존성 주입을 사용하기 위해 어떠한 설정도 할 필요가 없습니다.</p>\n<p>여러분은 루비의 의존성 주입을 사용하기 위해 코드의 단순함을 희생할 필요가 없습니다.</p>\n<p>여러분은 루비의 의존성 주입을 사용하기 위해 코드를 더 작성해야 할 필요가 없습니다.</p>\n<h2 id=\"루비의-의존성-주입은-아주-쉽다\"><a href=\"#%EB%A3%A8%EB%B9%84%EC%9D%98-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85%EC%9D%80-%EC%95%84%EC%A3%BC-%EC%89%BD%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>루비의 의존성 주입은 아주 쉽다</h2>\n<p>별로 대단한 건 없어요. 정말로요. 하지만 당신의 코드에 큰 영향을 줍니다. 자신만의 의존성을 갖는 객체를 만드는 것 보다 객체에 의존성을 주입 할 때 유연성은 증가하고 결합도는 낮아집니다. 더 나은 디자인을 채용하게 된 덤으로 테스트 하기도 쉬워지지요. 자주 일어나는 일입니다.</p>\n<p>한번 살펴보시죠:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># 일반적인 접근</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Hacker</span>\n\n  <span class=\"token keyword\">def</span> initialize\n    <span class=\"token variable\">@keyboard</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Keyboard</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:layout</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'us'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token comment\"># stuff</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\"># 그리고 의존성 주입의 경우</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Hacker</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>keyboard<span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@keyboard</span> <span class=\"token operator\">=</span> keyboard\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token comment\"># stuff</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>우리가 뭔가 멋진 의존성 주입 라이브러리를 사용했나요? 아니죠. 우리가 코드를 더 작성했나요? 글쎄요. 아니면 코드가 더 복잡해졌나요? 확실히 아닙니다.</p>\n<p>작은 변화에 불과했지만 여러분의 코드에 <strong>큰 영향을 미칩니다.</strong> <code class=\"language-text\">Hacker</code> 클래스는 더 이상 키보드를 만드는 방법에 종속될 필요가 없습니다. 그저 주어진 인터페이스를 사용하게 될 뿐이며, 우리는 키보드 인터페이스를 구현하기만 하면 어떤 것이든 편하게 집어넣을 수 있게 되었습니다. 이게 유연성이 증가하고 결합도가 낮아진다는 것을 뜻합니다.</p>\n<p>다 좋은데 그렇다면 키보드의 의존성은 어디서 만들어야 할까요? 분명 어디선가 만들어져야 할 텐데요?</p>\n<p>제가 사용하는 패턴은 이렇습니다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Hacker</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span>layout <span class=\"token operator\">=</span> <span class=\"token string\">'us'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token constant\">Keyboard</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:layout</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> layout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>keyboard<span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@keyboard</span> <span class=\"token operator\">=</span> keyboard\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token comment\"># stuff</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>잠깐만요, 제가 코드를 더 작성하지 않아도 된다고 했나요? 제가 거짓말을 했네요. <code class=\"language-text\">build</code> 메서드를 쓰기 위해 코드를 두 줄 정도 더 써버렸습니다. 들켰네요.</p>\n<p>그래도 일단 좋은 면만 보도록 합시다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># 우리는 hacker 인스턴스를 아주 작은 노력으로 만들 수 있습니다</span>\n<span class=\"token constant\">Hacker</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token string\">'us'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 만약 우리가 이미 키보드 객체를 가지고 있다면 이 방식으로도 작동합니다</span>\n<span class=\"token constant\">Hacker</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>keyboard_we_already_had<span class=\"token punctuation\">)</span></code></pre></div>\n<p>우리가 의존성을 명시적으로 드러냈기 때문에 테스트하기도 쉬워졌습니다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">describe <span class=\"token constant\">Hacker</span> <span class=\"token keyword\">do</span>\n  <span class=\"token comment\"># 여기서는 키보드 객체가 큰 의존성을 가지고 있어서 그냥 mock으로 만든다고 칩시다</span>\n  <span class=\"token function\">let</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:keyboard</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyboard'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token string\">'writes awesome ruby code'</span> <span class=\"token keyword\">do</span>\n    hacker <span class=\"token operator\">=</span> <span class=\"token constant\">Hacker</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>keyboard<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># some expectations</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>의존성 주입이 없었다면 어떤 모양으로 보일 지 생각해봅시다. 제가 끔찍한 예를 하나 들어보겠습니다. 그리고 저는 여전히 사람들이 이런 코드를 작성하는 것을 보곤 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">describe <span class=\"token constant\">Hacker</span> <span class=\"token keyword\">do</span>\n  <span class=\"token function\">let</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:keyboard</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyboard'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n  it <span class=\"token string\">'writes awesome ruby code'</span> <span class=\"token keyword\">do</span>\n\t<span class=\"token comment\"># 우웩!</span>\n    <span class=\"token constant\">Keyboard</span><span class=\"token punctuation\">.</span><span class=\"token function\">should_receive</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n      <span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:layout</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'us'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n      <span class=\"token function\">and_return</span><span class=\"token punctuation\">(</span>keyboard<span class=\"token punctuation\">)</span>\n\n    hacker <span class=\"token operator\">=</span> <span class=\"token constant\">Hacker</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span>\n\n    <span class=\"token comment\"># some expectations</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><em>역주: 윗부분에서 <code class=\"language-text\">Hacker</code> 클래스를 의존성 주입 없이 사용하는 예를 살펴보시면 ,<code class=\"language-text\">Hacker</code> 클래스의 인스턴스를 작성할 때 동시에 <code class=\"language-text\">Keyboard</code> 클래스의 인스턴스를 만든다는 것을 볼 수 있습니다. 그래서 <code class=\"language-text\">keyboard</code> 라는 객체가 의도대로 생성되는지를 테스트하기 위해 이런 복잡한 코드가 들어가게 되었다고 생각합니다.</em></p>\n<h2 id=\"더-나아가서\"><a href=\"#%EB%8D%94-%EB%82%98%EC%95%84%EA%B0%80%EC%84%9C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>더 나아가서</h2>\n<p>루비의 의존성 주입을 연습할 때 저는 몇몇 작은 패턴과 규칙을 정해놓고 따르고 있습니다.</p>\n<ul>\n<li><code class=\"language-text\">.new</code> 메서드를 깔끔하게 유지하고, 오버라이드 하지 말 것. 단순한 의존성만 인자로 받아들인다</li>\n<li>빌더 메서드를 분리하여 만들고 이 메서드가 \"모양빠지는\" 입력들을 받아서, 해당 클래스의 객체가 필요로 하는 모든 것을 만들 수 있게한다</li>\n<li>빌더 메서드가 너무 복잡해지게 되면 빌드 로직을 서로 다른 객체로 분리한다</li>\n<li>생성자에 옵션 해시를 전달하는 것을 피한다</li>\n</ul>\n<p>이 규칙들은 제가 작성하는 코드에 크게 긍정적인 영향을 주었습니다. 결합도를 낮추었고, 유연성을 높였으며, 리팩토링도 쉬워졌습니다.</p>\n<p>사실 제가 이 글을 통해 작성한 간단한 예제만으로 위의 규칙이 말이 된다고 설득하는 것은 어렵습니다. 그러므로 일단 루비의 의존성 주입을 사용해보라고 권하고 싶습니다. 의존성 주입을 사용하는게 단순히 테스트할 때 이득을 보기 위해서라고 여기지 말아주세요. 제발요 :)</p>\n<p>제가 말하고 싶은 것은 루비의 의존성 주입은 하나의 미덕이라는 점입니다. 루비는 복잡한 일들을 간단한 방법으로 구현할 수 있는 아름다운 언어입니다. 반면에 테스트 할 때 <code class=\"language-text\">Time.now</code> 에 <code class=\"language-text\">stub</code> 을 사용하는 것은 그렇게 영리한 방법은 아닙니다.<em>(역주: <code class=\"language-text\">stub</code> 메서드는 Rspec에서 일종의 객체 목업을 생성해주는 메서드로 알고 있습니다. 굳이 글쓴이가 <code class=\"language-text\">Time.now</code> 에 <code class=\"language-text\">stub</code> 메서드를 사용한다는 이야기를 꺼낸 것은 이 예시가 DHH의 포스트에 언급되어 있기 때문입니다.)</em></p>\n<p>물론 여러분이 루비의 의존성 주입을 사용하지 않을 수도 있지만, 실제로 사용해 보시면 더 깔끔하고 명시적인 코드를 작성하실 수 있습니다. 여러분의 코드는 더 좋아질 겁니다.</p>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>저는 언제나 기본적인 컴퓨터 과학 및 좋은 프로그래밍 방법론에 대한 지식이 부족하다는 점을 통감하고 있습니다. 단순히 전공자가 아니기 때문인 것도 있지만, 지속적으로 개발을 제대로 하려면 이러한 지식이 반드시 필요하다고 생각하고 있기 때문입니다. 이런 점에서 최근에 좀 더 알아보고 싶던 주제가 '의존성 주입' 입니다.</p>\n<p>자바 스프링 프레임워크를 사용할 때 주로 '의존성 주입' 이라는 단어가 많이 나왔을겁니다. 그런데 제가 제대로 쓸 수 있는(정말일까?) 유일한 언어인 루비는 어떻게 의존성 주입을 사용하는지 궁금하여 찾아보다 이 글을 발견하게 되었습니다.</p>\n<p>번역 과정 자체는 무난했는데 후반부에 \"Stub Time.now\" 라는 말의 뜻을 이해하지 못하겠더군요. 알고보니 두 가지 문제가 있었습니다.</p>\n<ol>\n<li>RSpec을 제대로 써 보지 않았다</li>\n<li>DHH의 글을 먼저 읽어보지 않았다</li>\n</ol>\n<p>글 작성자에게 더 자세한 설명을 부탁했더니 이런 답변을 받았습니다. 참고하시기 바랍니다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 790px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 94.36619718309859%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACa0lEQVQ4y3WUSY7bQAxFfaoE2TSycLctz7Ykz5ItWZ4yLAIEyKKBIAfIKifITRk+uijIcGdBsarE+kV+/qrWcj6Xn6+vslosZDoeSxrHskhTSdTHs5kkapPRSPpRJINe78FY538Sz2TY70sr225lk8Yym0wkzzJJk8SA3QgmMOp0pNft1t6N+WgwsP0c0GLx49OTdF9eZL1cylwBxwpCwHg4NEAHj6dTy5gx//nHGnOADZAPJ+C3m41cLxepylJOx6NZdSjloHPWL6dTbdfzWc4hhiRIrAZ0fsr9Xs4aXB0OBsqGi27MoWW1Mp7hnEoYQxcZdp6faz5rQIxNgJJpsdvJLs9lp7wuFKRZCQav7BkpLZTs87sMOXW7XkumgJ7RhrlmUuhBZMo4b87D4VPllLLvAPmZhw1k5pvxlMl/DtmHzKmGKvZUo/M7DkmZQBrAifCIZ+2oYzYBgIfnt9Tw0BQvGaAbh9ktG7IInv9lUVjJNAhg1hjXHLqR1efr1QIokSCMm+NzdIg3EE3gARAiETUTbgnNYMwaYsUYu/kcqTTXah2mo0j+/vmt/BTGB2Wb3oInA/hFHuNgyMfG4VqiRWINcBFP5NePb7aRLh6UH+xYVXJS40bQlE96UxA66zTHGwS3ANUZ9rqRtNttK3Ot5RKAsJGBd9bGKEAPQkbcIjj1cpsvUYsJfOAh18XqmgQMceMpy8HzoEOsCNlaU7g2XHx4gEO6yJvY9MQ4f/6kufbsLQzvpmWIpr5//XKTSLgF9oypVADE2ARHZODvoN9/SqY5xNkDy+KH9++MD7ijBE5vPqT/e62br7bH/QPWe/MwJaRjfAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"2017 02 04 sc2\"\n        title=\"\"\n        src=\"/static/0f2ed11f15088cd9b3c54a8078fb8ed1/ffc88/2017-02-04-sc2.png\"\n        srcset=\"/static/0f2ed11f15088cd9b3c54a8078fb8ed1/d16f8/2017-02-04-sc2.png 198w,\n/static/0f2ed11f15088cd9b3c54a8078fb8ed1/f21b1/2017-02-04-sc2.png 395w,\n/static/0f2ed11f15088cd9b3c54a8078fb8ed1/ffc88/2017-02-04-sc2.png 790w,\n/static/0f2ed11f15088cd9b3c54a8078fb8ed1/ee9f1/2017-02-04-sc2.png 994w\"\n        sizes=\"(max-width: 790px) 100vw, 790px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>루비의 의존성 주입에 대한 이야기는 <a href=\"http://www.aladin.co.kr/shop/wproduct.aspx?ItemId=49317754\">루비로 배우는 객체지향 디자인</a> 책에도 조금 설명되어 있습니다. 루비로 프로그래밍을 하신다면 두번 이상은 읽어보시길 추천드립니다.</p>\n<p>참고 링크:</p>\n<ul>\n<li><a href=\"http://www.slideshare.net/hnki0104/ss-42101768\">주니어 개발자도 이해할 수 있는 의존성 주입</a></li>\n<li><a href=\"https://medium.com/@Bakku1505/introduction-to-dependency-injection-in-ruby-dc238655a278#.ywoosbc3h\">Introduction to dependency injection in Ruby</a></li>\n<li><a href=\"http://david.heinemeierhansson.com/2012/dependency-injection-is-not-a-virtue.html\">Dependency injection is not a virtue</a></li>\n</ul>","id":"023bcfa8-7f9e-531e-8c41-1fcf0a3e64c6","frontmatter":{"date":"2017-02-04","path":"/posts/the-world-needs-another-post-about-dependency-injection-in-ruby-kor","title":"[번역] 세상은 루비의 의존성 주입에 대한 다른 글을 원한다","tags":["Ruby","OOP","Translation"],"category":"Translation"}},{"excerpt":"이 포스팅은  Cezar Halmagean…","html":"<ul>\n<li><strong>이 포스팅은 <a href=\"https://twitter.com/chalmagean\">Cezar Halmagean</a>의 <a href=\"https://mixandgo.com/blog/mastering-ruby-blocks-in-less-than-5-minutes\">포스팅</a>을 번역한 글입니다</strong></li>\n<li><strong>번역 내용에 대한 조언 및 의견은 언제나 작성자에게 큰 도움이 됩니다</strong></li>\n</ul>\n<hr>\n<p>블록은 루비에서 가장 강력한 기능이지만 대수롭지 않게 여겨지는 기능이기도 합니다. 고백컨데 저도 루비 블록이 어떻게 동작하는지, 그리고 실제로 어떻게 유용하게 사용될 수 있는지 알아내는데 시간이 좀 걸렸습니다.</p>\n<p>처음에 블록을 이해하는데 굉장히 어렵게 만드는 요소로 <code class=\"language-text\">yield</code> 등의 개념이 있습니다. 저는 블록의 일부 개념에 대해 이야기하고 몇몇 예시를 들어서 글 마지막에는 여러분이 루비 블록을 명확하게 이해하도록 돕겠습니다.</p>\n<h2 id=\"무엇을-배울-것인가\"><a href=\"#%EB%AC%B4%EC%97%87%EC%9D%84-%EB%B0%B0%EC%9A%B8-%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>무엇을 배울 것인가</h2>\n<ol>\n<li>\n<p>기초: 루비 블록이란?</p>\n</li>\n<li>\n<p><code class=\"language-text\">yield</code> 가 동작하는 방법</p>\n<ul>\n<li>블록을 메서드로 전달하기</li>\n<li><code class=\"language-text\">yield</code> 도 매개변수를 받는다</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">&amp;block</code> 은 무엇을 의미하는가?</p>\n</li>\n<li>\n<p>값의 반환</p>\n</li>\n<li>\n<p><code class=\"language-text\">.map(&amp;:something)</code> 은 어떻게 동작하는가?</p>\n</li>\n<li>\n<p>반복자, 그리고 여러분의 반복자를 직접 만들기</p>\n</li>\n<li>\n<p>블록을 이용하여 기본값으로 객체를 초기화하기</p>\n</li>\n<li>\n<p>루비 블록 예시</p>\n<p>​</p>\n</li>\n</ol>\n<h2 id=\"기초-루비-블록이란\"><a href=\"#%EA%B8%B0%EC%B4%88-%EB%A3%A8%EB%B9%84-%EB%B8%94%EB%A1%9D%EC%9D%B4%EB%9E%80\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기초: 루비 블록이란?</h2>\n<p>블록은 기본적으로 <code class=\"language-text\">do</code> 와 <code class=\"language-text\">end</code> 사이에 들어가는 코드입니다. 그게 다에요. <em>\"그럼 마법같은 일(Magic)은 어디서 일어나는거죠?\"</em> 라고 질문하실 수 있겠습니다. 우리는 몇 분 이내에 그 부분을 파고들겠지만 차례대로 설명하겠습니다(but first things first).</p>\n<p>여러분은 블록을 두 가지 방법으로 작성할 수 있습니다. 1. 멀티-라인으로 작성할 때는 <code class=\"language-text\">do</code> 와 <code class=\"language-text\">end</code> 사이에 코드를 작성하고, 2. 인라인으로 작성할 땐 <code class=\"language-text\">{</code> 와 <code class=\"language-text\">}</code> 사이에 코드를 작성하면 됩니다.</p>\n<p>이 두 가지 작성 방법은 정확하게 똑같이 작동합니다. 그래서 어느 방법을 고를 지는 여러분의 선택에 달려 있습니다. 일반적인 스타일 가이드에 의하면 가독성을 위해 코드가 한줄 이상 넘어가면 <code class=\"language-text\">do</code> ~ <code class=\"language-text\">end</code> 를 이용하여 작성하는 것이 좋습니다.</p>\n<p>멀티 라인 블록의 기본적인 예시는 이렇습니다: <code class=\"language-text\">[1, 2, 3].each do |n| puts &quot;Number #{n}&quot; end</code></p>\n<p>이 블록이 멀티 라인 블록이라 불리는 이유는 한 줄 이상으로 코드가 작성되어서가 아니고 인라인 블록이 아니기 때문입니다. 같은 예시를 인라인으로 작성할 수도 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>n<span class=\"token operator\">|</span> puts <span class=\"token string\">\"Number <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>n<span class=\"token delimiter tag\">}</span></span>\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>두 가지 버전 모두 1, 2, 3을 순서대로 출력할 겁니다. 파이프 사이에 있는 소문자 n(<code class=\"language-text\">|n|</code>)은 <strong>블록 매개변수(block parameter)</strong> 라고 불리고, 이 예시에서는 배열 안에 있는 각각의 번호가 순서대로 나오게됩니다. 그래서 처음 반복 시에 <code class=\"language-text\">n</code> 의 값은 1이 되고, 두번째 반복에서는 2가 되고 그 다음엔 3이 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\nNumber 1\nNumber 2\nNumber 3\n =&gt; [1, 2, 3]</code></pre></div>\n<h2 id=\"yield가-동작하는-방법\"><a href=\"#yield%EA%B0%80-%EB%8F%99%EC%9E%91%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yield가 동작하는 방법</h2>\n<p>이제 위험한 녀석이 왔습니다(Here's bad wolf). 이 녀석이 루비 블록의 마법스러움과 혼란스러움을 가져다주는 주범이지요. 제 생각엔 대부분 <code class=\"language-text\">yield</code> 가 블록을 호출하는 방법과 어떻게 매개변수를 전달하는지가 어렵게 보일 것이라 생각합니다. 우리는 이 섹션에서 두 가지 시나리오를 모두 살펴볼겁니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> my_method\n  puts <span class=\"token string\">\"reached the top\"</span>\n  <span class=\"token keyword\">yield</span>\n  puts <span class=\"token string\">\"reached the bottom\"</span>\n<span class=\"token keyword\">end</span>\n\nmy_method <span class=\"token keyword\">do</span>\n  puts <span class=\"token string\">\"reached yield\"</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\nreached the top\nreached yield\nreached the bottom\n =&gt; nil</code></pre></div>\n<p>기본적으로 <code class=\"language-text\">my_method</code> 메서드가 실행되고 <code class=\"language-text\">yield</code> 를 호출하는 줄에 도달하면, 블록 안에 있는 코드가 실행됩니다. 그리고 블록 안의 코드가 끝나면 <code class=\"language-text\">my_method</code> 메서드가 계속 실행됩니다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 492px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 42.07317073170732%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTklEQVQoz32R2U7DMBRE8///hQRCFYtQS6GlNdlIGy9xFsd2msHXooiH0iuNLCfO8egkQZjT6YRBDbC6hWsVnKjhGonJOXhnMY4mxpghnv1v5nlGct6UrARbr5AWb3jfPWGfvWKvCmTNF5wfMZ8mWGvQdV2Aj9Bao23bGHo2TVPkJN778IHFITuAPWY4hGZFX6PqBEp9jFFDE88QkHMOKSUYY0jTFEVRIM9zVFUV2yfWWkzh9mKXY7f+QKZKbGoGJnPsf7LhnzBugLNjaKTR9/0vWCkVQ3tiJS54orpGGvjRk4lw0wQfGpE/Z2l1cSWP5OnaRCBVlUpACI48S8GrI8bWxEYUG5zRD6GcXRH4UiJQSIHl8gWLxT1unu9wu3rAtkixFSE8eGrIjw8NB5Dzq0B6SVCeCui6gZ0ttG3RGA3VN5C9Qme6qICAfxtemm+oSGlJM6/67gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"2017 01 26 sc1\"\n        title=\"\"\n        src=\"/static/0b41e997207a170368c666aab1b250d5/806d2/2017-01-26-sc1.png\"\n        srcset=\"/static/0b41e997207a170368c666aab1b250d5/e0e3b/2017-01-26-sc1.png 198w,\n/static/0b41e997207a170368c666aab1b250d5/4f7b9/2017-01-26-sc1.png 395w,\n/static/0b41e997207a170368c666aab1b250d5/806d2/2017-01-26-sc1.png 492w\"\n        sizes=\"(max-width: 492px) 100vw, 492px\"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id=\"블록을-메서드로-전달하기\"><a href=\"#%EB%B8%94%EB%A1%9D%EC%9D%84-%EB%A9%94%EC%84%9C%EB%93%9C%EB%A1%9C-%EC%A0%84%EB%8B%AC%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>블록을 메서드로 전달하기</h3>\n<p>블록을 매개변수로 받기 위해 메서드에 특별히 무언가를 정의할 필요는 없습니다. 그냥 블록을 함수(메서드)로 전달할 수 있습니다. 하지만 그 함수가 <code class=\"language-text\">yield</code> 를 호출하지 않으면 블록은 실행되지 않을겁니다.</p>\n<p>반면에 메서드에 <code class=\"language-text\">yield</code> 를 호출하도록 해놓으면 블록을 인자로 전달하는 것이 강제됩니다. 이 메서드가 블록을 매개변수로 받지 않는다면 에러가 발생하게 됩니다.</p>\n<p>만약 블록을 매개변수로 받는 것을 가변적으로 처리하고 싶다면 <code class=\"language-text\">block_given?</code> 메서드를 사용할 수 있습니다. 이 메서드는 블록이 메서드로 전달되었는지를 따져 true나 false를 리턴합니다.</p>\n<h3 id=\"code-classlanguage-textyield\u001ccode-도-매개변수를-받는다\"><a href=\"#code-classlanguage-textyield%1Ccode-%EB%8F%84-%EB%A7%A4%EA%B0%9C%EB%B3%80%EC%88%98%EB%A5%BC-%EB%B0%9B%EB%8A%94%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">yield\u001c</code> 도 매개변수를 받는다</h3>\n<p>어떠한 매개변수든지  <code class=\"language-text\">yield</code> 로 전달되면 블록의 매개변수처럼 동작할 것입니다. 그래서 블록이 실행될 때 원래 메서드로(yield를 호출하는 메서드)부터 전달되는 매개변수를 사용할 수 있습니다. 즉 매개변수는 <code class=\"language-text\">yield</code> 가 자리잡고 있는 메서드의 지역 변수가 될 수도 있다는 뜻입니다.</p>\n<p>전달되는 매개변수의 순서는 중요합니다. 왜냐면 여러분이 전달하는 매개변수의 순서가 블록이 매개변수를 전달받는 순서와 일치하기 때문입니다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 475px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.15789473684211%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACF0lEQVQoz2NYPnGm+LKZEfzLpyUKbuqLEl0+LUtw2uJ2vnmz+wXmzO3jnzu3TwCI+WfP7hPs7W3lZQCCBQumMuAERxsPO12s6XO6UNdtd7mqzvN8Q6f53iVbxbfv6+ffsX2W4I4dMwRAeOfOOcKVlXkSID3////HbeCp2ite5xpvmJ1tvap7puWO4dmeiypnZhySPP2qi+PYoXk8R47M5Dl1ag732bNLeWtqCkQZCIENXetUWvZEc3dsTeHt3B7HM2V1Jf/CtT0CSxdNFd6wYZ7gli2LBJYvnyq4cuVMkbKyfBGCLgSB5c5PGC9N+s9Q4nOAkYEBrIcFiJmAWBiIQd5kB2KgHAOruLgoSJyhoqKCob29naGtrQ2MYWyG5fMW8s/o6+LtyS3hW9U8hffo1M28XpaOCjNLWvjbsssF61PyhVpzCvjbi0oFU9MSeQh6WUVb3EhVT8lSylbJISIx2Wpp1zaLhc0b7aZ1rjBf1bLLsWvGTNWYjelihasqpObOmSheWdnM3N7RxgF0DR/QVSCaB4h5gWwQzcKQ75Pr4hLmoGy+MFbTdFq4js2saHWbmTEaelNDjKymR2tbzIjUMp8Rqek2J0F17pR+mfqmZqDmNnGgZlkgFgZiGSCWA/GBhnIxHOg5qrZ300q+gwvm8x1ctJBv18K5fLuB+BCQvWPhbL49C+fx7V04n2/zvFmCU6Z28xLyMQBX/95WW5u5bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"2017 01 26 sc2\"\n        title=\"\"\n        src=\"/static/bb2e2064049183892cdc8f6790ab92a8/7203d/2017-01-26-sc2.png\"\n        srcset=\"/static/bb2e2064049183892cdc8f6790ab92a8/93713/2017-01-26-sc2.png 198w,\n/static/bb2e2064049183892cdc8f6790ab92a8/ae0be/2017-01-26-sc2.png 395w,\n/static/bb2e2064049183892cdc8f6790ab92a8/7203d/2017-01-26-sc2.png 475w\"\n        sizes=\"(max-width: 475px) 100vw, 475px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>한가지 유의하셔야 할 점은 블록 안의 매개변수는 블록에만 한정된 지역 변수가 된다는 겁니다. (메서드에 있던 지역 변수를 블록으로 전달할 때와는 다릅니다)</p>\n<h2 id=\"block은-무엇을-의미하는가-ampersand-parameter\"><a href=\"#block%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%84-%EC%9D%98%EB%AF%B8%ED%95%98%EB%8A%94%EA%B0%80-ampersand-parameter\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x26;block은 무엇을 의미하는가? (ampersand parameter)</h2>\n<p>여러분은 아마 다른 루비 코드 여기저기에 <code class=\"language-text\">&amp;block</code> 이 사용된 것을 보셨을 겁니다. 이 것은 지역 변수 대신에 블록에 대한 참조(reference) 자체를 메서드로 전달하는 방식입니다. 사실 <strong>루비는 블록처럼 작동하는 어떠한 객체라도 메서드에 전달되는걸 허용합니다.</strong> 메서드가 전달받은 객체가 블록이라면 이 블록을 사용하려 할 것이지만, <em>만약 블록이 아니라면 그 객체에 <code class=\"language-text\">to_proc</code> 메서드를 호출하여</em> 블록으로 변환하려고 시도할 것입니다.</p>\n<p>또 참고하셔야 할 점은 <code class=\"language-text\">block</code> 이라는 이름은(ampersend(&#x26;) 기호 이외의 부분) 단지 참조를 위한 이름일 뿐입니다. 여러분이 좋아하는 어떠한 이름이라도 사용하실 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token function\">my_method</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>block<span class=\"token punctuation\">)</span>\n  puts block\n  block<span class=\"token punctuation\">.</span>call\n<span class=\"token keyword\">end</span>\n\nmy_method <span class=\"token punctuation\">{</span> puts <span class=\"token string\">\"Hello!\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\n#&lt;Proc:0x0000010124e5a8@tmp/example.rb:6&gt;\nHello!</code></pre></div>\n<p>위의 예를 보시다시피, <code class=\"language-text\">my_method</code> 안에 있는 <code class=\"language-text\">block</code> 변수는 블록의 참조이고, 이 블록은 <code class=\"language-text\">call</code> 메서드를 통해 실행될 수 있습니다. 블록에 <code class=\"language-text\">call</code> 을 하는 것은 <code class=\"language-text\">yield</code> 와 똑같은 겁니다. 일부 사람들은 가독성을 위해 <code class=\"language-text\">yield</code> 대신에 <code class=\"language-text\">block.call</code> 을 사용합니다.</p>\n<h2 id=\"값의-반환\"><a href=\"#%EA%B0%92%EC%9D%98-%EB%B0%98%ED%99%98\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>값의 반환</h2>\n<p><code class=\"language-text\">yield</code> 는 블록 안에서 마지막으로 평가된 값(last evaluated expression)이 반환됩니다. 달리 말하면 <code class=\"language-text\">yield</code> 가 리턴하는 값은 블록이 리턴하는 값이라는 겁니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> my_method\n  value <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span>\n  puts <span class=\"token string\">\"value is: <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>value<span class=\"token delimiter tag\">}</span></span>\"</span>\n<span class=\"token keyword\">end</span>\n\nmy_method <span class=\"token keyword\">do</span>\n  <span class=\"token number\">2</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\nvalue is 2\n=&gt; nil</code></pre></div>\n<h2 id=\"mapsomething은-어떻게-동작하는가\"><a href=\"#mapsomething%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%8F%99%EC%9E%91%ED%95%98%EB%8A%94%EA%B0%80\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>.map(&#x26;:something)은 어떻게 동작하는가?</h2>\n<p>여러분은 아마 <code class=\"language-text\">.map(&amp;:capitalize)</code> 같은 단축 표현을 많이 쓰셨을 겁니다. 특히 레일즈로 코딩을 좀 해보셨다면 말이죠.  <code class=\"language-text\">.map { |title| title.capitalize }</code> 에 비하면 아주 깔끔한 단축 표현입니다.</p>\n<p><strong>그런데 이게 어떻게 작동하는걸까요?</strong></p>\n<p>실제로는 <a href=\"http://ruby-doc.org/core-2.2.0/Symbol.html#method-i-to_proc\">심볼 클래스가</a> <code class=\"language-text\">to_proc</code> 을 메서드를 구현하고 있기 때문에, 단축 표현을 풀어서 실제의 긴 표현식으로 변환해주는 겁니다. 멋지죠?</p>\n<h2 id=\"반복자-그리고-여러분의-반복자를-직접-만들기\"><a href=\"#%EB%B0%98%EB%B3%B5%EC%9E%90-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%97%AC%EB%9F%AC%EB%B6%84%EC%9D%98-%EB%B0%98%EB%B3%B5%EC%9E%90%EB%A5%BC-%EC%A7%81%EC%A0%91-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복자, 그리고 여러분의 반복자를 직접 만들기</h2>\n<p>여러분은 메서드 안에 있는 <code class=\"language-text\">yield</code> 를 원하시는 대로 몇번이든 부를 수 있습니다. 그게 기본적으로 반복자(iterator)가 동작하는 원리입니다. <code class=\"language-text\">yield</code> 를 배열 안에 있는 각 요소마다 호출하면 루비에서 기본적으로 제공하는 반복자를 흉내낼 수 있습니다.</p>\n<p>루비의 <code class=\"language-text\">map</code> 메서드와 비슷한 메서드를 작성하는 방법을 보여드리겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token function\">my_map</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span>\n  new_array <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">for</span> element <span class=\"token keyword\">in</span> array\n    new_array<span class=\"token punctuation\">.</span>push <span class=\"token keyword\">yield</span> element\n  <span class=\"token keyword\">end</span>\n\n  new_array\n<span class=\"token keyword\">end</span>\n\n<span class=\"token function\">my_map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>number<span class=\"token operator\">|</span>\n  number <span class=\"token operator\">*</span> <span class=\"token number\">2</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\n[2, 4, 6]</code></pre></div>\n<h2 id=\"블록을-이용하여-객체를-기본값과-함께-초기화하기\"><a href=\"#%EB%B8%94%EB%A1%9D%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EA%B8%B0%EB%B3%B8%EA%B0%92%EA%B3%BC-%ED%95%A8%EA%BB%98-%EC%B4%88%EA%B8%B0%ED%99%94%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>블록을 이용하여 객체를 기본값과 함께 초기화하기</h2>\n<p>루비 블록을 사용할 수 있는 멋진 패턴 중 하나는 객체를 기본값과 함께 초기화하는 것입니다. 한번이라도 아무 루비 젬에서나 <code class=\"language-text\">.gemspec</code> 파일을 살펴보았을 때 이 패턴을 보셨을겁니다.</p>\n<p>작동하는 원리는 이렇습니다. <code class=\"language-text\">initialize</code> 메서드 안에 <code class=\"language-text\">yield(self)</code> 를 호출하는 초기화 도구(initializer)를 넣어두는 겁니다. 여기서 <code class=\"language-text\">self</code>\u001c 는 초기화되는 객체 자신입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span>\n  attr_accessor <span class=\"token symbol\">:color</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:doors</span>\n\n  <span class=\"token keyword\">def</span> initialize\n    <span class=\"token keyword\">yield</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\ncar <span class=\"token operator\">=</span> <span class=\"token constant\">Car</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">do</span> <span class=\"token operator\">|</span>c<span class=\"token operator\">|</span>\n  c<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span>\n  c<span class=\"token punctuation\">.</span>doors <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n<span class=\"token keyword\">end</span>\n\nputs <span class=\"token string\">\"My car's color is <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>car<span class=\"token punctuation\">.</span>color<span class=\"token delimiter tag\">}</span></span> and it's got <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>car<span class=\"token punctuation\">.</span>doors<span class=\"token delimiter tag\">}</span></span> doors.\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\nMy car&#39;s color is Red and it&#39;s got 4 doors.</code></pre></div>\n<h2 id=\"루비-블록-예시\"><a href=\"#%EB%A3%A8%EB%B9%84-%EB%B8%94%EB%A1%9D-%EC%98%88%EC%8B%9C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>루비 블록 예시</h2>\n<p>요즘은 예시로 보여주는게 대세(all the rage these days)인만큼 실제 세계에서(혹은 실제 세계와 최대한 가까운) 블록을 사용하는 몇가지 흥미로운 시나리오를 보여드리겠습니다.</p>\n<h3 id=\"텍스트를-html-태그로-감싸기\"><a href=\"#%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%A5%BC-html-%ED%83%9C%EA%B7%B8%EB%A1%9C-%EA%B0%90%EC%8B%B8%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>텍스트를 HTML 태그로 감싸기</h3>\n<p>여러분이 다양한 코드 덩어리를 약간의 고정된 코드로 감싸고자 할 때 블록은 최고의 도구입니다. 예를 들자면 여러분이 어떤 텍스트를 감싸고 있는 HTML 태그를 만들고자 한다면, 텍스트는 가변적이고(왜냐면 아직 당신은 무엇을 태그로 감쌀지 전혀 모르니까요) 태그는 고정적인 부분입니다. 이 형태는 변하지 않습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> wrap_in_h1\n  <span class=\"token string\">\"&lt;h1><span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span><span class=\"token keyword\">yield</span><span class=\"token delimiter tag\">}</span></span>&lt;/h1>\"</span>\n<span class=\"token keyword\">end</span>\n\nwrap_in_h1 <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Here's my heading\"</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># => \"&lt;h1>Here's my heading&lt;/h1>\"</span>\n\nwrap_in_h1 <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Ha\"</span> <span class=\"token operator\">*</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># => \"&lt;h1>HaHaHa&lt;/h1>\"</span></code></pre></div>\n<p>메서드에 블록을 넘기는 방법은 여러분이 특정 행동을 재사용하고 싶지만 살짝 다르게 쓰고 싶을 때 유용하다는 점을 알아두시기 바랍니다. 이번엔 우리가 HTML 태그로 감싸고 싶은 문자열이 있고, 이걸 조금 다른 용도로 사용하는 경우를 봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token function\">wrap_in_tags</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span>\n  html <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>tag<span class=\"token delimiter tag\">}</span></span>><span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>text<span class=\"token delimiter tag\">}</span></span>&lt;/<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>tag<span class=\"token delimiter tag\">}</span></span>>\"</span>\n  <span class=\"token keyword\">yield</span> html\n<span class=\"token keyword\">end</span>\n\n<span class=\"token function\">wrap_in_tags</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>html<span class=\"token operator\">|</span> <span class=\"token constant\">Mailer</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token function\">wrap_in_tags</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">|</span>html<span class=\"token operator\">|</span> <span class=\"token constant\">Page</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:body</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> html<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>첫 번째 경우에는 <code class=\"language-text\">&lt;title&gt;Hello&lt;/title&gt;</code> 이라는 문자열을 이메일로 보냈고, 두 번째 경우에는 <code class=\"language-text\">Page</code>  레코드를 만듭니다. 두 경우 모두 같은 메서드를 사용했지만 다른 일을 했습니다.</p>\n<h3 id=\"노트-작성하기\"><a href=\"#%EB%85%B8%ED%8A%B8-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>노트 작성하기</h3>\n<p>우리가 생각(아이디어)을 데이터베이스 테이블로 저장하는 방법을 빠르게 개발한다고 생각해보겠습니다. 이 도구가 바르게 작동하려면 우리는 노트의 내용을 전달하고 메서드가 데이터베이스 연결을 다루도록 해야 합니다. 이상적으로 우리는 <code class=\"language-text\">Note.create { &quot;Nice day today&quot; }</code> 라고 호출하고 나면 데이터베이스 연결을 열고 닫는데 일일이 신경 쓰고 싶지 않을 것입니다. 그럼 한번 보시죠.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Note</span>\n  attr_accessor <span class=\"token symbol\">:note</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>note<span class=\"token operator\">=</span><span class=\"token keyword\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@note</span> <span class=\"token operator\">=</span> note\n    puts <span class=\"token string\">\"@note is <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>@note<span class=\"token delimiter tag\">}</span></span>\"</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>create\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>connect\n    note <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">yield</span><span class=\"token punctuation\">)</span>\n    note<span class=\"token punctuation\">.</span>write\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>disconnect\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> write\n    puts <span class=\"token string\">\"Writing \\\"<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>@note<span class=\"token delimiter tag\">}</span></span>\\\" to the database.\"</span>\n  <span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">private</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>connect\n    puts <span class=\"token string\">\"Connecting to the database...\"</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>disconnect\n    puts <span class=\"token string\">\"Disconnecting from the database...\"</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token constant\">Note</span><span class=\"token punctuation\">.</span>create <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Foo\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\nConnecting to the database...\n@note is Foo\nWriting &quot;Foo&quot; to the database.\nDisconnecting from the database...</code></pre></div>\n<p>데이터베이스 연결, 노트 작성, 그리고 연결을 종료하는 기능의 구체적인 구현은 이 글에서 다루는 범위를 넘어가는 것이라 설명하지 않겠습니다.</p>\n<h3 id=\"배열에서-나눌-수-있는divisible-요소를-찾기\"><a href=\"#%EB%B0%B0%EC%97%B4%EC%97%90%EC%84%9C-%EB%82%98%EB%88%8C-%EC%88%98-%EC%9E%88%EB%8A%94divisible-%EC%9A%94%EC%86%8C%EB%A5%BC-%EC%B0%BE%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배열에서 나눌 수 있는(divisible) 요소를 찾기</h3>\n<p>제가 점점 \"실제 시나리오\" 와 멀어진 설명을 하고 있는 것 같습니다만, 마지막 예시를 보여드리도록 하겠습니다. 만약 배열 안에 있는 모든 요소 중에서 3으로 나뉘는 요소를 가져온다고 할 때(어떤 숫자를 생각하셔도 상관없습니다), 루비 블록을 어떻게 활용할 수 있을까요?</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Fixnum</span>\n  <span class=\"token keyword\">def</span> to_proc\n    <span class=\"token builtin\">Proc</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">do</span> <span class=\"token operator\">|</span>obj<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token operator\">|</span>\n      obj <span class=\"token operator\">%</span> <span class=\"token keyword\">self</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\nnumbers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\nputs numbers</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 결과\n3\n6\n9</code></pre></div>\n<p>역주: 위의 코드를 간략하게 설명하자면, 글 위에 <code class=\"language-text\">&amp;block</code> 을 설명한 부분에서 <code class=\"language-text\">&amp;</code> 기호 뒤에 붙어있는 객체가 블록이 아니라면 <code class=\"language-text\">to_proc</code> 으로 블록으로 변환하는 것을 시도한다는 내용이 있습니다. 그래서 <a href=\"https://en.wikipedia.org/wiki/Monkey_patch\">몽키 패칭</a>으로 <code class=\"language-text\">Fixnum</code> 클래스에 <code class=\"language-text\">to_proc</code> 메서드를 정의해 두는 겁니다. 3이라는 숫자는 <code class=\"language-text\">Fixnum</code> 클래스의 객체이기 때문입니다. (루비 2.4.0부터는 Integer 클래스에 속합니다.) 실제로 변환된 블록은 다음의 형태를 가지고 있을 겁니다. <code class=\"language-text\">*args</code> 는 옵션입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>select <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>n<span class=\"token operator\">|</span>\n  n <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2 id=\"결론\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>블록은 단순히 <strong>코드 덩어리</strong>라고 볼 수 있고, <code class=\"language-text\">yield</code> 는 메서드 어딘가에 그 코드를 <em>주입</em>할 수 있도록 만들어줍니다. 말인 즉슨 여러분은 한 가지 메서드를 다양한 방법으로 조작할 수 있다는 뜻입니다. 그래서 여러 메서드를 작성할 필요가 없어지게 됩니다. (한 메서드를 재사용하여 여러 가지를 할 수 있다는 겁니다.)</p>\n<p>수고하셨습니다! 이 포스트를 통해 여러분은 루비 블록을 더 유용하게 활용하는 방법을 익히셨을 겁니다. 만약 여전히 혼란스러운 부분이 있거나 이 글에서 뭔가 놓친 부분이 있다면 <a href=\"https://mixandgo.com/blog/mastering-ruby-blocks-in-less-than-5-minutes\">댓글을 남겨주세요</a>.</p>\n<p>또는 루비 블록에 대해 새로 배운게 있다면 이 글을 공유해주세요.</p>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>회사에서 개발을 하면서 필요한 기능에 맞추어 메서드를 만들다가 무언가 반복되는 부분이 발견되었습니다. 처음엔 메서드를 쪼개서 한 메서드를 여러 메서드가 공유하는 방식으로 사용했었는데, 생각해보니 그렇게까지 할 것도 없더군요. 분명 머리속엔 <code class=\"language-text\">yield</code> 라는 게 있다고 기억은 하고 있었는데.. 자세한 용도를 다시 살펴보고자 검색을 하니 이 포스팅을 발견하였고, 내용이 너무 좋아서 바로 번역을 해도 되겠냐고 저자에게 물었습니다. 하지만 실제 번역된 결과물을 내기까지 생각보다 시간이 걸렸습니다.</p>\n<p>포스팅에 작성 된 예제 말고도 <a href=\"https://ko.wikipedia.org/wiki/%EB%A9%94%ED%83%80_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D\">메타프로그래밍</a> 등 블록이 사용될 수 있는 부분은 무궁무진하게 많습니다. 이 글을 시작으로 간단하게 블록을 사용하여 이미 작성한 메서드를 개량하는 것부터 시작해보시는게 어떨까요?</p>\n<p>여담이지만 아직까지는 번역을 하면서 존대어를 쓰는 번역도 있고 경어를 쓰는 번역도 있습니다. 제 자신도 실력이 부족하고, 표현에 대해서 큰 고민을 하지 않고 의미 전달에만 초점을 두다 보니 이런 뒤죽박죽인 결과가 나왔네요. 번역 퀄리티가 점점 더 발전할 수 있도록 노력하겠습니다. 물론 좋은 글들을 흡수하여 제 자신이 더 좋은 코드를 작성하는 것도 신경 써야겠지요 :)</p>","id":"fde08ee6-5fc5-53a7-9515-3869f1df442a","frontmatter":{"date":"2017-01-26","path":"/posts/mastering-ruby-blocks-in-less-than-5minutes-kor","title":"[번역] 루비 블록을 5분 이내에 마스터하기","tags":["Ruby","Translation"],"category":"Translation"}},{"excerpt":"이 번역글은  Justin Weiss의 포스팅 을 번역한 글입니다 오류 지적 및 피드백은 언제나 환영합니다. 댓글이나 메일로 알려주세요 당신은 자신이 만든 앱을 보고 매우 흥분한 상태이다. 한가지 문제가 있다는 점만 빼고 - 테스트를 전혀 작성하지 않았다는 점 말이다. 당신은 TDD(Test-Driven Development…","html":"<ul>\n<li><strong>이 번역글은 <a href=\"http://www.justinweiss.com/articles/how-do-you-take-an-app-from-test-less-to-tdd/\">Justin Weiss의 포스팅</a>을 번역한 글입니다</strong></li>\n<li><strong>오류 지적 및 피드백은 언제나 환영합니다. 댓글이나 메일로 알려주세요</strong></li>\n</ul>\n<hr>\n<p>당신은 자신이 만든 앱을 보고 매우 흥분한 상태이다. 한가지 문제가 있다는 점만 빼고 - 테스트를 전혀 작성하지 않았다는 점 말이다. 당신은 TDD(Test-Driven Development) 방법론을 적용하여 코드를 쓰고 싶었지만, 어디부터 시작해야 할지 전혀 몰라서 막혀버렸다. 어디부터 시작해야 할 것인가? <strong>어떻게 하면 테스트가 없는 앱을 가지고 TDD를 이용한 앱을 작성할 수 있을까?</strong></p>\n<h2 id=\"이미-작성한-코드를-테스트하라\"><a href=\"#%EC%9D%B4%EB%AF%B8-%EC%9E%91%EC%84%B1%ED%95%9C-%EC%BD%94%EB%93%9C%EB%A5%BC-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%98%EB%9D%BC\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이미 작성한 코드를 테스트하라</h2>\n<p>당신은 테스트가 없는 코드 뭉치를 가지고 있다. 그렇다고 <em>당장</em> 기존의 코드를 가지고 테스트를 작성할 수 없다는 뜻은 아니다. 이미 가지고 있는 코드를 테스트하는 것 부터 시작해보라. 기대하던대로 코드가 작동하는지 확인해보는 것이다.</p>\n<p>이건 TDD가 아니다. <strong>그러나 이미 존재하는 코드를 테스팅하는 것은 TDD를 배우는데 도움을 줄 것이다.</strong></p>\n<ul>\n<li>\n<p><strong>예외적인 경우나 에러가 발생하는 조건에 대해 생각하는 연습을 하게 된다</strong></p>\n<p>모든 가능한 입력을 테스트하느라 수 년을 허비하지 않고 테스트를 작성하기 위해서, 당신은 보통 코드의 어느 부분에서 문제가 발생하는지 생각해야 한다. 만약 문자열을 받는 메서드를 테스트한다고 할 때, 대신 심볼을 넣으면 어떤 일이 생길 것인가?  <code class=\"language-text\">nil</code> 을 넣는다면? 혹은 숫자를 나누는 함수를 테스트한다면, 0을 입력하는 경우에 대한 테스트를 하는 것이 좋다. 하지만 아마 1과 2를 테스트 할 필요는 없을 것이다.</p>\n<p>당신은 충분한 테스트를 작성한 뒤에 메서드의 어느 부분에서 문제가 발생할지 예측하기 시작할 것이다. 그리고 한번 TDD를 시작하면 이 기술을 이용하여 탄탄한 테스트를 작성할 수 있을 것이다. 이 테스트들은 예외 사항들을 더욱 잘 처리하도록 코드를 강제하는 역할을 한다. </p>\n</li>\n<li>\n<p><strong>짜임새있는 테스트를 작성하는 연습을 하게 된다</strong></p>\n<p>이미 작성한 코드에 대한 테스트를 작성한다면, 이 테스트들을 <a href=\"https://www.justinweiss.com/articles/writing-better-tests-with-the-three-phase-pattern//\">구조화하는 다른 패턴들</a>을 시도해볼 수도 있다. 테스트하고자 하는 코드는 이미 있다. 그러니 당신은 테스트 자체, 그리고 이 테스트가 어떤 식으로 작성되어야 하는지에 대해 집중할 수 있다. 그리고 한번 몇몇 좋은 패턴들을 익히고 나면 당신이 기댈 코드가 <em>없을</em> 때에도 더 좋은 테스트를 작성할 것이다.</p>\n</li>\n<li>\n<p><strong>코드를 테스트하기 힘들게 하는 요소들을 발견하게 된다</strong></p>\n<p>테스트들을 작성할 수록 점점 시스템 어느 부분이 테스트하기 제일 어려운지 느끼게 될 것이다. 그런 부분들을 알아차리게 되면 그 부분을 리팩터링이 필요한 부분이라고 표시해둘 수 있다. 더 나아가 처음부터 더욱 테스트하기 좋은 코드를 작성하기 시작할 것이다.</p>\n<p>테스트하기 좋은 코드가 어떤 식으로 생겼는지 알기 시작하면, 그 지식을 기반으로 TDD하기 쉬운 API를 개발할 수 있으며 더욱 빨리 앱을 개발할 수 있을 것이다.</p>\n</li>\n</ul>\n<h2 id=\"tdd에-익숙해지기ease-into-tdd\"><a href=\"#tdd%EC%97%90-%EC%9D%B5%EC%88%99%ED%95%B4%EC%A7%80%EA%B8%B0ease-into-tdd\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD에 익숙해지기(Ease into TDD)</h2>\n<p>'테스트를 나중에' 기법을 TDD를 배우는데 도움이 되는 기술로 사용할 수 있다. 하지만 여전히 당신 앱의 일부에 TDD를 적용하고 싶을 것이다.<em>(역주: 테스트를 먼저 작성하고 기능을 개발하는 것을 의미하는 것이라 추정합니다)</em> <strong>그리고 기존의 코드를 가지고 TDD에 익숙해지는 간단한 방법이 있다: <a href=\"https://ko.wikipedia.org/wiki/%ED%9A%8C%EA%B7%80_%ED%85%8C%EC%8A%A4%ED%8A%B8\">회귀 테스트를 작성하는 것이다</a></strong></p>\n<p>회귀 테스트는 이미 확정한 코드를 부수는 것을 억누른다. 아이디어 자체는 아주 간단하다. 당신이 버그를 발견할 때마다, 그 버그를 다시 만들어보기 위해 브라우저에서 여기저기 클릭해보는 대신에:</p>\n<ul>\n<li>버그를 재생성하기 위해 <strong>실패하는 테스트를 작성하라.</strong></li>\n<li><strong>테스트를 실행하라,</strong> 그리고 그 테스트가 확실히 실패하는지 확인하라 (왜냐면 버그는 아직 존재하니까).</li>\n<li>가능한한 가장 간단한 방법으로 <strong>버그를 수정하라.</strong></li>\n<li><strong>테스트를 실행하라,</strong> 그리고 테스트가 통과하는지 확인하라.</li>\n<li>만약 필요하다면 당신이 수정한 방법을 <strong>리팩터링하라.</strong></li>\n</ul>\n<p>이 방법은 새 시스템을 밑바닥부터 TDD로 개발하는 것 보단 훨씬 쉽다. 왜냐면 이미 작성된 코드를 단지 테스트 주도적으로 바꾸기만 하는 것이기 때문이다. 그리고 \"Red, Green, Refactor\" 라는 TDD의 핵심적인 루프를 습관화하게 된다. <strong>그리고 이쯤부터 당신의 TDD는 테스트가 없는 상태에서 바로 TDD로 개발하는 것에 가까워지게 된다.(And from here, TDD is a shorter step away than trying to go straight to TDD from no tests.)</strong></p>\n<h2 id=\"테스트가-없는-상태에서-tdd로\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8%EA%B0%80-%EC%97%86%EB%8A%94-%EC%83%81%ED%83%9C%EC%97%90%EC%84%9C-tdd%EB%A1%9C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트가 없는 상태에서 TDD로</h2>\n<p>테스트가 없는 앱은 그렇게 나쁜 출발점은 아니다. 이미 작성된 코드를 테스트할 때, 당신은 좋은 TDD 테스트를 작성하기 위해 무엇이 필요한지 많이 배우게 될 것이다. '테스트를 나중에' 하는 것은 시작부터 TDD로 개발하는 것 보다 쉽다. 왜냐면 아직 어떻게 디자인해야할지 모르는 API들을 상상할 필요가 없기 때문이다. 그리고 자신의 앱에 한번 TDD를 도입하기로 결정했다면 회귀 테스트를 통해 익숙해질 수 있다.</p>\n<p>그러니 만약 당신이 상상하고 있는 시스템에 TDD를 어떻게 도입해야 할 지 모르겠다면, 계속 테스트를 작성하라. 비록 코드를 먼저 써야 하더라도 말이다.</p>\n<hr>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>2017년 첫 번역은 TDD에 관한 글입니다. TDD 혹은 BDD(Behavior Driven Development)가 개발 방법론에 있어서 절대적인 진리는 아닐 겁니다. 다만 많이 권장되는데는 이유가 있겠지요. 저는 간단하게 TDD가 확장성, 유지보수성에 큰 도움이 된다고 인지하고 있습니다.</p>\n<p>제 자신도 아직 실력이 미천하여 코드 없이 테스트를 작성한다는 것에 큰 두려움을 느끼면서 지내왔습니다. 최근에야 일부 기능에 대해 예측되는 결과를 먼저 테스트로 작성하고, 이후에 실제 기능을 작성하여 잘 작동하는지 확인하는 수준에 불과합니다.</p>\n<p>그러다가 마침 기존에 작성한 코드를 이용하여 TDD를 배워나가는 과정에 대해 간단한 포스팅이 있어 이렇게 소개를 하게 되었습니다. 음.. 당장은 기존의 코드를 이용하여 테스트를 작성하는게 꽤 부끄럽지만 (왜냐면 테스트를 작성할 것도 없이 손대야 할 부분들이 수두룩하게 보이니까요) 이런 방식으로 약간 우회하여 TDD를 습득하는 방법도 있겠지요. </p>\n<p>그럼 모두 2017년 한해에도 좋은 테스트 + 테스트를 통과하는 좋은 코드 작성이 잘 되시길 바랍니다 :)</p>\n<p>(추가) 피드백에 의해 'You' 라는 단어의 직역이 너무 많이 들어간 것 같아 조금 수정하였습니다. 확실히 번역할 때 '당신' 이라는 단어가 일일이 들어갈 필요는 없겠네요. 좋은 피드백을 주신 <a href=\"https://twitter.com/initnirvana\">@initNirvana</a> 님께 감사드립니다.</p>","id":"6cfa3680-15ae-5731-ac76-b465d3bc3518","frontmatter":{"date":"2017-01-16","path":"/posts/how-do-you-take-an-app-from-no-tests-to-tdd-kor","title":"[번역] 테스트가 없는 앱을 이용하여 TDD를 배우는 방법","tags":["Ruby","Testing","Translation"],"category":"Translation"}},{"excerpt":"이 포스팅은  Luca Guidi의 포스팅 을 번역한 글입니다 오역이나 잘못된 표현 지적은 언제나 환영합니다 객체 지향 프로그래밍, 인터페이스, 동적 타입에 대한 짧은 이야기 역주: 이 글은 가상의 이야기를 기반으로 객체 지향의 개념을 일부 짚어주는 글입니다 '루비 3'는 아직 개발 중이며, 어떤 형태로 나오게 될 지 모릅니다. 오늘은 주식회사 활빈당(Spectacular Foo Ltd…","html":"<ul>\n<li><strong>이 포스팅은 <a href=\"https://lucaguidi.com/2016/06/07/the-penguin-that-cannot-fly.html\">Luca Guidi의 포스팅</a>을 번역한 글입니다</strong></li>\n<li><strong>오역이나 잘못된 표현 지적은 언제나 환영합니다</strong></li>\n</ul>\n<hr>\n<h2 id=\"객체-지향-프로그래밍-인터페이스-동적-타입에-대한-짧은-이야기\"><a href=\"#%EA%B0%9D%EC%B2%B4-%EC%A7%80%ED%96%A5-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EB%8F%99%EC%A0%81-%ED%83%80%EC%9E%85%EC%97%90-%EB%8C%80%ED%95%9C-%EC%A7%A7%EC%9D%80-%EC%9D%B4%EC%95%BC%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>객체 지향 프로그래밍, 인터페이스, 동적 타입에 대한 짧은 이야기</h2>\n<p><em>역주: 이 글은 가상의 이야기를 기반으로 객체 지향의 개념을 일부 짚어주는 글입니다 '루비 3'는 아직 개발 중이며, 어떤 형태로 나오게 될 지 모릅니다.</em></p>\n<p>오늘은 주식회사 활빈당(Spectacular Foo Ltd. <em>역주: 보통 임의의 사람 이름을 홍길동이라고 하다 보니 임의의 회사 이름은 무엇으로 할까 하다가...</em>)의 본사에서 일어나는 일을 이야기해보고자 한다. 이 회사는 인디 게임계에서 떠오르고 있는 회사이고, 다음 블록버스터 타이틀인 <em>흔해빠진 새들(Banal Birds)</em> 의 발매를 앞두고 있다.</p>\n<p>올해는 2019년이고, 루비 3는 세배나 빠르고, 놀랍게도 모든 문제를 해결할 수 있는 동적 타입을 가지고 있다! 조금 향수에 젖은 결정이긴 하지만 당신은 리드 개발자로서 루비를 이 프로젝트에 사용하기로 결정했다.</p>\n<p>당신은 관리자인 제인에게 최종 코드 리뷰를 부탁했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Game</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>bird<span class=\"token punctuation\">:</span> <span class=\"token constant\">Bird</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@bird</span> <span class=\"token operator\">=</span> bird\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> play\n    <span class=\"token variable\">@bird</span><span class=\"token punctuation\">.</span>fly\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>아이디어는 간단하지만 혁명적이었다: 플레이어는 <strong>어떤</strong> 종류의 새라도 고를 수 있고 그 새가 날아가는 것을 볼 수 있다. 이건 엄청날거야!(This is gonna be kickass!)</p>\n<p>당신은 유명한 루비 젬 <code class=\"language-text\">acts_as_a_bird</code>(새처럼 행동하라)를 재사용했다. 이 젬은 <code class=\"language-text\">Bird</code> 를 완벽하게 구현하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Bird</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>많은 새들 가운데서 우리는 올빼미나 벌새도 구현했다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Owl</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Bird</span>\n  <span class=\"token keyword\">def</span> fly\n    puts <span class=\"token string\">\"I'm a flying owl\"</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Hummingbird</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Bird</span>\n  <span class=\"token keyword\">def</span> fly\n    puts <span class=\"token string\">\"I'm a flying hummingbird\"</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>소프트웨어 공학의 참으로 놀라운 부분 아닌가? 글쎄, 이 게임에 엄청난 투자를 했음에도 불구하고 문제가 하나 남아있었다: 제인이 '그러면 펭귄은요?' 라고 물었다. 그렇다, 펭귄은 새지만 날 수 없다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Penguin</span> <span class=\"token operator\">&lt;</span> <span class=\"token constant\">Bird</span>\n  <span class=\"token comment\"># LOL I'm a penguin (ㅋㅋㅋ 난 펭귄인데?)</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>오늘은 게임 발매 당일이고 당신은 버그를 수정하기 위한 여력이 없다. 그래도 발매는 되어야 한다(The show must go on). 그래서 당신은 게임을 발매하고 사용자들이 펭귄을 고르지 않기를 기도할 수 밖에 없다.</p>\n<p>당신은 기분이 별로다. 그리고 자기 자신에게 묻기 시작한다: <em>왜 내가 루비를 골랐지? 왜 동적 타입을 쓴걸까?</em></p>\n<p>제인은 \"당신이 정말 사용해야 했던 것은 타입이 아니라 인터페이스에요.\" 라고 말했다. 당신은 그 말을 듣자마자 \"맙소사, 자바 말인가요!?(OMG, Java!)\"  라고 말했지만, 그녀는 찬찬히 시간을 들여 그 개념은 <a href=\"http://golangtutorials.blogspot.kr/2011/06/interfaces-in-go.html\">Go(GoLang)</a>에서 빌려온 것이라고 설명하였다.</p>\n<blockquote>\n<p>\"루비같이 동적 타입을 가지고 있는 언어에서, 당신이 정말 신경써야 하는 것은 <strong>행동(behavior)</strong>이에요. 당신은 객체에 <em>메세지를 보낼 수 있도록</em> 해야합니다. 그게 객체 지향 프로그래밍의 핵심이에요.\"</p>\n</blockquote>\n<p>그녀는 계속 설명했다: \"타입을 사용하는 것은, 당신이 수행하고자 하는 일보다 과하게 많은 일을 수행하려는 객체를 받아들인다는 것과 같아요. 그리고 그건 <a href=\"https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4_%EB%B6%84%EB%A6%AC_%EC%9B%90%EC%B9%99\">인터페이스 분리 원칙</a>을 무너뜨립니다.\"</p>\n<blockquote>\n<p>\"차이점은 미묘해요: 당신은 <code class=\"language-text\">Bird</code> 클래스가 <code class=\"language-text\">fly</code> 메서드에 반응할 것이라(respond to) 추측했지요. 하지만 언제나 그렇진 않아요. 대신 프로그래밍 언어 측에서<em>(역주: 문맥 상 프로그래머가 작성한 코드를 말하는 것으로 보입니다)</em> 주어진 객체가 특정 메서드(혹은 메서드의 모음)를 구현하고 있는 지 확인하는 도구를 제공해야 합니다.\"</p>\n</blockquote>\n<p>이 시점에서 당신은 충격을 받았다. 당신은 루비가 행동의 모음을 정의할 수 있는 특별한 모듈을 제공했으면 정말 좋겠다고 생각했다<em>(역주: wished라는 동사를 사용했지만 문맥상 희망하다라고 쓰기엔 딱딱해 보입니다)</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">interface <span class=\"token class-name\">Flying</span>\n  <span class=\"token keyword\">def</span> fly\n    puts <span class=\"token string\">\"I'm a flying <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span> name <span class=\"token delimiter tag\">}</span></span>\"</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> name\n    <span class=\"token string\">\"bird\"</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Falcon</span>\n  include <span class=\"token constant\">Flying</span>\n\n  <span class=\"token keyword\">def</span> name\n    <span class=\"token string\">\"falcon\"</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Game</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>bird<span class=\"token punctuation\">:</span> <span class=\"token constant\">Flying</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@bird</span> <span class=\"token operator\">=</span> bird\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> play\n    <span class=\"token variable\">@bird</span><span class=\"token punctuation\">.</span>fly\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>또한 가상머신(VM)이 '펭귄은 날 수 없다' 같은 당황스러운 에러를 내뿜기 전에 당신을 막아주었으면 좋겠다고 생각했다. </p>\n<hr>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>예전에 RORLAB 슬랙의 질문 채널에서 이런 내용의 대화를 주고받은 적이 있습니다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 544px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 87.86764705882352%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACtklEQVQ4y31UuY7UQBScH+Ij+Af4BH6BjJSIhBghIkICMqKVWBEgEaAVYnfYGd/3+BqP7Tk9Ll4949kDFkvtvuu96qruyYezK9hB8QXAy647vjvIt9vtcTweezzw9X3/z8Jv8uLVW3y/tH4lcfgxiuLPURR1tu0giuO+KEssFimSJNE6jCL4QYCqqh4MNIHkstlsUNcNynIJ23Hgul7v+z4cx0UYhrAsG6ZpIRbgLMt0nEEkAakXiOMEXdcNGfIngEcB6GTjsW3bXuhCmPf7vVIH68Oh0zY/9rfbLdcoEOsTZf7quobneQiEjlDWiEJZs2EWy+VS5kKdZ+ZFUSjtOI41U5buTzAFbNu1bhqjjWXss95ud9jtdtpnpvfXnjJ8/uwJvn09h2HaAtxitVqdFg1UB8ABYKg3QpfgYwDWJ8D3b17jx8UFLNtWQQzDUBEM08RsNlMxqLptD8KMQqVpqiKRWZ7nN6J4riWTiZ5RluUyWehiZspzymQxN1XVSl1AFv/z5+Tp40c4P/uE65khXlugLEoFK8WDFOuwEWpCcQygtRQKlsh6CtI0zQ2gbVyrWqZQdEVpUmV7Op2KH114lgNPaHJsPjcGXwp90myaVoPQx7eMrT7U86jLCnmaIRdbcAOz4DhtRAOPlqJ9eAxj1hTvDiDpmZbcBHrN9TXT+XyumSR+KOPRSbDLyyvNnAKxP7riDiDPiuoxGwJ7nq8bCOxSVQHlmO8HcATMkjXMkna5LcjJ2Ov1Gp7roc5KNLEoneYKVhVCK19qoOGWBPpIsLDPILw1fwPKwxDNHSycANOfVwpuGKYWX9oEvxZP0lqOUB/ABgHZ5nmPtBWQaukZ8pkSD6YiDAvVT2kPCiZBmQUNPD4SY1b3ni/oy5GomrFeftY0MSmxzcI2fUdxwjDSPQzC63gb/DfqqlBeKJlTYwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"slack_conversation\"\n        title=\"\"\n        src=\"/static/a13427f93ee2f60a5107ed26df13cfdc/959a9/2016-12-31-sc1.png\"\n        srcset=\"/static/a13427f93ee2f60a5107ed26df13cfdc/5510e/2016-12-31-sc1.png 198w,\n/static/a13427f93ee2f60a5107ed26df13cfdc/f5670/2016-12-31-sc1.png 395w,\n/static/a13427f93ee2f60a5107ed26df13cfdc/959a9/2016-12-31-sc1.png 544w\"\n        sizes=\"(max-width: 544px) 100vw, 544px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>마침 이 글을 읽은 직후라 비유를 <code class=\"language-text\">fly</code> 로 사용했었던 것이 기억나네요. 보통 동적 타입을 사용하는 언어들의 단점으로 여러가지가 거론되지만 '실행하기 전에는 무슨 일이 일어날 지 바로 알 수 없다' 라는 단점을 본 적이 있습니다.</p>\n<p>하지만 본문에서 설명한 개념으로 그런 단점을 최소화하는게 가능하겠지요. 핵심은 프로그래머가 자신의 프로그램이 어떻게 동작할지를 면밀하게 설계할 필요가 있다는 것입니다.</p>\n<p>위 개념을 조금 더 적극적으로 활용하고자 하시는 루비 프로그래머분들은 <a href=\"http://www.aladin.co.kr/shop/wproduct.aspx?ItemId=49317754\">루비로 배우는 객체지향 디자인</a>의 5, 6, 7장을 찬찬히 살펴보시면 많은 도움이 될 것입니다.</p>\n<p>2016년의 마지막 날, 이 글을 읽는 분들에게 조그마한 새해 선물이 되었이 되었으면 좋곘고 새해에도 많은 분들과 더 좋은 내용의 글을 주고받을 수 있도록 개발자로서의 역량을 갈고 닦고 싶습니다 :)</p>","id":"f5449eb2-034d-5058-9ba4-7098ae1d6386","frontmatter":{"date":"2016-12-31","path":"/posts/the-penguin-that-cannot-fly-kor","title":"[번역] 펭귄은 날 수 없다(The Penguin That Can't Fly)","tags":["Ruby","OOP","Translation"],"category":"Translation"}},{"excerpt":"본 포스트는  Luca Guidi의 포스팅을  번역한 글입니다 문제를 설명하는데 나온 하나미(Hanami…","html":"<ul>\n<li><strong>본 포스트는 <a href=\"https://lucaguidi.com/2016/12/27/isolate-global-state.html\">Luca Guidi의 포스팅을</a> 번역한 글입니다</strong></li>\n<li><strong>문제를 설명하는데 나온 하나미(Hanami)에 대해서는 <a href=\"https://emaren84.github.io/blog/archivers/hanami-introduction\">이 포스팅</a>을 참조해주세요</strong></li>\n<li><strong>전문 번역이 아니기에 부족한 표현이나 오역은 언제든지 지적해주세요</strong></li>\n</ul>\n<hr>\n<p>소프트웨어 프로그램에서 전역 상태를 사용하는건 개발하기엔 쉽지만 유지보수 할 때는 악몽이 된다. 예상치 못한 상황에서 발생하여 추적하기도 어려운 버그가 되기 쉽상이다.</p>\n<p>왜 그렇게 되는지, 그리고 어떻게 그 문제를 완화할 수 있을지 살펴보자.</p>\n<p><em>역주: 이 글에서 전역 상태는 전역 변수와 거의 동일한 의미로 사용되는 것으로 추정됩니다.</em></p>\n<h2 id=\"문제의-예시\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%9D%98-%EC%98%88%EC%8B%9C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제의 예시</h2>\n<p>예를 들자면 하나미의 코드 베이스 안에서 우리는 환경 변수에 따라 어떻게 프레임워크가 설정되는지 테스트 할 필요가 있다.</p>\n<p>우리<em>(역주: 하나미 개발팀으로 보입니다)</em>는 보통 테스트를 이런 식으로 작성한다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Environment</span> <span class=\"token keyword\">do</span>\n  before <span class=\"token keyword\">do</span>\n    <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HANAMI_ENV'</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span>\n    <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'RACK_ENV'</span><span class=\"token punctuation\">]</span>    <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span>\n    <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HANAMI_HOST'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span>\n    <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HANAMI_PORT'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span>\n\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n\n  context <span class=\"token string\">\"when HANAMI_ENV is set\"</span> <span class=\"token keyword\">do</span>\n    before <span class=\"token keyword\">do</span>\n      <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HANAMI_ENV'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'production'</span>\n      <span class=\"token variable\">@env</span> <span class=\"token operator\">=</span> described_class<span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span>\n    <span class=\"token class-name\">end</span>\n\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>우리는 보통 각각의 테스트를 실행하기 전에 모든 환경 변수를 초기화해왔다. 그리고 우리가 필요로 하는 특별한 상황(the edge case)에서만 하나씩 설정했다.</p>\n<p>이러한 접근 방식을 사용할 때의 <strong>문제는</strong> 이 방법이 루비 프로세스의 전역 상태를 <strong>더럽힌다는</strong> 것이다. 우리가 테스트 파일을 단독으로 실행할 때는  <code class=\"language-text\">before</code> 블록이 환경 변수를 리셋하기 때문에 잘 작동한다.</p>\n<p>그러나 모든 테스트를 한번에 실행할 때, 테스트는 꼬이게 될 것이다. 환경 변수 초기화가 언제나 작동하진 않기 때문이다.</p>\n<p>만약 한 테스트가 <code class=\"language-text\">ENV</code> 속성을 변환하고 나서 뒷정리를 하지 않으면, 그 다음 테스트는 기존의 <code class=\"language-text\">ENV</code> 값의 변화를 <strong>물려받아서</strong> 우리가 기대하던대로 작동하지 않을 수 있다.</p>\n<p>때때로 위의 예시 처럼 눈에 띄는 부분에서 변화를 준 경우에는 우리가 <code class=\"language-text\">after</code> 블록을 설정하여 뒷정리를 할 수 있다. 그러나 다른 때엔 변환한 것(the mutation)이 우리 눈에 보이지 않는 부분에서 부작용을 초래할 수 있다.</p>\n<p>이건 소스의 버그다. 그리고 이 버그는 엉킨 실타래처럼 되어 디버그하기 힘들다.</p>\n<p><strong>오랜 시간동안, 여러 가지 전역 상태의 조합하는 것은 하나미를 지속적 통합 개발(<a href=\"https://ko.wikipedia.org/wiki/%EC%A7%80%EC%86%8D%EC%A0%81_%ED%86%B5%ED%95%A9\">CI builds</a>)이 힘들도록 만들고 여러 버그를 일으켰다.</strong></p>\n<p>개발자로서의 내 경험으로 미루어보아(<em>역주: Luca Guidi는 숙련된 웹 개발자입니다</em>) 이런 형태의 문제를 완화할 수 있는 유일한 방법은 <strong>전역 상태를 격리하거나, 전역 상태를 사용하는 것을 아예 피하는 것이다.</strong> 우리는 <strong>가능한한 전역 상태를 사용하는 것을 줄이도록</strong> 하나미의 내부 구현을 바꾸고 있다.</p>\n<h2 id=\"문제의-해법\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%9D%98-%ED%95%B4%EB%B2%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제의 해법</h2>\n<p>앞서 이야기한 특별한 경우를 위해 우리는 환경 변수를 격리할 수 있는 새로운 객체를 선보였다. 이는 <code class=\"language-text\">Hanami::Env</code> 라고 불린다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token constant\">Hanami</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Env</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">:</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@env</span> <span class=\"token operator\">=</span> env\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@env</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@env</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>구현 자체는 별 것 아니다: <code class=\"language-text\">ENV</code> 에 접근하는 것을 캡슐화하는 것이다.</p>\n<p>우리는 환경 변수를 관리하기 위해 자체 인터페이스를 정의했다. 우리는 명시적인 구현(concrete implementation)을 사용하기보다(<code class=\"language-text\">ENV</code>) 추상화(<code class=\"language-text\">Hanami::Env</code>)에 의존하고 있다(<a href=\"https://ko.wikipedia.org/wiki/%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84_%EC%97%AD%EC%A0%84_%EC%9B%90%EC%B9%99\">의존관계 역전 원칙 참고</a>). </p>\n<p><code class=\"language-text\">Hanami::Environment</code> 는 프로젝트의 환경 변수를 설정하는 책임을 가지고 있는데, 우리는 이런 방식으로 사용한다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token constant\">Hanami</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Environment</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n      opts <span class=\"token operator\">=</span> options<span class=\"token punctuation\">.</span>to_h<span class=\"token punctuation\">.</span>dup\n      <span class=\"token variable\">@env</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Env</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">:</span> opts<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:env</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\"># ...</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>우리가 하나미 프로젝트를 사용할 때, <code class=\"language-text\">:env</code> 옵션은 설정되지 않은 상태이다. 이로 인해 <code class=\"language-text\">@env</code> 는 <code class=\"language-text\">ENV</code> 를 참조하여 루비 프로세스의 진짜 환경 변수를 읽거나 쓰게 된다.</p>\n<p>이렇게 우리는 <code class=\"language-text\">Hanami::Environment</code> 의 테스트 중에 많은 양의 코드를 단순화하고, <strong>공유되고 변화 가능한 상태(shared mutable state, 즉 <code class=\"language-text\">ENV</code> 말이다)의 사용을 피할 수 있었다.</strong> 아래 코드에서 우리는 <code class=\"language-text\">ENV</code> 와 유사하게 동작하는 <code class=\"language-text\">:env</code> 를 객체의 옵션으로 전달하지만, 이 것은 실제로 <code class=\"language-text\">ENV</code>가 아니다: 그냥 <code class=\"language-text\">Hash</code> 이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">RSpec</span><span class=\"token punctuation\">.</span>describe <span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Environment</span> <span class=\"token keyword\">do</span>\n  context <span class=\"token string\">\"when HANAMI_ENV is set\"</span> <span class=\"token keyword\">do</span>\n    <span class=\"token function\">let</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:env</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">Hash</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"HANAMI_ENV\"</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"production\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n\n    it <span class=\"token string\">\"tests something interesting\"</span>\n      <span class=\"token variable\">@env</span> <span class=\"token operator\">=</span> described_class<span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token comment\"># ...</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2 id=\"결론\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p><a href=\"https://ko.wikipedia.org/wiki/%EC%BA%A1%EC%8A%90%ED%99%94\">캡슐화</a>와 <a href=\"http://solnic.eu/2013/12/17/the-world-needs-another-post-about-dependency-injection-in-ruby.html\">의존성 주입</a>을 적절하게 사용하여, 각각의 테스트에서 발생할 수 있는 변화는 나머지 테스트에서는 보이지 않게 되었다. 결과적으로 안정적인 테스트 수행을 할 수 있게 되었고, 하나미 내부를 <a href=\"https://ko.wikipedia.org/wiki/SOLID\">SOLID 디자인</a>에 맞게 구성할 수 있었다. </p>\n<hr>\n<h2 id=\"번역-후기\"><a href=\"#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번역 후기</h2>\n<p>보통 루비 프로젝트에서 <code class=\"language-text\">dotenv</code> 같은 젬으로 환경 변수를 관리합니다. 사실 이 환경 변수라는 개념도 저에게 아직 모호한 개념이지만, 객체지향 프로그래밍의 핵심적인 주제인 캡슐화와 의존성 주입을 어떤 식으로 활용하는지 좋은 예를 보여준 것 같아 한번 번역해보게 되었습니다.</p>\n<p>특히 제가 요즘에야 테스트를 작성해보기 시작했는데, 테스트를 개별로 실행할 때는 몰라도 전체 테스트를 실행할 때 원인을 알 수 없는 오류가 생길 때가 종종 있었습니다. 이 글을 통해 약간의 힌트를 얻었다는 생각도 듭니다. </p>","id":"7768f4dd-0a21-52f1-8bca-1c77a11d1d3d","frontmatter":{"date":"2016-12-30","path":"/posts/isolate-global-state-kor","title":"[번역] 전역 상태를 격리하라","tags":["Ruby","Hanami","Testing","Translation"],"category":"Translation"}},{"excerpt":"본 포스팅은  루비 대림절 달력 을 위해 제작하였습니다 기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다 작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다 들어가며 아직 갓…","html":"<ul>\n<li><strong>본 포스팅은 <a href=\"http://ruby-korea.github.io/advent-calendar/\">루비 대림절 달력</a>을 위해 제작하였습니다</strong></li>\n<li><strong>기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다</strong></li>\n<li><strong>작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다</strong></li>\n</ul>\n<h2 id=\"들어가며\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가며</h2>\n<p>아직 갓 6개월 된 초보 개발자로서 이제 루비 온 레일즈(이하 레일즈)에 조금씩 익숙해지던 차에, 상사로부터 '하나미라는 프레임워크가 있으니 한번 리서치를 해 보세요' 라는 권유를 받았다. 그는 루비로 백엔드 서버들을 구축했지만 레일즈는 자신의 취향에 맞지 않다고 했고, 구조적으로도 하나미가 더 나아보인다고 이야기하였다.</p>\n<p>그리고 하나미 공식 가이드를 쭉 읽어본 나에게는 혼돈과 절망만 남았다. 루비 뿐 아니라 웹 개발의 기초 지식이 부족해서 그런지 도저히 이게 어떻게 돌아가는건지도 모르겠고, 레일즈에 대입해서 이해할 수 있는 것도 아니라는 생각이 들었다.</p>\n<p>다시 6개월을 다른 레일즈 프로젝트 제작, 리서치 작업을 하며 보내고 나니 회사에서는 본격적으로 레일즈 사용을 하지 않고 하나미를 사용하는 방향으로 가닥을 잡았다. 어쩌다가 레일즈라는 걸출한 웹 프레임워크를 두고 생소한 하나미라는 프레임워크를 사용하게 되었는지, 이번 기회를 통해 독자 분들의 관심을 이끄는 계기를 만들어보고자 한다.</p>\n<h2 id=\"변화가-일고-있는-레일즈-커뮤니티\"><a href=\"#%EB%B3%80%ED%99%94%EA%B0%80-%EC%9D%BC%EA%B3%A0-%EC%9E%88%EB%8A%94-%EB%A0%88%EC%9D%BC%EC%A6%88-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>변화가 일고 있는 레일즈 커뮤니티</h2>\n<p>레일즈는 2005년에 처음 소개 된 이후 빠르고 쉬운 웹 애플리케이션 개발을 위한 도구로써 많은 개발자들의 사랑을 받아왔다.</p>\n<p>'프로그래머의 단짝 친구' 라고 소개할 정도로 쉽고 재미있는 언어인 루비를 기반으로 삼은 프레임워크이기도 하고, 꼭 루비 문법을 모두 꿰고 있어야 할 정도로 많은 지식을 알고 있지 않아도 금방 어지간한 웹 애플리케이션을 제작할 수 있다는 점이 주요 셀링 포인트라고 여겨진다.</p>\n<p>소위 'Rails Magic' 덕분에 form에 변수를 할당하는 것으로 경로 설정이 알아서 되거나 스캐폴딩만 해도 신기하게 돌아가는 애플리케이션을 보며 감탄했던 적이 한두 번이 아니었다.</p>\n<p>2016년 현재 레일즈는 버전 5까지 발매되었고, 더 많은 기능이 구현되어 있으며 커뮤니티는 많이 거대해졌다. 거대해진 레일즈 세계와 함께 그 음영을 느끼는 개발자들도 조금씩 늘어나게 되었다.</p>\n<p>예를 들어 보통 레일즈 애플리케이션을 오래 개발해온 사람들은 애플리케이션의 규모가 커질수록 유지보수하는게 힘들어진다는 점을 지적하고 있는데, 이를 해결하기 위해 <strong>Fat model, Skinny controller</strong> 등의 방법론이 제시되고 있지만 '뭔가 문제가 있다'는 의견들은 끊임없이 제시되고 있다.</p>\n<p>또한 DHH(David Heinemeier Hansson, 레일즈의 창시자)가 제시하고 있는 <a href=\"http://solnic.eu/2016/05/22/my-time-with-rails-is-up.html\">'Rails way'에 반감을 가진 사람들이 점차 늘어나고</a> 루비로 웹 개발을 하는 것에 대해 <a href=\"http://rwdtow.stdout.in/\">더 나은 방법을 찾는</a> 사람들이 점차 늘어나고 있다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 599px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 131.3856427378965%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB3UIJrU3hI5l//8QAGBAAAgMAAAAAAAAAAAAAAAAAAQIQETD/2gAIAQEAAQUCUUuJj//EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAVEAEBAAAAAAAAAAAAAAAAAAABMP/aAAgBAQAGPwIp/8QAGxAAAgIDAQAAAAAAAAAAAAAAABEBECExUWH/2gAIAQEAAT8hROQPwmmMySOtBn//2gAMAwEAAgADAAAAEG/s/P/EABcRAQEBAQAAAAAAAAAAAAAAAAEAERD/2gAIAQMBAT8QcNshz//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/ECn/xAAcEAEAAwACAwAAAAAAAAAAAAABABExIUFRgaH/2gAIAQEAAT8QKnxPkexqDnWFVsRle4kyGxOIQeblOp1N4ryz/9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"현재 레일즈 커뮤니티\"\n        title=\"\"\n        src=\"/static/f0f9a1c45e0435424b34e6518f9574d9/f36a6/2016-12-03-sc1.jpg\"\n        srcset=\"/static/f0f9a1c45e0435424b34e6518f9574d9/28fc4/2016-12-03-sc1.jpg 198w,\n/static/f0f9a1c45e0435424b34e6518f9574d9/44f6c/2016-12-03-sc1.jpg 395w,\n/static/f0f9a1c45e0435424b34e6518f9574d9/f36a6/2016-12-03-sc1.jpg 599w\"\n        sizes=\"(max-width: 599px) 100vw, 599px\"\n      />\n    </span>\n  </span>\n  </p>\n<p><em>현재 레일즈 커뮤니티의 묘사 - 출처: <a href=\"http://railshurts.com/current_state\">http://railshurts.com/current_state</a></em></p>\n<p>이러한 분위기 속에서 'Ruby way, not Rails' 를 표방하는 루비 기반 웹 프레임워크가 등장하였으니, 바로 이번에 소개할 <a href=\"hanamirb.org\">Hanami(하나미)</a>이다.</p>\n<h2 id=\"하나미가-뭐죠\"><a href=\"#%ED%95%98%EB%82%98%EB%AF%B8%EA%B0%80-%EB%AD%90%EC%A3%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하나미가 뭐죠?</h2>\n<p>하나미는 이탈리아의 개발자 <a href=\"https://lucaguidi.com\">Luca Guidi</a> 가 개발한 루비 MVC 웹 프레임워크이다. 2014년에 Lotus라는 이름으로 처음 등장하였으나, IBM의 Louts 상표권과 엮이는 문제가 있어 지금의 이름으로 변경하게 되었다.</p>\n<p>새로운 이름으로 <strong>하나미</strong>라는 이름을 쓰게 된 이유는 '꽃구경' 이라는 일본어 본래의 뜻에 걸맞게 함께 하는 커뮤니티의 중요성을 일깨운다는 점을 강조하기 위해서라고 한다. 루비의 창시자 Matz와(일본인이다) 루비 그 자체에 대한 찬사의 의미도 가지고 있다.</p>\n<p>하나미의 특징을 몇 가지 소개하자면 먼저 최대한 루비라는 언어를 직접적으로 사용하는 방식으로 구현되어 있다는 점이다. 다만 이 때문에 레일즈를 습득하는데 루비 지식이 크게 필요하지 않은 것과 다르게 일정 수준의 루비 언어의 이해를 요구한다.</p>\n<p>또한 Magic을 최대한 배제하고(하나미 Gitter 채팅방에서 혹은 몇몇 포스트에서 \"I'm now sick of rails magic!\" 이라고 주장하는 사람들이 많이 보인다) 개발자가 최대한 자신이 무엇을 하고 있는지 인지하면서 앱을 제작하도록 유도한다.</p>\n<p>그리고 보통 Rails best practice 로 제시되는 요소들을 기본적으로 구현하고 있다.</p>\n<ul>\n<li>컨트롤러는 HTTP 콜만 다룬다 -> 액션에서 비지니스 로직을 분리하여 처리하기 위해 <code class=\"language-text\">Interactor</code> 라는 모듈이 있다</li>\n<li>퍼시스턴스 로직과 도메인 로직을 분리한다 -> 하나미 모델은 기본적으로 도메인과 퍼시스턴스 레이어가 분리되어 있다</li>\n<li>루비 객체를 만들어서 제대로 OOP를 한다 -> 하나미는 OOP 개념을 잘 지키기 위해 노력한다. 또한 모듈화도 굉장히 쉽다</li>\n</ul>\n<p>하나미 가이드 페이지 첫머리에서 제시하는 <a href=\"http://hanamirb.org/guides/#why-choose-hanami-\">'하나미를 선택하는 이유'</a> 를 가볍게 살펴보면 이렇게 말하고 있다.</p>\n<ul>\n<li>하나미는 가볍다 -> 상대적으로 짧은 코드, 웹 애플리케이션 개발에 필요한 필수적인 부분에 초점을 맞춤</li>\n<li>하나미는 구조적으로 건전하다 -> 컨트롤러 액션은 각각의 클래스로 분리되어 있으며 테스트하기 용이하다</li>\n<li>하나미는 스레드에 안전하다 -> (아직 이런 문제를 겪을만한 규모의 앱을 작성해본 적이 없어서 설명하기 어렵다)</li>\n</ul>\n<p>또한 하나미는 컨테이너 형태의 앱 구조를 기본적으로 제공한다. 덕분에 한 개의 프로젝트를 생성하여 API 서버와 웹 서버를 동시에 운용하는게 가능하다. 물론 레일즈로도 비슷한 구성을 할 수야 있겠지만 충돌 없는 구현을 위해 앱의 구조가 훨씬 복잡해질 가능성이 높다.</p>\n<h2 id=\"만들어-볼까요\"><a href=\"#%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%BC%EA%B9%8C%EC%9A%94\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>만들어 볼까요</h2>\n<p>글을 길게 써 보았지만, 개발자들에겐 장황한 글보다 코드 몇 줄을 보는 것이 훨씬 이해가 빠를 것이다. 하나미의 공식 가이드를 따라가면서 눈여겨 볼 점들을 소개하겠다.</p>\n<h3 id=\"bookshelf-프로젝트-생성\"><a href=\"#bookshelf-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookshelf 프로젝트 생성</h3>\n<p>이번에 만들어볼 애플리케이션(이하 앱)은 <code class=\"language-text\">Bookshelf</code> 라는 앱이다. 책의 제목과, 작가가 있고 이 책들의 리스트를 살펴보고 책을 추가할 수 있는 기능을 가지고 있다. 가이드에서 수정과 삭제는 다루고 있지 않아 조금 아쉬운 느낌이 들지만 기본적인 웹 개발(레일즈) 지식이 있다면 구현하는 것이 그렇게 어렵지는 않다.</p>\n<p>기본적으로 루비 버전은 2.3+ 을 권장한다. 또한 데이터베이스는 sqlite3를 사용할 예정이다.</p>\n<p>먼저 하나미로 프로젝트를 생성하기 위해서는 <code class=\"language-text\">gem install hanami</code> 로 하나미가 설치되어 있어야 한다. 그 다음에는 새 프로젝트를 생성해본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ hanami new bookshelf</code></pre></div>\n<p>생성된 프로젝트의 폴더 구조를 살펴보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ tree -L 2\n.\n├── Gemfile\n├── Rakefile\n├── apps\n│   └── web\n├── config\n│   ├── environment.rb\n│   └── initializers\n├── config.ru\n├── db\n│   ├── migrations\n│   └── schema.sql\n├── lib\n│   ├── bookshelf\n│   └── bookshelf.rb\n├── public\n└── spec\n    ├── bookshelf\n    ├── features_helper.rb\n    ├── spec_helper.rb\n    ├── support\n    └── web</code></pre></div>\n<p>여기서 특이한 점은 <code class=\"language-text\">apps</code> 라는 폴더가 있다는 점인데 기본 컨테이너는 <code class=\"language-text\">web</code> 이지만 사용자가 웹 브라우저로 보는 애플리케이션 이외에 같은 데이터베이스를 공유하는 api 서버 등을 따로 만들고자 하면 제네레이터로 따로 컨테이너를 생성할 수 있다. 그러면 같은 데이터베이스 사용하는 별개의 앱을 따로 구축할 수 있다는 장점이 있다. (물론 라우팅은 다르겠지만.. 이 부분은 <code class=\"language-text\">mount</code> 옵션으로 처리할 수 있다) <a href=\"http://hanamirb.org/guides/getting-started/#hanami-architecture\">- 참고</a></p>\n<p>각 앱들에는 별개의 설정 파일, 컨트롤러, 뷰, 라우트, 템플릿 파일 및 폴더가 있다.</p>\n<p>테스트는 사용자가 원하는 어떤 형태로도 이용할 수 있다.(minitest or rspec) 하나미에서는 minitest를 기본으로 사용하며 capybara 젬도 사용한다. 이번 포스팅에서는 테스트를 구현하는 부분은 넘어가고자 한다. 테스팅이 궁금한 분들은 공식 가이드를 참조하시라.</p>\n<h3 id=\"루트-페이지-만들기\"><a href=\"#%EB%A3%A8%ED%8A%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>루트 페이지 만들기</h3>\n<p>라우팅은 각 앱의 <code class=\"language-text\">config/routes.rb</code> 파일에서 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/config/routes.rb</span>\nroot to<span class=\"token punctuation\">:</span> <span class=\"token string\">'home#index'</span></code></pre></div>\n<p>그러면 home 컨트롤러의 index 액션을 실행해주기 위해 제네레이터로 액션을 생성해본다. 아직 하나미는 레일즈처럼 다양하고 세분화된 옵션의 CLI를 제공하진 않는다. 번거롭긴 하지만 개발에 큰 지장은 없다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate action web home#index\n    create  spec/web/controllers/home/index_spec.rb\n    create  apps/web/controllers/home/index.rb\n    create  apps/web/views/home/index.rb\n    create  apps/web/templates/home/index.html.erb\n    create  spec/web/views/home/index_spec.rb\n    insert  apps/web/config/routes.rb</code></pre></div>\n<p><code class=\"language-text\">action</code> 뒤에 있는 <code class=\"language-text\">web</code> 은 액션을 생성하고자 하는 컨테이너의 이름이다. 그 다음에 컨트롤러와 액션 이름을 적어주면 된다. 앱 구조가 단독 컨테이너 구조일 경우(<code class=\"language-text\">hanami new</code> 커맨드로 앱 생성시 <code class=\"language-text\">--arch=app</code> 옵션을 주어 단독 컨테이너 앱 생성도 가능하다)에는 바로 액션 이름만 작성해주어도 된다.</p>\n<p>아쉬운 점은 매 액션마다 저 명령어를 작성해주어야 한다는 점이다. <code class=\"language-text\">hanami-scaffold</code> 라는 젬이 있지만 그닥 유지보수는 되지 않고 있어서 사용하는 것을 추천하지 않는다.</p>\n<p>컨트롤러는 폴더에 불과하며 그 폴더에 속한 각각의 액션 파일에 컨트롤러가 정의되어 있는 형태이다. 또한 뷰는 템플릿 파일(레일즈의 views 폴더 안에 있는 템플릿들)과 뷰 파일(레일즈에 비유하자면 뷰 헬퍼와 비슷)로 구성되어있다. 지금은 템플릿 파일에 간단하게 제목을 추가해보도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"># apps/web/templates/home/index.html.erb\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Bookshelf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><em>(주의) 템플릿 파일이 변경될 때에는 서버를 재실행할 필요가 없지만, 컨트롤러 등의 루비 파일이 변경될 때에는 서버를 재실행해야 한다.</em></p>\n<p>그리고 서버를 실행한 뒤 <code class=\"language-text\">localhost:2300</code> 으로 접속해보면 심플하지만 Bookshelf라는 글씨가 보이는 페이지를 마주할 수 있다.\n(본 포스트에서는 빠른 진행을 위해 <code class=\"language-text\">application.html.erb</code> 파일을 미리 수정해두었다)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami server</code></pre></div>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 358px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 74.58100558659218%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y81R32tSYRg+/8tyumBjEkxd5TKZRRlHnU70HM/x1/RibmArF5UXDRbtz/CmwfyVJ4i6qP6CdhEEbRmIO4pCA9F25Y+n93xk0MVawS468PB+7/c97/M833c446QeNuMlzC1chsGkw8WpafCORVgXbLhy1Yo5kxkms+UX5jTQ3njfbJmHTj+FC5MGTOj04Cwk6DLPw87fhOHaBBxWGyrZDFKrq0gmE3A6neB5Hi6XCy6qbrf7N4iiSMJmTM/MkLAB3G0i3aAh+3U77tziEQgEEBRExGIxhmQigXg8DkmSEA6HIQgC44wRDAbh9/vJkAw8HnAyEaVQCB6PG4IoQJZkJpDJZLC5mcEDQjqdprRJrKXWEIlEWCpZlplJiGa1tWYejUbBabG1RiIhLQEjiSEskUE0FodIabWhYCCI5WUfVihxJBKFz+dFIpEk8xUK44Fxdhb2RQe4fD6PcrmMUqkMRVGolqh/gVKxiEpFQZGqdlYsFNhZ5SenQL2ivGTr/N4ecrkcnu/ugsM5f5x6VMeH/X30ej2cnHzHwcEhvh0fo/rlEEeqik6ng/fv3qJa/coG+v0+BoPBqeDevH6FJa8Xz3Z28PjRQ6TvbiCbzWLryRY27t3H9vZTrKdS+PjpMxMcDIcYjUangut2u2g0GgQV9XodzWYTtVoNqtpAq9WiqqLdblOyARPUhv545X95n7PEmKBGGtI1zsJY7FwT/tVf/u8FfwCkJLVg24iPyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Bookshelf Title\"\n        title=\"\"\n        src=\"/static/3a065f050faf7e4f996a919b015fb34b/8524e/2016-12-03-sc2.png\"\n        srcset=\"/static/3a065f050faf7e4f996a919b015fb34b/dc079/2016-12-03-sc2.png 198w,\n/static/3a065f050faf7e4f996a919b015fb34b/8524e/2016-12-03-sc2.png 358w\"\n        sizes=\"(max-width: 358px) 100vw, 358px\"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id=\"모델-구축하기\"><a href=\"#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 구축하기</h3>\n<p>본격적으로 책들을 저장하고 출력하기 위해 데이터베이스 마이그레이션을 진행해 보도록 한다. 먼저 마이그레이션 파일을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate migration create_books</code></pre></div>\n<p>생성된 마이그레이션 파일은 이렇게 작성해 보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># db/migrations/20161203083239_create_books.rb</span>\n<span class=\"token constant\">Hanami</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Model</span><span class=\"token punctuation\">.</span>migration <span class=\"token keyword\">do</span>\n  change <span class=\"token keyword\">do</span>\n    create_table <span class=\"token symbol\">:books</span> <span class=\"token keyword\">do</span>\n      primary_key <span class=\"token symbol\">:id</span>\n\n      column <span class=\"token symbol\">:title</span><span class=\"token punctuation\">,</span>  <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:author</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n\n      column <span class=\"token symbol\">:created_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n      column <span class=\"token symbol\">:updated_at</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DateTime</span><span class=\"token punctuation\">,</span> null<span class=\"token punctuation\">:</span> <span class=\"token keyword\">false</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">primary_key</code> 가 반드시 <code class=\"language-text\">id</code> 일 필요는 없다. 또한 <code class=\"language-text\">String</code>, <code class=\"language-text\">DateTime</code> 은 루비 타입이다(루비 클래스). 반드시 루비 타입을 사용할 필요는 없고 <code class=\"language-text\">&quot;varchar(255)&quot;</code> 같이 데이터베이스 타입을 문자열로 직접 작성해주어도 된다.</p>\n<p>마이그레이션 파일 작성이 완료되면 테이블을 생성해주는 명령어를 입력한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami db prepare\n$ bundle exec hanami db migrate</code></pre></div>\n<p>그리고 <code class=\"language-text\">Book</code> 모델을 생성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate model book\n      create  lib/bookshelf/entities/book.rb\n      create  lib/bookshelf/repositories/book_repository.rb\n      create  spec/bookshelf/entities/book_spec.rb\n      create  spec/bookshelf/repositories/book_repository_spec.rb</code></pre></div>\n<p>생성된 파일을 보면 조금 특이한 점을 볼 수 있는데 <code class=\"language-text\">entities</code> 폴더와 <code class=\"language-text\">repositories</code> 폴더가 따로 나뉘어져 있다는 점이다. <code class=\"language-text\">Entity</code> 는 도메인 객체로, 실제 데이터베이스 쿼리 등으로 추출된 자료 객체를 일컫는다. <code class=\"language-text\">Repository</code> 는 퍼시스턴스 계층과 <code class=\"language-text\">Entity</code> 를 이어주는 역할을 한다. 여기서 <code class=\"language-text\">Entity</code> 는 데이터베이스의 존재를 전혀 모르는 단순 루비 객체이며 테스트가 용이하고 가벼운 앱을 만드는데 도움이 된다.</p>\n<p>실제 콘솔에서 레코드를 다루어보면 이런 방식으로 동작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami console\n&gt;&gt; repo = BookRepository.new\n=&gt; #&lt;BookRepository:... &gt;\n&gt;&gt; repo.all\n=&gt; []\n&gt;&gt; book = repo.create(title: &#39;TDD&#39;, author: &#39;Kent Beck&#39;)\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;\n&gt;&gt; repo.find(book.id)\n=&gt; #&lt;Book:... @attribute={:id =&gt; 1, :title =&gt; &quot;TDD&quot;, :author =&gt; &quot;Kent Beck&quot; ... }&gt;</code></pre></div>\n<p><code class=\"language-text\">Repository</code> (이하 리퍼지토리)에서 제공되는 메서드로 데이터베이스에 <code class=\"language-text\">Entity</code> (이하 엔티티)를 조작할 수 있고, 엔티티에는 따로 속성 혹은 동작을 지정할 수 있다. 그래서 레일즈에서 사용하는 <code class=\"language-text\">scope</code> 나 커스텀 쿼리가 작성된 메서드 등은 리퍼지토리 클래스에 분리해 둘 수 있다.</p>\n<h3 id=\"데이터를-표현하기\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터를 표현하기</h3>\n<p>임의로 몇 개의 <code class=\"language-text\">Book</code> 레코드를 생성해주고 리스트를 표현해보기 위해 새 컨트롤러 액션을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami generate action web books#index</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"># apps/web/templates/books/index.html.erb\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>All books<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\n&lt;% if books.any? %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>books<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    &lt;% books.each do |book| %>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>book<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>&lt;%= book.title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>&lt;%= book.author %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    &lt;% end %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n&lt;% else %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>placeholder<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>There are no books yet.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n&lt;% end %></code></pre></div>\n<p>여기서 <code class=\"language-text\">books</code> 는 어디서 온 것일까? 실제로 액션 부분은 이렇게 작성되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/controllers/books/index.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Index</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    expose <span class=\"token symbol\">:books</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@books</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span>all\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">expose</code> 메서드의 사용은 하나미의 규칙으로, <code class=\"language-text\">expose</code> 로 지정한 변수만 템플릿으로 노출되며 그 변수는 <code class=\"language-text\">call</code> 메서드 안에 인스턴스 변수로 존재해야 한다.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 385px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 128.05194805194807%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAAC+0lEQVRIx61U/UtTURi+f0vq0n7oA0Q2P5L8ojLEocxtd03nvpztw2V/QBqmmRpYRjgrrIku06kUBEFQ6IhyZaap6Nb6oURJ3Jyi4rane44oaubHtQsP59z3nPc5z3PP+14mXnAc6fFCJKQJEXUmCqkJIkguZeNcRiYys7KQlp4BUWLSrkhMSkbM8ThEC2JxLFpAwYji4pCdeBYpF1MRkyCAuUCKxnIL9KVGWMwm6PU65IpzIRaLtyEvLw8KBQuhUISTp05DEHuCkjN5Egmyc3JwPusCLrNKyFg5dHo9R6SHwWBAaWkpnWs0GmjUGjoWFxdDJpNBLpeDVSjoSCCVysAolUoUKguRn59PTyQbCYHFYoHVaoXJaFwn42AoKYFWq4VarYZKpQLJZVkWEk4Uy+WqVAowZKGszAqj0QSz2QzjFSN0Wh10Oi2NEcuGEgOKioroISYuRubl5ddgMlug4AiTk1MglxbgqsUAxuPxYHJykmJqaoqCxDbiXq8XPp+Pvm9d2zone9ZjHjD4zw/T2+NEVdVNdHY50dXpwN2m++h29qCmuhp9vb2or2vAg2Yb3by2toZwOLwnGLd7EHa7HTbbQzja29DheIb2Dgfa7E/R43Si83k3Bt2fKCFJiEQieys8qBVCdiDLq6ur+D03h5mZGSwvL2NlZQWBQICOhCQUCm2SEXX7KnQN9KO27g4e2ZrRbGtBa+sTNDTUo+/Fy79s7ke2qXBhYQGLi0HMz89z8NPR7/cfWNU2QnJzxNZuz2GINgnHvo2iueUxrlfewPjEBA2SA7baPJTCVe7j//w1jbHxcc724jZlvBTuTNp6o7w6xcv1oGvAhaGhL3j7rh8jI6OI8LC6rbA3EkOh8JHsUsIgVzLT09OY44qbYHZ2FgEuxvsbvne5cKumBvW3a9F0rxGVFRV49frNodpt114mpbL+Nwlt1iUvhUtLS7RTSP/6/QFq90iEP3zf4Xa7MfR5CMPDX/Hh4yCCwSB/wn8t8L7ljXrbCb6kfwBgoxYXcTdGKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Bookshelf list\"\n        title=\"\"\n        src=\"/static/58eb0336ccd6468d50eb76c6d049377e/3fe9a/2016-12-03-sc3.png\"\n        srcset=\"/static/58eb0336ccd6468d50eb76c6d049377e/54c53/2016-12-03-sc3.png 198w,\n/static/58eb0336ccd6468d50eb76c6d049377e/3fe9a/2016-12-03-sc3.png 385w\"\n        sizes=\"(max-width: 385px) 100vw, 385px\"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id=\"새로운-책을-등록하기\"><a href=\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%B1%85%EC%9D%84-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>새로운 책을 등록하기</h3>\n<p>웹 페이지에서 새로운 책을 등록하기 위해서는 <code class=\"language-text\">new</code>, <code class=\"language-text\">create</code> 액션과 패러매터를 전달해 줄 <code class=\"language-text\">Form</code> 이 필요할 것이다. 먼저 <code class=\"language-text\">books#new</code>, <code class=\"language-text\">books#create</code> 액션을 생성해 준 뒤에 라우팅을 조금 깔끔하게 다듬어주도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/config/routes.rb</span>\nroot to<span class=\"token punctuation\">:</span> <span class=\"token string\">'home#index'</span>\nresources <span class=\"token symbol\">:books</span><span class=\"token punctuation\">,</span> only<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token symbol\">:index</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:new</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:create</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>하나미는 REST를 기본적으로 지원한다. 2번째 줄에서 사용 된 <code class=\"language-text\">resources</code> 는 보통 레일즈 라우트 파일에서 자주 보았던 그 <code class=\"language-text\">resources</code> 메서드처럼 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ bundle exec hanami routes\n        Name Method     Path           Action\n\n        root GET, HEAD  /              Web::Controllers::Home::Index\n       books GET, HEAD  /books         Web::Controllers::Books::Index\n    new_book GET, HEAD  /books/new     Web::Controllers::Books::New\n       books POST       /books         Web::Controllers::Books::Create</code></pre></div>\n<p>다음은 <code class=\"language-text\">new</code> 템플릿에 폼 헬퍼(Form helper) 를 이용하여 간단한 폼을 작성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"># apps/web/templates/books/new.html.erb\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Add book<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\n&lt;%=\n  form_for :book, routes.books_path do\n    div class: 'input' do\n      label      :title\n      text_field :title\n    end\n\n    div class: 'input' do\n      label      :author\n      text_field :author\n    end\n\n    div class: 'controls' do\n      submit 'Create Book'\n    end\n  end\n%></code></pre></div>\n<p>폼 헬퍼의 구조가 레일즈의 <code class=\"language-text\">form_for</code> 헬퍼와는 사뭇 다르다. 간단하게 차이점을 이야기하자면 하나미의 <code class=\"language-text\">form_for</code> 는 레일즈의 <code class=\"language-text\">form_tag</code> 헬퍼에 가깝다고 생각하면 된다. <a href=\"http://hanamirb.org/guides/helpers/forms/#technical-notes\">하나미 가이드에 따르면</a> <code class=\"language-text\">form_for do |f|</code> 형식으로 작성하는 것은 올바른 ERB 템플릿이 아니며, 하나미의 폼 헬퍼는 템플릿 엔진에 의존하지 않고 사용할 수 있도록(어느 템플릿 엔진을 사용하던 같은 루비 코드를 사용하도록) 구성되어 있다.</p>\n<p><code class=\"language-text\">routes.books_path</code> 는 라우팅 헬퍼이며 상기 라우팅 구조에 있는 이름을 사용하여 <code class=\"language-text\">routes</code> 뒤에 메서드 형식으로 붙여주면 자동으로 경로를 연결해준다.</p>\n<p>책을 생성하기 위한 <code class=\"language-text\">create</code> 액션은 다음과 같이 작성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/controllers/books/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    expose <span class=\"token symbol\">:book</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">@book</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:book</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n      redirect_to routes<span class=\"token punctuation\">.</span>books_path\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>이후 생성된 폼에 새로운 책을 등록해보니 문제없이 책이 생성되었다.</p>\n<h3 id=\"유효성-검사\"><a href=\"#%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%82%AC\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유효성 검사</h3>\n<p>하나미는 유효성 검사를 모델이 아닌 컨트롤러 액션에서 처리한다. 물론 엔티티 클래스에 유효성 검사를 정의할 수 있지만, 유효성 검사는 입력 이후 가장 가까운 단계에서 이루어질 것을 권장하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/controllers/books/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Controllers</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Action</span>\n\n    expose <span class=\"token symbol\">:book</span>\n\n    params <span class=\"token keyword\">do</span>\n      <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:book</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>schema <span class=\"token keyword\">do</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:title</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:author</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filled</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">:str?</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> params<span class=\"token punctuation\">.</span>valid<span class=\"token operator\">?</span>\n        <span class=\"token variable\">@book</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookRepository</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:book</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n        redirect_to routes<span class=\"token punctuation\">.</span>books_path\n      <span class=\"token keyword\">else</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token number\">422</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">params</code> 로 시작하는 유효성 검사는 엔티티를 정의해놓은 것 같은 역할을 할 수 있겠다. 자세한 내용은 <a href=\"http://hanamirb.org/guides/actions/parameters/\">가이드</a>를 참고하면 손쉽게 작성할 수 있다.</p>\n<p>만약 패러매터가 유효하지 않다면 HTTP 상태 코드 422(Unprocessable Entity)를 리턴하고, 그에 알맞는 뷰를 다시 표현해 주어야 한다. 현재 <code class=\"language-text\">create</code> 액션에는 아무런 템플릿도 작성되어있지 않고, 실제로는 <code class=\"language-text\">new</code> 템플릿을 그대로 사용하면 되기 때문에 뷰 파일에 알맞는 템플릿을 정의해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># apps/web/views/books/create.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Views</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Books</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Create</span>\n    include <span class=\"token constant\">Web</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">View</span>\n    template <span class=\"token string\">'books/new'</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>지금까지 하나미를 통해 간단한 웹 애플리케이션을 개발하는 과정을 살펴보았다. 아주 기초적인 부분만 설명하였지만, 가이드를 살펴보고 하나미의 기능에 조금 더 익숙해진 뒤에는 github에 올라와 있는 몇몇 프로젝트 소스를 살펴보면서 하나미를 파악해보는 것을 추천한다.</p>\n<p>개인적으로 <a href=\"https://github.com/bruz/bookshelf-delivery-example\">이 Github 저장소</a>를 방문해 보는 것을 추천한다. 하나미의 컨테이너 구조 및 컨트롤러 액션과 비지니스 로직을 구분하는 예를 잘 보여준 코드로 구성되어있다.(<code class=\"language-text\">lib</code> 폴더 안에 있는 <code class=\"language-text\">interactors</code> 폴더에 주목하라)</p>\n<p>본 포스팅에 사용된 코드는 <a href=\"https://github.com/emaren84/hanami-introduction\">여기서</a> 확인해 볼 수 있다.</p>\n<h2 id=\"결론\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>루비는 일반적 용도의 언어로써 충분히 완성도가 있는 언어이지만 상대적으로 다양한 분야에서 사용되는 파이썬에 비해 어느샌가 웹 개발에만 쓰이는 언어라는 선입견이 심어지게 되었다. 그리고 이러한 선입견의 중심엔 레일즈가 있다.</p>\n<p>레일즈가 등장하고 루비라는 언어가 크게 알려지는 데 기여한 것은 사실이다. 하지만 이 세상에 특정 문제 해결을 위한 단 하나의 정답은 거의 없다. 루비라는 언어 자체도 하나의 문제를 해결 하는데 다양한 방법을 제시하는 언어이기도 하다.</p>\n<p>하나미의 등장도 이런 맥락에서 바라볼 수 있다. 단순히 레일즈만이 루비로 웹 애플리케이션을 만드는 최고의 방법이 아니며, 하나미를 잘 활용하면 레일즈에 비해 유지보수가 쉽고, 더 성능이 좋은 웹 애플리케이션을 작성할 수도 있을 것이다.</p>\n<p>물론 하나미는 나온지 얼마 되지 않은 프레임워크이고, 기능 구현이 레일즈에 비해 상대적으로 부족한 점도 있다. <strong>특히 문서화가 되어있지 않아 소스 코드를 이리저리 살펴보아야 하는 부분들이 아직 많이 있다는 점이 아쉽다.</strong> 하지만 충분한 발전 가능성을 지니고 있고, 진정 루비라는 언어로 프로그래밍을 하는 재미를 주는 것이 매력적이기 때문에 루비 언어 자체를 좋아하는 사람들이라면 한번 사용해 볼 것을 추천한다.</p>\n<p>하나미의 정보를 더 얻고자 하는 분들에게는 다음의 링크를 살펴보면 된다.</p>\n<ul>\n<li><a href=\"http://hanamirb.org/guides/\">하나미 공식 가이드</a> + <a href=\"https://github.com/hanami/hanami\">소스 코드</a></li>\n<li><a href=\"https://gitter.im/hanami/chat\">하나미 Gitter 채팅방</a></li>\n<li><a href=\"https://github.com/davydovanton/awesome-hanami\">유용한 젬 및 링크 공유</a></li>\n</ul>","id":"a7345024-efcc-5fef-8ba1-d12b3b0b1959","frontmatter":{"date":"2016-12-03","path":"/posts/hanami-introduction","title":"레일즈(Ruby on Rails)와는 또 다른 루비 웹 프레임워크, Hanami(하나미)","tags":["Ruby","Rails","Hanami"],"category":"Hanami"}},{"excerpt":"Beginning of the Heonchek-hunter…","html":"<h2 id=\"beginning-of-the-heonchek-hunter\"><a href=\"#beginning-of-the-heonchek-hunter\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Beginning of the Heonchek-hunter</h2>\n<p>예전에 레일즈로 <strong>헌책 헌터</strong> 라는 이름의 웹앱을 한번 만들어 본 적이 있다.</p>\n<p>알라딘 중고서점에 원하는 책의 재고가 있는지 알아보고 해당 매장으로 가고 싶은데 일일이 매장을 하나하나 잡아서 검색해야하는게 너무 불편했었기 때문이다.</p>\n<p>잉여력이 넘치던 시절에는 서울 어지간한 지역에는 마음만 먹으면 방문할 수 있었기 때문에 꽤 유용한 아이디어라고 생각했는데, 지금은 딱히 그러기가 힘들다. 그래도 여러 개 매장의 중고책 재고를 검색하는데는 꽤 요긴하다는 생각이 든다.</p>\n<p>구현 원리는 생각보다 단순했지만 귀찮은 과정이었다. 알라딘 중고서점 검색 url은 하나만 제공되는데, 어떤 매장의 책을 검색하는지 구분하는 방법은 클라이언트가 가지고 있는 쿠키(cookie) 정보이다. 먼저 신촌점 페이지를 방문한 뒤에 검색을 하면 신촌점의 검색 결과가 나오고, 종로점 페이지를 방문한 뒤에 검색을 하면 종로점 검색 결과가 나오는 형식이다.</p>\n<p>다만 이 문제로 단순히 요청을 하고 결과를 받아오는 형식의 웹 크롤링을 해 주는 <code class=\"language-text\">nokogiri</code> 젬은 쓸 수가 없었다. 이런저런 조사를 해 본 결과 <a href=\"https://github.com/sparklemotion/mechanize\"><code class=\"language-text\">mechanize</code></a> 젬이 웹사이트에 대한 자동 상호작용(automatic interaction)을 지원한다는 것을 발견하여 임의의 <code class=\"language-text\">Mechanize</code> 객체가 가상으로 각 매장을 방문한 뒤에 책을 검색하고, 결과를 파싱해와서 html 페이지에 출력하는 방식의 구현에 성공했었다.</p>\n<h2 id=\"why-not-rails\"><a href=\"#why-not-rails\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why not Rails?</h2>\n<p>여러가지 자잘한 문제가 있었지만, 일단 돌아가는 애플리케이션을 만들어서 쓰다 보니 조금 아쉽게 생각되는 점들이 있었다. 처음에야 가장 익숙한 웹 애플리케이션을 제작할 수 있는 도구인 레일즈로 제작을 하였지만, 여러 가지 이유에서 이 프로젝트를 제작하는데는 레일즈를 쓸 필요가 없었다.</p>\n<ol>\n<li><code class=\"language-text\">rails new myapp</code> 를 입력하고 엔터를 치는 순간 나는 굳이 쓸 필요가 없는 파일들이 무더기로 생성된다. 미관상 마음에 들지 않는다.</li>\n<li>(지금 수준의 애플리케이션에는 차이가 크게 느껴지지 않겠지만) 레일즈는 다른 가벼운 웹 프레임워크에 비해 무겁다.</li>\n<li>DB가 필요없는 애플리케이션임에 불구하고 앱을 실행하기 위해서는 반드시 DB를 준비해야 한다. (Sqlite 등)</li>\n</ol>\n<p>제일 크게 느껴지는 문제는 1번 이었는데, 각종 컨트롤러 파일, 헬퍼 파일 등 나는 굳이 쓸 필요가 없는 파일들이 기본적으로 저장소에 자리잡고 있는게 마음에 들지 않았다.</p>\n<p>그리고 서울 지역 알라딘 중고매장 페이지를 모두 방문하고 정보를 긁어와야 하는 앱 구조상 동작이 꽤 느린데, 혹시나 더 가볍게 앱을 제작하면 속도가 더 빨라지지 않을까 하는 막연한 기대가 있었다.</p>\n<p>그래서 처음에는 요즘 야금야금 공부하고 있는 Node.js(노드) 로 크롤링 앱을 작성해볼까 했는데, 쿠키를 들고 리퀘스트를 보내는 등의 여러가지 시도를 하였음에도 불구하고 자꾸 결과가 나오지 않아 포기 상태이다. 루비에 비하면 월등히 빠른 처리 속도를 가지고 있는 노드를 활용해보려 했지만(싱글 스레드라는 단점이 있어도) 자꾸 500에러를 내뿜으니.. 나중에 다시 시도해보고자 한다.</p>\n<p>그래서 기존에 레일즈용으로 작성했던 로직을 가져와 또 다른 루비 웹 프레임워크인 시나트라로 다시 한번 더 나은 버전의 헌책 헌터를 구현해보기로 하였다.</p>\n<h2 id=\"what-is-sinatra\"><a href=\"#what-is-sinatra\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Sinatra?</h2>\n<blockquote>\n<p>Sinatra is a <a href=\"https://en.wikipedia.org/wiki/Domain-specific_language\">DSL</a> for quickly creating web applications in Ruby with minimal effort</p>\n</blockquote>\n<p>시나트라는 최소한의 노력으로 루비 기반 웹 애플리케이션을 신속하게 작성하기 위한 DSL이다.</p>\n<p>특히 Node.js 의 웹 프레임워크로 유명한 Express 에 영감을 준 것으로 잘 알려져 있다. 파이썬의 Flask와도 비슷하다는데 파이썬을 제대로 써 보지 않아서 모르겠다.</p>\n<p>Rack(루비 기반 웹 애플리케이션 개발을 위한 인터페이스 제공, Rack자체로도 웹 애플리케이션 개발은 가능하다) 기반으로 작성되어 있으며 흔히 생각하는 MVC 패턴을 구현한 웹 프레임워크는 아니다.</p>\n<p>RESTful 라우팅과 다양한 템플릿을 지원하고, 유저가 어느정도 직접 구현하면 레일즈로 만든 애플리케이션 부럽지 않은 웹 애플리케이션 제작이 가능하다. 보통 레일즈가 더 유명하고 편해서 그렇지.. 그렇지만 순수한 루비를 이용하는 느낌이 더 강해서 이쪽이 더 마음에 든다.</p>\n<p>데이터베이스와 연결하고자 하면 보통 ActiveRecord(그 레일즈의 ActiveRecord 맞다) 를 불러와 쓰거나, DataMapper 라는 젬을 이용한다고 한다.</p>\n<p>시나트라로 간단하게 Hello World를 출력하는 앱을 만든다면 한개의 파일, 약 4줄짜리 코드면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># myapp.rb</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'sinatra'</span>\n\nget <span class=\"token string\">'/'</span> <span class=\"token keyword\">do</span>\n  <span class=\"token string\">'Hello world!'</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>당연 그 전에 시나트라 젬은 설치되어 있어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Install sinatra gem\n$ gem install sinatra\n\n# Launch the application\n$ ruby myapp.rb  # View at http://localhost:4567</code></pre></div>\n<h2 id=\"how-to-improve\"><a href=\"#how-to-improve\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to improve?</h2>\n<p>그럼 이 시나트라를 이용하여 어떻게 기존에 작성한 애플리케이션을 재구성할 수 있을까? 기존에 작성한 소스는 그냥 정적 페이지로만 구성하였다. <code class=\"language-text\">index</code> 액션에서 검색어를 입력받고 <code class=\"language-text\">search</code> 같은 액션에 패러미터를 보내어 검색 후 결과가 나오면 <code class=\"language-text\">result</code> 페이지에서 출력해주는 방식이다.</p>\n<p>어차피 검색하고 결과를 출력하기만 하면 되는데 페이지 여러개를 만들 필요는 딱히 없겠다는 생각이 들었다. 그래서 이번에는</p>\n<ul>\n<li>컨트롤러와 검색 로직의 분리</li>\n<li>AJAX 통신으로 초기 페이지에서 결과 부분만 따로 랜더링</li>\n</ul>\n<p>이 두 가지 포인트를 우선적으로 구현하는 것을 목표로 애플리케이션을 제작해 보았다. Single Page Application이라고 AngularJS 등의 거창한 자바스크립트 프레임워크를 쓸 수준은 아니기에 단순히 jQuery AJAX로 구현할 예정이다.</p>\n<h2 id=\"work-with-sinatra\"><a href=\"#work-with-sinatra\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Work with Sinatra</h2>\n<p>시나트라는 <code class=\"language-text\">rails new</code> 같이 편리한 CLI(Command Line Interface) 가 없다. 정말 위에 적은대로 루비파일 하나만으로도 만들 수 있을 정도이다. 조금 검색을 해 보니 따로 정립된 프로젝트의 형태는 없지만, 배포를 염두에 둔다면 시나트라 애플리케이션 구동 설정을 하는데 <code class=\"language-text\">config.ru</code> 파일을 작성하길 권장하고 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># config.ru</span>\n<span class=\"token keyword\">require</span> <span class=\"token string\">'./app'</span>\nrun <span class=\"token constant\">Sinatra</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Application</span></code></pre></div>\n<p>그리고 <code class=\"language-text\">rackup</code> 커맨드로 애플리케이션을 실행시킨다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ rackup -p 4000</code></pre></div>\n<p>기본으로 설정된 애셋 파일은 <code class=\"language-text\">/public</code> 폴더에, 뷰 파일을 <code class=\"language-text\">/views</code> 파일에 랜더링된다고 적혀있으니 컨트롤러인 <code class=\"language-text\">app.rb</code> 파일은 루트에 두고 필요한 폴더를 작성하고 자바스크립트와 CSS 파일은 <code class=\"language-text\">public</code> 폴더에, ERB파일은 <code class=\"language-text\">views</code> 폴더에 작성하였다.</p>\n<h3 id=\"controller\"><a href=\"#controller\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller</h3>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'sinatra'</span>\nrequire_relative <span class=\"token string\">'./lib/book_search'</span>\n\nget <span class=\"token string\">'/'</span> <span class=\"token keyword\">do</span>\n  erb <span class=\"token symbol\">:index</span>\n<span class=\"token keyword\">end</span>\n\nget <span class=\"token string\">'/search'</span> <span class=\"token keyword\">do</span>\n  book_title <span class=\"token operator\">=</span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:title</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token variable\">@results</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookSearch</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>book_title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>search\n  erb <span class=\"token symbol\">:result</span><span class=\"token punctuation\">,</span> locals<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> results<span class=\"token punctuation\">:</span> <span class=\"token variable\">@results</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>검색을 위한 클래스를 따로 작성하여 <code class=\"language-text\">/lib</code> 폴더에 저장해두었다. 지금은 기존에 레일즈용으로 작성했던 로직을 거의 그대로 사용한 클래스인데, 여러가지 면에서 개선할 점들이 많다.</p>\n<p><code class=\"language-text\">erb</code> 로 템플릿을 지정하고 심볼로 파일 이름을 지정하면 해당 이름의 템플릿을 찾아서 html 파일로 랜더링한다. 굳이 <code class=\"language-text\">index.html.erb</code> 같은 이름이 아닌 <code class=\"language-text\">index.erb</code> 로 작성하여도 잘 작동하는게 신기했다. 또한 이 부분은 나중에 <code class=\"language-text\">result.erb</code> 파일에도 중요한 포인트로 작용한다.</p>\n<p><code class=\"language-text\">locals</code> 옵션은 레일즈의 <code class=\"language-text\">render partial</code> 이후 지역변수를 삽입해주는 것과 비슷하게 작용한 것 처럼 보여서 사용해보았다. 사실 굳이 쓰지 않고 그냥 <code class=\"language-text\">@results</code> 를 그대로 사용해도 별 문제 없어 보인다.</p>\n<h3 id=\"searching-books\"><a href=\"#searching-books\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Searching Books</h3>\n<p>맨 처음 레일즈용으로 앱을 작성할 당시에는 컨트롤러에 프라이빗 메서드 하나 작성해 두고 거기다 모든 과정을 다 처리했었다. 처음엔 '나중에 리팩터링 하면 되지' 하고 생각했지만 이렇게 아예 새로 만드는 방향까지 와 버렸다.</p>\n<p><code class=\"language-text\">BookSearch</code> 라는 클래스를 하나 정의하여 거기에 매장 리스트, 매장 방문 URI, 검색 URI 등을 상수로 지정해 두고 시작하는 형태이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>book_title<span class=\"token punctuation\">)</span>\n  <span class=\"token variable\">@book_title</span> <span class=\"token operator\">=</span> book_title<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'euc-kr'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token variable\">@agent</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Mechanize</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span>\n  <span class=\"token variable\">@result</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>인자로 받는 <code class=\"language-text\">book_title</code> 은 인코딩을 반드시 바꾸어 주어야 한다. 알라딘 홈페이지는 EUC-KR 인코딩을 사용하기 때문이다. 국내 사이트는 정말 어쩔수가 없는건지.. <code class=\"language-text\">@agent</code> 는 알라딘 서버와 연결 상호작용을 수행할 <code class=\"language-text\">mechanize</code> 젬의 객체이다. 기존에는 매 검색마다 객체를 생성하도록 코드를 작성했었는데 전혀 그럴 필요가 없다는걸 뒤늦게 깨달았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># ...</span>\n<span class=\"token keyword\">def</span> search\n  <span class=\"token constant\">STORE_LISTS</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>store_code<span class=\"token punctuation\">,</span> store_name<span class=\"token operator\">|</span>\n    <span class=\"token comment\"># 개별 매장 검색 시작</span>\n    search_results <span class=\"token operator\">=</span> <span class=\"token function\">get_books</span><span class=\"token punctuation\">(</span>store_code<span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@result</span><span class=\"token punctuation\">[</span>store_name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">serialize_info</span><span class=\"token punctuation\">(</span>search_results<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token variable\">@result</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">private</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>store_url<span class=\"token punctuation\">)</span>\n  store_index <span class=\"token operator\">=</span> <span class=\"token variable\">@agent</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>store_url<span class=\"token punctuation\">)</span>\n  store_form <span class=\"token operator\">=</span> store_index<span class=\"token punctuation\">.</span><span class=\"token function\">form</span><span class=\"token punctuation\">(</span><span class=\"token string\">'QuickSearch'</span><span class=\"token punctuation\">)</span>\n  store_form<span class=\"token punctuation\">[</span><span class=\"token string\">'SearchWord'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">@book_title</span>\n\n  query_result <span class=\"token operator\">=</span> <span class=\"token variable\">@agent</span><span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span>store_form<span class=\"token punctuation\">)</span>\n  query_result<span class=\"token punctuation\">.</span>encoding <span class=\"token operator\">=</span> <span class=\"token string\">'EUC-KR'</span>\n\n  query_result\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_books</span><span class=\"token punctuation\">(</span>store_code<span class=\"token punctuation\">)</span>\n  store_url <span class=\"token operator\">=</span> <span class=\"token constant\">URI</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STORE_URI</span> <span class=\"token operator\">+</span> store_code<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>store_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div.ss_book_box'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">serialize_info</span><span class=\"token punctuation\">(</span>search_results<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\"># 검색 결과가 있다면 검색 시작, 아니면 빈 배열 입력</span>\n  <span class=\"token keyword\">return</span> search_results <span class=\"token keyword\">if</span> search_results<span class=\"token punctuation\">.</span>empty<span class=\"token operator\">?</span>\n\n  <span class=\"token comment\"># 매장별 결과는 배열로 리턴 (각 배열의 요소는 해쉬)</span>\n  search_results<span class=\"token punctuation\">.</span>map <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>book<span class=\"token operator\">|</span>\n    book_info<span class=\"token punctuation\">,</span> price_info <span class=\"token operator\">=</span> book<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div.ss_book_list'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.</span><span class=\"token number\">.1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># Pattern matching</span>\n\n    title <span class=\"token operator\">=</span> book_info<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a.bo_l b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    sub_title <span class=\"token operator\">=</span> book_info<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span.ss_f_g2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n\n    author_list <span class=\"token operator\">=</span> book_info<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ul > li'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' | '</span><span class=\"token punctuation\">)</span>\n\n    author<span class=\"token punctuation\">,</span> publisher<span class=\"token punctuation\">,</span> pub_date <span class=\"token operator\">=</span> author_list<span class=\"token punctuation\">[</span><span class=\"token number\">0.</span><span class=\"token number\">.2</span><span class=\"token punctuation\">]</span>\n\n    price <span class=\"token operator\">=</span> price_info<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span.ss_p2 b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text\n    stock <span class=\"token operator\">=</span> price_info<span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span.ss_p4 b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n\n    <span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span>\n      sub_title<span class=\"token punctuation\">:</span> sub_title<span class=\"token punctuation\">,</span>\n      author<span class=\"token punctuation\">:</span> author<span class=\"token punctuation\">,</span>\n      publisher<span class=\"token punctuation\">:</span> publisher<span class=\"token punctuation\">,</span>\n      pub_date<span class=\"token punctuation\">:</span> pub_date<span class=\"token punctuation\">,</span>\n      price<span class=\"token punctuation\">:</span> price<span class=\"token punctuation\">,</span>\n      stock<span class=\"token punctuation\">:</span> stock\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p><code class=\"language-text\">query</code> 메서드는 생성한 에이전트로 중고매장 각 지점을 임의로 방문한 뒤에 생성된 쿠키를 들고 책을 검색하는 역할을 수행한다. 초반부에 서술했듯이 검색을 할 때 매장이름을 패러미터로 받는 것이 아니라 요청한 클라이언트가 들고있는 쿠키로 어느 매장의 책을 찾고자 하는지 조회하기 때문이다.</p>\n<p>중요한 점은 여기서도 출력된 결과물을 EUC-KR 인코딩으로 바꾸어주어야 한다는 것이다.</p>\n<p><code class=\"language-text\">get_books</code> 는 각 매장 코드와 매장명을 가지고 있는 해시로 반복문을 돌 때 <code class=\"language-text\">query</code> 메서드를 매번 다른 매장명으로 실행시키고 그 결과를 출력하는 부분을 담당한다. <code class=\"language-text\">css</code> 는 <code class=\"language-text\">nokogiri</code> 젬에서 지원하는 메서드로 파싱한 결과를 말 그대로 css 선택자처럼 사용하여 결과를 가져올 수 있도록 만든다. 선택자로 선택된 DOM들은 <code class=\"language-text\">nokogiri</code>의 객체가 담긴 배열로 리턴된다. (nokogiri 젬은 웹 크롤링에 사용되는 대표적인 루비 젬이며 <code class=\"language-text\">mechanize</code> 젬과 의존관계를 형성하고 있다.)</p>\n<p>그리고 이를 이용하여 <code class=\"language-text\">serialize_info</code> 메서드를 실행하여 원하는 결과를 출력하는 방식이다. 각각 어떤 결과를 가져와야 하는지는 알라딘 검색을 직접 해 보고 크롬의 개발자 도구로 html 코드를 뒤져 찾아내었다.</p>\n<p>변수 할당에 패턴 매칭이 들어간 점도 눈여겨 볼 수 있다. 배열의 요소 하나하나를 변수에 할당한다고 한줄씩 코드를 작성하는 것 보다 배열의 범위와 그에 맞는 개수의 변수를 할당해주어 여러 줄로 작성할 코드를 손쉽게 한 줄로 줄일 수 있었다.</p>\n<h3 id=\"views\"><a href=\"#views\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Views</h3>\n<p>뷰 파일들은 레일즈로 작성할 때 <code class=\"language-text\">html.erb</code> 템플릿과 크게 차이는 없었다. 단순히 <code class=\"language-text\">erb</code>  확장자만 넣어도 그대로 작동한다는 것만 빼면 컨트롤러 부분에서 보다시피 어떤 인자를 가져올 것인지 주입할 수도 있고, 템플릿을 바꾼다던지 할 수도 있다. 다만 내가 여지껏 깨닫지 못했던 흥미로운 요소가 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// public/script/app.js</span>\n<span class=\"token comment\">// ...</span>\n  $<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/search'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">:</span> bookTitle <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    $dimmer<span class=\"token punctuation\">.</span><span class=\"token function\">dimmer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hide'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>indexPage <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.ui.main.text.container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$result_partial<span class=\"token punctuation\">.</span><span class=\"token function\">hasClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result_container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      $result_partial<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result_container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    $result_partial<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $result_partial<span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token string\">'slide down in'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>다음은 내가 책 검색을 비동기로 처리하기 위해 작성했던 AJAX 호출이다. 함수 자체야 별거 없는데 성공 후의 콜백에서 <code class=\"language-text\">$result_partial.html(data);</code> 부분이 핵심이다. 저 <code class=\"language-text\">data</code> 인자는 컨트롤러에서 어떤 방식으로 전달되었을까?</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># app.rb</span>\n<span class=\"token comment\"># ...</span>\nget <span class=\"token string\">'/search'</span> <span class=\"token keyword\">do</span>\n  book_title <span class=\"token operator\">=</span> params<span class=\"token punctuation\">[</span><span class=\"token symbol\">:title</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token variable\">@results</span> <span class=\"token operator\">=</span> <span class=\"token constant\">BookSearch</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>book_title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>search\n  erb <span class=\"token symbol\">:result</span><span class=\"token punctuation\">,</span> locals<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> results<span class=\"token punctuation\">:</span> <span class=\"token variable\">@results</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>액션 실행 후 리턴은 erb로 한다고 작성되어 있다. 말인 즉슨 랜더링 처리가 다 된 erb 파일을 콜백 함수의 <code class=\"language-text\">data</code> 인자로 전달한다는 것이다. 보통 레일즈에서 작성했다면 <code class=\"language-text\">respond_to</code> 메서드로 어떤 포맷에 반응하여 출력할지를 지정해주어야 했을 텐데, 오히려 그런 면에서 신경 쓸 필요가 전혀 없었다. 랜더링된 <code class=\"language-text\">result.erb</code> 는 그냥 html 코드 덩어리나 다름없겠다는 생각에 jQuery의 <code class=\"language-text\">html()</code> 함수에 넣어보았다. 아주 잘 작동하였다.</p>\n<p>여지껏 'Rails way' 로 작성한 AJAX 호출에 익숙해져 있다 보니 이런 방식으로 결과를 출력할 수 있다는게 새삼 새롭게 느껴졌다.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>이번에는 아주 간단한 기능 위주로 작성해본 것지만, <a href=\"http://hanamirb.org\">하나미</a> 를 시작으로 점점 레일즈를 벗어나 루비로 웹 애플리케이션을 작성하는데 익숙해지고, 더 재미를 느끼고 있다.</p>\n<p>앱 특성상 레일즈와 비교하여 검색 결과를 출력하는 속도가 압도적으로 빠르다고 느끼진 못했다. 아마 일반적인 형태의 홈페이지로 비교한다면 조금 다른 결과가 나올지도 모르겠다.</p>\n<p>특히 지금처럼 모든 웹 애플리케이션이 데이터베이스(혹은 모델)을 필요로 하는 것은 아니다. 이런 경우에는 레일즈보단 시나트라로 작성하는게 더 나아 보인다.</p>\n<p>앞으로도 더 복잡한 애플리케이션을 쉽게 잘 작성해보고 싶다. 공부해야할 것들이 너무나 많지만, 지금은 자바스크립트 위주의 공부부터 차근차근 도전중이다.</p>\n<p><strong>Source Code</strong>: <a href=\"https://github.com/emaren84/heoncheck-hunter-sinatra\">https://github.com/emaren84/heoncheck-hunter-sinatra</a></p>","id":"c045993c-c945-5fad-8e75-6b53b148f16a","frontmatter":{"date":"2016-11-21","path":"/posts/simple-spa-application-with-sinatra","title":"시나트라(Sinatra)로 간단한 Single Page Application(SPA) 제작해 보기","tags":["Ruby","Sinatra"],"category":"Ruby"}}],"tagName":"Ruby"}}