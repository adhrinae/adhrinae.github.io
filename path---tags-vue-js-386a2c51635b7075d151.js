webpackJsonp([96212511153696],{490:function(n,s){n.exports={pathContext:{postsByTag:[{excerpt:"Hanamirb + Vue.js 시리즈 목차 API 서버 로그인 & 회원가입 페이지 가계부 페이지 로그인 페이지를 만드는데도 꽤 많은 노력이 들었지만, 기존에 사용하시던 방법으로 같은 페이지를 작성한다고 했을 때 얼마나 시간과 노력이 드는지 한번 생각해보시면 Vue.js…",html:'<p><strong>Hanamirb + Vue.js 시리즈 목차</strong></p>\n<ol>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-api-server">API 서버</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-1">로그인 &#x26; 회원가입 페이지</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-2">가계부 페이지</a></p>\n</li>\n</ol>\n<hr>\n<p>로그인 페이지를 만드는데도 꽤 많은 노력이 들었지만, 기존에 사용하시던 방법으로 같은 페이지를 작성한다고 했을 때 얼마나 시간과 노력이 드는지 한번 생각해보시면 Vue.js로 구현하는 쪽이 약간 쉽지 않으셨는지요?</p>\n<p>가계부 페이지 구현은 로그인 페이지보다 내용이 약간 길어지겠지만 여전히 그렇게 어려운 난이도는 아닙니다. 비슷한 페이지를 예전에 React로 만들어 본 적이 있었는데 지금 생각해보면 코드를 따라 쳐 봤을 뿐이지 실질적인 내용은 거의 이해가 되지 않았네요. <strong>참고로 이 글의 내용이 이해가 잘 되지 않으시면 언제든지 질문 및 지적 부탁드립니다.</strong></p>\n<p>처음에 API서버를 만들 때 구상해 두었던 요소들보다 조금 축소되긴 했지만 다음의 기능을 구현해볼 예정입니다. 혹시나 아쉽다고 느끼시는 분들은 직접 구현에 도전해보시는 것도 좋은 배움의 기회가 될 수 있겠네요.</p>\n<ul>\n<li>Amount, Description 을 입력하여 기록</li>\n<li>최신 시간 순서대로 내용을 표로 출력</li>\n<li>\n<p>Edit, Delete 버튼을 눌러서 자료의 수정 및 삭제</p>\n<ul>\n<li>Edit 버튼을 누르면 해당 레코드의 내용이 자동으로 수정 Form으로 변화</li>\n</ul>\n</li>\n<li>모든 수익, 지출과 그 합계를 모아 상단에 대시보드 형식으로 표시</li>\n</ul>\n<p>기존 방식대로 레일즈나 하나미로 웹 애플리케이션을 만들었을 때는 모든 값을 서버에서 미리 계산해두고, 랜더링된 값을 클라이언트로 전달해주면 클라이언트는 받은 페이지를 불러오는 정도의 역할을 수행했었습니다. 하지만 자바스크립트를 적극적으로 활용하면 서버에서는 레코드만 던져주고, 브라우저에서 랜더링에 필요한 값을 계산하여 출력해 줄 수 있게 됩니다.</p>\n<h2 id="페이지-틀-만들기"><a href="#%ED%8E%98%EC%9D%B4%EC%A7%80-%ED%8B%80-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>페이지 틀 만들기</h2>\n<p>먼저 Vue 인스턴스와 연결할 HTML 페이지를 만들겠습니다. 파일 이름은 <code class="language-text">content.html</code> 이며, 이전에 만들었던 페이지와 같은 폴더에 위치해야 합니다. 불러와야 하는 자바스크립트 라이브러리가 하나 변경된 수준입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.1/axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.0/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>MoneyBook<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token comment">&lt;!-- ... --></span></code></pre>\n      </div>\n<p><code class="language-text">moment</code> 라이브러리는 자바스크립트에서 시간을 다루는 데 필요한 최고의 라이브러리입니다. 현재 서버에 자료를 저장할 때 각 레코드의 <code class="language-text">created_at</code>, <code class="language-text">updated_at</code> 이 UTC 기준으로 저장되어 있는데, 서버에서 이 시간을 변경해서 보내주기보다 클라이언트에서 직접 시간대를 변경하여 알맞은 형식으로 표현하는 것 까지 처리할 것입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">\n<span class="token selector">html, body</span> <span class="token punctuation">{</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token property">background-color</span><span class="token punctuation">:</span> #E6E6E6<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">#app</span> <span class="token punctuation">{</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n  <span class="token property">margin</span><span class="token punctuation">:</span> 1.5rem 0<span class="token punctuation">;</span>\n  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.title</span> <span class="token punctuation">{</span>\n  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.message:not(:last-child)</span> <span class="token punctuation">{</span>\n  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.message-body</span> <span class="token punctuation">{</span>\n  <span class="token property">font-weight</span><span class="token punctuation">:</span> 600<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.button</span> <span class="token punctuation">{</span>\n  <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.income</span> <span class="token punctuation">{</span>\n  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.outcome</span> <span class="token punctuation">{</span>\n  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>columns is-mobile<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column is-10 is-offset-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token comment">&lt;!--title--></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title is-2 is-spaced<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Your Records<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n      <span class="token comment">&lt;!--input form--></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field has-addons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>amount<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Amount<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control is-expanded<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Description<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-primary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n      <span class="token comment">&lt;!--dashboard--></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>columns<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message is-success<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Income<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message is-danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Outcome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message is-info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Total<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n      <span class="token comment">&lt;!--contents--></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Record Time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Amount<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-light<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>단순히 입력 태그가 맨 윗쪽에 있고, 대시보드, 테이블 순으로 자료가 표시되는 구조입니다. 이 안에 어떻게 내용을 채워나가게 될 지 기대해주세요.</p>\n<h2 id="인증-및-자료-가져오기"><a href="#%EC%9D%B8%EC%A6%9D-%EB%B0%8F-%EC%9E%90%EB%A3%8C-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>인증 및 자료 가져오기</h2>\n<p>지난번 로그인 페이지를 만들 때 로그인이 성공하면 JWT 토큰을 저장하고, 이 <code class="language-text">content.html</code> 페이지로 이동하도록 만들어 두었습니다. 그러면 당연하게도 <code class="language-text">content.html</code> 페이지를 이용할 수 있는 사람은 유효한 토큰을 가지고 있는 사람이어야 합니다.</p>\n<p>페이지가 처음 랜더링 될 때 무언가 행동을 지시하려면 Vue 인스턴스에 <code class="language-text">created</code> 를 지정하면 됩니다. Vue 인스턴스의 라이프사이클을 더 자세히 보시려면 <a href="https://kr.vuejs.org/v2/guide/instance.html#%EB%9D%BC%EC%9D%B4%ED%94%84%EC%82%AC%EC%9D%B4%ED%81%B4-%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8">다음 가이드</a>를 참고해주세요.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  el<span class="token punctuation">:</span> <span class="token string">\'#app\'</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    records<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">\'auth_token\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">\'./login.html\'</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>인스턴스가 만들어질 때 토큰을 가져오고, 만약 해당 토큰이 없다고 하면 로그인 페이지로 되돌립니다. <code class="language-text">fetchData</code> 는 바로 아래에 구현할 메서드인데, 여기서도 만약 유효하지 않은 토큰이라고 판명되면 로그인 페이지로 되돌립니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ...</span>\nmethods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token function">fetchData</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'get\'</span><span class="token punctuation">,</span>\n      url<span class="token punctuation">:</span> <span class="token string">\'http://localhost:2300/api/records\'</span><span class="token punctuation">,</span>\n      headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>records <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>records<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>ersponse<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">\'auth_token\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">\'./login.html\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// handle error</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// ...</span></code></pre>\n      </div>\n<p>토큰이 있다면 <code class="language-text">fetchData</code> 메서드로 토큰을 실어 서버에 요청을 보내게 됩니다. 이미 API 서버를 만들 때 유효하지 않은 토큰이라면 401에러를 리턴하도록 만들어두었기 때문에, 그냥 로그인 페이지로 돌려버리면 됩니다. 만에 하나 다른 에러가 출력된다면 여러분들이 편한 방법대로 에러를 다루면 될 것입니다.</p>\n<p>잘 작동하는지 테스트하실 때는 하나미 API 서버를 미리 켜두시는 것을 잊지 마시기 바랍니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami server</code></pre>\n      </div>\n<p>당장은 저장된 자료가 없기 때문에 POSTMAN으로 일일이 요청을 보내어 자료를 생성할 수 밖에 없을겁니다. 그냥 하나미 콘솔에서 임의의 자료를 몇 개 생성해두록 하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami console\n-------------------------\n[2] pry(main)&gt; 15.times do\n[2] pry(main)*   RecordRepository.new.create(\n[2] pry(main)*     user_id: 5, // Your favorite user id\n[2] pry(main)*     amount: [-1000, -5000, 5000, 1000, 10000].sample,\n[2] pry(main)*     description: %w(FUS RO DAH).sample\n[2] pry(main)*   )\n[2] pry(main)* end</code></pre>\n      </div>\n<p>이제 랜더링 된 후에 브라우저 콘솔에서 <code class="language-text">app.records</code> 명령어를 입력해보시면 가져온 자료들이 배열로 표시됩니다.</p>\n<h2 id="대시보드-표시하기"><a href="#%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C-%ED%91%9C%EC%8B%9C%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>대시보드 표시하기</h2>\n<p>대시보드에 쓰일 자료를 자바스크립트로 계산하여 표시해주는 작업은 <code class="language-text">computed</code> 속성에 정의해두면 됩니다. <code class="language-text">data</code> 들을 다루어 계산된 결과를 리턴해주고, 만약 값의 변화가 있다면 바로 반영됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function">sumOfIncome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>record <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> record<span class="token punctuation">.</span>amount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> income<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> sum <span class="token operator">+</span> income<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n    <span class="token function">sumOfOutcome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>record <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> record<span class="token punctuation">.</span>amount <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> outcome<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> sum <span class="token operator">+</span> outcome<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n    <span class="token function">totalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> record<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> sum <span class="token operator">+</span> record<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>수입과 지출을 표시해주는 함수는 <code class="language-text">records</code> 배열에서 각각 0보다 크거나 작은 수를 추린 뒤에 모든 수를 합치고, 전체 합계를 표시해주는 함수는 그냥 더해주기만 하면 됩니다. <code class="language-text">filter</code>, <code class="language-text">map</code> 등에 바로 이어 <code class="language-text">reduce</code> 를 활용해주는 방법은 여러모로 유용하게 사용할 수 있습니다.</p>\n<p>이 계산된 값을 바로 HTML 태그 안에 <code class="language-text">{{ }}</code> 로 감싸주어 입력해주시면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token comment">&lt;!--dashboard--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>columns<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message is-success<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Income<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        {{ sumOfIncome }}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message is-danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Outcome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        {{ sumOfOutcome }}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message is-info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Total<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        {{ totalAmount }}\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<h2 id="전체-자료-표로-표시하기"><a href="#%EC%A0%84%EC%B2%B4-%EC%9E%90%EB%A3%8C-%ED%91%9C%EB%A1%9C-%ED%91%9C%EC%8B%9C%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>전체 자료 표로 표시하기</h2>\n<p>API 서버에 요청하여 가져온 자료를 바로 쓰는데는 몇 가지 문제가 있습니다.</p>\n<ol>\n<li>오래된 자료가 먼저 나옵니다. 보통은 최신 순서로 정렬을 하게 되지요.</li>\n<li>시간 표시가 UTC인데다가, 바로 표시하기 어려운 형식으로 나옵니다.</li>\n</ol>\n<p>그러면 우리는 자료 표시 순서를 뒤집어주고, 시간 표시를 더 깔끔하게 해 주면 되겠네요. 여기서도 <code class="language-text">computed</code> 를 활용합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ...</span>\ncomputed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token function">allRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>record <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> createdAt <span class="token operator">=</span> record<span class="token punctuation">.</span>created_at<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\sUTC$/</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">let</span> localCreatedAt <span class="token operator">=</span> moment<span class="token punctuation">.</span><span class="token function">utc</span><span class="token punctuation">(</span>createdAt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">\'YYYY-MM-DD HH:mm:ss\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> <span class="token punctuation">{</span>\n        id<span class="token punctuation">:</span> record<span class="token punctuation">.</span>id<span class="token punctuation">,</span>\n        amount<span class="token punctuation">:</span> record<span class="token punctuation">.</span>amount<span class="token punctuation">,</span>\n        description<span class="token punctuation">:</span> record<span class="token punctuation">.</span>description<span class="token punctuation">,</span>\n        created_at<span class="token punctuation">:</span> localCreatedAt\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token comment">// ...</span></code></pre>\n      </div>\n<p><code class="language-text">records</code> 배열의 순서를 뒤집어주고, 시간대를 다시 지정한 뒤에 원하는 포맷으로 출력하도록 만들었습니다. 이렇게 변환된 배열을 <code class="language-text">v-for</code> 로 반복 출력해주면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token comment">&lt;!--contents--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Record Time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Amount<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record in allRecords<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{ record.created_at }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{\n          income: record.amount > 0,\n          outcome: record.amount &lt; 0\n        }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n          {{ record.amount }}\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{ record.description }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-light<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>파이썬의 <code class="language-text">for..in</code> 문법과 비슷하게 생각하시면 됩니다<em>(이 사람은 파이썬을 써 본적이 없다)</em>. <code class="language-text">allRecords</code> 배열에 있는 각각의 <code class="language-text">record</code> 를 사용하여 템플릿을 랜더링하게 됩니다.</p>\n<p>한 가지 살펴보실 점은 수입과 지출을 구분하기 위해 사용한 <code class="language-text">:class</code> 입니다. <code class="language-text">v-bind:class</code> 와 같은 의미인데, 해당 HTML 속성을 Vue 인스턴스와 묶어둔다는 의미입니다. 자세한 내용은 <a href="https://kr.vuejs.org/v2/guide/class-and-style.html">가이드</a>를 참고하시기 바랍니다.</p>\n<p>보통은 <code class="language-text">data</code>, <code class="language-text">computed</code> 에 객체를 정의해두고 <code class="language-text">:class</code> 로 불러와서 해당 객체의 값이 true이면 표시하고, false이면 표시하지 않는 형태로 되어있는데, 반복문에서는 어떻게 활용해야할지 잘 몰라서 저렇게 직접 입력했습니다. 레코드의 값이 0 이상이면 income 클래스가 활성화되고, 0 이하이면 outcome 클래스가 활성화됩니다.</p>\n<p>여기까지 하셨다면 절반은 오신겁니다. 나머지는 자료의 입력, 수정 및 삭제를 구현하면 됩니다.</p>\n<p><img src="/2017-05-02-sc1-b6b1e472327780813fa5b39517e5a316.gif"></p>\n<h2 id="지출-및-수입-기록하기"><a href="#%EC%A7%80%EC%B6%9C-%EB%B0%8F-%EC%88%98%EC%9E%85-%EA%B8%B0%EB%A1%9D%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>지출 및 수입 기록하기</h2>\n<p>지난번 로그인 Form과 같은 형태로 Form이라는 클래스를 따로 만들겠습니다. 클래스 내부는 이전에 로그인 페이지 만들었던 때와 거의 동일합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>originalData <span class="token operator">=</span> data<span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originalData<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      data<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> data<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> record<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">\'auth_token\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'post\'</span><span class="token punctuation">,</span>\n      url<span class="token punctuation">:</span> <span class="token string">\'http://localhost:2300/api/records\'</span><span class="token punctuation">,</span>\n      data<span class="token punctuation">:</span> data<span class="token punctuation">,</span>\n      headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">{</span>\n      app<span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// handle errors</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  el<span class="token punctuation">:</span> <span class="token string">\'#app\'</span><span class="token punctuation">,</span>\n\n  data<span class="token punctuation">:</span><span class="token punctuation">{</span>\n    records<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    insertForm<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      amount<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n      description<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p><code class="language-text">create</code> 메서드가 호출될 때 저장되어있던 토큰을 가져와서 요청할 때 헤더에 실어보내게 됩니다. 요청이 성공했을 때 돌아온 데이터는 우리가 레코드 저장용으로 지정해두었던 <code class="language-text">records</code> 배열에다 추가해주면 됩니다. (혹시나 해서 말씀드리지만 <code class="language-text">app.records</code> 는 아래부분에 만들어놓은 Vue 인스턴스의 <code class="language-text">this.records</code> 와 같은 의미입니다.) 그 다음에 배열에 변화를 감지한 뷰 인스턴스는 <code class="language-text">computed</code> 에 지정해두었던 <code class="language-text">allRecords</code> 의 계산을 다시 하게 됩니다. 변경을 감지하는 배열 메서드 및 그 활용법은 <a href="https://kr.vuejs.org/v2/guide/list.html#%EB%B0%B0%EC%97%B4-%EB%B3%80%EA%B2%BD-%EA%B0%90%EC%A7%80">가이드</a>를 참고하시기 바랍니다.</p>\n<p>나머지는 저장 버튼을 누를 때 <code class="language-text">Form#create</code> 함수가 실행되도록 만들면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token comment">&lt;!--input form--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field has-addons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insertForm.amount<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Amount<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control is-expanded<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insertForm.description<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Description<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insertRecord<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    <span class="token function">insertRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>insertForm<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<h2 id="기록-변경하기"><a href="#%EA%B8%B0%EB%A1%9D-%EB%B3%80%EA%B2%BD%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>기록 변경하기</h2>\n<p>너무나 당연하겠지만 우리가 작성한 기록은 수정할 수 있어야합니다. Edit 버튼을 누르면 기존의 자료가 표시되던 테이블 행이 Input 폼으로 변하게 만들 예정입니다.</p>\n<p><img src="/2017-05-02-sc2-94166b4983ac54195b522a7b106b82ad.gif"></p>\n<p>여기까지 튜토리얼을 진행해보셨다면 Amount, Description 표시 부분에 <code class="language-text">v-if</code>, <code class="language-text">v-else</code> 를 이용하면 되지 않을까? 하고 생각하실 수 있을겁니다. 지금처럼 작은 규모의 프로젝트에는 매 <code class="language-text">td</code> 태그마다 조건에 따라 레이아웃이 변하게 만드는 일이 그렇게 어렵지 않지요. 그런데 너무 줄이 길어져서 가독성도 떨어지고, 아예 <code class="language-text">tr</code> 태그의 레이아웃이 통채로 달라지게 만들 예정이라면? 그럴 땐 컴포넌트를 도입하면 됩니다.</p>\n<h3 id="컴포넌트-추출하기"><a href="#%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%B6%94%EC%B6%9C%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>컴포넌트 추출하기</h3>\n<p>리액트를 조금이라도 해 보셨던 분이라면 아시겠지만, 리액트는 JSX로 DOM을 생성하고, 계층화된 컴포넌트의 조합으로 하나의 앱을 만드는게 가능합니다. Vue.js도 컴포넌트를 지원합니다. 보통은 노드 프로젝트로 Vue 프로젝트를 만들 때 많이 쓰게 되는데, 일반적인 자바스크립트에도 충분히 컴포넌트를 만들 수 있습니다.</p>\n<p>HTML 부분에 너무 코드가 많아지면 가독성이 떨어진다고 생각하고, 앞으로 한 부분에서 두 개의 컴포넌트가 나오도록 만들 예정이기 때문에 지금 사용자 레코드를 보여주는 부분을 컴포넌트로 분리해보겠습니다. 우리가 <code class="language-text">v-for</code> 문 바로 아래에 만들었던 <code class="language-text">tr</code> 태그 부분을 통채로 복사하시면 됩니다.</p>\n<p><code class="language-text">Form</code> 클래스 바로 아래에 새로운 변수를 선언합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> RecordRow <span class="token operator">=</span> <span class="token punctuation">{</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'record\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`\n    &lt;tr>\n      &lt;td>{{ record.created_at }}&lt;/td>\n      &lt;td :class="{\n        income: record.amount > 0,\n        outcome: record.amount &lt; 0\n      }">\n        {{ record.amount }}\n      &lt;/td>\n      &lt;td>{{ record.description }}&lt;/td>\n      &lt;td>\n        &lt;button class="button is-danger">Delete&lt;/button>\n        &lt;button class="button is-light">Edit&lt;/button>\n      &lt;/td>\n    &lt;/tr>\n  `</span></span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p><code class="language-text">template</code> 속성은 이 컴포넌트가 어떤 형태의 HTML 태그를 가지고 있는지 나타냅니다. 그리고 <code class="language-text">props</code> 는 부모 컴포넌트에서 자식 컴포넌트로 내려보내는 속성입니다. 여기서는 기존에 쓰던대로 <code class="language-text">record</code> 를 속성으로 가져왔고, 이 속성을 그대로 활용하고 있습니다.</p>\n<p>컴포넌트를 만들었으면 사용할 수 있도록 장착하고, HTML 파일에 선언해주어야 합니다. 먼저 Vue 인스턴스에 <code class="language-text">components</code> 속성을 정의합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">\'record-row\'</span><span class="token punctuation">:</span> RecordRow\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>이제 우리는 HTML 파일에 <code class="language-text">record-row</code> 라는 이름으로 태그를 선언하여 컴포넌트를 사용할 수 있습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record in allRecords<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record-row</span> <span class="token attr-name">:record</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record-row</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p><code class="language-text">:record</code> 는 <code class="language-text">v-bind:record</code> 의 약어입니다. 해당 속성을 이렇게 컴포넌트에 지정해주면 컴포넌트에서 <code class="language-text">record</code> 라는 이름의 속성을 사용할 수 있는겁니다. 다른 이름을 사용하고자 하면 <code class="language-text">:somethingElse</code> 같이 다른 이름을 넣고, 컴포넌트의 <code class="language-text">props</code> 속성에도 다른 이름을 넣어주고 사용하시면 됩니다. 아직까지 이 컴포넌트는 기존에 HTML에 작성해둔 코드와 똑같은 일을 수행합니다.</p>\n<h3 id="edit-버튼으로-토글하기"><a href="#edit-%EB%B2%84%ED%8A%BC%EC%9C%BC%EB%A1%9C-%ED%86%A0%EA%B8%80%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Edit 버튼으로 토글하기</h3>\n<p>일단 Edit 버튼을 누르면 테이블 행 자체가 바뀌도록 만드는 기능부터 구현해보겠습니다. 토글 버튼을 누르면서 일어나는 과정을 순서대로 나열해보자면 다음과 같습니다.</p>\n<ol>\n<li>토글 버튼 클릭</li>\n<li>해당 행의 자료가 \'수정 가능한 상태(isEditMode or isEditable)\' 로 변경</li>\n<li>변경된 자료를 배열에 반영</li>\n<li>배열이 수정되면서 변경된 부분만 Vue.js 가 알아서 새로 랜더링</li>\n</ol>\n<p>우리가 처음에 <code class="language-text">records</code> 배열을 만들 당시에는 수정 가능한 상태를 표시하는 속성이 없었으니 이 속성을 먼저 추가하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Vue instance</span>\ncomputed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token function">allRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      id<span class="token punctuation">:</span> record<span class="token punctuation">.</span>id<span class="token punctuation">,</span>\n      amount<span class="token punctuation">:</span> record<span class="token punctuation">.</span>amount<span class="token punctuation">,</span>\n      description<span class="token punctuation">:</span> record<span class="token punctuation">.</span>description<span class="token punctuation">,</span>\n      created_at<span class="token punctuation">:</span> localCreatedAt<span class="token punctuation">,</span>\n      isEditMode<span class="token punctuation">:</span> record<span class="token punctuation">.</span>isEditMode\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token comment">// ...</span>\nmethods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token function">fetchData</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>records <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>record <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assgin</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">{</span> isEditMode<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>처음에 <code class="language-text">fetchData</code> 메서드로 레코드를 가져올 때 각 레코드마다 <code class="language-text">isEditMode</code> 속성을 추가하면서 초기값으로 <code class="language-text">false</code> 를 넣어주었습니다. 그리고 <code class="language-text">allRecords</code> 는 <code class="language-text">records</code> 배열에 따라 값을 가져오니까 그대로 값을 가져오면 됩니다. 나중에 <code class="language-text">isEditMode</code> 속성이 <code class="language-text">true</code> 로 변하게 되면 <code class="language-text">allRecords</code> 는 자동으로 새로운 배열을 만들어낼겁니다.</p>\n<p>기본적으로 상위 컴포넌트와 하위 컴포넌트는 Props를 통한 단방향 데이터 흐름을 형성합니다. 물론 다양한 방법으로 양방향으로 데이터 변경을 가하는 방법은 있습니다. 하지만 이 경우에는 신중을 기하여 설계하셔야 합니다. 자칫 앱의 규모가 커지면서 상태 관리가 겉잡을 수 없이 복잡해질 수 있으니까요.</p>\n<p>그럼 우리는 어떻게 하위 컴포넌트에 있는 Edit 버튼을 클릭하여 상태를 변경할 수 있을까요? 이 때는 <a href="https://kr.vuejs.org/v2/guide/components.html#%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%A0%95%EC%9D%98-%EC%9D%B4%EB%B2%A4%ED%8A%B8">사용자 지정 이벤트</a>를 활용하여 하위 컴포넌트에 특정 이벤트가 일어났다고 상위 컴포넌트에 알리고, 그에 따라 상위 컴포넌트가 연산을 수행하도록 만들면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> RecordRow <span class="token operator">=</span> <span class="token punctuation">{</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'record\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`\n\t// ...\n      &lt;td>\n        &lt;button class="button is-danger">Delete&lt;/button>\n        &lt;button class="button is-light" @click="toggleEdit">Edit&lt;/button>\n      &lt;/td>\n    &lt;/tr>\n  `</span></span><span class="token punctuation">,</span>\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function">toggleEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">\'toggle-edit\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p><code class="language-text">toggle-edit</code> 은 상위 컴포넌트에서 <code class="language-text">record-row</code> 컴포넌트를 선언할 때 이벤트로 지정해두면 됩니다. <strong>이벤트 이름이 일치하지 않는다고 오류가 따로 나지 않기 때문에 오탈자에 유의하셔야 합니다.</strong></p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(record, index) in allRecords<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record-row</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!record.isEditMode<span class="token punctuation">"</span></span> <span class="token attr-name">@toggle-edit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleEditModeOf(index)<span class="token punctuation">"</span></span> <span class="token attr-name">:record</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record-row</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>Hello! Edit Mode Toggled!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p><code class="language-text">v-for</code> 는 이렇게 각 배열의 요소 뿐 아니라 인덱스도 가져올 수 있습니다. Vue 인스턴스에서 <code class="language-text">toggle-edit</code> 이벤트가 일어났다고 감지하면 <code class="language-text">toggleEditModeOf</code> 메서드를 실행하게 만들면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Vue instance</span>\nmethods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token function">toggleEditModeOf</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> target_record <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>\n\t\tObject<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>target_record<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      \t\tisEditMode<span class="token punctuation">:</span> <span class="token operator">!</span>target_record<span class="token punctuation">.</span>isEditMode\n\t    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p><code class="language-text">Array#splice</code> 메서드로 해당 인덱스에 있는 자료의 상태를 변경해줍니다. Vue.js는 이 변화를 감지하여 <code class="language-text">allRecords</code> 의 변경된 부분만 새로 만듭니다.</p>\n<h3 id="수정용-컴포넌트-만들기"><a href="#%EC%88%98%EC%A0%95%EC%9A%A9-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>수정용 컴포넌트 만들기</h3>\n<p>이제 토글 버튼을 눌러서 원하는 줄의 내용이 바뀌는걸 확인하셨다면  <code class="language-text">v-else</code> 위치에 새로운 컴포넌트가 들어가게 만들면 됩니다. 수정용 컴포넌트는 조금 더 복잡합니다. 왜냐면 Edit 버튼을 눌렀을 때 원래 적혀있던 값이 input 태그로 바뀌면서 그대로 유지되어야 하며, 변경된 값을 서버에 전송하기 전에 처리해두어야 하기 때문입니다.</p>\n<ol>\n<li>updateForm이라는 새로운 Form 객체를 생성</li>\n<li>Edit 버튼이 토글 될 때 updateForm은 기존 레코드의 자료를 복사해서 저장</li>\n<li>수정용 컴포넌트에서 변경값이 입력될 때 updateForm의 속성도 같이 변화</li>\n<li>Update 버튼을 누르면 입력된 정보를 서버로 전송</li>\n</ol>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> UpdateRow <span class="token operator">=</span> <span class="token punctuation">{</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'record\'</span><span class="token punctuation">,</span> <span class="token string">\'form\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`\n    &lt;tr>\n      &lt;td>{{ record.created_at }}&lt;/td>\n      &lt;td>\n        &lt;input class="input" type="number" :value="record.amount"\n               @input="updateFormValue(\'amount\', $event.target.value)" />\n      &lt;/td>\n      &lt;td>\n        &lt;input class="input" type="text" :value="record.description"\n               @input="updateFormValue(\'description\', $event.target.value)" />\n      &lt;/td>\n      &lt;td>\n        &lt;button class="button is-danger" @click="toggleEdit">Cancel&lt;/button>\n        &lt;button class="button is-light" @click="updateRecord">Update&lt;/button>\n      &lt;/td>\n    &lt;/tr>\n  `</span></span><span class="token punctuation">,</span>\n  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function">editForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>record<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        form<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>record<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> form<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function">toggleEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">\'toggle-edit\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">updateFormValue</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>editForm<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">\'form-update\'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editForm<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">updateRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">\'update-record\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ..</span>\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  el<span class="token punctuation">:</span> <span class="token string">\'#app\'</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    updateForm<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      id<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n      amount<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n      description<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    <span class="token function">updateRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>updateForm<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">\'record-row\'</span><span class="token punctuation">:</span> RecordRow<span class="token punctuation">,</span>\n    <span class="token string">\'update-row\'</span><span class="token punctuation">:</span> UpdateRow\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>코드 아래 쪽을 먼저 봐주시면 <code class="language-text">updateForm</code> 객체를 만들어두긴 했지만 아직 빈 값밖에 없는 상태입니다. 그래서 <code class="language-text">editForm</code> 을 이용하여 컴포넌트에서 <code class="language-text">record</code> 의 값을 updateForm(여기서는 form) 으로 복사해주는 작업을 합니다. 다음에는 input 이벤트가 일어날 때마다 해당 값을 반영한 뒤에 변경된 <code class="language-text">form</code> 을 부모 컴포넌트로 올려보냅니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(record, index) in allRecords<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record-row</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!record.isEditMode<span class="token punctuation">"</span></span>\n    <span class="token attr-name">@toggle-edit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleEditModeOf(index)<span class="token punctuation">"</span></span>\n    <span class="token attr-name">:record</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record-row</span><span class="token punctuation">></span></span>\n  &lt;update-row v-else\n    @toggle-edit="toggleEditModeOf(index)"\n    :record="record" :form="updateForm"\n    @form-update="form => { updateForm = form }"\n              // 여기서 form은 아까 컴포넌트에 있던 this.editForm 입니다\n    @update-record="updateRecord"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update-row</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p><code class="language-text">form-update</code> 이벤트 리스너는 자식 컴포넌트가 올려준 <code class="language-text">form</code> 을 기존에 만들어두었던 <code class="language-text">updateForm</code> 과 바꿔치기하게 되지요. 분명 더 좋은 방법은 있습니다만, 저와 이 글을 보시는 여러분 모두 차근차근 보면서 더 나은 방법으로 구현할 수 있게 되었으면 좋겠습니다.</p>\n<h3 id="서버에-전송하기"><a href="#%EC%84%9C%EB%B2%84%EC%97%90-%EC%A0%84%EC%86%A1%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버에 전송하기</h3>\n<p>Update 버튼을 누르면 <code class="language-text">updateRecord</code> 가 실행되게 만드는 것 까지 하셨다면 Form 클래스에 <code class="language-text">update</code> 메서드를 구현하면 됩니다. 기존에 하던 방법처럼 axios로 요청을 보내고 그 응답을 처리하시면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> record_id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> record<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">\'auth_token\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'patch\'</span><span class="token punctuation">,</span>\n      url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`http://localhost:2300/api/records/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>\n      data<span class="token punctuation">:</span> data<span class="token punctuation">,</span>\n      headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> index <span class="token operator">=</span> app<span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>record <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> record<span class="token punctuation">.</span>id <span class="token operator">===</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      app<span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// handle error</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<h2 id="레코드-삭제하기"><a href="#%EB%A0%88%EC%BD%94%EB%93%9C-%EC%82%AD%EC%A0%9C%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>레코드 삭제하기</h2>\n<p>마지막 기능인 레코드 삭제를 구현하겠습니다. 여지껏 구현해왔던 기능에 비하면 훨씬 쉽게 구현할 수 있습니다. 삭제 버튼을 클릭하면 \'이 기록을 삭제할것이다\' 라는 이벤트를 전송하고, 그러면 우리는 레코드 삭제용 메서드에 해당 레코드의 인덱스를 넘겨주면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup">&lt;record-row v-if="!record.isEditMode"\n  @toggle-edit="toggleEditModeOf(index)"\n  @delete-record="deleteRecord(index)" // delete-record 추가\n  :record="record"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record-row</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> RecordRow <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`\n\t// ...\n    &lt;td>\n      &lt;button class="button is-danger" @click="deleteRecord">Delete&lt;/button>\n      &lt;button class="button is-light" @click="toggleEdit">Edit&lt;/button>\n    &lt;/td>\n  `</span></span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function">toggleEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">\'toggle-edit\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">deleteRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">\'delete-record\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    <span class="token function">deleteRecord</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> record_id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n      <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">\'auth_token\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        method<span class="token punctuation">:</span> <span class="token string">\'delete\'</span><span class="token punctuation">,</span>\n        url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`http://localhost:2300/api/records/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>\n        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>여담이지만 서버와 통신하는 메서드는 어느정도 일관된 틀을 가지고 있다는 점을 보실 수 있습니다. 토큰을 가져와야 하고, 비슷한 URL로 요청을 보내며, 응답에 따라 <code class="language-text">response</code> / <code class="language-text">error</code> 를 받아옵니다. 이 기본 기능을 이해하시면 서버 통신하는 기능을 재사용 가능한 함수로 만들어서 불필요한 코드가 반복되는 일을 줄일 수 있을겁니다.</p>\n<hr>\n<p>이렇게 간단한 가계부 앱을 HTML 페이지 두 장으로 만들어보았습니다. 강좌에서 제공한 코드 곳곳에 개선해야 할 점들은 많습니다. 바로 위에 말씀드렸다시피 중복되는 기능을 재사용 가능하게 만든다던가, 자료를 처리하는 방법을 조금 더 효율적으로 만들거나, 에러를 처리를 위한 고민도 필요합니다.</p>\n<p>코드를 찬찬히 살펴보시면서 \'이렇게 하면 더 나을거같은데..\' 라고 생각하는 부분을 직접 구현해보시면서 점차 Vue.js의 사용법을 익혀나갈 수 있으리라 생각합니다. <a href="https://kr.vuejs.org/v2/guide/">공식 가이드만 참고하셔도</a> 충분히 괜찮은 퀄리티의 앱을 만드실 수 있을겁니다.</p>\n<ul>\n<li>Source Code: <a href="https://github.com/emaren84/moneybook_client">Github</a></li>\n</ul>',
id:"/home/circleci/repo/src/pages/posts/2017-05-02-hanami-vuejs-moneybook-frontend-2/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2017-05-02",path:"/posts/hanami-vuejs-moneybook-frontend-2",title:"Hanamirb + Vue.js 로 간단 가계부 구현 (프론트엔드 편 - 2)",tags:["Javascript","Vue.js"],category:"Vue.js"}},{excerpt:"Hanamirb + Vue.js 시리즈 목차 API 서버 로그인 & 회원가입 페이지 가계부 페이지 지난 시간에 하나미로 JSON API 서버를 만들었습니다. 이제 가계부 클라이언트를 Vue.js로 구현해보겠습니다.\n처음에는 vue-cli나 Nuxt…",html:'<p><strong>Hanamirb + Vue.js 시리즈 목차</strong></p>\n<ol>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-api-server">API 서버</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-1">로그인 &#x26; 회원가입 페이지</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-2">가계부 페이지</a></p>\n</li>\n</ol>\n<hr>\n<p>지난 시간에 하나미로 JSON API 서버를 만들었습니다. 이제 가계부 클라이언트를 Vue.js로 구현해보겠습니다.\n처음에는 vue-cli나 Nuxt같은 다양한 도구를 이용해서 프로젝트를 만들어야 하나 고민을 했는데, 굳이 그렇게 할 필요도 없이 쉽게 구현 가능하다는 사실을 깨달았습니다.</p>\n<p>이번 프로젝트에서 우리가 필요한건 로그인 페이지와 가계부 페이지 html 두 장 뿐입니다. CSS와 자바스크립트는 같은 파일안에 작성하려는데, 가독성이 떨어지거나 번거롭게 느껴지신다면 따로 분리하여 작업하셔도 됩니다.</p>\n<p><strong>이번에 만드는 프로젝트는 ES6(ECMAscript 2016) 문법을 적극적으로 활용하여 작성할 예정입니다. 크롬 최신버전 (현재 58) 기준으로 만들 예정이며, 더 낮은 버전의 브라우저는 제대로 작동하지 않을 확률이 큽니다(특히 IE).</strong></p>\n<h2 id="vuejs란"><a href="#vuejs%EB%9E%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Vue.js란?</h2>\n<p>여태까지 AngularJS, ReactJS가 프론트엔드 JS 프레임워크의 양대 산맥을 이루고 있었지만, Vue.js가 혜성처럼 등장하여 3대장과 같은 위치를 차지하게 되었습니다. 두 프레임워크의 장점을 적절히 가져오고 쉽게 익힐 수 있도록 설계되어 있는데다가, 복잡한 프로젝트 세팅 없이 바로 CDN에서 파일을 가져오기만 해도 충분히 쓸만할 만큼 가볍고 사용성이 좋습니다.</p>\n<p>Vue.js에 관한 더 자세한 소개와 간단한 튜토리얼은 아래 링크를 참고하시기 바랍니다</p>\n<p><a href="https://velopert.com/3007">Vue.js 2.0 소개 및 시작하기 - velopert</a></p>\n<h2 id="회원-가입--로그인-페이지-만들기"><a href="#%ED%9A%8C%EC%9B%90-%EA%B0%80%EC%9E%85--%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>회원 가입 &#x26; 로그인 페이지 만들기</h2>\n<p>지난 시간에 가계부 앱에 필요한 기능들을 말씀드렸을 때, 회원 가입을 하고 로그인을 하면 토큰을 받고 브라우저의 LocalStorage에 저장한다고 말씀드렸습니다. 두 기능 모두 거의 같은 로그인 Form을 공유하기 때문에 한 페이지로 만들고 <code class="language-text">v-if</code> 같은 분기문을 사용해서 상태에 따라 조금씩 다른 모습이 나타나도록 만들면 되겠습니다.</p>\n<h3 id="기본-설정"><a href="#%EA%B8%B0%EB%B3%B8-%EC%84%A4%EC%A0%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>기본 설정</h3>\n<p>하나미 프로젝트와 다른 곳 혹은 같은 곳에 폴더를 생성하고 <code class="language-text">login.html</code> 파일을 만든 뒤에 필요한 파일들을 등록해두겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.1/axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.0/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>MoneyBook<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>서버와 AJAX 통신을 위해 axios, 좀더 깔끔한 페이지 뷰를 위해 CSS 프레임워크인 Bulma를 사용하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">\n  <span class="token selector">html, body</span> <span class="token punctuation">{</span>\n    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n\n  <span class="token selector">#app</span> <span class="token punctuation">{</span>\n    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">background-color</span><span class="token punctuation">:</span> #E6E6E6<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">#app .column</span> <span class="token punctuation">{</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 10%<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">#app .column > p</span> <span class="token punctuation">{</span>\n    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">#sign-up-button</span> <span class="token punctuation">{</span>\n    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token comment">&lt;!--main container--></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>columns is-mobile<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token comment">&lt;!--centered column--></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>column is-half is-offset-one-quarter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title is-2 is-spaced<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>MoneyBook<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n\n      <span class="token comment">&lt;!--login form--></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control has-icons-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon is-small is-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-envelope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control has-icons-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon is-small is-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-lock<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-success<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log-in-button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n                Login\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-info<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sign-up-button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n                Sign up\n              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token comment">&lt;!--end of form--></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token comment">&lt;!--end of column--></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token comment">&lt;!--end of container--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>위의 코드를 넣어주시면 다음과 같은 화면을 보실 수 있습니다.</p>\n<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 790px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 56.46437994722956%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABPElEQVQoz41TS07DQAzN+TgCl2HBjhNwinIAVl20Cyp2qBISSCj/+QTapGnTJDMPe/pRaJPSkZ7s8djO8ydeHMc4RRRF6LNf8+4NOfH9gO79vw94XQPLMAyd9H0fs9kMk8nEyfF47PT5fI4kSY5+3dgzhuyotUaWZU5KKSGEQJqm7o11tvEbQynVz/BgZOe6aZCvCmzrLfhYa3E4rDOa1qA1FpuqupxQSAEYiqRc1XpDyWsYDm7bP9g5AU1dURzH9yTknnyrDK/lB570FGmuYSmZsQSzg93Ll88Nnt/WCFUJkQ4w9MMAK7XEgx7hxr/HVyMdC07YLd1QqXejH9w+akzfCyLBZKLhtcn1AmudQysaipKu8acoFhrlkoan5dkqna1NQKUHxJZbMATnE4RHZt318a79O4YR7Qezwy9tojFePAHLOwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="2017 04 30 sc1"\n        title=""\n        src="/static/2017-04-30-sc1-9100a80c23929f21d4e5ca6a8de99a9e-ffc88.png"\n        srcset="/static/2017-04-30-sc1-9100a80c23929f21d4e5ca6a8de99a9e-d16f8.png 198w,\n/static/2017-04-30-sc1-9100a80c23929f21d4e5ca6a8de99a9e-f21b1.png 395w,\n/static/2017-04-30-sc1-9100a80c23929f21d4e5ca6a8de99a9e-ffc88.png 790w,\n/static/2017-04-30-sc1-9100a80c23929f21d4e5ca6a8de99a9e-81e7e.png 1185w,\n/static/2017-04-30-sc1-9100a80c23929f21d4e5ca6a8de99a9e-53295.png 1516w"\n        sizes="(max-width: 790px) 100vw, 790px"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id="회원-가입--로그인-페이지-전환"><a href="#%ED%9A%8C%EC%9B%90-%EA%B0%80%EC%9E%85--%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%A0%84%ED%99%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>회원 가입 &#x26; 로그인 페이지 전환</h3>\n<p>형태를 잡았으니 본격적인 Vue 도입을 시작하겠습니다. 가장 먼저 <code class="language-text">Vue</code> 인스턴스를 생성한 뒤, 필요한 데이터 필드를 설정하고, 회원 가입 버튼을 누를 때 다른 페이지가 나올 수 있도록 설정할 예정입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  el<span class="token punctuation">:</span> <span class="token string">\'#app\'</span><span class="token punctuation">,</span>\n\n  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    isSignUp<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function">toggleSignUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>isSignUp <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isSignUp<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p><code class="language-text">body</code> 태그 맨 아래에 <code class="language-text">script</code> 태그를 삽입하고 위의 코드를 넣어줍니다. 먼저 어느 엘리먼트에서 Vue 앱이 구동될지 지정해주고, 앱 안에서 사용하고자 하는 데이터를 설정해준 뒤, 데이터를 조작할 수 있는 메서드를 지정해 주었습니다.</p>\n<p>한 페이지 안에서 로그인 페이지와 회원가입 페이지를 버튼에 따라 다르게 나타나게 하려면 <code class="language-text">v-if</code>, <code class="language-text">v-else</code> 를 사용하면 됩니다. 자세한 내용은 <a href="https://kr.vuejs.org/v2/guide/conditional.html">공식 가이드를 참고해주세요.</a></p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token comment">&lt;!--password confirmation--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control has-icons-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Password Confirmation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon is-small is-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-lock<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n\n<span class="token comment">&lt;!--buttons--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!isSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-success<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log-in-button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Login\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-info<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sign-up-button<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Sign up\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-success<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log-in-button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Submit\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-light<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sign-up-button<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Back\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p><code class="language-text">template</code> 태그는 Vue에서 사용하는 래퍼 태그입니다. <code class="language-text">v-if</code> 나  <code class="language-text">v-else</code> 는 기본적으로 하나의 태그에만 작동하고, 그 하위 태그들에는 동작하지 않기 때문에 이렇게 단위로 묶어줄 필요가 있습니다.</p>\n<p><code class="language-text">@click.prevent</code> 는 <code class="language-text">v-on:click.prevent</code> 와 같은 의미입니다. 이 버튼을 클릭하면 아까 지정해둔 <code class="language-text">toggleSignIn</code> 메서드를 실행하게 되고, 이 메서드가 <code class="language-text">isSignIn</code> 값을 변경하여 모든 템플릿에 영향을 줍니다.</p>\n<h3 id="form의-자료를-저장할-객체-생성"><a href="#form%EC%9D%98-%EC%9E%90%EB%A3%8C%EB%A5%BC-%EC%A0%80%EC%9E%A5%ED%95%A0-%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Form의 자료를 저장할 객체 생성</h3>\n<p>우리가 만들어놓은 Form에는 세 가지 필드가 있습니다. 이메일 주소, 비밀번호, 비밀번호 확인 필드입니다. 기존에 jQuery를 사용해 오셨다면, 필드의 변화를 바로바로 잡아내기 보다 폼을 제출할 때 이벤트 핸들러가 이런저런 일을 처리하도록 만드셨을 겁니다. Vue도 그렇게 하는게 가능은 하지만 그닥 추천하고 싶은 방법은 아닙니다.</p>\n<p>이번에는 <code class="language-text">v-model</code> 속성을 이용하여 데이터를 묶어두는(binding) 방법을 적용해 보겠습니다. 가장 기초적인 방법으로 Vue 인스턴스에 data를 다음과 같이 지정해둘 수 있을겁니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  el<span class="token punctuation">:</span> <span class="token string">\'#app\'</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    isSignIn<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    email<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n    password<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n    password_confirmation<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Vue 인스턴스의 <code class="language-text">data</code> 속성은 해당 인스턴스의 스키마 역할을 하기도 하고, 이렇게 지정해두지 않은 데이터는 동적으로 제어하는게 불가능합니다. (API 문서를 보시면 이후에 추가하는 메서드가 있긴 하지만 그닥 추천드리고 싶지 않습니다) 지금은 필드가 단지 3개밖에 없으니까 이렇게 바로 데이터를 지정해둘 수 있을겁니다.</p>\n<p>미리 서버에 요청을 보내는 과정을 알려드리면 <strong>Form의 데이터를 객체로 모으기 -> axios로 post 요청 보내기 -> 서버의 응답 리턴</strong> 일텐데, 첫 번째 과정을 눈여겨보셔야 합니다. 만약 우리가 회원 가입을 할 때 전화번호나 주소같이 추가적인 정보를 더 많이 받게 된다면, 이 모든 속성을 <code class="language-text">data</code> 에 지정하는 일은 비효율적입니다. 아예 Form 데이터를 모아주고, 요청도 전송해주고, 특정 버튼을 눌렀을 때 input 값을 초기화해주는 등의 역할을 해 주는 객체를 새로 만들면 어떨까요?</p>\n<p>먼저 해당 역할을 해 주는 Form 클래스를 만들고, <code class="language-text">data</code> 속성에 지정해두겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>originalData <span class="token operator">=</span> data<span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  el<span class="token punctuation">:</span> <span class="token string">\'#app\'</span><span class="token punctuation">,</span>\n\n  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    isSignIn<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    form<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      email<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n      password<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n      password_confirmation<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>참고로 자바스크립트 인터프리터는 코드를 위에서 아래 순서대로 읽기 때문에 Form 클래스의 정의를 Vue 인스턴스 아랫부분에 하게 되면 에러가 납니다.</p>\n<p>Form의 <code class="language-text">originalData</code> 속성은 단순히 필드 저장용으로 사용하게 됩니다. 지금은 <code class="language-text">email</code>, <code class="language-text">password</code>, <code class="language-text">password_confirmation</code> 필드가 있지요. 그리고 for..in으로  Form 클래스의 속성에 필드를 추가합니다.</p>\n<p>이제 input 태그에 데이터를 연결해보겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token comment">&lt;!--email input--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control has-icons-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon is-small is-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-envelope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n<span class="token comment">&lt;!--password input--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control has-icons-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon is-small is-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-lock<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n<span class="token comment">&lt;!--password confirmation--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control has-icons-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Password Confirmation<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form.password_confirmation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon is-small is-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-lock<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>각 input 태그에 <code class="language-text">v-model</code> 속성과 함께, 어느 속성이 연결되어야 할 지 지정되어있는 모습을 보실 수 있습니다. 이제 각 필드의 값에 변화가 일어날 때 마다 Form 객체의 속성이 변하게 됩니다.</p>\n<p><img src="/2017-04-30-sc2-f20f52ea53e7fae81e0d032d4e69d830.gif"></p>\n<p>이제 작동 원리가 눈에 들어오셨다면 Form 클래스에 몇 가지 메서드를 추가해 보겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>originalData <span class="token operator">=</span> data<span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originalData<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^password/</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">\'\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        data<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`moneybook:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        data<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> data<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> field <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originalData<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p><code class="language-text">reset</code> 메서드는 말 그대로 각 필드를 비우는 메서드이고, <code class="language-text">data</code> 필드는 새로운 객체에 각 필드에 입력된 값을 모아주는 역할을 합니다. 서버에 패스워드를 전송할 때는 반드시 암호화되어야 하기 때문에 <a href="https://github.com/emn178/js-sha256">SHA-256 라이브러리</a>를 적용했습니다. 단순히 작동되는 모습을 보기만 하시려면 굳이 적용하지 않으셔도 됩니다.</p>\n<p><code class="language-text">reset</code> 메서드는 <code class="language-text">toggleSignIn</code> 메서드가 실행될 때 같이 실행되도록 하여 회원가입&#x3C;->로그인 전환 시 필드 값을 초기화하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ...</span>\n\tmethods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function">toggleSignUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>isSignUp <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isSignUp<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token comment">// ...</span></code></pre>\n      </div>\n<h3 id="서버와-통신하기"><a href="#%EC%84%9C%EB%B2%84%EC%99%80-%ED%86%B5%EC%8B%A0%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버와 통신하기</h3>\n<p>사실 Form 을 다루는 이야기를 더 하자면 내용이 꽤 길어집니다. 유효성 검사라던가, 서버로부터 들어온 에러를 다루는 방법이라던가.. 이 부분은 나중에 소스코드에는 구현 할 예정이니 업로드 된 소스코드를 직접 살펴보시길 바랍니다.</p>\n<p>지금은 서버에 데이터를 전송한 뒤에 리턴된 토큰을 저장하는 방법을 살펴보겠습니다. 같은 Form 안에서 조건에 따라 다른 요청을 하도록 구성되어 있기 때문에 Login, Submit 버튼에 다른 메서드를 연결하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code class="language-markup"><span class="token comment">&lt;!--buttons--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!isSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-success<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log-in-button<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submitLogin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Login\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-info<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sign-up-button<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Sign up\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>control<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-success<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log-in-button<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submitSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Submit\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button is-light<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sign-up-button<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toggleSignUp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        Back\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ...</span>\n\tmethods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n        <span class="token function">submitLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token string">\'http://localhost:2300/api/auth/sign_in\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n        <span class="token function">submitSignUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token string">\'http://localhost:2300/api/auth/sign_up\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">}</span></code></pre>\n      </div>\n<p>요청 주소는 하나미 기본 서버 주소 및 포트를 기준으로 했습니다. 별도로 하나미쪽에 CORS를 신경 써 주어야 하는데 미처 신경 쓰지 못했네요, 추후에 업데이트 하겠습니다.</p>\n<p><code class="language-text">submit</code> 메서드는 지정한 url을 받아서 서버에 POST요청을 하고, 응답에 따라 토큰을 저장하거나, 메세지를 띄우면서 Login 페이지로 돌아오는 역할을 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n      <span class="token function">submit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">\'auth_token\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">\'auth_token\'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">\'auth_token\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">\'./content.html\'</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              app<span class="token punctuation">.</span><span class="token function">renderNotification</span><span class="token punctuation">(</span><span class="token string">\'Successfully Singed Up\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              app<span class="token punctuation">.</span><span class="token function">toggleSignUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=></span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>axios 라이브러리를 이용하여 요청을 하고, 성공하거나 실패한 요청을 각각 <code class="language-text">then</code>, <code class="language-text">catch</code> 로 다룰 수 있습니다. API 서버 구현 파트에서 보셨다시피 사용자가 가입을 할 때는 해당 사용자의 정보를 리턴하고, 가입된 계정으로 로그인을 할 때만 <code class="language-text">auth_token</code> 을 반환합니다. 그리고 받은 토큰을 브라우저의 <code class="language-text">localStorage</code> 에 저장합니다. 그 뒤에 자연스럽게 가계부  앱 페이지로 이동하게 만들면 됩니다.</p>\n<p>회원 가입이 정상적으로 처리 된 뒤에는 다시 로그인 페이지로 돌아도록 만들었습니다. <code class="language-text">renderNotification</code> 메서드는 오른쪽 구석에 알림을 띄우도록 만든 메서드인데, 이를 활용하여 에러 메세지도 손쉽게 표현하실 수 있을겁니다.</p>\n<p>다음 포스팅에서 로그인 이후에 실제 가계부 앱을 Vue.js로 구현해보겠습니다.</p>\n<hr>\n<p>Source Code: <a href="https://github.com/emaren84/moneybook_client">Github</a></p>',
id:"/home/circleci/repo/src/pages/posts/2017-04-30-hanami-vuejs-moneybook-frontend-1/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2017-04-30",path:"/posts/hanami-vuejs-moneybook-frontend-1",title:"Hanamirb + Vue.js 로 간단 가계부 구현 (프론트엔드 편 - 1)",tags:["Javascript","Vue.js"],category:"Vue.js"}},{excerpt:"Hanamirb + Vue.js 시리즈 목차 API 서버 로그인 & 회원가입 페이지 가계부 페이지 업데이트 BCrypt 관련 설명 수정 (2017-05-02) 들어가며 하나미 정식 버전이 지난 4월 6일에 발표되었습니다. 기존에 레일즈에 여러모로 아쉬움을 느끼고 있던 해외의 루비 개발자들은 많은 관심을 가지고 있나봅니다. 제가 처음 하나미를 접했을 때 버전이 0.7.2였는데 어느새 1.0.…",html:'<p><strong>Hanamirb + Vue.js 시리즈 목차</strong></p>\n<ol>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-api-server">API 서버</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-1">로그인 &#x26; 회원가입 페이지</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-2">가계부 페이지</a></p>\n</li>\n</ol>\n<hr>\n<p><strong>업데이트</strong></p>\n<ul>\n<li>BCrypt 관련 설명 수정 (2017-05-02)</li>\n</ul>\n<hr>\n<h2 id="들어가며"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>들어가며</h2>\n<p>하나미 정식 버전이 지난 4월 6일에 발표되었습니다. 기존에 레일즈에 여러모로 아쉬움을 느끼고 있던 해외의 루비 개발자들은 많은 관심을 가지고 있나봅니다. 제가 처음 하나미를 접했을 때 버전이 0.7.2였는데 어느새 1.0.0 버전이 발매되었고, 아직도 쓰고있다보니 감개무량합니다.</p>\n<p>요즘 프론트엔드 JS 프레임워크에 많은 관심을 가지고 ReactJS, Vue.js를 공부하고 있는데, 간단히 배운 내용을 적용해볼 겸 간단 가계부를 구현해보도록 하겠습니다. 백엔드 JSON API 서버는 하나미로 구현하고, 프론트엔드는 Vue.js로 구현하는 과정을 보여드리겠습니다.</p>\n<p>최대한 간단히 설명해드리려 노력하겠지만, 기존에 루비로 웹 개발을 해보신분이 이해하시기 쉬울 겁니다. 사실 JSON API 서버는 어떤 언어나 프레임워크로 제공해도 되니까요 :) 구현방법에 약간씩 차이가 있을 뿐이지 제가 보여드리는 정도의 앱은 그렇게 어렵지 않게 작성하실 수 있으리라 봅니다.</p>\n<h2 id="애플리케이션의-기본-구성"><a href="#%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>애플리케이션의 기본 구성</h2>\n<p>처음에는 더욱 간단한 To-Do List(할일 관리) 를 구현하려고 했는데, 그러면 하나미를 다루는 부분이 너무 영양가가 없어질 것 같아서 가계부 형식의 앱으로 만들고, 다음의 기능을 구상해 보았습니다.</p>\n<ul>\n<li>\n<p>회원 등록 및 인증</p>\n<ul>\n<li>이메일과 비밀번호로 회원 가입</li>\n<li>JWT로 인증 (토큰은 LocalStorage에 저장)</li>\n</ul>\n</li>\n<li>\n<p>사용금액, 내용 입력</p>\n<ul>\n<li>수입은 녹색, 지출은 빨강색으로 표시</li>\n<li>각 아이템을 클릭하면 바로 수정 가능, 삭제 버튼을 누르면 삭제</li>\n</ul>\n</li>\n<li>수입, 지출을 필터링하여 보기</li>\n<li>가장 최신 레코드 30개를 처음에 불러온 뒤, 화면에 보이는 마지막 내역까지 스크롤 하게 되면 추가로 자료 가져오기</li>\n</ul>\n<p>이 정도의 기능을 구현해볼 예정입니다. 막상 하려니 쉽진 않겠지만 차근차근 진행해보겠습니다.</p>\n<h2 id="하나미-프로젝트-생성"><a href="#%ED%95%98%EB%82%98%EB%AF%B8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>하나미 프로젝트 생성</h2>\n<p>너무나 당연하지만 하나미를 사용하기 위해서는 개발 환경에 루비가 세팅되어 있어야 합니다. 아직 루비가 설치되어있지 않은 경우에는 <a href="https://gorails.com/setup/">GoRails의 설치 가이드</a>를 따라하시면 되겠습니다. 그 다음에 하나미 젬을 설치하시면 됩니다. 이번 강좌에서는 <strong>루비 2.4.1</strong>, <strong>하나미 1.0.0</strong> 버전을 기준으로 프로젝트를 생성하겠습니다.</p>\n<p>먼저 하나미 젬을 설치합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">gem install hanami</code></pre>\n      </div>\n<p>설치 된 이후에 프로젝트는 원하시는 이름으로 설치하시면 됩니다. 하나미는 SQLite, MySQL, PostgreSQL 등을 지원하지만, 기본적으로 PostgreSQL을 권장합니다. 또한 테스팅 프레임워크도 처음 프로젝트를 설정할 때 Minitest, RSpec 중에서 고르실 수 있습니다. 제가 아직 RSpec은 커녕 TDD를 잘 못하기 때문에 Minitest로 진행해보겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">hanami new moneybook-api --database=postgres --test=minitest</code></pre>\n      </div>\n<p>생성된 프로젝트에서 젬파일을 살펴보시면 꽤 간단합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># Gemfile</span>\nsource <span class="token string">\'https://rubygems.org\'</span>\n\ngem <span class="token string">\'rake\'</span>\ngem <span class="token string">\'hanami\'</span><span class="token punctuation">,</span>       <span class="token string">\'~> 1.0\'</span>\ngem <span class="token string">\'hanami-model\'</span><span class="token punctuation">,</span> <span class="token string">\'~> 1.0\'</span>\n\ngem <span class="token string">\'pg\'</span>\n\ngroup <span class="token symbol">:development</span> <span class="token keyword">do</span>\n  <span class="token comment"># Code reloading</span>\n  <span class="token comment"># See: http://hanamirb.org/guides/projects/code-reloading</span>\n  gem <span class="token string">\'shotgun\'</span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:test</span><span class="token punctuation">,</span> <span class="token symbol">:development</span> <span class="token keyword">do</span>\n  gem <span class="token string">\'dotenv\'</span><span class="token punctuation">,</span> <span class="token string">\'~> 2.0\'</span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:test</span> <span class="token keyword">do</span>\n  gem <span class="token string">\'minitest\'</span>\n  gem <span class="token string">\'capybara\'</span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:production</span> <span class="token keyword">do</span>\n  <span class="token comment"># gem \'puma\'</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>이 중에서 <code class="language-text">capybara</code> 젬은 뷰 테스트 용이기 떄문에 이번 프로젝트에선 굳이 없어도 됩니다. 앞으로 젬이 더 추가될테지만 필요에 따라 추가하기로 하고, <code class="language-text">bundle install</code> 커맨드로 필요한 젬을 설치해두겠습니다.</p>\n<p>참고로 PostgreSQL을 이용하시려면 <code class="language-text">.env</code> 파일에서 계정 설정을 해주셔야 합니다. SQLite를 이용하신다면 파일로 관리되기 때문에 계정 설정을 해 주실 필요는 없습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text"># .env.development\nDATABASE_URL=&quot;postgresql://username:password@localhost/moneybook_api_development&quot;</code></pre>\n      </div>\n<h2 id="사용자-인증-구현"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자 인증 구현</h2>\n<p>기존의 웹 페이지는 서버에서 인증 관련 정보를 들고, 세션을 이용하여 인증 상태를 유지하고 요청을 하는 경우가 많았습니다. 하지만 모바일 애플리케이션이나, 많은 인스턴스를 올려서 인증을 관리하는 경우 세션 기반 인증은 유연한 대응이 어렵습니다. JWT라는 개념을 이용하면 세션 기반 인증의 단점을 극복하고 사용자 인증을 적용할 수 있습니다.</p>\n<p>JWT 인증이 무엇인지 궁금하시다면 다음의 링크를 읽어보시길 바랍니다.</p>\n<ul>\n<li><a href="https://velopert.com/2389">JSON Web Token 소개 및 구조 - velopert</a></li>\n<li><a href="http://bcho.tistory.com/999">REST JWT 소개 - 조대협</a></li>\n<li><a href="https://jwt.io/introduction/">Introduction to JSON Web Tokens</a></li>\n</ul>\n<p>인증에 필요한 젬을 추가한 뒤, 사용자 정보를 기록하는 모델을 생성하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># Gemfile</span>\n<span class="token comment"># ...</span>\ngem <span class="token string">\'bcrypt\'</span>\ngem <span class="token string">\'jwt\'</span>\n<span class="token comment"># ...</span></code></pre>\n      </div>\n<p><code class="language-text">bcrypt</code> 젬은 비밀번호 생성에 특화된 단방향 해시 함수를 지원합니다.<br>\n간단한 사용법을 알려드리면 <code class="language-text">BCrypt::Password.create(&#39;password&#39;)</code> 로 해시 다이제스트를 생성하고, <code class="language-text">BCrypt::Password.new(digest)</code> 로 해시 다이제스트가 본래 비밀번호와 일치하는지 검사합니다.</p>\n<p>너무나 당연하면서 중요한 이야기지만 웹 개발자로서 복잡한 보안 알고리즘을 직접 구현하면 관리 및 취약점을 파악하기가 어렵기 때문에 차라리 <code class="language-text">bcrypt</code> 처럼 검증된 라이브러리를 사용하시길 추천합니다. 비슷한 예로 Rails에서 사용자 인증과 관련한 부분은 되도록이면 Devise 젬을 사용하길 권장하는 것 처럼요.</p>\n<p>패스워드 저장 매커니즘에 대해 <a href="http://d2.naver.com/helloworld/318732">이 글</a>을 읽어보시길 추천합니다.</p>\n<h3 id="사용자-모델-생성"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%AA%A8%EB%8D%B8-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자 모델 생성</h3>\n<p>먼저 사용자 정보를 저장하기 위한 모델을 생성하겠습니다. 간단히 이메일과 패스워드를 저장하는 테이블을 만들면 되겠네요.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami generate model user</code></pre>\n      </div>\n<p>앞으로 모든 하나미 커맨드 앞에는 <code class="language-text">bundle exec</code>  이 붙을 예정입니다. 앞으로 하나미를 자주 쓰게 되면 <code class="language-text">bashrc</code> 나  <code class="language-text">zshrc</code> 에 alias 지정을 해 두는걸 추천합니다.</p>\n<p>그리고 레일즈와 비슷하게 <code class="language-text">db/migrations</code> 폴더에 마이그레이션 파일이 있습니다. 어떤 컬럼에 어떤 정보가 들어가게 될 지 작성해주어야 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># db/migration/2017***_create_users.rb</span>\n<span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span><span class="token punctuation">.</span>migration <span class="token keyword">do</span>\n  change <span class="token keyword">do</span>\n    create_table <span class="token symbol">:users</span> <span class="token keyword">do</span>\n      primary_key <span class="token symbol">:id</span>\n\n      column <span class="token symbol">:email</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:password_digest</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n\n      column <span class="token symbol">:created_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:updated_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>방법에 따라서는 이메일 컬럼만 있어도 충분히 JWT 인증을 구현할 수 있다는데 아직 잘 모르겠습니다. 이제 테이블 생성을 위해 마이그레이션을 실행하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami db create # 먼저 데이터베이스 생성부터\nbundle exec hanami db migrate</code></pre>\n      </div>\n<h3 id="사용자-등록-액션"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%93%B1%EB%A1%9D-%EC%95%A1%EC%85%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자 등록 액션</h3>\n<p>이제 사용자를 등록하는 액션을 생성하겠습니다. 이후에 JWT 인증하는 과정을 덧붙일 예정입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami generate action api auth#sign_in --skip-view\nbundle exec hanami generate action api auth#sign_up --skip-view</code></pre>\n      </div>\n<p>action 뒤에 <code class="language-text">api</code> 는 제가 사용할 앱 이름입니다. 기본값은 web으로 되어 있지만, <a href="http://hanamirb.org/guides/command-line/generators/">하나미 가이드의 Command Line 부분을 참고하시면</a> 다른 앱을 생성하거나 삭제하는 등 액션을 실행할 수 있습니다.</p>\n<p><code class="language-text">--skip-view</code> 는 뷰와 관련된 템플릿 파일이나 뷰 클래스 및 테스트를 생성하지 않는 커맨드입니다. 우리는 하나미를 순순히 API 서버로 사용할 것이기 때문에 미리 입력해주어야 불필요한 파일을 만들지 않게 됩니다.</p>\n<p>라우팅 파일의 내용도 변경해줍니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/config/routes.rb</span>\npost <span class="token string">\'/auth/sign_in\'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">\'auth#sign_in\'</span>\npost <span class="token string">\'/auth/sign_up\'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">\'auth#sign_up\'</span></code></pre>\n      </div>\n<p>사용자를 등록하는 과정은 JWT랑은 관련이 없습니다. 단순히 이메일, 비밀번호, 비밀번호 확인을 하는 패러매터를 전달 받은 뒤, 유효성 검사에 성공하면 비밀번호를 암호화하여 데이터베이스에 저장하면 됩니다.</p>\n<p>우리는 JSON API 서버를 만들고 있기 때문에 애플리케이션의 <code class="language-text">body_parsers</code> 나 <code class="language-text">default_request_format</code> 등의 설정을 바꾸어 주어야 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/application.rb</span>\n<span class="token comment"># From Line 90</span>\n      <span class="token comment"># Default format for the requests that don\'t specify an HTTP_ACCEPT header</span>\n      <span class="token comment"># Argument: A symbol representation of a mime type, defaults to :html</span>\n      <span class="token comment">#</span>\n      default_request_format <span class="token symbol">:json</span>\n\n      <span class="token comment"># Default format for responses that don\'t consider the request format</span>\n      <span class="token comment"># Argument: A symbol representation of a mime type, defaults to :html</span>\n      <span class="token comment">#</span>\n      default_response_format <span class="token symbol">:json</span>\n\n      <span class="token comment"># HTTP Body parsers</span>\n      <span class="token comment"># Parse non GET responses body for a specific mime type</span>\n      <span class="token comment"># Argument: Symbol, which represent the format of the mime type</span>\n      <span class="token comment">#             (only `:json` is supported)</span>\n      <span class="token comment">#           Object, the parser</span>\n      <span class="token comment">#</span>\n      body_parsers <span class="token symbol">:json</span>\n<span class="token comment"># ...</span></code></pre>\n      </div>\n<p>이제 안정적으로 기능을 구현하기 위해 테스트를 작성하겠습니다. 테스트 파일은 <code class="language-text">spec/</code> 폴더에 있습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># spec/api/controllers/auth/sign_up_spec.rb</span>\n<span class="token keyword">require</span> <span class="token string">\'spec_helper\'</span>\nrequire_relative <span class="token string">\'../../../../apps/api/controllers/auth/sign_up\'</span>\n\ndescribe <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Auth</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SignUp</span> <span class="token keyword">do</span>\n  <span class="token function">let</span><span class="token punctuation">(</span><span class="token symbol">:action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Auth</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SignUp</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token punctuation">}</span>\n  <span class="token function">let</span><span class="token punctuation">(</span><span class="token symbol">:params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> <span class="token string">"foo@bar.com"</span><span class="token punctuation">,</span>\n        password<span class="token punctuation">:</span> <span class="token string">"secret"</span><span class="token punctuation">,</span>\n        password_confirmation<span class="token punctuation">:</span> <span class="token string">"secret"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  describe <span class="token string">\'with valid params\'</span> <span class="token keyword">do</span>\n    it <span class="token string">\'is successful\'</span> <span class="token keyword">do</span>\n      response <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>must_equal <span class="token number">201</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n\n  describe <span class="token string">\'with invalid params\'</span> <span class="token keyword">do</span>\n    it <span class="token string">\'returns 422\'</span> <span class="token keyword">do</span>\n      response <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n      response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>must_equal <span class="token number">422</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>먼저 유효성 검사부터 만들겠습니다. 하나미의 유효성 검사는 모델에서 수행하는 게 아니라 각 액션에서 수행합니다. (공통된 유효성 검사를 모듈화할 수도 있습니다)</p>\n<p><strong>작성되는 코드는 모두 테스트를 먼저 작성하고 진행하지만, 글에서 모두 보여드리지 않겠습니다. 자세한 내용은 <a href="https://github.com/emaren84/moneybook_api">Github에 올라와 있는 소스코드</a>를 살펴봐 주세요.</strong></p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/auth/sign_up.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignUp</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n\n    <span class="token constant">VALID_EMAIL_REGEX</span> <span class="token operator">=</span> <span class="token regex">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:email</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">,</span> format<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">VALID_EMAIL_REGEX</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:password</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span><span class="token punctuation">.</span>confirmation\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p><code class="language-text">halt</code> 메서드는 인자로 받은 스테이터스 번호와 메세지를 리턴합니다. 메세지는 생략 가능합니다. 이제 올바른 패러매터가 들어왔으면  사용자를 등록하면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># same file</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignUp</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n\n    <span class="token constant">VALID_EMAIL_REGEX</span> <span class="token operator">=</span> <span class="token regex">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:email</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">,</span> format<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">VALID_EMAIL_REGEX</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:password</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span><span class="token punctuation">.</span>confirmation\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>interactor<span class="token punctuation">:</span> <span class="token constant">UserSignUp</span><span class="token punctuation">)</span>\n      <span class="token variable">@interactor</span> <span class="token operator">=</span> interactor\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n\n      result <span class="token operator">=</span> <span class="token variable">@interactor</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call\n      status <span class="token number">201</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>user<span class="token punctuation">.</span>show_info<span class="token punctuation">.</span>to_json\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>뭔가 이상한 녀석이 나왔습니다. interactor라뇨? 인터렉터(Interactor)는 하나미에서 제공하는 모듈인데, 보통 다양한 비지니스 처리 로직을 분리하는 용도 혹은 재사용 가능한 비지니스 로직을 API, Web 같이 서로 다른 앱에서도 공유할 수 있도록 만들어졌습니다. <code class="language-text">lib/interactor</code> 에 해당 클래스명으로 작성합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># lib/interactor/user_sign_up.rb</span>\n<span class="token keyword">require</span> <span class="token string">"hanami/interactor"</span>\n<span class="token keyword">require</span> <span class="token string">"bcrypt"</span>\n\n<span class="token keyword">class</span> <span class="token class-name">UserSignUp</span>\n  include <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Interactor</span>\n  include <span class="token constant">BCrypt</span>\n\n  expose <span class="token symbol">:user</span>\n\n  <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>user_attr<span class="token punctuation">,</span> encryptor<span class="token punctuation">:</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> repo<span class="token punctuation">:</span> <span class="token keyword">nil</span><span class="token punctuation">)</span>\n    <span class="token variable">@user_attr</span> <span class="token operator">=</span> user_attr\n    <span class="token variable">@encryptor</span> <span class="token operator">=</span> encryptor <span class="token operator">||</span> <span class="token constant">BCrypt</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Password</span>\n    <span class="token variable">@repo</span> <span class="token operator">=</span> repo <span class="token operator">||</span> <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span>\n  <span class="token class-name">end</span>\n\n  <span class="token keyword">def</span> call\n    safe_user <span class="token operator">=</span> <span class="token function">encrypt_user</span><span class="token punctuation">(</span>user_attr<span class="token punctuation">)</span>\n    <span class="token variable">@user</span> <span class="token operator">=</span> <span class="token variable">@repo</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>safe_user<span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n\n  <span class="token keyword">private</span>\n\n  attr_reader <span class="token symbol">:user_attr</span>\n\n  <span class="token keyword">def</span> <span class="token function">encrypt_user</span><span class="token punctuation">(</span>attributes<span class="token punctuation">)</span>\n    password <span class="token operator">=</span> <span class="token variable">@encryptor</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>attributes<span class="token punctuation">[</span><span class="token symbol">:password</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n    <span class="token punctuation">{</span> email<span class="token punctuation">:</span> user_attr<span class="token punctuation">[</span><span class="token symbol">:email</span><span class="token punctuation">]</span><span class="token punctuation">,</span> password_digest<span class="token punctuation">:</span> password <span class="token punctuation">}</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>눈여겨 보실점은 <code class="language-text">expose</code> 밖에 없고 나머지는 일반적인 사용자 등록 로직으로 구성되어 있습니다. 인터렉터는 해당 클래스의 객체를 생성하고 <code class="language-text">call</code> 메서드로 연산을 수행하는데, 그 결과값을 <code class="language-text">expose</code> 로 내보내야 합니다. 참고로 <code class="language-text">expose</code> 로 내보내려는 값은 인스턴스 변수여야 합니다. 여기서는 <code class="language-text">@user</code> 가 되겠네요. 내보낸 결과물은 메서드처럼 <code class="language-text">.user</code> 로 가져올 수 있습니다.</p>\n<p>그런데 액션 부분에 <code class="language-text">result.user.show_info.to_json</code>  이라고 되어있는 부분이 있습니다. <code class="language-text">to_json</code> 은 리턴값이 JSON이어야 되니까 그렇다 치고, <code class="language-text">show_info</code> 는 어디에 있는 녀석일까요? 방금까지 우리는 사용자를 생성했습니다. 그리고 생성된 결과값이 User Entity(엔티티)인데, 엔티티에 메서드를 정의하여 원하는 정보를 가공하여 보여줄 수 있도록 만든 것입니다. 콘솔에서 한번 확인해 보겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami console</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">[2] pry(main)&gt; UserRepository.new.create(email: &#39;foo@baz.com&#39;, password_digest: &#39;some secret&#39;)\n[moneybook_api] [INFO] [2017-04-22 14:06:37 +0900] (0.003739s) INSERT INTO &quot;users&quot; (&quot;email&quot;, &quot;password_digest&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (&#39;foo@baz.com&#39;, &#39;some secret&#39;, &#39;2017-04-22 05:06:37.222355+0000&#39;, &#39;2017-04-22 05:06:37.222355+0000&#39;) RETURNING &quot;id&quot;, &quot;email&quot;, &quot;password_digest&quot;, &quot;created_at&quot;, &quot;updated_at&quot;\n=&gt; #&lt;User:0x007fb6a6c49348\n @attributes=\n  {:id=&gt;3, :email=&gt;&quot;foo@baz.com&quot;, :password_digest=&gt;&quot;some secret&quot;, :created_at=&gt;2017-04-22 05:06:37 UTC, :updated_at=&gt;2017-04-22 05:06:37 UTC}&gt;</code></pre>\n      </div>\n<p>저렇게 임의의 사용자를 생성하니 User 엔티티가 리턴된 것을 볼 수 있습니다. Repository가 뭐고, Entity가 무엇인지는 <a href="https://emaren84.github.io/blog/archivers/hanami-introduction#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0">제가 전에 작성한 하나미 소개 포스트를 참고해주세요.</a></p>\n<p>엔티티 클래스 파일의 위치는 <code class="language-text">lib/moneybook_api/entities</code> 입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># lib/moneybook_api/entities/user.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Entity</span>\n  <span class="token keyword">def</span> show_info\n    <span class="token keyword">self</span><span class="token punctuation">.</span>to_h<span class="token punctuation">.</span>tap <span class="token punctuation">{</span> <span class="token operator">|</span>attributes<span class="token operator">|</span> attributes<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token symbol">:password_digest</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>이렇게 하여 사용자 생성 후 리턴 값에는 패스워드를 뺸 나머지 정보만 보이게 됩니다.</p>\n<h3 id="토큰-생성하기"><a href="#%ED%86%A0%ED%81%B0-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>토큰 생성하기</h3>\n<p>이제부터가 본격적인 JWT 인증을 구현하는 부분입니다. 생성한 사용자가 로그인을 시도하고 요청한 이메일과 비밀번호가 맞다면 우리는 인증 토큰을 생성하여 돌려주게 되고, 사용자는 매번 로그인 할 필요 없이 그 토큰을 가지고 (유효기간이 만료할 때 까지) 자유로이 앱을 사용할 수 있게 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/controllers/auth/sign_in.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignIn</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n\n    <span class="token constant">VALID_EMAIL_REGEX</span> <span class="token operator">=</span> <span class="token regex">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:email</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">,</span> format<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">VALID_EMAIL_REGEX</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:password</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n      email <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">,</span> <span class="token symbol">:email</span><span class="token punctuation">)</span>\n      password <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">,</span> <span class="token symbol">:password</span><span class="token punctuation">)</span>\n\n      user <span class="token operator">=</span> <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">find_by_email</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>\n\n      <span class="token keyword">if</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>valid_password<span class="token operator">?</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>\n        token <span class="token operator">=</span> <span class="token constant">JwtIssuer</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n\n        status <span class="token number">201</span><span class="token punctuation">,</span> token<span class="token punctuation">.</span>to_json\n      <span class="token keyword">else</span>\n        halt <span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">\'Authentication Failed\'</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>유효성 검사를 하는 부분은 회원 등록 하는 액션에서도 적어놓았기 때문에 쉽게 알아보실 수 있을겁니다. 바로 아래에 <code class="language-text">params.get</code> 이라는 메서드는 <code class="language-text">Hash#dig</code> 메서드와 비슷한 용도를 가지고 있는데 <code class="language-text">params[:user][:email]</code> 같이 값을 검색하려다가 <code class="language-text">params[:user]</code> 가 <code class="language-text">nil</code> 인 경우 <code class="language-text">NoMethodError</code> 에러가 발생하는 일을 방지해줍니다. 대신 <code class="language-text">nil</code> 을 리턴합니다.</p>\n<p><code class="language-text">find_by_email</code> 같은 메서드는 레일즈를 하시는 분들이 보기엔 아주 친숙할겁니다. 하지만 우리는 이 메서드를 직접 구현해야 합니다. 레일즈로 개발하면서 느끼는 마법은 하나미에서는 일어나지 않습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># lib/moneybook_api/repositories/user_repository.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">UserRepository</span> <span class="token operator">&lt;</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Repository</span>\n  <span class="token keyword">def</span> <span class="token function">find_by_email</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>\n    users<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span> email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token symbol">:entity</span><span class="token punctuation">)</span><span class="token punctuation">.</span>one\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p><strong>모든 하나미의 쿼리 메서드는 private 입니다. 콘솔에서 바로 테스트 할 수 없습니다.</strong> 테스트를 작성하거나, 원하는 쿼리를 메서드로 정의한 뒤에 콘솔에서 돌려봐야 합니다.</p>\n<p><code class="language-text">users</code> 는 리퍼지토리와 연결되어있는 테이블명을 나타내는 규약입니다. 만약 <code class="language-text">BookRepository</code> 에서 <code class="language-text">books</code> 라는 테이블의 내용을 가져오게 된다면 우리는 <code class="language-text">books.</code> 로 시작하는 메서드를 작성하게 됩니다. 자세한 내용은 하나미 모델의 구현체인 <a href="http://rom-rb.org">ROM</a>의 문서를 참고하시는게 좋습니다.</p>\n<p>레일즈를 개발하는 분들은 보통 쿼리의 결과가 각 모델의 객체로 나오기 때문에 이후에 각 엔티티마다 메서드를 바로 사용할 수 있을겁니다. 하지만 하나미에서는 <code class="language-text">as(:entity)</code> 옵션을 적용해주지 않으면 결과물이 단순한 <code class="language-text">ROM::Struct</code> 객체를 리턴하거나. <code class="language-text">ROM::Relation</code> 객체를 리턴하는 경우가 많습니다.</p>\n<p><code class="language-text">Struct</code> 객체는 Hash처럼 되어있어서, 쿼리의 결과 레코드를 그대로 쓰는 건 가능하지만 엔티티에 정의해놓은 메서드를 사용할 수 없습니다. <code class="language-text">Relation</code> 객체는 쿼리를 아직 실행하기 전에 ROM에서 쿼리를 준비해 놓는 객체입니다. 이 객체에 <code class="language-text">to_a</code> 나 <code class="language-text">each</code> 같은 메서드를 사용해서 자료를 가공할 때 쿼리를 실행하고, 그 때 엔티티를 다룰 수 있습니다.</p>\n<p>지금은 간단한 쿼리라서 <code class="language-text">.as(:entity)</code> 부분을 빼도 결과값을 맨 앞 한개만 출력하라는 <code class="language-text">one</code> 메서드 때문에 바로 User 엔티티가 출력될겁니다. 이후에 더 복잡한 쿼리를 작성하게 되는 일이 있을 때 제가 말씀드린 내용이 도움이 되었으면 좋겠습니다.</p>\n<p><code class="language-text">user.valid_password?</code> 메서드는 <code class="language-text">BCrypt</code> 젬을 이용하여 암호화했던 비밀번호를 해독하고, 맞는지 확인하는 역할을 합니다.</p>\n<p><code class="language-text">JwtIssuer</code> 클래스는 라이브러리로 활용하기 위해 <code class="language-text">lib/moneybook_api/services</code> 폴더에 작성했습니다. 여기에 작성해 두면 다른 앱이나 액션에서 자유롭게 사용할 수 있기 때문입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># lib/moneybook_api/services</span>\n<span class="token keyword">class</span> <span class="token class-name">JwtIssuer</span>\n  <span class="token constant">DEFAULT_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">86400</span> <span class="token comment"># 24 hours</span>\n\n  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> exp <span class="token operator">=</span> <span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>to_i <span class="token operator">+</span> <span class="token constant">DEFAULT_EXPIRE_TIME</span><span class="token punctuation">)</span>\n    payload <span class="token operator">=</span> <span class="token punctuation">{</span> user_id<span class="token punctuation">:</span> user_id<span class="token punctuation">,</span> iss<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'JWT_ISSUER\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> exp<span class="token punctuation">:</span> exp <span class="token punctuation">}</span>\n    token <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'JWT_SECRET\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'HS256\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span> auth_token<span class="token punctuation">:</span> token <span class="token punctuation">}</span>\n  <span class="token keyword">end</span>\n\n  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n    <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'JWT_SECRET\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>코드의 내용은 <a href="https://github.com/jwt/ruby-jwt/blob/master/README.md#algorithms-and-usage">JWT 젬의 사용법을 따라</a> 우리가 필요한 부분을 캡슐화한 정도입니다. 토큰 생성 시점에서 24시간의 기한을 주었고, <code class="language-text">iss</code> 옵션은 발행자 옵션인데, 임의로 <code class="language-text">localhost</code> 로 지정해두었습니다. <code class="language-text">ENV[&#39;JWT_SECRET&#39;]</code> 같이 지정되어있는 환경변수를 가져오는 방법은 프로젝트 폴더에 <code class="language-text">.env.development</code> 같이 되어있는 파일에다 작성는 것입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text"># .env.development\n# ...\nJWT_SECRET=&quot;some secret&quot;\n# ...</code></pre>\n      </div>\n<p>비밀번호 토큰은 여러분이 원하는대로 만든 다음에, <code class="language-text">Base64</code> 나 <code class="language-text">Digest</code> 클래스를 활용하여 암호화하시길 추천합니다.</p>\n<p>인코딩에 성공하면 컨트롤러 액션은 201 스테이터스와 함께 토큰 JSON을 리턴하게 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">$ curl -X POST -H &quot;Content-Type: application/json&quot; -H &quot;Accept: application/json&quot; -d &#39;{ &quot;user&quot;: { &quot;email&quot;: &quot;foo@bar.com&quot;, &quot;foo&quot;: &quot;cherryblossom&quot; } }&#39; &quot;http://localhost:2300/api/auth/sign_in&quot;\n=&gt;\n{\n  &quot;auth_token&quot;: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo0LCJpc3MiOiJsb2NhbGhvc3QiLCJleHAiOjE0OTI5NjM2NTV9.38-CWKZkOuWD_idEOhv1gAret6_qG_ue7kk0iPftJ_M&quot;\n}</code></pre>\n      </div>\n<p>이제 사용자가 매 요청을 할 때마다 이 토큰이 유효한지 검사하는 부분을 만들어야 하는데, 가계부 기록 작성과 관련된 API를 구현한 뒤에 마저 만들어 보겠습니다.</p>\n<h2 id="가계부-api-만들기"><a href="#%EA%B0%80%EA%B3%84%EB%B6%80-api-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>가계부 API 만들기</h2>\n<p>가계부 API는 간단한 REST 형식으로 만들 예정입니다.</p>\n<table>\n<thead>\n<tr>\n<th align="center">정의</th>\n<th align="center">내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">/records (GET)</td>\n<td align="center">모든 레코드를 가져온다</td>\n</tr>\n<tr>\n<td align="center">/records (POST)</td>\n<td align="center">레코드를 생성한다</td>\n</tr>\n<tr>\n<td align="center">/records/:record_id (PATCH)</td>\n<td align="center">해당 레코드를 수정한다</td>\n</tr>\n<tr>\n<td align="center">/records/:record_id(DELETE)</td>\n<td align="center">해당 레코드를 삭제한다</td>\n</tr>\n</tbody>\n</table>\n<p>RESTful API 라면 보통 사용자가 가지고 있는 레코드를 표현해야 하니까 URL 어딘가에 <code class="language-text">user_id</code> 같은게 있어야 할 것 처럼 보입니다. 하지만 우리가 구현하고자 하는 서버에는 필요가 없습니다. JWT 토큰을 HTTP 헤더에 추가하여 요청을 하면, 서버가 토큰을 해석하여 <code class="language-text">user_id</code> 를 찾아내고 그 값을 기반으로 특정 사용자의 레코드를 검색하게 됩니다.</p>\n<h3 id="모델-생성--라우팅"><a href="#%EB%AA%A8%EB%8D%B8-%EC%83%9D%EC%84%B1--%EB%9D%BC%EC%9A%B0%ED%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>모델 생성 &#x26; 라우팅</h3>\n<p>일단 레코드 모델과 레코드를 생성하는 액션을 만들고 나서, 토큰 인증 과정을 덧붙이도록 하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami generate model record</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># db/migrations/2017**_create_records.rb</span>\n<span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Model</span><span class="token punctuation">.</span>migration <span class="token keyword">do</span>\n  change <span class="token keyword">do</span>\n    create_table <span class="token symbol">:records</span> <span class="token keyword">do</span>\n      primary_key <span class="token symbol">:id</span>\n      foreign_key <span class="token symbol">:user_id</span><span class="token punctuation">,</span> <span class="token symbol">:users</span><span class="token punctuation">,</span> on_delete<span class="token punctuation">:</span> <span class="token symbol">:cascade</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n\n      column <span class="token symbol">:amount</span><span class="token punctuation">,</span>      <span class="token builtin">Integer</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:description</span><span class="token punctuation">,</span> <span class="token builtin">String</span>\n\n      column <span class="token symbol">:created_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:updated_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>외부 키는 컬럼 이름과, 연결해 줄 테이블 이름을 지정해줍니다. 나머지 뒤에 있는 요소들은 <a href="http://hanamirb.org/guides/migrations/create-table/">공식 문서에 자세한 설명이 있으니</a> 참조바랍니다. 그리고 마이그레이션을 실행하면 됩니다.</p>\n<p>그 다음에 액션을 생성하고 라우트를 지정하겠습니다. 다른 <code class="language-text">records</code> 관련 액션을 미리 생성해두셔도 상관 없습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">bundle exec hanami generate action api records#create --skip-view</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/config/routes.rb</span>\n<span class="token comment"># ...</span>\nresources <span class="token symbol">:records</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:index</span><span class="token punctuation">,</span> <span class="token symbol">:create</span><span class="token punctuation">,</span> <span class="token symbol">:update</span><span class="token punctuation">,</span> <span class="token symbol">:destroy</span><span class="token punctuation">]</span></code></pre>\n      </div>\n<p>이 부분은 레일즈의 자동 라우팅과 아주 유사합니다. 라우팅이 어떻게 구성되었는지 확인하시려면 <code class="language-text">bundle exec hanami routes</code> 커맨드를 실행하시면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">    Name Method     Path                           Action\n\n         POST       /api/auth/sign_in    Api::Controllers::Auth::SignIn\n         POST       /api/auth/sign_up    Api::Controllers::Auth::SignUp\n records GET, HEAD  /api/records         Api::Controllers::Records::Index\n records POST       /api/records         Api::Controllers::Records::Create\n  record PATCH      /api/records/:id     Api::Controllers::Records::Update\n  record DELETE     /api/records/:id     Api::Controllers::Records::Destroy</code></pre>\n      </div>\n<h3 id="레코드-생성"><a href="#%EB%A0%88%EC%BD%94%EB%93%9C-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>레코드 생성</h3>\n<p>이제 세부 로직을 구현할 준비가 끝났으니 레코드 생성을 해 보겠습니다. 지금은 임의의 사용자를 지정하여 레코드를 생성하려 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/records/create.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Create</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:amount</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:int?</span><span class="token punctuation">)</span>\n        <span class="token function">optional</span><span class="token punctuation">(</span><span class="token symbol">:description</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n      user <span class="token operator">=</span> <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span>first\n      amount <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">,</span> <span class="token symbol">:amount</span><span class="token punctuation">)</span>\n      description <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">,</span> <span class="token symbol">:description</span><span class="token punctuation">)</span>\n\n      record <span class="token operator">=</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>\n        user_id<span class="token punctuation">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>\n        amount<span class="token punctuation">:</span> amount<span class="token punctuation">,</span>\n        description<span class="token punctuation">:</span> description\n      <span class="token punctuation">)</span>\n\n      status <span class="token number">201</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span>to_json\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>패러매터가 유효하면 레코드를 생성하고 그 정보를 JSON으로 리턴하는 간단한 내용의 코드입니다. 이제 패러매터의 유효성은 둘째치고 모든 액션에 앞서 토큰의 유효성을 검사하는 모듈이 필요합니다. 이 파일을 어디에 정의하고 어떻게 사용하는지 <a href="http://hanamirb.org/guides/actions/share-code/">가이드에 잘 설명이 되어있는데</a>, 가이드의 내용을 활용하여 만들어보겠습니다.</p>\n<h3 id="토큰-인증"><a href="#%ED%86%A0%ED%81%B0-%EC%9D%B8%EC%A6%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>토큰 인증</h3>\n<p>컨트롤러에 공통적으로 사용되는 모듈은 해당 앱의 <code class="language-text">/controllers</code> 폴더에다 바로 작성하면 됩니다. 그리고 모든 컨트롤러 액션에 공통적으로 사용하고자 하면 <code class="language-text">application.rb</code> 파일을 수정해야 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/authentication.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span>\n  <span class="token keyword">module</span> <span class="token constant">Authentication</span>\n    <span class="token keyword">module</span> <span class="token constant">Skip</span>\n      <span class="token keyword">def</span> authenticate<span class="token operator">!</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">included</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>\n      action<span class="token punctuation">.</span>class_eval <span class="token keyword">do</span>\n        before <span class="token symbol">:authenticate!</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">private</span>\n\n    <span class="token keyword">def</span> authenticate<span class="token operator">!</span>\n      halt <span class="token number">401</span> <span class="token keyword">unless</span> authenticated<span class="token operator">?</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> authenticated<span class="token operator">?</span>\n      <span class="token operator">!</span><span class="token operator">!</span>current_user\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> current_user\n      user_id <span class="token operator">=</span> validate_token <span class="token operator">?</span> validate_token<span class="token punctuation">[</span><span class="token string">\'user_id\'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">nil</span>\n      <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> validate_token\n      token_header <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">get_header</span><span class="token punctuation">(</span><span class="token string">\'HTTP_AUTHORIZATION\'</span><span class="token punctuation">)</span>\n      token <span class="token operator">=</span> token_header<span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span><span class="token regex">/^Bearer\\s/</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n\n      <span class="token keyword">begin</span>\n        <span class="token constant">JwtIssuer</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n      <span class="token keyword">rescue</span>\n        <span class="token keyword">nil</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>몇 가지 이상한 녀석들이 나왔습니다. 일단 <code class="language-text">included</code> 메서드는 모듈이 특정 모듈이나 클래스에 <code class="language-text">include</code> 될 때 실행되는 훅(Hook)과 같은 메서드입니다. 인자 <code class="language-text">action</code> 은 이 모듈을 불러온 액션을 뜻합니다. 그리고 <code class="language-text">class_eval</code> 은 해당 클래스에 블락의 내용을 추가로 작성해주는 메서드라고 이해하시면 됩니다. 즉 이 모듈을 불러오는 클래스는 <code class="language-text">before :authenticate!</code> 라는 코드 라인이 추가되는겁니다. <code class="language-text">before</code> 는 레일즈의 <code class="language-text">before_action</code> 처럼 해당 액션을 실행하기 전에 먼저 실행되는 메서드를 정의합니다.</p>\n<p>마지막으로 <code class="language-text">request</code> 는 <code class="language-text">Rack::Request</code> 에 정의되어 있는 객체입니다 <a href="http://hanamirb.org/guides/actions/request-and-response/">가이드에 간단한 사용법이 있지만</a> 더 자세한 사용법을 보시려면 <a href="http://www.rubydoc.info/gems/rack/Rack/Request">직접 문서를 보셔야 합니다</a>.</p>\n<p>사용자는 발급받은 토큰을 매 HTTP 헤더에 실어서 보내야 합니다. 그 형식은 <code class="language-text">Authorization =&gt; Bearer {token}</code> 이 되도록 지정했습니다.</p>\n<p>이제 애플리케이션 설정 파일에서 이 모듈을 공통적으로 불러오게 하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/application.rb</span>\n<span class="token comment"># ...</span>\nrequire_relative <span class="token string">\'./controllers/authentication\'</span>\n<span class="token comment"># ...</span>\n      controller<span class="token punctuation">.</span>prepare <span class="token keyword">do</span>\n        include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Authentication</span> <span class="token comment"># included in all the actions</span>\n      <span class="token keyword">end</span>\n<span class="token comment"># ...</span></code></pre>\n      </div>\n<p>약 260번째 줄 부근에 해당 코드가 있습니다. 모든 컨트롤러 액션에 이 블록 안의 코드가 추가됩니다. 맨 윗줄에 <code class="language-text">require_relative</code> 로 파일을 불러오는 걸 잊어버리시면 안됩니다.</p>\n<p>그 다음 <code class="language-text">records#create</code> 액션의 코드를 수정해줍시다. 한 줄이면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/records/create.rb</span>\n<span class="token comment"># ...</span>\nuser <span class="token operator">=</span> current_user\n<span class="token comment"># ...</span></code></pre>\n      </div>\n<p>테스트를 잘 작성해오셨다면 전혀 뜬금없이 회원 가입, 로그인 액션에서 오류가 납니다. 인증 토큰을 요구할 필요가 없는 액션에서도 토큰을 요구하고 있기 때문입니다. 하지만 위에 인증을 스킵할 수 있도록 오버라이드용 메서드를 정의해 두었으니 <code class="language-text">Api::Authentication::Skip</code> 모듈을 불러오기만 하면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/auth/sign_up.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignUp</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Authentication</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Skip</span>\n<span class="token comment"># ...</span></code></pre>\n      </div>\n<h3 id="나머지-액션들-작성"><a href="#%EB%82%98%EB%A8%B8%EC%A7%80-%EC%95%A1%EC%85%98%EB%93%A4-%EC%9E%91%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>나머지 액션들 작성</h3>\n<p>이제 레코드를 만들고, 인증하는 과정을 만들었으니 나머지 액션들은 비교적 간단합니다. 간단하게 작성한 코드를 참고해주세요.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/records/index.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Index</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>repository<span class="token punctuation">:</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">)</span>\n      <span class="token variable">@repo</span> <span class="token operator">=</span> repository\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      status <span class="token number">200</span><span class="token punctuation">,</span> get_records<span class="token punctuation">.</span>to_json\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">private</span>\n\n    attr_reader <span class="token symbol">:repo</span>\n\n    <span class="token keyword">def</span> get_records\n      records <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">by_user</span><span class="token punctuation">(</span>current_user<span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token operator">|</span>record<span class="token operator">|</span> record<span class="token punctuation">.</span>to_h <span class="token punctuation">}</span>\n\n      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>tap <span class="token keyword">do</span> <span class="token operator">|</span>hash<span class="token operator">|</span>\n        hash<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token symbol">:records</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p><code class="language-text">by_user</code> 메서드는 <code class="language-text">RecordRepository</code> 에 정의되어 있습니다. 사실 레일즈 사용자분들이라면 모델에 <code class="language-text">has_many</code> 같은 메서드를 사용하여 1:N 관계를 정의하는 경우가 보편적일텐데요. 하나미도 <a href="http://hanamirb.org/guides/models/associations/">최근에 그런 기능을 지원하기 시작헀지만</a> 아직 실험적인 기능이기 때문에 직접 구현했습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># lib/moneybook_api/repositories/record_repository.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">RecordRepository</span> <span class="token operator">&lt;</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Repository</span>\n  <span class="token keyword">def</span> <span class="token function">by_user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>\n    records<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>user_id<span class="token punctuation">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>이후의 결과물은 완성된 Hash나 Array가 아니라 <code class="language-text">Enumerator</code> 같은 객체라서 원하는 결과물을 반복 메서드를 사용하여 다양하게 다룰 수 있습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby">require_relative <span class="token string">\'./set_record\'</span>\n\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Update</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n    include <span class="token constant">SetRecord</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:amount</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:int?</span><span class="token punctuation">)</span>\n        <span class="token function">optional</span><span class="token punctuation">(</span><span class="token symbol">:description</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>repository<span class="token punctuation">:</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">)</span>\n      <span class="token variable">@repo</span> <span class="token operator">=</span> repository\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n\n      <span class="token keyword">begin</span>\n        updated_record <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        status <span class="token number">200</span><span class="token punctuation">,</span> updated_record<span class="token punctuation">.</span>to_h<span class="token punctuation">.</span>to_json\n      <span class="token keyword">rescue</span>\n        status <span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">\'There was a problem during the process\'</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">private</span>\n\n    attr_reader <span class="token symbol">:repo</span><span class="token punctuation">,</span> <span class="token symbol">:record</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p><code class="language-text">SetRecord</code> 모듈도 <a href="http://hanamirb.org/guides/actions/share-code/">공식 가이드의 내용</a>을 참고하여 만들었습니다. Update와 Destroy 액션에서 공통적으로 레코드를 찾는 과정이 필요한데, 모듈에다 구현해두고 여러 액션에서 재활용할 수 있도록 만든겁니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/records/set_record.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Records</span>\n  <span class="token keyword">module</span> <span class="token constant">SetRecord</span>\n    <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">included</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>\n      action<span class="token punctuation">.</span>class_eval <span class="token keyword">do</span>\n        before <span class="token symbol">:set_record</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">private</span>\n\n    <span class="token keyword">def</span> set_record\n      <span class="token variable">@record</span> <span class="token operator">=</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n      halt <span class="token number">404</span> <span class="token keyword">unless</span> <span class="token variable">@record</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># apps/api/controllers/records/destroy.rb</span>\nrequire_relative <span class="token string">\'./set_record\'</span>\n\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Controllers</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Destroy</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Action</span>\n    include <span class="token constant">SetRecord</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>repository<span class="token punctuation">:</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">)</span>\n      <span class="token variable">@repo</span> <span class="token operator">=</span> repository\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      <span class="token keyword">begin</span>\n        repo<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n        status <span class="token number">204</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> success<span class="token punctuation">:</span> <span class="token string">\'Successfully Removed\'</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json\n      <span class="token keyword">rescue</span>\n        status <span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">\'There is a problem during the process\'</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">private</span>\n\n    attr_reader <span class="token symbol">:repo</span><span class="token punctuation">,</span> <span class="token symbol">:record</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre>\n      </div>\n<p>축하합니다. 여러분은 하나미로 간단 API 서버를 가독성 높고 모듈화하기 용이한 루비 코드로 작성하였습니다.</p>\n<hr>\n<p>사실 더 개선할 부분들은 많습니다. 예를 들면 Interactor 를 활용한 로직 분리, 명확한 의존성 주입으로 테스트 효율 높이기 + 더 짜임새 있는 테스트 작성 등을 고려해야겠지요. 마침 <a href="https://github.com/nickgnd/hanami-jwt-example">비슷한 내용의 예제 코드가 아주아주 높은 퀄리티로 작성되어 있어서</a> 이번 튜토리얼을 구현해보면서 기본 개념을 익히신 다음에, 다른 예제를 참고하시면 큰 도움이 될 것이라 생각합니다.</p>\n<ul>\n<li>Source Code: <a href="https://github.com/emaren84/moneybook_api">Github</a></li>\n</ul>',
id:"/home/circleci/repo/src/pages/posts/2017-04-27-hanami-vuejs-moneybook-api-server/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2017-04-27",path:"/posts/hanami-vuejs-moneybook-api-server",title:"Hanamirb + Vue.js 로 간단 가계부 구현 (API 서버 편)",tags:["Ruby","Hanami","Vue.js"],category:"Hanami"}}],tagName:"Vue.js"}}}});
//# sourceMappingURL=path---tags-vue-js-386a2c51635b7075d151.js.map