webpackJsonp([0xdbbd485a8257],{463:function(n,s){n.exports={pathContext:{postsByTag:[{excerpt:"Hanamirb + Vue.js 시리즈 목차 API 서버 로그인 & 회원가입 페이지 가계부 페이지 업데이트 BCrypt 관련 설명 수정 (2017-05-02) 들어가며 하나미 정식 버전이 지난 4월 6일에 발표되었습니다. 기존에 레일즈에 여러모로 아쉬움을 느끼고 있던 해외의 루비 개발자들은 많은 관심을 가지고 있나봅니다. 제가 처음 하나미를 접했을 때 버전이 0.7.2였는데 어느새 1.0.…",html:'<p><strong>Hanamirb + Vue.js 시리즈 목차</strong></p>\n<ol>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-api-server">API 서버</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-1">로그인 &#x26; 회원가입 페이지</a></p>\n</li>\n<li>\n<p><a href="/posts/hanami-vuejs-moneybook-frontend-2">가계부 페이지</a></p>\n</li>\n</ol>\n<hr>\n<p><strong>업데이트</strong></p>\n<ul>\n<li>BCrypt 관련 설명 수정 (2017-05-02)</li>\n</ul>\n<hr>\n<h2 id="들어가며"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>들어가며</h2>\n<p>하나미 정식 버전이 지난 4월 6일에 발표되었습니다. 기존에 레일즈에 여러모로 아쉬움을 느끼고 있던 해외의 루비 개발자들은 많은 관심을 가지고 있나봅니다. 제가 처음 하나미를 접했을 때 버전이 0.7.2였는데 어느새 1.0.0 버전이 발매되었고, 아직도 쓰고있다보니 감개무량합니다.</p>\n<p>요즘 프론트엔드 JS 프레임워크에 많은 관심을 가지고 ReactJS, Vue.js를 공부하고 있는데, 간단히 배운 내용을 적용해볼 겸 간단 가계부를 구현해보도록 하겠습니다. 백엔드 JSON API 서버는 하나미로 구현하고, 프론트엔드는 Vue.js로 구현하는 과정을 보여드리겠습니다.</p>\n<p>최대한 간단히 설명해드리려 노력하겠지만, 기존에 루비로 웹 개발을 해보신분이 이해하시기 쉬울 겁니다. 사실 JSON API 서버는 어떤 언어나 프레임워크로 제공해도 되니까요 :) 구현방법에 약간씩 차이가 있을 뿐이지 제가 보여드리는 정도의 앱은 그렇게 어렵지 않게 작성하실 수 있으리라 봅니다.</p>\n<h2 id="애플리케이션의-기본-구성"><a href="#%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>애플리케이션의 기본 구성</h2>\n<p>처음에는 더욱 간단한 To-Do List(할일 관리) 를 구현하려고 했는데, 그러면 하나미를 다루는 부분이 너무 영양가가 없어질 것 같아서 가계부 형식의 앱으로 만들고, 다음의 기능을 구상해 보았습니다.</p>\n<ul>\n<li>\n<p>회원 등록 및 인증</p>\n<ul>\n<li>이메일과 비밀번호로 회원 가입</li>\n<li>JWT로 인증 (토큰은 LocalStorage에 저장)</li>\n</ul>\n</li>\n<li>\n<p>사용금액, 내용 입력</p>\n<ul>\n<li>수입은 녹색, 지출은 빨강색으로 표시</li>\n<li>각 아이템을 클릭하면 바로 수정 가능, 삭제 버튼을 누르면 삭제</li>\n</ul>\n</li>\n<li>수입, 지출을 필터링하여 보기</li>\n<li>가장 최신 레코드 30개를 처음에 불러온 뒤, 화면에 보이는 마지막 내역까지 스크롤 하게 되면 추가로 자료 가져오기</li>\n</ul>\n<p>이 정도의 기능을 구현해볼 예정입니다. 막상 하려니 쉽진 않겠지만 차근차근 진행해보겠습니다.</p>\n<h2 id="하나미-프로젝트-생성"><a href="#%ED%95%98%EB%82%98%EB%AF%B8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>하나미 프로젝트 생성</h2>\n<p>너무나 당연하지만 하나미를 사용하기 위해서는 개발 환경에 루비가 세팅되어 있어야 합니다. 아직 루비가 설치되어있지 않은 경우에는 <a href="https://gorails.com/setup/">GoRails의 설치 가이드</a>를 따라하시면 되겠습니다. 그 다음에 하나미 젬을 설치하시면 됩니다. 이번 강좌에서는 <strong>루비 2.4.1</strong>, <strong>하나미 1.0.0</strong> 버전을 기준으로 프로젝트를 생성하겠습니다.</p>\n<p>먼저 하나미 젬을 설치합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>gem install hanami</code></pre>\n      </div>\n<p>설치 된 이후에 프로젝트는 원하시는 이름으로 설치하시면 됩니다. 하나미는 SQLite, MySQL, PostgreSQL 등을 지원하지만, 기본적으로 PostgreSQL을 권장합니다. 또한 테스팅 프레임워크도 처음 프로젝트를 설정할 때 Minitest, RSpec 중에서 고르실 수 있습니다. 제가 아직 RSpec은 커녕 TDD를 잘 못하기 때문에 Minitest로 진행해보겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>hanami new moneybook-api --database=postgres --test=minitest</code></pre>\n      </div>\n<p>생성된 프로젝트에서 젬파일을 살펴보시면 꽤 간단합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># Gemfile</span>\nsource <span class="token string">\'https://rubygems.org\'</span>\n\ngem <span class="token string">\'rake\'</span>\ngem <span class="token string">\'hanami\'</span><span class="token punctuation">,</span>       <span class="token string">\'~> 1.0\'</span>\ngem <span class="token string">\'hanami-model\'</span><span class="token punctuation">,</span> <span class="token string">\'~> 1.0\'</span>\n\ngem <span class="token string">\'pg\'</span>\n\ngroup <span class="token symbol">:development</span> <span class="token keyword">do</span>\n  <span class="token comment"># Code reloading</span>\n  <span class="token comment"># See: http://hanamirb.org/guides/projects/code-reloading</span>\n  gem <span class="token string">\'shotgun\'</span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:test</span><span class="token punctuation">,</span> <span class="token symbol">:development</span> <span class="token keyword">do</span>\n  gem <span class="token string">\'dotenv\'</span><span class="token punctuation">,</span> <span class="token string">\'~> 2.0\'</span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:test</span> <span class="token keyword">do</span>\n  gem <span class="token string">\'minitest\'</span>\n  gem <span class="token string">\'capybara\'</span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:production</span> <span class="token keyword">do</span>\n  <span class="token comment"># gem \'puma\'</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>이 중에서 <code>capybara</code> 젬은 뷰 테스트 용이기 떄문에 이번 프로젝트에선 굳이 없어도 됩니다. 앞으로 젬이 더 추가될테지만 필요에 따라 추가하기로 하고, <code>bundle install</code> 커맨드로 필요한 젬을 설치해두겠습니다.</p>\n<p>참고로 PostgreSQL을 이용하시려면 <code>.env</code> 파일에서 계정 설정을 해주셔야 합니다. SQLite를 이용하신다면 파일로 관리되기 때문에 계정 설정을 해 주실 필요는 없습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code># .env.development\nDATABASE_URL="postgresql://username:password@localhost/moneybook_api_development"</code></pre>\n      </div>\n<h2 id="사용자-인증-구현"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자 인증 구현</h2>\n<p>기존의 웹 페이지는 서버에서 인증 관련 정보를 들고, 세션을 이용하여 인증 상태를 유지하고 요청을 하는 경우가 많았습니다. 하지만 모바일 애플리케이션이나, 많은 인스턴스를 올려서 인증을 관리하는 경우 세션 기반 인증은 유연한 대응이 어렵습니다. JWT라는 개념을 이용하면 세션 기반 인증의 단점을 극복하고 사용자 인증을 적용할 수 있습니다.</p>\n<p>JWT 인증이 무엇인지 궁금하시다면 다음의 링크를 읽어보시길 바랍니다.</p>\n<ul>\n<li><a href="https://velopert.com/2389">JSON Web Token 소개 및 구조 - velopert</a></li>\n<li><a href="http://bcho.tistory.com/999">REST JWT 소개 - 조대협</a></li>\n<li><a href="https://jwt.io/introduction/">Introduction to JSON Web Tokens</a></li>\n</ul>\n<p>인증에 필요한 젬을 추가한 뒤, 사용자 정보를 기록하는 모델을 생성하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># Gemfile</span>\n<span class="token comment"># ...</span>\ngem <span class="token string">\'bcrypt\'</span>\ngem <span class="token string">\'jwt\'</span>\n<span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<p><code>bcrypt</code> 젬은 비밀번호 생성에 특화된 단방향 해시 함수를 지원합니다.<br>\n간단한 사용법을 알려드리면 <code>BCrypt::Password.create(\'password\')</code> 로 해시 다이제스트를 생성하고, <code>BCrypt::Password.new(digest)</code> 로 해시 다이제스트가 본래 비밀번호와 일치하는지 검사합니다.</p>\n<p>너무나 당연하면서 중요한 이야기지만 웹 개발자로서 복잡한 보안 알고리즘을 직접 구현하면 관리 및 취약점을 파악하기가 어렵기 때문에 차라리 <code>bcrypt</code> 처럼 검증된 라이브러리를 사용하시길 추천합니다. 비슷한 예로 Rails에서 사용자 인증과 관련한 부분은 되도록이면 Devise 젬을 사용하길 권장하는 것 처럼요.</p>\n<p>패스워드 저장 매커니즘에 대해 <a href="http://d2.naver.com/helloworld/318732">이 글</a>을 읽어보시길 추천합니다.</p>\n<h3 id="사용자-모델-생성"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%AA%A8%EB%8D%B8-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자 모델 생성</h3>\n<p>먼저 사용자 정보를 저장하기 위한 모델을 생성하겠습니다. 간단히 이메일과 패스워드를 저장하는 테이블을 만들면 되겠네요.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>bundle exec hanami generate model user</code></pre>\n      </div>\n<p>앞으로 모든 하나미 커맨드 앞에는 <code>bundle exec</code>  이 붙을 예정입니다. 앞으로 하나미를 자주 쓰게 되면 <code>bashrc</code> 나  <code>zshrc</code> 에 alias 지정을 해 두는걸 추천합니다.</p>\n<p>그리고 레일즈와 비슷하게 <code>db/migrations</code> 폴더에 마이그레이션 파일이 있습니다. 어떤 컬럼에 어떤 정보가 들어가게 될 지 작성해주어야 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># db/migration/2017***_create_users.rb</span>\n<span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Model</span><span class="token punctuation">.</span>migration <span class="token keyword">do</span>\n  change <span class="token keyword">do</span>\n    create_table <span class="token symbol">:users</span> <span class="token keyword">do</span>\n      primary_key <span class="token symbol">:id</span>\n\n      column <span class="token symbol">:email</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:password_digest</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n\n      column <span class="token symbol">:created_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:updated_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>방법에 따라서는 이메일 컬럼만 있어도 충분히 JWT 인증을 구현할 수 있다는데 아직 잘 모르겠습니다. 이제 테이블 생성을 위해 마이그레이션을 실행하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>bundle exec hanami db create # 먼저 데이터베이스 생성부터\nbundle exec hanami db migrate</code></pre>\n      </div>\n<h3 id="사용자-등록-액션"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%93%B1%EB%A1%9D-%EC%95%A1%EC%85%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자 등록 액션</h3>\n<p>이제 사용자를 등록하는 액션을 생성하겠습니다. 이후에 JWT 인증하는 과정을 덧붙일 예정입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>bundle exec hanami generate action api auth#sign_in --skip-view\nbundle exec hanami generate action api auth#sign_up --skip-view</code></pre>\n      </div>\n<p>action 뒤에 <code>api</code> 는 제가 사용할 앱 이름입니다. 기본값은 web으로 되어 있지만, <a href="http://hanamirb.org/guides/command-line/generators/">하나미 가이드의 Command Line 부분을 참고하시면</a> 다른 앱을 생성하거나 삭제하는 등 액션을 실행할 수 있습니다.</p>\n<p><code>--skip-view</code> 는 뷰와 관련된 템플릿 파일이나 뷰 클래스 및 테스트를 생성하지 않는 커맨드입니다. 우리는 하나미를 순순히 API 서버로 사용할 것이기 때문에 미리 입력해주어야 불필요한 파일을 만들지 않게 됩니다.</p>\n<p>라우팅 파일의 내용도 변경해줍니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/config/routes.rb</span>\npost <span class="token string">\'/auth/sign_in\'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">\'auth#sign_in\'</span>\npost <span class="token string">\'/auth/sign_up\'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">\'auth#sign_up\'</span>\n</code></pre>\n      </div>\n<p>사용자를 등록하는 과정은 JWT랑은 관련이 없습니다. 단순히 이메일, 비밀번호, 비밀번호 확인을 하는 패러매터를 전달 받은 뒤, 유효성 검사에 성공하면 비밀번호를 암호화하여 데이터베이스에 저장하면 됩니다.</p>\n<p>우리는 JSON API 서버를 만들고 있기 때문에 애플리케이션의 <code>body_parsers</code> 나 <code>default_request_format</code> 등의 설정을 바꾸어 주어야 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/application.rb</span>\n<span class="token comment"># From Line 90</span>\n      <span class="token comment"># Default format for the requests that don\'t specify an HTTP_ACCEPT header</span>\n      <span class="token comment"># Argument: A symbol representation of a mime type, defaults to :html</span>\n      <span class="token comment">#</span>\n      default_request_format <span class="token symbol">:json</span>\n\n      <span class="token comment"># Default format for responses that don\'t consider the request format</span>\n      <span class="token comment"># Argument: A symbol representation of a mime type, defaults to :html</span>\n      <span class="token comment">#</span>\n      default_response_format <span class="token symbol">:json</span>\n\n      <span class="token comment"># HTTP Body parsers</span>\n      <span class="token comment"># Parse non GET responses body for a specific mime type</span>\n      <span class="token comment"># Argument: Symbol, which represent the format of the mime type</span>\n      <span class="token comment">#             (only `:json` is supported)</span>\n      <span class="token comment">#           Object, the parser</span>\n      <span class="token comment">#</span>\n      body_parsers <span class="token symbol">:json</span>\n<span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<p>이제 안정적으로 기능을 구현하기 위해 테스트를 작성하겠습니다. 테스트 파일은 <code>spec/</code> 폴더에 있습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># spec/api/controllers/auth/sign_up_spec.rb</span>\n<span class="token keyword">require</span> <span class="token string">\'spec_helper\'</span>\nrequire_relative <span class="token string">\'../../../../apps/api/controllers/auth/sign_up\'</span>\n\ndescribe <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Auth</span><span class="token punctuation">:</span><span class="token symbol">:SignUp</span> <span class="token keyword">do</span>\n  <span class="token function">let</span><span class="token punctuation">(</span><span class="token symbol">:action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Auth</span><span class="token punctuation">:</span><span class="token symbol">:SignUp</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token punctuation">}</span>\n  <span class="token function">let</span><span class="token punctuation">(</span><span class="token symbol">:params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n      user<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> <span class="token string">"foo@bar.com"</span><span class="token punctuation">,</span>\n        password<span class="token punctuation">:</span> <span class="token string">"secret"</span><span class="token punctuation">,</span>\n        password_confirmation<span class="token punctuation">:</span> <span class="token string">"secret"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  describe <span class="token string">\'with valid params\'</span> <span class="token keyword">do</span>\n    it <span class="token string">\'is successful\'</span> <span class="token keyword">do</span>\n      response <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>must_equal <span class="token number">201</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n\n  describe <span class="token string">\'with invalid params\'</span> <span class="token keyword">do</span>\n    it <span class="token string">\'returns 422\'</span> <span class="token keyword">do</span>\n      response <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n      response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>must_equal <span class="token number">422</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>먼저 유효성 검사부터 만들겠습니다. 하나미의 유효성 검사는 모델에서 수행하는 게 아니라 각 액션에서 수행합니다. (공통된 유효성 검사를 모듈화할 수도 있습니다)</p>\n<p><strong>작성되는 코드는 모두 테스트를 먼저 작성하고 진행하지만, 글에서 모두 보여드리지 않겠습니다. 자세한 내용은 <a href="https://github.com/emaren84/moneybook_api">Github에 올라와 있는 소스코드</a>를 살펴봐 주세요.</strong></p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/auth/sign_up.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignUp</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    <span class="token constant">VALID_EMAIL_REGEX</span> <span class="token operator">=</span> <span class="token regex">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:email</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">,</span> format<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">VALID_EMAIL_REGEX</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:password</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span><span class="token punctuation">.</span>confirmation\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><code>halt</code> 메서드는 인자로 받은 스테이터스 번호와 메세지를 리턴합니다. 메세지는 생략 가능합니다. 이제 올바른 패러매터가 들어왔으면  사용자를 등록하면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># same file</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignUp</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    <span class="token constant">VALID_EMAIL_REGEX</span> <span class="token operator">=</span> <span class="token regex">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:email</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">,</span> format<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">VALID_EMAIL_REGEX</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:password</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span><span class="token punctuation">.</span>confirmation\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>interactor<span class="token punctuation">:</span> <span class="token constant">UserSignUp</span><span class="token punctuation">)</span>\n      <span class="token variable">@interactor</span> <span class="token operator">=</span> interactor\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n\n      result <span class="token operator">=</span> <span class="token variable">@interactor</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call\n      status <span class="token number">201</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>user<span class="token punctuation">.</span>show_info<span class="token punctuation">.</span>to_json\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>뭔가 이상한 녀석이 나왔습니다. interactor라뇨? 인터렉터(Interactor)는 하나미에서 제공하는 모듈인데, 보통 다양한 비지니스 처리 로직을 분리하는 용도 혹은 재사용 가능한 비지니스 로직을 API, Web 같이 서로 다른 앱에서도 공유할 수 있도록 만들어졌습니다. <code>lib/interactor</code> 에 해당 클래스명으로 작성합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># lib/interactor/user_sign_up.rb</span>\n<span class="token keyword">require</span> <span class="token string">"hanami/interactor"</span>\n<span class="token keyword">require</span> <span class="token string">"bcrypt"</span>\n\n<span class="token keyword">class</span> <span class="token class-name">UserSignUp</span>\n  include <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Interactor</span>\n  include <span class="token constant">BCrypt</span>\n\n  expose <span class="token symbol">:user</span>\n\n  <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>user_attr<span class="token punctuation">,</span> encryptor<span class="token punctuation">:</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> repo<span class="token punctuation">:</span> <span class="token keyword">nil</span><span class="token punctuation">)</span>\n    <span class="token variable">@user_attr</span> <span class="token operator">=</span> user_attr\n    <span class="token variable">@encryptor</span> <span class="token operator">=</span> encryptor <span class="token operator">||</span> <span class="token constant">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span>\n    <span class="token variable">@repo</span> <span class="token operator">=</span> repo <span class="token operator">||</span> <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span>\n  <span class="token class-name">end</span>\n\n  <span class="token keyword">def</span> call\n    safe_user <span class="token operator">=</span> <span class="token function">encrypt_user</span><span class="token punctuation">(</span>user_attr<span class="token punctuation">)</span>\n    <span class="token variable">@user</span> <span class="token operator">=</span> <span class="token variable">@repo</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>safe_user<span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n\n  private\n\n  attr_reader <span class="token symbol">:user_attr</span>\n\n  <span class="token keyword">def</span> <span class="token function">encrypt_user</span><span class="token punctuation">(</span>attributes<span class="token punctuation">)</span>\n    password <span class="token operator">=</span> <span class="token variable">@encryptor</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>attributes<span class="token punctuation">[</span><span class="token symbol">:password</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n    <span class="token punctuation">{</span> email<span class="token punctuation">:</span> user_attr<span class="token punctuation">[</span><span class="token symbol">:email</span><span class="token punctuation">]</span><span class="token punctuation">,</span> password_digest<span class="token punctuation">:</span> password <span class="token punctuation">}</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>눈여겨 보실점은 <code>expose</code> 밖에 없고 나머지는 일반적인 사용자 등록 로직으로 구성되어 있습니다. 인터렉터는 해당 클래스의 객체를 생성하고 <code>call</code> 메서드로 연산을 수행하는데, 그 결과값을 <code>expose</code> 로 내보내야 합니다. 참고로 <code>expose</code> 로 내보내려는 값은 인스턴스 변수여야 합니다. 여기서는 <code>@user</code> 가 되겠네요. 내보낸 결과물은 메서드처럼 <code>.user</code> 로 가져올 수 있습니다.</p>\n<p>그런데 액션 부분에 <code>result.user.show_info.to_json</code>  이라고 되어있는 부분이 있습니다. <code>to_json</code> 은 리턴값이 JSON이어야 되니까 그렇다 치고, <code>show_info</code> 는 어디에 있는 녀석일까요? 방금까지 우리는 사용자를 생성했습니다. 그리고 생성된 결과값이 User Entity(엔티티)인데, 엔티티에 메서드를 정의하여 원하는 정보를 가공하여 보여줄 수 있도록 만든 것입니다. 콘솔에서 한번 확인해 보겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>bundle exec hanami console</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>[2] pry(main)> UserRepository.new.create(email: \'foo@baz.com\', password_digest: \'some secret\')\n[moneybook_api] [INFO] [2017-04-22 14:06:37 +0900] (0.003739s) INSERT INTO "users" ("email", "password_digest", "created_at", "updated_at") VALUES (\'foo@baz.com\', \'some secret\', \'2017-04-22 05:06:37.222355+0000\', \'2017-04-22 05:06:37.222355+0000\') RETURNING "id", "email", "password_digest", "created_at", "updated_at"\n=> #<User:0x007fb6a6c49348\n @attributes=\n  {:id=>3, :email=>"foo@baz.com", :password_digest=>"some secret", :created_at=>2017-04-22 05:06:37 UTC, :updated_at=>2017-04-22 05:06:37 UTC}></code></pre>\n      </div>\n<p>저렇게 임의의 사용자를 생성하니 User 엔티티가 리턴된 것을 볼 수 있습니다. Repository가 뭐고, Entity가 무엇인지는 <a href="https://emaren84.github.io/blog/archivers/hanami-introduction#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0">제가 전에 작성한 하나미 소개 포스트를 참고해주세요.</a></p>\n<p>엔티티 클래스 파일의 위치는 <code>lib/moneybook_api/entities</code> 입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># lib/moneybook_api/entities/user.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Entity</span>\n  <span class="token keyword">def</span> show_info\n    <span class="token keyword">self</span><span class="token punctuation">.</span>to_h<span class="token punctuation">.</span>tap <span class="token punctuation">{</span> <span class="token operator">|</span>attributes<span class="token operator">|</span> attributes<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token symbol">:password_digest</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>이렇게 하여 사용자 생성 후 리턴 값에는 패스워드를 뺸 나머지 정보만 보이게 됩니다.</p>\n<h3 id="토큰-생성하기"><a href="#%ED%86%A0%ED%81%B0-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>토큰 생성하기</h3>\n<p>이제부터가 본격적인 JWT 인증을 구현하는 부분입니다. 생성한 사용자가 로그인을 시도하고 요청한 이메일과 비밀번호가 맞다면 우리는 인증 토큰을 생성하여 돌려주게 되고, 사용자는 매번 로그인 할 필요 없이 그 토큰을 가지고 (유효기간이 만료할 때 까지) 자유로이 앱을 사용할 수 있게 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/controllers/auth/sign_in.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignIn</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    <span class="token constant">VALID_EMAIL_REGEX</span> <span class="token operator">=</span> <span class="token regex">/\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:email</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">,</span> format<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">VALID_EMAIL_REGEX</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:password</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n      email <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">,</span> <span class="token symbol">:email</span><span class="token punctuation">)</span>\n      password <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:user</span><span class="token punctuation">,</span> <span class="token symbol">:password</span><span class="token punctuation">)</span>\n\n      user <span class="token operator">=</span> <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">find_by_email</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>\n\n      <span class="token keyword">if</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>valid_password<span class="token operator">?</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>\n        token <span class="token operator">=</span> <span class="token constant">JwtIssuer</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n\n        status <span class="token number">201</span><span class="token punctuation">,</span> token<span class="token punctuation">.</span>to_json\n      <span class="token keyword">else</span>\n        halt <span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">\'Authentication Failed\'</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>유효성 검사를 하는 부분은 회원 등록 하는 액션에서도 적어놓았기 때문에 쉽게 알아보실 수 있을겁니다. 바로 아래에 <code>params.get</code> 이라는 메서드는 <code>Hash#dig</code> 메서드와 비슷한 용도를 가지고 있는데 <code>params[:user][:email]</code> 같이 값을 검색하려다가 <code>params[:user]</code> 가 <code>nil</code> 인 경우 <code>NoMethodError</code> 에러가 발생하는 일을 방지해줍니다. 대신 <code>nil</code> 을 리턴합니다.</p>\n<p><code>find_by_email</code> 같은 메서드는 레일즈를 하시는 분들이 보기엔 아주 친숙할겁니다. 하지만 우리는 이 메서드를 직접 구현해야 합니다. 레일즈로 개발하면서 느끼는 마법은 하나미에서는 일어나지 않습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># lib/moneybook_api/repositories/user_repository.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">UserRepository</span> <span class="token operator">&lt;</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Repository</span>\n  <span class="token keyword">def</span> <span class="token function">find_by_email</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>\n    users<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span> email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as</span><span class="token punctuation">(</span><span class="token symbol">:entity</span><span class="token punctuation">)</span><span class="token punctuation">.</span>one\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><strong>모든 하나미의 쿼리 메서드는 private 입니다. 콘솔에서 바로 테스트 할 수 없습니다.</strong> 테스트를 작성하거나, 원하는 쿼리를 메서드로 정의한 뒤에 콘솔에서 돌려봐야 합니다.</p>\n<p><code>users</code> 는 리퍼지토리와 연결되어있는 테이블명을 나타내는 규약입니다. 만약 <code>BookRepository</code> 에서 <code>books</code> 라는 테이블의 내용을 가져오게 된다면 우리는 <code>books.</code> 로 시작하는 메서드를 작성하게 됩니다. 자세한 내용은 하나미 모델의 구현체인 <a href="http://rom-rb.org">ROM</a>의 문서를 참고하시는게 좋습니다.</p>\n<p>레일즈를 개발하는 분들은 보통 쿼리의 결과가 각 모델의 객체로 나오기 때문에 이후에 각 엔티티마다 메서드를 바로 사용할 수 있을겁니다. 하지만 하나미에서는 <code>as(:entity)</code> 옵션을 적용해주지 않으면 결과물이 단순한 <code>ROM::Struct</code> 객체를 리턴하거나. <code>ROM::Relation</code> 객체를 리턴하는 경우가 많습니다.</p>\n<p><code>Struct</code> 객체는 Hash처럼 되어있어서, 쿼리의 결과 레코드를 그대로 쓰는 건 가능하지만 엔티티에 정의해놓은 메서드를 사용할 수 없습니다. <code>Relation</code> 객체는 쿼리를 아직 실행하기 전에 ROM에서 쿼리를 준비해 놓는 객체입니다. 이 객체에 <code>to_a</code> 나 <code>each</code> 같은 메서드를 사용해서 자료를 가공할 때 쿼리를 실행하고, 그 때 엔티티를 다룰 수 있습니다.</p>\n<p>지금은 간단한 쿼리라서 <code>.as(:entity)</code> 부분을 빼도 결과값을 맨 앞 한개만 출력하라는 <code>one</code> 메서드 때문에 바로 User 엔티티가 출력될겁니다. 이후에 더 복잡한 쿼리를 작성하게 되는 일이 있을 때 제가 말씀드린 내용이 도움이 되었으면 좋겠습니다.</p>\n<p><code>user.valid_password?</code> 메서드는 <code>BCrypt</code> 젬을 이용하여 암호화했던 비밀번호를 해독하고, 맞는지 확인하는 역할을 합니다.</p>\n<p><code>JwtIssuer</code> 클래스는 라이브러리로 활용하기 위해 <code>lib/moneybook_api/services</code> 폴더에 작성했습니다. 여기에 작성해 두면 다른 앱이나 액션에서 자유롭게 사용할 수 있기 때문입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># lib/moneybook_api/services</span>\n<span class="token keyword">class</span> <span class="token class-name">JwtIssuer</span>\n  <span class="token constant">DEFAULT_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">86400</span> <span class="token comment"># 24 hours</span>\n\n  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> exp <span class="token operator">=</span> <span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>to_i <span class="token operator">+</span> <span class="token constant">DEFAULT_EXPIRE_TIME</span><span class="token punctuation">)</span>\n    payload <span class="token operator">=</span> <span class="token punctuation">{</span> user_id<span class="token punctuation">:</span> user_id<span class="token punctuation">,</span> iss<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'JWT_ISSUER\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> exp<span class="token punctuation">:</span> exp <span class="token punctuation">}</span>\n    token <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'JWT_SECRET\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'HS256\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span> auth_token<span class="token punctuation">:</span> token <span class="token punctuation">}</span>\n  <span class="token keyword">end</span>\n\n  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n    <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'JWT_SECRET\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>코드의 내용은 <a href="https://github.com/jwt/ruby-jwt/blob/master/README.md#algorithms-and-usage">JWT 젬의 사용법을 따라</a> 우리가 필요한 부분을 캡슐화한 정도입니다. 토큰 생성 시점에서 24시간의 기한을 주었고, <code>iss</code> 옵션은 발행자 옵션인데, 임의로 <code>localhost</code> 로 지정해두었습니다. <code>ENV[\'JWT_SECRET\']</code> 같이 지정되어있는 환경변수를 가져오는 방법은 프로젝트 폴더에 <code>.env.development</code> 같이 되어있는 파일에다 작성는 것입니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code># .env.development\n# ...\nJWT_SECRET="some secret"\n# ...</code></pre>\n      </div>\n<p>비밀번호 토큰은 여러분이 원하는대로 만든 다음에, <code>Base64</code> 나 <code>Digest</code> 클래스를 활용하여 암호화하시길 추천합니다.</p>\n<p>인코딩에 성공하면 컨트롤러 액션은 201 스테이터스와 함께 토큰 JSON을 리턴하게 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ curl -X POST -H "Content-Type: application/json" -H "Accept: application/json" -d \'{ "user": { "email": "foo@bar.com", "foo": "cherryblossom" } }\' "http://localhost:2300/api/auth/sign_in"\n=>\n{\n  "auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo0LCJpc3MiOiJsb2NhbGhvc3QiLCJleHAiOjE0OTI5NjM2NTV9.38-CWKZkOuWD_idEOhv1gAret6_qG_ue7kk0iPftJ_M"\n}</code></pre>\n      </div>\n<p>이제 사용자가 매 요청을 할 때마다 이 토큰이 유효한지 검사하는 부분을 만들어야 하는데, 가계부 기록 작성과 관련된 API를 구현한 뒤에 마저 만들어 보겠습니다.</p>\n<h2 id="가계부-api-만들기"><a href="#%EA%B0%80%EA%B3%84%EB%B6%80-api-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>가계부 API 만들기</h2>\n<p>가계부 API는 간단한 REST 형식으로 만들 예정입니다.</p>\n<table>\n<thead>\n<tr>\n<th align="center">정의</th>\n<th align="center">내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">/records (GET)</td>\n<td align="center">모든 레코드를 가져온다</td>\n</tr>\n<tr>\n<td align="center">/records (POST)</td>\n<td align="center">레코드를 생성한다</td>\n</tr>\n<tr>\n<td align="center">/records/:record_id (PATCH)</td>\n<td align="center">해당 레코드를 수정한다</td>\n</tr>\n<tr>\n<td align="center">/records/:record_id(DELETE)</td>\n<td align="center">해당 레코드를 삭제한다</td>\n</tr>\n</tbody>\n</table>\n<p>RESTful API 라면 보통 사용자가 가지고 있는 레코드를 표현해야 하니까 URL 어딘가에 <code>user_id</code> 같은게 있어야 할 것 처럼 보입니다. 하지만 우리가 구현하고자 하는 서버에는 필요가 없습니다. JWT 토큰을 HTTP 헤더에 추가하여 요청을 하면, 서버가 토큰을 해석하여 <code>user_id</code> 를 찾아내고 그 값을 기반으로 특정 사용자의 레코드를 검색하게 됩니다.</p>\n<h3 id="모델-생성--라우팅"><a href="#%EB%AA%A8%EB%8D%B8-%EC%83%9D%EC%84%B1--%EB%9D%BC%EC%9A%B0%ED%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>모델 생성 &#x26; 라우팅</h3>\n<p>일단 레코드 모델과 레코드를 생성하는 액션을 만들고 나서, 토큰 인증 과정을 덧붙이도록 하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>bundle exec hanami generate model record</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># db/migrations/2017**_create_records.rb</span>\n<span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Model</span><span class="token punctuation">.</span>migration <span class="token keyword">do</span>\n  change <span class="token keyword">do</span>\n    create_table <span class="token symbol">:records</span> <span class="token keyword">do</span>\n      primary_key <span class="token symbol">:id</span>\n      foreign_key <span class="token symbol">:user_id</span><span class="token punctuation">,</span> <span class="token symbol">:users</span><span class="token punctuation">,</span> on_delete<span class="token punctuation">:</span> <span class="token symbol">:cascade</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n\n      column <span class="token symbol">:amount</span><span class="token punctuation">,</span>      <span class="token builtin">Integer</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:description</span><span class="token punctuation">,</span> <span class="token builtin">String</span>\n\n      column <span class="token symbol">:created_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:updated_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>외부 키는 컬럼 이름과, 연결해 줄 테이블 이름을 지정해줍니다. 나머지 뒤에 있는 요소들은 <a href="http://hanamirb.org/guides/migrations/create-table/">공식 문서에 자세한 설명이 있으니</a> 참조바랍니다. 그리고 마이그레이션을 실행하면 됩니다.</p>\n<p>그 다음에 액션을 생성하고 라우트를 지정하겠습니다. 다른 <code>records</code> 관련 액션을 미리 생성해두셔도 상관 없습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>bundle exec hanami generate action api records#create --skip-view</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/config/routes.rb</span>\n<span class="token comment"># ...</span>\nresources <span class="token symbol">:records</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:index</span><span class="token punctuation">,</span> <span class="token symbol">:create</span><span class="token punctuation">,</span> <span class="token symbol">:update</span><span class="token punctuation">,</span> <span class="token symbol">:destroy</span><span class="token punctuation">]</span>\n</code></pre>\n      </div>\n<p>이 부분은 레일즈의 자동 라우팅과 아주 유사합니다. 라우팅이 어떻게 구성되었는지 확인하시려면 <code>bundle exec hanami routes</code> 커맨드를 실행하시면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>    Name Method     Path                           Action\n\n         POST       /api/auth/sign_in    Api::Controllers::Auth::SignIn\n         POST       /api/auth/sign_up    Api::Controllers::Auth::SignUp\n records GET, HEAD  /api/records         Api::Controllers::Records::Index\n records POST       /api/records         Api::Controllers::Records::Create\n  record PATCH      /api/records/:id     Api::Controllers::Records::Update\n  record DELETE     /api/records/:id     Api::Controllers::Records::Destroy</code></pre>\n      </div>\n<h3 id="레코드-생성"><a href="#%EB%A0%88%EC%BD%94%EB%93%9C-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>레코드 생성</h3>\n<p>이제 세부 로직을 구현할 준비가 끝났으니 레코드 생성을 해 보겠습니다. 지금은 임의의 사용자를 지정하여 레코드를 생성하려 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/records/create.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Create</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:amount</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:int?</span><span class="token punctuation">)</span>\n        <span class="token function">optional</span><span class="token punctuation">(</span><span class="token symbol">:description</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n      user <span class="token operator">=</span> <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span>first\n      amount <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">,</span> <span class="token symbol">:amount</span><span class="token punctuation">)</span>\n      description <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">,</span> <span class="token symbol">:description</span><span class="token punctuation">)</span>\n\n      record <span class="token operator">=</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>\n        user_id<span class="token punctuation">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>\n        amount<span class="token punctuation">:</span> amount<span class="token punctuation">,</span>\n        description<span class="token punctuation">:</span> description\n      <span class="token punctuation">)</span>\n\n      status <span class="token number">201</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span>to_json\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>패러매터가 유효하면 레코드를 생성하고 그 정보를 JSON으로 리턴하는 간단한 내용의 코드입니다. 이제 패러매터의 유효성은 둘째치고 모든 액션에 앞서 토큰의 유효성을 검사하는 모듈이 필요합니다. 이 파일을 어디에 정의하고 어떻게 사용하는지 <a href="http://hanamirb.org/guides/actions/share-code/">가이드에 잘 설명이 되어있는데</a>, 가이드의 내용을 활용하여 만들어보겠습니다.</p>\n<h3 id="토큰-인증"><a href="#%ED%86%A0%ED%81%B0-%EC%9D%B8%EC%A6%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>토큰 인증</h3>\n<p>컨트롤러에 공통적으로 사용되는 모듈은 해당 앱의 <code>/controllers</code> 폴더에다 바로 작성하면 됩니다. 그리고 모든 컨트롤러 액션에 공통적으로 사용하고자 하면 <code>application.rb</code> 파일을 수정해야 합니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/authentication.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span>\n  <span class="token keyword">module</span> <span class="token constant">Authentication</span>\n    <span class="token keyword">module</span> <span class="token constant">Skip</span>\n      <span class="token keyword">def</span> authenticate<span class="token operator">!</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">included</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>\n      action<span class="token punctuation">.</span>class_eval <span class="token keyword">do</span>\n        before <span class="token symbol">:authenticate!</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    private\n\n    <span class="token keyword">def</span> authenticate<span class="token operator">!</span>\n      halt <span class="token number">401</span> <span class="token keyword">unless</span> authenticated<span class="token operator">?</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> authenticated<span class="token operator">?</span>\n      <span class="token operator">!</span><span class="token operator">!</span>current_user\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> current_user\n      user_id <span class="token operator">=</span> validate_token <span class="token operator">?</span> validate_token<span class="token punctuation">[</span><span class="token string">\'user_id\'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">nil</span>\n      <span class="token constant">UserRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> validate_token\n      token_header <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">get_header</span><span class="token punctuation">(</span><span class="token string">\'HTTP_AUTHORIZATION\'</span><span class="token punctuation">)</span>\n      token <span class="token operator">=</span> token_header<span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span><span class="token regex">/^Bearer\\s/</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n\n      <span class="token keyword">begin</span>\n        <span class="token constant">JwtIssuer</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n      <span class="token keyword">rescue</span>\n        <span class="token keyword">nil</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>몇 가지 이상한 녀석들이 나왔습니다. 일단 <code>included</code> 메서드는 모듈이 특정 모듈이나 클래스에 <code>include</code> 될 때 실행되는 훅(Hook)과 같은 메서드입니다. 인자 <code>action</code> 은 이 모듈을 불러온 액션을 뜻합니다. 그리고 <code>class_eval</code> 은 해당 클래스에 블락의 내용을 추가로 작성해주는 메서드라고 이해하시면 됩니다. 즉 이 모듈을 불러오는 클래스는 <code>before :authenticate!</code> 라는 코드 라인이 추가되는겁니다. <code>before</code> 는 레일즈의 <code>before_action</code> 처럼 해당 액션을 실행하기 전에 먼저 실행되는 메서드를 정의합니다.</p>\n<p>마지막으로 <code>request</code> 는 <code>Rack::Request</code> 에 정의되어 있는 객체입니다 <a href="http://hanamirb.org/guides/actions/request-and-response/">가이드에 간단한 사용법이 있지만</a> 더 자세한 사용법을 보시려면 <a href="http://www.rubydoc.info/gems/rack/Rack/Request">직접 문서를 보셔야 합니다</a>.</p>\n<p>사용자는 발급받은 토큰을 매 HTTP 헤더에 실어서 보내야 합니다. 그 형식은 <code>Authorization => Bearer {token}</code> 이 되도록 지정했습니다.</p>\n<p>이제 애플리케이션 설정 파일에서 이 모듈을 공통적으로 불러오게 하겠습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/application.rb</span>\n<span class="token comment"># ...</span>\nrequire_relative <span class="token string">\'./controllers/authentication\'</span>\n<span class="token comment"># ...</span>\n      controller<span class="token punctuation">.</span>prepare <span class="token keyword">do</span>\n        include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Authentication</span> <span class="token comment"># included in all the actions</span>\n      <span class="token keyword">end</span>\n<span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<p>약 260번째 줄 부근에 해당 코드가 있습니다. 모든 컨트롤러 액션에 이 블록 안의 코드가 추가됩니다. 맨 윗줄에 <code>require_relative</code> 로 파일을 불러오는 걸 잊어버리시면 안됩니다.</p>\n<p>그 다음 <code>records#create</code> 액션의 코드를 수정해줍시다. 한 줄이면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/records/create.rb</span>\n<span class="token comment"># ...</span>\nuser <span class="token operator">=</span> current_user\n<span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<p>테스트를 잘 작성해오셨다면 전혀 뜬금없이 회원 가입, 로그인 액션에서 오류가 납니다. 인증 토큰을 요구할 필요가 없는 액션에서도 토큰을 요구하고 있기 때문입니다. 하지만 위에 인증을 스킵할 수 있도록 오버라이드용 메서드를 정의해 두었으니 <code>Api::Authentication::Skip</code> 모듈을 불러오기만 하면 됩니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/auth/sign_up.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Auth</span>\n  <span class="token keyword">class</span> <span class="token class-name">SignUp</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Authentication</span><span class="token punctuation">:</span><span class="token symbol">:Skip</span>\n<span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<h3 id="나머지-액션들-작성"><a href="#%EB%82%98%EB%A8%B8%EC%A7%80-%EC%95%A1%EC%85%98%EB%93%A4-%EC%9E%91%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>나머지 액션들 작성</h3>\n<p>이제 레코드를 만들고, 인증하는 과정을 만들었으니 나머지 액션들은 비교적 간단합니다. 간단하게 작성한 코드를 참고해주세요.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/records/index.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Index</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>repository<span class="token punctuation">:</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">)</span>\n      <span class="token variable">@repo</span> <span class="token operator">=</span> repository\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      status <span class="token number">200</span><span class="token punctuation">,</span> get_records<span class="token punctuation">.</span>to_json\n    <span class="token keyword">end</span>\n\n    private\n\n    attr_reader <span class="token symbol">:repo</span>\n\n    <span class="token keyword">def</span> get_records\n      records <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">by_user</span><span class="token punctuation">(</span>current_user<span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token operator">|</span>record<span class="token operator">|</span> record<span class="token punctuation">.</span>to_h <span class="token punctuation">}</span>\n\n      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>tap <span class="token keyword">do</span> <span class="token operator">|</span>hash<span class="token operator">|</span>\n        hash<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token symbol">:records</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><code>by_user</code> 메서드는 <code>RecordRepository</code> 에 정의되어 있습니다. 사실 레일즈 사용자분들이라면 모델에 <code>has_many</code> 같은 메서드를 사용하여 1:N 관계를 정의하는 경우가 보편적일텐데요. 하나미도 <a href="http://hanamirb.org/guides/models/associations/">최근에 그런 기능을 지원하기 시작헀지만</a> 아직 실험적인 기능이기 때문에 직접 구현했습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># lib/moneybook_api/repositories/record_repository.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">RecordRepository</span> <span class="token operator">&lt;</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Repository</span>\n  <span class="token keyword">def</span> <span class="token function">by_user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>\n    records<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>user_id<span class="token punctuation">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>이후의 결과물은 완성된 Hash나 Array가 아니라 <code>Enumerator</code> 같은 객체라서 원하는 결과물을 반복 메서드를 사용하여 다양하게 다룰 수 있습니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code>require_relative <span class="token string">\'./set_record\'</span>\n\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Update</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n    include <span class="token constant">SetRecord</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:amount</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:int?</span><span class="token punctuation">)</span>\n        <span class="token function">optional</span><span class="token punctuation">(</span><span class="token symbol">:description</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>repository<span class="token punctuation">:</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">)</span>\n      <span class="token variable">@repo</span> <span class="token operator">=</span> repository\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      halt <span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">\'Invalid Parameters\'</span> <span class="token keyword">unless</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n\n      <span class="token keyword">begin</span>\n        updated_record <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token symbol">:record</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        status <span class="token number">200</span><span class="token punctuation">,</span> updated_record<span class="token punctuation">.</span>to_h<span class="token punctuation">.</span>to_json\n      <span class="token keyword">rescue</span>\n        status <span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">\'There was a problem during the process\'</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    private\n\n    attr_reader <span class="token symbol">:repo</span><span class="token punctuation">,</span> <span class="token symbol">:record</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><code>SetRecord</code> 모듈도 <a href="http://hanamirb.org/guides/actions/share-code/">공식 가이드의 내용</a>을 참고하여 만들었습니다. Update와 Destroy 액션에서 공통적으로 레코드를 찾는 과정이 필요한데, 모듈에다 구현해두고 여러 액션에서 재활용할 수 있도록 만든겁니다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/records/set_record.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Records</span>\n  <span class="token keyword">module</span> <span class="token constant">SetRecord</span>\n    <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">included</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>\n      action<span class="token punctuation">.</span>class_eval <span class="token keyword">do</span>\n        before <span class="token symbol">:set_record</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    private\n\n    <span class="token keyword">def</span> set_record\n      <span class="token variable">@record</span> <span class="token operator">=</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n      halt <span class="token number">404</span> <span class="token keyword">unless</span> <span class="token variable">@record</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/api/controllers/records/destroy.rb</span>\nrequire_relative <span class="token string">\'./set_record\'</span>\n\n<span class="token keyword">module</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Records</span>\n  <span class="token keyword">class</span> <span class="token class-name">Destroy</span>\n    include <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n    include <span class="token constant">SetRecord</span>\n\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>repository<span class="token punctuation">:</span> <span class="token constant">RecordRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">)</span>\n      <span class="token variable">@repo</span> <span class="token operator">=</span> repository\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      <span class="token keyword">begin</span>\n        repo<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n        status <span class="token number">204</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> success<span class="token punctuation">:</span> <span class="token string">\'Successfully Removed\'</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json\n      <span class="token keyword">rescue</span>\n        status <span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">\'There is a problem during the process\'</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>to_json\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    private\n\n    attr_reader <span class="token symbol">:repo</span><span class="token punctuation">,</span> <span class="token symbol">:record</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>축하합니다. 여러분은 하나미로 간단 API 서버를 가독성 높고 모듈화하기 용이한 루비 코드로 작성하였습니다.</p>\n<hr>\n<p>사실 더 개선할 부분들은 많습니다. 예를 들면 Interactor 를 활용한 로직 분리, 명확한 의존성 주입으로 테스트 효율 높이기 + 더 짜임새 있는 테스트 작성 등을 고려해야겠지요. 마침 <a href="https://github.com/nickgnd/hanami-jwt-example">비슷한 내용의 예제 코드가 아주아주 높은 퀄리티로 작성되어 있어서</a> 이번 튜토리얼을 구현해보면서 기본 개념을 익히신 다음에, 다른 예제를 참고하시면 큰 도움이 될 것이라 생각합니다.</p>\n<ul>\n<li>Source Code: <a href="https://github.com/emaren84/moneybook_api">Github</a></li>\n</ul>',
id:"/Users/rinae/Dev/blog/src/pages/posts/2017-04-27-hanami-vuejs-moneybook-api-server/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2017-04-27",path:"/posts/hanami-vuejs-moneybook-api-server",title:"Hanamirb + Vue.js 로 간단 가계부 구현 (API 서버 편)",tags:["Ruby","Hanami","Vue.js"],category:"Hanami"}},{excerpt:"기존에  Learn Vue.js 2  강좌를 보면서 Form 제출에 대한 프로젝트를 레일즈로 작성하는 부분까지 따라했었는데, 이번에 다시 익혀보면서 백엔드 구축을 하나미로 작성해보았다. 그 과정에서 webpack을 밑바닥부터 설정하는 에피소드를 참고하여 하나미를 기반으로 설정해 보았다. application.rb…",html:'<p>기존에 <a href="https://laracasts.com/series/learn-vue-2-step-by-step/">Learn Vue.js 2</a> 강좌를 보면서 Form 제출에 대한 프로젝트를 레일즈로 작성하는 부분까지 따라했었는데, 이번에 다시 익혀보면서 백엔드 구축을 하나미로 작성해보았다. 그 과정에서 webpack을 밑바닥부터 설정하는 에피소드를 참고하여 하나미를 기반으로 설정해 보았다.</p>\n<h2 id="applicationrb-설정하기"><a href="#applicationrb-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>application.rb 설정하기</h2>\n<p>프로젝트를 작성하고 레일즈로 작성해놓았던 코드도 옮기고 한 건 좋은데 제대로 돌아가는 게 하나도 없었다. 브라우저 콘솔에 나타난 에러를 가만히 들여다보니 Content Security Policy를 미리 설정해둘 필요가 있었다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># application.rb</span>\n<span class="token comment"># ...</span>\n      security<span class="token punctuation">.</span>content_security_policy <span class="token string">%{\n        form-action \'self\';\n        frame-ancestors \'self\';\n        base-uri \'self\';\n        default-src \'none\';\n        script-src \'self\' \'unsafe-inline\' \'unsafe-eval\' https:;\n        connect-src \'self\';\n        img-src \'self\' https: data:;\n        style-src \'self\' \'unsafe-inline\' https:;\n        font-src \'self\';\n        object-src \'none\';\n        plugin-types application/pdf;\n        child-src \'self\';\n        frame-src \'self\';\n        media-src \'self\'\n      }</span>\n<span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<p><code>script-src</code> 부분에 주목해야한다. <code>unsafe-inline</code> 뿐 아니라 <code>unsafe-eval</code> 도 추가해주어야 한다. 그리고 애셋을 하나미에서 컴파일하지 않도록 설정해주어야 한다. 그렇지 않으면 자동적으로 하나미가 컴파일되지 않은 파일을 <code>public</code> 폴더로 옮겨버린다. 나중에 다시 설정하는 법을 찾을 수 있을지 모르겠지만 <code>fingerprint</code> 도 사용하지 않도록 체크해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code>    <span class="token comment">##</span>\n    <span class="token comment"># DEVELOPMENT</span>\n    <span class="token comment">#</span>\n    configure <span class="token symbol">:development</span> <span class="token keyword">do</span>\n      <span class="token comment"># Don\'t handle exceptions, render the stack trace</span>\n      handle_exceptions <span class="token keyword">false</span>\n\n      assets <span class="token keyword">do</span>\n        compile <span class="token keyword">false</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n\t<span class="token comment"># ...</span>\n\n    <span class="token comment">##</span>\n    <span class="token comment"># PRODUCTION</span>\n    <span class="token comment">#</span>\n    configure <span class="token symbol">:production</span> <span class="token keyword">do</span>\n      <span class="token comment"># scheme \'https\'</span>\n      <span class="token comment"># host   \'example.org\'</span>\n      <span class="token comment"># port   443</span>\n\n      assets <span class="token keyword">do</span>\n        <span class="token comment"># Don\'t compile static assets in production mode (eg. Sass, ES6)</span>\n        <span class="token comment">#</span>\n        <span class="token comment"># See: http://www.rubydoc.info/gems/hanami-assets#Configuration</span>\n        compile <span class="token keyword">false</span>\n        \n        <span class="token comment"># Use fingerprint file name for asset paths</span>\n        <span class="token comment">#</span>\n        <span class="token comment"># See: http://hanamirb.org/guides/assets/overview</span>\n        fingerprint <span class="token keyword">false</span>\n        \n        <span class="token comment"># ...</span>\n</code></pre>\n      </div>\n<h2 id="yarn-init"><a href="#yarn-init" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>yarn init</h2>\n<p>현재로서 <code>npm</code> 보다 <code>yarn</code> 이 더 나아보이니까 한번 적용해보았다. 이번 프로젝트와 관련된 모듈들은 다음의 커맨드로 설치하면 된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code># 필수 모듈\n$ yarn add axios vue\n\n# 개발용 모듈\n$ yarn add webpack babel-core babel-loader babel-preset-es2015 --dev</code></pre>\n      </div>\n<h2 id="webpack-설정-파일-생성"><a href="#webpack-%EC%84%A4%EC%A0%95-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 설정 파일 생성</h2>\n<p>다음은 webpack을 설정하는 파일을 작성할 차례이다. 처음엔 아주 간단한 부분만 작성한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  entry<span class="token punctuation">:</span> <span class="token string">\'./apps/web/assets/javascript/app.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 타겟 파일 지정</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  \tpath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">\'/public/assets\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 번들된 파일 저장 위치, path 모듈을 불러와야한다.</span>\n  \tfilename<span class="token punctuation">:</span> <span class="token string">\'app.js\'</span><span class="token punctuation">,</span> <span class="token comment">// bundle.js를 많이 쓰는 경향이 있는데 이번엔 app.js로 지정</span>\n  \tpublicPath<span class="token punctuation">:</span> <span class="token string">\'./public\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>이렇게 설정을 해 주고 <code>app.js</code> 파일이 엔트리 포인트가 되도록 각 모듈 사이의 <code>import</code> 나 <code>export</code> 를 지정해준다.</p>\n<p>번들된 파일을 생성하기 위해선 다음 커맨드를 입력해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ node_modules/.bin/webpack --hide-modules\n# 계속 변화를 감지하기 위한 커맨드는 다음과 같다.\n$ node_modules/.bin/webpack --hide-modules --watch</code></pre>\n      </div>\n<p>하지만 저 커맨드를 굳이 매번 입력해 줄 필요는 없다. <code>package.json</code> 파일에 스크립트를 설정해줄 수 있다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code>// package.json\n<span class="token punctuation">{</span>\n  // ...\n  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"NODE_ENV=development webpack --hide-modules"</span><span class="token punctuation">,</span>\n    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"NODE_ENV=development webpack --hide-modules --watch"</span><span class="token punctuation">,</span>\n    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"NODE_ENV=production webpack --hide-modules"</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p><code>NODE_ENV</code> 에 대해서는 나중에 살펴 볼 것이다.</p>\n<p>하나미의 <code>application.html.erb</code> 파일에서는 <code>javascript</code> 뷰 헬퍼로 자바스크립트 파일을 불러오는데, body  태그 마지막에 불러오도록 한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code><span class="token comment">&lt;!-- ... --></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      &lt;%= yield %>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n    &lt;%= javascript \'app\' %>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token comment">&lt;!-- ... --></span>\n</code></pre>\n      </div>\n<p>대신 css 파일은 수동으로 옮겨주어야 할 것이다. <code>scss</code> 같은 preprocessing이 필요한 파일들은 어떻게 처리하는지 아직 실험해보지 못했다. 어차피 전부 webpack으로 해결할 수 있다.</p>\n<p>하지만 막상 번들된 파일을 불러와도 크롬에서 에러를 뿜으면서 랜더링이 되지 않았다. 왜인지 살펴보니 뷰의 모든 구성요소를 컴포넌트로 만들지 않고(Runtime-only), 기존에 작성한 html에 속성을 적용하려면(Full version) <a href="https://kr.vuejs.org/v2/guide/installation.html#Runtime-Compiler-vs-Runtime-only">별도의 설정</a>을 해 주어야 한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token string">\'vue$\'</span><span class="token punctuation">:</span> <span class="token string">\'vue/dist/vue.esm.js\'</span> <span class="token comment">// \'vue/dist/vue.common.js\'  webpack 1용 입니다</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>이렇게 하면 생각하던대로 작동한다. 나중에 다른 프로젝트에서 Vue 컴포넌트로만 빌드를 하게 되면 이 설정은 입력할 필요가 없을 것이다.</p>\n<h2 id="환경-변수-관리"><a href="#%ED%99%98%EA%B2%BD-%EB%B3%80%EC%88%98-%EA%B4%80%EB%A6%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>환경 변수 관리</h2>\n<p>윗부분에서 <code>NODE_ENV</code> 와 관련된 스크립트를 언급했는데, 프로덕션 모드에서는 번들된 패키지를 더 압축해주고, 프로덕션 모드임을 지정해주는 설정이 가능하다. 별도로 패키지를 설정해 줄 필요는 없고, webpack 설정 파일 제일 아랫부분에 스크립트를 더 추가해주어야 한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        warnings<span class="token punctuation">:</span> <span class="token boolean">false</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  \n  module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token string">\'process_env\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        NODE_ENV<span class="token punctuation">:</span> <span class="token string">\'"production"\'</span> <span class="token comment">// 오타가 아니고 따옴표 안에 겹따옴표 들어가는거 맞다</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">)</span><span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<h2 id="babel-적용하기"><a href="#babel-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>babel 적용하기</h2>\n<p>최신 버전 크롬은 ES6 문법 대부분을 지원하기 때문에 별 신경을 쓰지 않아도 되곘지만.. 그래도 바벨을 적용해두는게 좋을 것이다. </p>\n<p>위에서 필요한 모듈은 설치되어있으니 <code>.babelrc</code> 파일부터 지정해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code>// .babelrc\n<span class="token punctuation">{</span>\n  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">"modules"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>그리고 바벨에서 제공하는 <a href="http://babeljs.io/docs/setup/#installation">공식 문서를 따라</a> webpack 설정 파일에 다음 코드를 추가해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n      \ttest<span class="token punctuation">:</span> <span class="token regex">/\\.js$/</span><span class="token punctuation">,</span>\n      \texclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n      \tloader<span class="token punctuation">:</span> <span class="token string">"babel-loader"</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>이제부터 webpack을 실행하면 바벨로 변환된 결과물이 나온다.</p>\n<h2 id="라이브러리-나누어서-적용하기"><a href="#%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EB%82%98%EB%88%84%EC%96%B4%EC%84%9C-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>라이브러리 나누어서 적용하기</h2>\n<p>만약에 내가 자바스크립트 파일을 작성하다가 아주 일부분만 수정하고 다시 빌드를 해야하는 일이 있다고 할 때 계속 시간을 잡아먹는게 상당히 짜증날 것이다. 일단 기본적인 라이브러리는 내용이 변할 일이 없기 때문에 별도로 합쳐지도록 적용하고, 내가 실제로 작성하는 파일만 변화가 있을 때 다시 번들되도록 만들면 많은 시간을 단축할 수 있을 것이다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    app<span class="token punctuation">:</span> <span class="token string">\'./apps/web/assets/javascripts/app.js\'</span><span class="token punctuation">,</span>\n    vendor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'vue\'</span><span class="token punctuation">,</span> <span class="token string">\'axios\'</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">\'/public/assets\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].js\'</span><span class="token punctuation">,</span> <span class="token comment">// entry에 지정된 name(app, vendor)로 번들된 파일이 생성된다.</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'./public\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunckPlugin</span><span class="token punctuation">(</span>\n      <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'vendor\'</span> <span class="token punctuation">}</span> <span class="token comment">// vendor 파일 덩어리를 따로 보관하고 캐싱한다.</span>\n    <span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>이러고 나서 빌드를 마치고 나면 <code>public/assets</code> 폴더에는 <code>app.js</code>, <code>vendor.js</code> 두 개의 파일이 생성된다. 당연하게 레이아웃 페이지에서 <code>vendor.js</code> 파일도 로딩해주어야 한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code><span class="token comment">&lt;!-- ... --></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      &lt;%= yield %>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n    &lt;%= javascript \'vendor\', \'app\' %>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token comment">&lt;!-- ... --></span>\n</code></pre>\n      </div>\n<h2 id="css-파일도-관리하자"><a href="#css-%ED%8C%8C%EC%9D%BC%EB%8F%84-%EA%B4%80%EB%A6%AC%ED%95%98%EC%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 파일도 관리하자</h2>\n<p>이래저래 잘 작동하길래 슬슬 코드를 올려볼까 했더니 CSS 파일이 문제가 되었다. 물론 CSS 파일의 내용은 몇 줄 없지만, 매번 내용을 수정한 다음에 일일이 파일을 <code>public</code> 폴더로 옮기는건 아주 비효율적이다. 당연히 webpack이 CSS 파일도 모아줄 수 있다.</p>\n<p>먼저 필요한 모듈을 설치한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ yarn add css-loader extract-text-webpack-plugin --dev</code></pre>\n      </div>\n<p>그리고 설정파일에 CSS 관련 모듈 규칙과 플러그인을 추가해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>\n<span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'extract-text-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// ...</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span>\n        loader<span class="token punctuation">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          use<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token comment">// ...</span>\n    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">\'styles.css\'</span><span class="token punctuation">)</span> <span class="token comment">// 원하는 이름으로 지정</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n</code></pre>\n      </div>\n<p>이후 webpack을 실행하면 <code>public/assets</code> 폴더에 <code>styles.css</code> 파일이 추가된다. 나머지는 레이아웃 파일에서 이 파일을 불러오도록 만들면 된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    &lt;%= stylesheet \'https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.min.css\' %>\n    &lt;%= stylesheet \'styles\' %>\n    <span class="token comment">&lt;!-- ... --></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p>위 내용을 기반으로 작성한 간단한 프로젝트는 <a href="https://github.com/emaren84/hanami-webpack-config-example">Github</a>에 업로드 되어있다.</p>',id:"/Users/rinae/Dev/blog/src/pages/posts/2017-04-09-hanami-webpack-config/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2017-04-09",path:"/posts/hanami-webpack-config",title:"하나미 프로젝트에서 webpack 설정하기",tags:["Ruby","Hanami","Javascript","Webpack"],category:"Webpack"}},{excerpt:"본 포스트는  Luca Guidi의 포스팅을  번역한 글입니다 문제를 설명하는데 나온 하나미(Hanami…",html:'<ul>\n<li><strong>본 포스트는 <a href="https://lucaguidi.com/2016/12/27/isolate-global-state.html">Luca Guidi의 포스팅을</a> 번역한 글입니다</strong></li>\n<li><strong>문제를 설명하는데 나온 하나미(Hanami)에 대해서는 <a href="https://emaren84.github.io/blog/archivers/hanami-introduction">이 포스팅</a>을 참조해주세요</strong></li>\n<li><strong>전문 번역이 아니기에 부족한 표현이나 오역은 언제든지 지적해주세요</strong></li>\n</ul>\n<hr>\n<p>소프트웨어 프로그램에서 전역 상태를 사용하는건 개발하기엔 쉽지만 유지보수 할 때는 악몽이 된다. 예상치 못한 상황에서 발생하여 추적하기도 어려운 버그가 되기 쉽상이다.</p>\n<p>왜 그렇게 되는지, 그리고 어떻게 그 문제를 완화할 수 있을지 살펴보자.</p>\n<p><em>역주: 이 글에서 전역 상태는 전역 변수와 거의 동일한 의미로 사용되는 것으로 추정됩니다.</em></p>\n<h2 id="문제의-예시"><a href="#%EB%AC%B8%EC%A0%9C%EC%9D%98-%EC%98%88%EC%8B%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>문제의 예시</h2>\n<p>예를 들자면 하나미의 코드 베이스 안에서 우리는 환경 변수에 따라 어떻게 프레임워크가 설정되는지 테스트 할 필요가 있다.</p>\n<p>우리<em>(역주: 하나미 개발팀으로 보입니다)</em>는 보통 테스트를 이런 식으로 작성한다:</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token constant">RSpec</span><span class="token punctuation">.</span>describe <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Environment</span> <span class="token keyword">do</span>\n  before <span class="token keyword">do</span>\n    <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'HANAMI_ENV\'</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token keyword">nil</span>\n    <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'RACK_ENV\'</span><span class="token punctuation">]</span>    <span class="token operator">=</span> <span class="token keyword">nil</span>\n    <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'HANAMI_HOST\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>\n    <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'HANAMI_PORT\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>\n\n    <span class="token comment"># ...</span>\n  <span class="token keyword">end</span>\n\n  context <span class="token string">"when HANAMI_ENV is set"</span> <span class="token keyword">do</span>\n    before <span class="token keyword">do</span>\n      <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">\'HANAMI_ENV\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'production\'</span>\n      <span class="token variable">@env</span> <span class="token operator">=</span> described_class<span class="token punctuation">.</span><span class="token keyword">new</span>\n    <span class="token class-name">end</span>\n\n    <span class="token comment"># ...</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>우리는 보통 각각의 테스트를 실행하기 전에 모든 환경 변수를 초기화해왔다. 그리고 우리가 필요로 하는 특별한 상황(the edge case)에서만 하나씩 설정했다.</p>\n<p>이러한 접근 방식을 사용할 때의 <strong>문제는</strong> 이 방법이 루비 프로세스의 전역 상태를 <strong>더럽힌다는</strong> 것이다. 우리가 테스트 파일을 단독으로 실행할 때는  <code>before</code> 블록이 환경 변수를 리셋하기 때문에 잘 작동한다.</p>\n<p>그러나 모든 테스트를 한번에 실행할 때, 테스트는 꼬이게 될 것이다. 환경 변수 초기화가 언제나 작동하진 않기 때문이다.</p>\n<p>만약 한 테스트가 <code>ENV</code> 속성을 변환하고 나서 뒷정리를 하지 않으면, 그 다음 테스트는 기존의 <code>ENV</code> 값의 변화를 <strong>물려받아서</strong> 우리가 기대하던대로 작동하지 않을 수 있다.</p>\n<p>때때로 위의 예시 처럼 눈에 띄는 부분에서 변화를 준 경우에는 우리가 <code>after</code> 블록을 설정하여 뒷정리를 할 수 있다. 그러나 다른 때엔 변환한 것(the mutation)이 우리 눈에 보이지 않는 부분에서 부작용을 초래할 수 있다.</p>\n<p>이건 소스의 버그다. 그리고 이 버그는 엉킨 실타래처럼 되어 디버그하기 힘들다.</p>\n<p><strong>오랜 시간동안, 여러 가지 전역 상태의 조합하는 것은 하나미를 지속적 통합 개발(<a href="https://ko.wikipedia.org/wiki/%EC%A7%80%EC%86%8D%EC%A0%81_%ED%86%B5%ED%95%A9">CI builds</a>)이 힘들도록 만들고 여러 버그를 일으켰다.</strong></p>\n<p>개발자로서의 내 경험으로 미루어보아(<em>역주: Luca Guidi는 숙련된 웹 개발자입니다</em>) 이런 형태의 문제를 완화할 수 있는 유일한 방법은 <strong>전역 상태를 격리하거나, 전역 상태를 사용하는 것을 아예 피하는 것이다.</strong> 우리는 <strong>가능한한 전역 상태를 사용하는 것을 줄이도록</strong> 하나미의 내부 구현을 바꾸고 있다.</p>\n<h2 id="문제의-해법"><a href="#%EB%AC%B8%EC%A0%9C%EC%9D%98-%ED%95%B4%EB%B2%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>문제의 해법</h2>\n<p>앞서 이야기한 특별한 경우를 위해 우리는 환경 변수를 격리할 수 있는 새로운 객체를 선보였다. 이는 <code>Hanami::Env</code> 라고 불린다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token keyword">module</span> <span class="token constant">Hanami</span>\n  <span class="token keyword">class</span> <span class="token class-name">Env</span>\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>env<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">)</span>\n      <span class="token variable">@env</span> <span class="token operator">=</span> env\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>\n      <span class="token variable">@env</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n      <span class="token variable">@env</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n    <span class="token keyword">end</span>\n\n    <span class="token comment"># ...</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>구현 자체는 별 것 아니다: <code>ENV</code> 에 접근하는 것을 캡슐화하는 것이다.</p>\n<p>우리는 환경 변수를 관리하기 위해 자체 인터페이스를 정의했다. 우리는 명시적인 구현(concrete implementation)을 사용하기보다(<code>ENV</code>) 추상화(<code>Hanami::Env</code>)에 의존하고 있다(<a href="https://ko.wikipedia.org/wiki/%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84_%EC%97%AD%EC%A0%84_%EC%9B%90%EC%B9%99">의존관계 역전 원칙 참고</a>). </p>\n<p><code>Hanami::Environment</code> 는 프로젝트의 환경 변수를 설정하는 책임을 가지고 있는데, 우리는 이런 방식으로 사용한다:</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token keyword">module</span> <span class="token constant">Hanami</span>\n  <span class="token keyword">class</span> <span class="token class-name">Environment</span>\n    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>\n      opts <span class="token operator">=</span> options<span class="token punctuation">.</span>to_h<span class="token punctuation">.</span>dup\n      <span class="token variable">@env</span> <span class="token operator">=</span> <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Env</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>env<span class="token punctuation">:</span> opts<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token symbol">:env</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">ENV</span><span class="token punctuation">)</span>\n\n      <span class="token comment"># ...</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>우리가 하나미 프로젝트를 사용할 때, <code>:env</code> 옵션은 설정되지 않은 상태이다. 이로 인해 <code>@env</code> 는 <code>ENV</code> 를 참조하여 루비 프로세스의 진짜 환경 변수를 읽거나 쓰게 된다.</p>\n<p>이렇게 우리는 <code>Hanami::Environment</code> 의 테스트 중에 많은 양의 코드를 단순화하고, <strong>공유되고 변화 가능한 상태(shared mutable state, 즉 <code>ENV</code> 말이다)의 사용을 피할 수 있었다.</strong> 아래 코드에서 우리는 <code>ENV</code> 와 유사하게 동작하는 <code>:env</code> 를 객체의 옵션으로 전달하지만, 이 것은 실제로 <code>ENV</code>가 아니다: 그냥 <code>Hash</code> 이다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token constant">RSpec</span><span class="token punctuation">.</span>describe <span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Environment</span> <span class="token keyword">do</span>\n  context <span class="token string">"when HANAMI_ENV is set"</span> <span class="token keyword">do</span>\n    <span class="token function">let</span><span class="token punctuation">(</span><span class="token symbol">:env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token builtin">Hash</span><span class="token punctuation">[</span><span class="token string">"HANAMI_ENV"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"production"</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span>\n\n    it <span class="token string">"tests something interesting"</span>\n      <span class="token variable">@env</span> <span class="token operator">=</span> described_class<span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>env<span class="token punctuation">:</span> env<span class="token punctuation">)</span>  \n    <span class="token keyword">end</span>\n\n    <span class="token comment"># ...</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<h2 id="결론"><a href="#%EA%B2%B0%EB%A1%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결론</h2>\n<p><a href="https://ko.wikipedia.org/wiki/%EC%BA%A1%EC%8A%90%ED%99%94">캡슐화</a>와 <a href="http://solnic.eu/2013/12/17/the-world-needs-another-post-about-dependency-injection-in-ruby.html">의존성 주입</a>을 적절하게 사용하여, 각각의 테스트에서 발생할 수 있는 변화는 나머지 테스트에서는 보이지 않게 되었다. 결과적으로 안정적인 테스트 수행을 할 수 있게 되었고, 하나미 내부를 <a href="https://ko.wikipedia.org/wiki/SOLID">SOLID 디자인</a>에 맞게 구성할 수 있었다. </p>\n<hr>\n<h2 id="번역-후기"><a href="#%EB%B2%88%EC%97%AD-%ED%9B%84%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>번역 후기</h2>\n<p>보통 루비 프로젝트에서 <code>dotenv</code> 같은 젬으로 환경 변수를 관리합니다. 사실 이 환경 변수라는 개념도 저에게 아직 모호한 개념이지만, 객체지향 프로그래밍의 핵심적인 주제인 캡슐화와 의존성 주입을 어떤 식으로 활용하는지 좋은 예를 보여준 것 같아 한번 번역해보게 되었습니다.</p>\n<p>특히 제가 요즘에야 테스트를 작성해보기 시작했는데, 테스트를 개별로 실행할 때는 몰라도 전체 테스트를 실행할 때 원인을 알 수 없는 오류가 생길 때가 종종 있었습니다. 이 글을 통해 약간의 힌트를 얻었다는 생각도 듭니다. </p>',
id:"/Users/rinae/Dev/blog/src/pages/posts/2016-12-30-isolate-global-state-kor/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2016-12-30",path:"/posts/isolate-global-state-kor",title:"[번역] 전역 상태를 격리하라",tags:["Ruby","Hanami","Testing","Translation"],category:"Translation"}},{excerpt:"본 포스팅은  루비 대림절 달력 을 위해 제작하였습니다 기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다 작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다 들어가며 아직 갓…",html:'<ul>\n<li><strong>본 포스팅은 <a href="http://ruby-korea.github.io/advent-calendar/">루비 대림절 달력</a>을 위해 제작하였습니다</strong></li>\n<li><strong>기본적인 루비 언어 및 루비 온 레일즈의 이해도가 있는 독자를 대상으로 작성하였습니다</strong></li>\n<li><strong>작성자의 지식이 부족하여 설명이 부족하거나 잘못된 정보가 있다면 제보 부탁드립니다</strong></li>\n</ul>\n<h2 id="들어가며"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>들어가며</h2>\n<p>아직 갓 6개월 된 초보 개발자로서 이제 루비 온 레일즈(이하 레일즈)에 조금씩 익숙해지던 차에, 상사로부터 \'하나미라는 프레임워크가 있으니 한번 리서치를 해 보세요\' 라는 권유를 받았다. 그는 루비로 백엔드 서버들을 구축했지만 레일즈는 자신의 취향에 맞지 않다고 했고, 구조적으로도 하나미가 더 나아보인다고 이야기하였다.</p>\n<p>그리고 하나미 공식 가이드를 쭉 읽어본 나에게는 혼돈과 절망만 남았다. 루비 뿐 아니라 웹 개발의 기초 지식이 부족해서 그런지 도저히 이게 어떻게 돌아가는건지도 모르겠고, 레일즈에 대입해서 이해할 수 있는 것도 아니라는 생각이 들었다.</p>\n<p>다시 6개월을 다른 레일즈 프로젝트 제작, 리서치 작업을 하며 보내고 나니 회사에서는 본격적으로 레일즈 사용을 하지 않고 하나미를 사용하는 방향으로 가닥을 잡았다. 어쩌다가 레일즈라는 걸출한 웹 프레임워크를 두고 생소한 하나미라는 프레임워크를 사용하게 되었는지, 이번 기회를 통해 독자 분들의 관심을 이끄는 계기를 만들어보고자 한다.</p>\n<h2 id="변화가-일고-있는-레일즈-커뮤니티"><a href="#%EB%B3%80%ED%99%94%EA%B0%80-%EC%9D%BC%EA%B3%A0-%EC%9E%88%EB%8A%94-%EB%A0%88%EC%9D%BC%EC%A6%88-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>변화가 일고 있는 레일즈 커뮤니티</h2>\n<p>레일즈는 2005년에 처음 소개 된 이후 빠르고 쉬운 웹 애플리케이션 개발을 위한 도구로써 많은 개발자들의 사랑을 받아왔다.</p>\n<p>\'프로그래머의 단짝 친구\' 라고 소개할 정도로 쉽고 재미있는 언어인 루비를 기반으로 삼은 프레임워크이기도 하고, 꼭 루비 문법을 모두 꿰고 있어야 할 정도로 많은 지식을 알고 있지 않아도 금방 어지간한 웹 애플리케이션을 제작할 수 있다는 점이 주요 셀링 포인트라고 여겨진다.</p>\n<p>소위 \'Rails Magic\' 덕분에 form에 변수를 할당하는 것으로 경로 설정이 알아서 되거나 스캐폴딩만 해도 신기하게 돌아가는 애플리케이션을 보며 감탄했던 적이 한두 번이 아니었다.</p>\n<p>2016년 현재 레일즈는 버전 5까지 발매되었고, 더 많은 기능이 구현되어 있으며 커뮤니티는 많이 거대해졌다. 거대해진 레일즈 세계와 함께 그 음영을 느끼는 개발자들도 조금씩 늘어나게 되었다.</p>\n<p>예를 들어 보통 레일즈 애플리케이션을 오래 개발해온 사람들은 애플리케이션의 규모가 커질수록 유지보수하는게 힘들어진다는 점을 지적하고 있는데, 이를 해결하기 위해 <strong>Fat model, Skinny controller</strong> 등의 방법론이 제시되고 있지만 \'뭔가 문제가 있다\'는 의견들은 끊임없이 제시되고 있다.</p>\n<p>또한 DHH(David Heinemeier Hansson, 레일즈의 창시자)가 제시하고 있는 <a href="http://solnic.eu/2016/05/22/my-time-with-rails-is-up.html">\'Rails way\'에 반감을 가진 사람들이 점차 늘어나고</a> 루비로 웹 개발을 하는 것에 대해 <a href="http://rwdtow.stdout.in/">더 나은 방법을 찾는</a> 사람들이 점차 늘어나고 있다.</p>\n<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 599px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 131.3856427378965%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABe2AlTSxFMuUv/8QAGRABAAIDAAAAAAAAAAAAAAAAAQACEBEw/9oACAEBAAEFAqmqxODj/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQMBAT8BY//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABUQAQEAAAAAAAAAAAAAAAAAAAEw/9oACAEBAAY/Ain/xAAaEAADAQADAAAAAAAAAAAAAAAAAREQITFR/9oACAEBAAE/IYTxFLPKU5GXOpWf/9oADAMBAAIAAwAAABBv7vz/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAEDAQE/EHDbIc//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxAp/8QAHhABAAICAQUAAAAAAAAAAAAAAQARITFBUWGBkaH/2gAIAQEAAT8QKn0nwj0BmUTlxMVEarzE8Q3EKIQbZTiXibZ3H3P/2Q==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="현재 레일즈 커뮤니티"\n        title=""\n        src="/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-f36a6.jpg"\n        srcset="/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-28fc4.jpg 198w,\n/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-44f6c.jpg 395w,\n/static/2016-12-03-sc1-f0f9a1c45e0435424b34e6518f9574d9-f36a6.jpg 599w"\n        sizes="(max-width: 599px) 100vw, 599px"\n      />\n    </span>\n  </span>\n  </p>\n<p><em>현재 레일즈 커뮤니티의 묘사 - 출처: <a href="http://railshurts.com/current_state">http://railshurts.com/current_state</a></em></p>\n<p>이러한 분위기 속에서 \'Ruby way, not Rails\' 를 표방하는 루비 기반 웹 프레임워크가 등장하였으니, 바로 이번에 소개할 <a href="hanamirb.org">Hanami(하나미)</a>이다.</p>\n<h2 id="하나미가-뭐죠"><a href="#%ED%95%98%EB%82%98%EB%AF%B8%EA%B0%80-%EB%AD%90%EC%A3%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>하나미가 뭐죠?</h2>\n<p>하나미는 이탈리아의 개발자 <a href="https://lucaguidi.com">Luca Guidi</a> 가 개발한 루비 MVC 웹 프레임워크이다. 2014년에 Lotus라는 이름으로 처음 등장하였으나, IBM의 Louts 상표권과 엮이는 문제가 있어 지금의 이름으로 변경하게 되었다.</p>\n<p>새로운 이름으로 <strong>하나미</strong>라는 이름을 쓰게 된 이유는 \'꽃구경\' 이라는 일본어 본래의 뜻에 걸맞게 함께 하는 커뮤니티의 중요성을 일깨운다는 점을 강조하기 위해서라고 한다. 루비의 창시자 Matz와(일본인이다) 루비 그 자체에 대한 찬사의 의미도 가지고 있다.</p>\n<p>하나미의 특징을 몇 가지 소개하자면 먼저 최대한 루비라는 언어를 직접적으로 사용하는 방식으로 구현되어 있다는 점이다. 다만 이 때문에 레일즈를 습득하는데 루비 지식이 크게 필요하지 않은 것과 다르게 일정 수준의 루비 언어의 이해를 요구한다.</p>\n<p>또한 Magic을 최대한 배제하고(하나미 Gitter 채팅방에서 혹은 몇몇 포스트에서 "I\'m now sick of rails magic!" 이라고 주장하는 사람들이 많이 보인다) 개발자가 최대한 자신이 무엇을 하고 있는지 인지하면서 앱을 제작하도록 유도한다.</p>\n<p>그리고 보통 Rails best practice 로 제시되는 요소들을 기본적으로 구현하고 있다.</p>\n<ul>\n<li>컨트롤러는 HTTP 콜만 다룬다 -> 액션에서 비지니스 로직을 분리하여 처리하기 위해 <code>Interactor</code> 라는 모듈이 있다</li>\n<li>퍼시스턴스 로직과 도메인 로직을 분리한다 -> 하나미 모델은 기본적으로 도메인과 퍼시스턴스 레이어가 분리되어 있다</li>\n<li>루비 객체를 만들어서 제대로 OOP를 한다 -> 하나미는 OOP 개념을 잘 지키기 위해 노력한다. 또한 모듈화도 굉장히 쉽다</li>\n</ul>\n<p>하나미 가이드 페이지 첫머리에서 제시하는 <a href="http://hanamirb.org/guides/#why-choose-hanami-">\'하나미를 선택하는 이유\'</a> 를 가볍게 살펴보면 이렇게 말하고 있다.</p>\n<ul>\n<li>하나미는 가볍다 -> 상대적으로 짧은 코드, 웹 애플리케이션 개발에 필요한 필수적인 부분에 초점을 맞춤</li>\n<li>하나미는 구조적으로 건전하다 -> 컨트롤러 액션은 각각의 클래스로 분리되어 있으며 테스트하기 용이하다</li>\n<li>하나미는 스레드에 안전하다 -> (아직 이런 문제를 겪을만한 규모의 앱을 작성해본 적이 없어서 설명하기 어렵다)</li>\n</ul>\n<p>또한 하나미는 컨테이너 형태의 앱 구조를 기본적으로 제공한다. 덕분에 한 개의 프로젝트를 생성하여 API 서버와 웹 서버를 동시에 운용하는게 가능하다. 물론 레일즈로도 비슷한 구성을 할 수야 있겠지만 충돌 없는 구현을 위해 앱의 구조가 훨씬 복잡해질 가능성이 높다.</p>\n<h2 id="만들어-볼까요"><a href="#%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B3%BC%EA%B9%8C%EC%9A%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>만들어 볼까요</h2>\n<p>글을 길게 써 보았지만, 개발자들에겐 장황한 글보다 코드 몇 줄을 보는 것이 훨씬 이해가 빠를 것이다. 하나미의 공식 가이드를 따라가면서 눈여겨 볼 점들을 소개하겠다.</p>\n<h3 id="bookshelf-프로젝트-생성"><a href="#bookshelf-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bookshelf 프로젝트 생성</h3>\n<p>이번에 만들어볼 애플리케이션(이하 앱)은 <code>Bookshelf</code> 라는 앱이다. 책의 제목과, 작가가 있고 이 책들의 리스트를 살펴보고 책을 추가할 수 있는 기능을 가지고 있다. 가이드에서 수정과 삭제는 다루고 있지 않아 조금 아쉬운 느낌이 들지만 기본적인 웹 개발(레일즈) 지식이 있다면 구현하는 것이 그렇게 어렵지는 않다.</p>\n<p>기본적으로 루비 버전은 2.3+ 을 권장한다. 또한 데이터베이스는 sqlite3를 사용할 예정이다.</p>\n<p>먼저 하나미로 프로젝트를 생성하기 위해서는 <code>gem install hanami</code> 로 하나미가 설치되어 있어야 한다. 그 다음에는 새 프로젝트를 생성해본다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ hanami new bookshelf</code></pre>\n      </div>\n<p>생성된 프로젝트의 폴더 구조를 살펴보면 다음과 같다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ tree -L 2\n.\n├── Gemfile\n├── Rakefile\n├── apps\n│   └── web\n├── config\n│   ├── environment.rb\n│   └── initializers\n├── config.ru\n├── db\n│   ├── migrations\n│   └── schema.sql\n├── lib\n│   ├── bookshelf\n│   └── bookshelf.rb\n├── public\n└── spec\n    ├── bookshelf\n    ├── features_helper.rb\n    ├── spec_helper.rb\n    ├── support\n    └── web</code></pre>\n      </div>\n<p>여기서 특이한 점은 <code>apps</code> 라는 폴더가 있다는 점인데 기본 컨테이너는 <code>web</code> 이지만 사용자가 웹 브라우저로 보는 애플리케이션 이외에 같은 데이터베이스를 공유하는 api 서버 등을 따로 만들고자 하면 제네레이터로 따로 컨테이너를 생성할 수 있다. 그러면 같은 데이터베이스 사용하는 별개의 앱을 따로 구축할 수 있다는 장점이 있다. (물론 라우팅은 다르겠지만.. 이 부분은 <code>mount</code> 옵션으로 처리할 수 있다) <a href="http://hanamirb.org/guides/getting-started/#hanami-architecture">- 참고</a></p>\n<p>각 앱들에는 별개의 설정 파일, 컨트롤러, 뷰, 라우트, 템플릿 파일 및 폴더가 있다.</p>\n<p>테스트는 사용자가 원하는 어떤 형태로도 이용할 수 있다.(minitest or rspec) 하나미에서는 minitest를 기본으로 사용하며 capybara 젬도 사용한다. 이번 포스팅에서는 테스트를 구현하는 부분은 넘어가고자 한다. 테스팅이 궁금한 분들은 공식 가이드를 참조하시라.</p>\n<h3 id="루트-페이지-만들기"><a href="#%EB%A3%A8%ED%8A%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>루트 페이지 만들기</h3>\n<p>라우팅은 각 앱의 <code>config/routes.rb</code> 파일에서 설정한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/web/config/routes.rb</span>\nroot to<span class="token punctuation">:</span> <span class="token string">\'home#index\'</span>\n</code></pre>\n      </div>\n<p>그러면 home 컨트롤러의 index 액션을 실행해주기 위해 제네레이터로 액션을 생성해본다. 아직 하나미는 레일즈처럼 다양하고 세분화된 옵션의 CLI를 제공하진 않는다. 번거롭긴 하지만 개발에 큰 지장은 없다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami generate action web home#index\n    create  spec/web/controllers/home/index_spec.rb\n    create  apps/web/controllers/home/index.rb\n    create  apps/web/views/home/index.rb\n    create  apps/web/templates/home/index.html.erb\n    create  spec/web/views/home/index_spec.rb\n    insert  apps/web/config/routes.rb</code></pre>\n      </div>\n<p><code>action</code> 뒤에 있는 <code>web</code> 은 액션을 생성하고자 하는 컨테이너의 이름이다. 그 다음에 컨트롤러와 액션 이름을 적어주면 된다. 앱 구조가 단독 컨테이너 구조일 경우(<code>hanami new</code> 커맨드로 앱 생성시 <code>--arch=app</code> 옵션을 주어 단독 컨테이너 앱 생성도 가능하다)에는 바로 액션 이름만 작성해주어도 된다.</p>\n<p>아쉬운 점은 매 액션마다 저 명령어를 작성해주어야 한다는 점이다. <code>hanami-scaffold</code> 라는 젬이 있지만 그닥 유지보수는 되지 않고 있어서 사용하는 것을 추천하지 않는다.</p>\n<p>컨트롤러는 폴더에 불과하며 그 폴더에 속한 각각의 액션 파일에 컨트롤러가 정의되어 있는 형태이다. 또한 뷰는 템플릿 파일(레일즈의 views 폴더 안에 있는 템플릿들)과 뷰 파일(레일즈에 비유하자면 뷰 헬퍼와 비슷)로 구성되어있다. 지금은 템플릿 파일에 간단하게 제목을 추가해보도록 한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code># apps/web/templates/home/index.html.erb\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Bookshelf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p><em>(주의) 템플릿 파일이 변경될 때에는 서버를 재실행할 필요가 없지만, 컨트롤러 등의 루비 파일이 변경될 때에는 서버를 재실행해야 한다.</em></p>\n<p>그리고 서버를 실행한 뒤 <code>localhost:2300</code> 으로 접속해보면 심플하지만 Bookshelf라는 글씨가 보이는 페이지를 마주할 수 있다.\n(본 포스트에서는 빠른 진행을 위해 <code>application.html.erb</code> 파일을 미리 수정해두었다)</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami server</code></pre>\n      </div>\n<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 358px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 74.58100558659218%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y81R32tSYRg+/8tyumBjEkxd5TKZRRlHnU70HM/x1/RibmArF5UXDRbtz/CmwfyVJ4i6qP6CdhEEbRmIO4pCA9F25Y+n93xk0MVawS468PB+7/c97/M833c446QeNuMlzC1chsGkw8WpafCORVgXbLhy1Yo5kxkms+UX5jTQ3njfbJmHTj+FC5MGTOj04Cwk6DLPw87fhOHaBBxWGyrZDFKrq0gmE3A6neB5Hi6XCy6qbrf7N4iiSMJmTM/MkLAB3G0i3aAh+3U77tziEQgEEBRExGIxhmQigXg8DkmSEA6HIQgC44wRDAbh9/vJkAw8HnAyEaVQCB6PG4IoQJZkJpDJZLC5mcEDQjqdprRJrKXWEIlEWCpZlplJiGa1tWYejUbBabG1RiIhLQEjiSEskUE0FodIabWhYCCI5WUfVihxJBKFz+dFIpEk8xUK44Fxdhb2RQe4fD6PcrmMUqkMRVGolqh/gVKxiEpFQZGqdlYsFNhZ5SenQL2ivGTr/N4ecrkcnu/ugsM5f5x6VMeH/X30ej2cnHzHwcEhvh0fo/rlEEeqik6ng/fv3qJa/coG+v0+BoPBqeDevH6FJa8Xz3Z28PjRQ6TvbiCbzWLryRY27t3H9vZTrKdS+PjpMxMcDIcYjUangut2u2g0GgQV9XodzWYTtVoNqtpAq9WiqqLdblOyARPUhv545X95n7PEmKBGGtI1zsJY7FwT/tVf/u8FfwCkJLVg24iPyAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Bookshelf Title"\n        title=""\n        src="/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-8524e.png"\n        srcset="/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-dc079.png 198w,\n/static/2016-12-03-sc2-3a065f050faf7e4f996a919b015fb34b-8524e.png 358w"\n        sizes="(max-width: 358px) 100vw, 358px"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id="모델-구축하기"><a href="#%EB%AA%A8%EB%8D%B8-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>모델 구축하기</h3>\n<p>본격적으로 책들을 저장하고 출력하기 위해 데이터베이스 마이그레이션을 진행해 보도록 한다. 먼저 마이그레이션 파일을 생성한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami generate migration create_books</code></pre>\n      </div>\n<p>생성된 마이그레이션 파일은 이렇게 작성해 보았다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># db/migrations/20161203083239_create_books.rb</span>\n<span class="token constant">Hanami</span><span class="token punctuation">:</span><span class="token symbol">:Model</span><span class="token punctuation">.</span>migration <span class="token keyword">do</span>\n  change <span class="token keyword">do</span>\n    create_table <span class="token symbol">:books</span> <span class="token keyword">do</span>\n      primary_key <span class="token symbol">:id</span>\n\n      column <span class="token symbol">:title</span><span class="token punctuation">,</span>  <span class="token builtin">String</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:author</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n\n      column <span class="token symbol">:created_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n      column <span class="token symbol">:updated_at</span><span class="token punctuation">,</span> <span class="token constant">DateTime</span><span class="token punctuation">,</span> null<span class="token punctuation">:</span> <span class="token keyword">false</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><code>primary_key</code> 가 반드시 <code>id</code> 일 필요는 없다. 또한 <code>String</code>, <code>DateTime</code> 은 루비 타입이다(루비 클래스). 반드시 루비 타입을 사용할 필요는 없고 <code>"varchar(255)"</code> 같이 데이터베이스 타입을 문자열로 직접 작성해주어도 된다.</p>\n<p>마이그레이션 파일 작성이 완료되면 테이블을 생성해주는 명령어를 입력한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami db prepare\n$ bundle exec hanami db migrate</code></pre>\n      </div>\n<p>그리고 <code>Book</code> 모델을 생성해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami generate model book\n      create  lib/bookshelf/entities/book.rb\n      create  lib/bookshelf/repositories/book_repository.rb\n      create  spec/bookshelf/entities/book_spec.rb\n      create  spec/bookshelf/repositories/book_repository_spec.rb</code></pre>\n      </div>\n<p>생성된 파일을 보면 조금 특이한 점을 볼 수 있는데 <code>entities</code> 폴더와 <code>repositories</code> 폴더가 따로 나뉘어져 있다는 점이다. <code>Entity</code> 는 도메인 객체로, 실제 데이터베이스 쿼리 등으로 추출된 자료 객체를 일컫는다. <code>Repository</code> 는 퍼시스턴스 계층과 <code>Entity</code> 를 이어주는 역할을 한다. 여기서 <code>Entity</code> 는 데이터베이스의 존재를 전혀 모르는 단순 루비 객체이며 테스트가 용이하고 가벼운 앱을 만드는데 도움이 된다.</p>\n<p>실제 콘솔에서 레코드를 다루어보면 이런 방식으로 동작한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami console\n>> repo = BookRepository.new\n=> #<BookRepository:... >\n>> repo.all\n=> []\n>> book = repo.create(title: \'TDD\', author: \'Kent Beck\')\n=> #<Book:... @attribute={:id => 1, :title => "TDD", :author => "Kent Beck" ... }>\n>> repo.find(book.id)\n=> #<Book:... @attribute={:id => 1, :title => "TDD", :author => "Kent Beck" ... }></code></pre>\n      </div>\n<p><code>Repository</code> (이하 리퍼지토리)에서 제공되는 메서드로 데이터베이스에 <code>Entity</code> (이하 엔티티)를 조작할 수 있고, 엔티티에는 따로 속성 혹은 동작을 지정할 수 있다. 그래서 레일즈에서 사용하는 <code>scope</code> 나 커스텀 쿼리가 작성된 메서드 등은 리퍼지토리 클래스에 분리해 둘 수 있다.</p>\n<h3 id="데이터를-표현하기"><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>데이터를 표현하기</h3>\n<p>임의로 몇 개의 <code>Book</code> 레코드를 생성해주고 리스트를 표현해보기 위해 새 컨트롤러 액션을 생성한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami generate action web books#index</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code># apps/web/templates/books/index.html.erb\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>All books<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">books.any?</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>books<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">books.each</span> <span class="token attr-name">do</span> <span class="token attr-name">|book|</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>&lt;%= book.title %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&lt;%= book.author %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">end</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">else</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>There are no books yet.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">end</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p>여기서 <code>books</code> 는 어디서 온 것일까? 실제로 액션 부분은 이렇게 작성되어 있다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/web/controllers/books/index.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Books</span>\n  <span class="token keyword">class</span> <span class="token class-name">Index</span>\n    include <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    expose <span class="token symbol">:books</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      <span class="token variable">@books</span> <span class="token operator">=</span> <span class="token constant">BookRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span>all\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><code>expose</code> 메서드의 사용은 하나미의 규칙으로, <code>expose</code> 로 지정한 변수만 템플릿으로 노출되며 그 변수는 <code>call</code> 메서드 안에 인스턴스 변수로 존재해야 한다.</p>\n<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 128.05194805194807%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAAC+0lEQVRIx61U/UtTURi+f0vq0n7oA0Q2P5L8ojLEocxtd03nvpztw2V/QBqmmRpYRjgrrIku06kUBEFQ6IhyZaap6Nb6oURJ3Jyi4rane44oaubHtQsP59z3nPc5z3PP+14mXnAc6fFCJKQJEXUmCqkJIkguZeNcRiYys7KQlp4BUWLSrkhMSkbM8ThEC2JxLFpAwYji4pCdeBYpF1MRkyCAuUCKxnIL9KVGWMwm6PU65IpzIRaLtyEvLw8KBQuhUISTp05DEHuCkjN5Egmyc3JwPusCLrNKyFg5dHo9R6SHwWBAaWkpnWs0GmjUGjoWFxdDJpNBLpeDVSjoSCCVysAolUoUKguRn59PTyQbCYHFYoHVaoXJaFwn42AoKYFWq4VarYZKpQLJZVkWEk4Uy+WqVAowZKGszAqj0QSz2QzjFSN0Wh10Oi2NEcuGEgOKioroISYuRubl5ddgMlug4AiTk1MglxbgqsUAxuPxYHJykmJqaoqCxDbiXq8XPp+Pvm9d2zone9ZjHjD4zw/T2+NEVdVNdHY50dXpwN2m++h29qCmuhp9vb2or2vAg2Yb3by2toZwOLwnGLd7EHa7HTbbQzja29DheIb2Dgfa7E/R43Si83k3Bt2fKCFJiEQieys8qBVCdiDLq6ur+D03h5mZGSwvL2NlZQWBQICOhCQUCm2SEXX7KnQN9KO27g4e2ZrRbGtBa+sTNDTUo+/Fy79s7ke2qXBhYQGLi0HMz89z8NPR7/cfWNU2QnJzxNZuz2GINgnHvo2iueUxrlfewPjEBA2SA7baPJTCVe7j//w1jbHxcc724jZlvBTuTNp6o7w6xcv1oGvAhaGhL3j7rh8jI6OI8LC6rbA3EkOh8JHsUsIgVzLT09OY44qbYHZ2FgEuxvsbvne5cKumBvW3a9F0rxGVFRV49frNodpt114mpbL+Nwlt1iUvhUtLS7RTSP/6/QFq90iEP3zf4Xa7MfR5CMPDX/Hh4yCCwSB/wn8t8L7ljXrbCb6kfwBgoxYXcTdGKQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Bookshelf list"\n        title=""\n        src="/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-3fe9a.png"\n        srcset="/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-54c53.png 198w,\n/static/2016-12-03-sc3-58eb0336ccd6468d50eb76c6d049377e-3fe9a.png 385w"\n        sizes="(max-width: 385px) 100vw, 385px"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id="새로운-책을-등록하기"><a href="#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%B1%85%EC%9D%84-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>새로운 책을 등록하기</h3>\n<p>웹 페이지에서 새로운 책을 등록하기 위해서는 <code>new</code>, <code>create</code> 액션과 패러매터를 전달해 줄 <code>Form</code> 이 필요할 것이다. 먼저 <code>books#new</code>, <code>books#create</code> 액션을 생성해 준 뒤에 라우팅을 조금 깔끔하게 다듬어주도록 한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/web/config/routes.rb</span>\nroot to<span class="token punctuation">:</span> <span class="token string">\'home#index\'</span>\nresources <span class="token symbol">:books</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:index</span><span class="token punctuation">,</span> <span class="token symbol">:new</span><span class="token punctuation">,</span> <span class="token symbol">:create</span><span class="token punctuation">]</span>\n</code></pre>\n      </div>\n<p>하나미는 REST를 기본적으로 지원한다. 2번째 줄에서 사용 된 <code>resources</code> 는 보통 레일즈 라우트 파일에서 자주 보았던 그 <code>resources</code> 메서드처럼 사용하면 된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ bundle exec hanami routes\n        Name Method     Path           Action\n\n        root GET, HEAD  /              Web::Controllers::Home::Index\n       books GET, HEAD  /books         Web::Controllers::Books::Index\n    new_book GET, HEAD  /books/new     Web::Controllers::Books::New\n       books POST       /books         Web::Controllers::Books::Create</code></pre>\n      </div>\n<p>다음은 <code>new</code> 템플릿에 폼 헬퍼(Form helper) 를 이용하여 간단한 폼을 작성해준다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-markup"><code># apps/web/templates/books/new.html.erb\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Add book<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n\n&lt;%=\n  form_for :book, routes.books_path do\n    div class: \'input\' do\n      label      :title\n      text_field :title\n    end\n\n    div class: \'input\' do\n      label      :author\n      text_field :author\n    end\n\n    div class: \'controls\' do\n      submit \'Create Book\'\n    end\n  end\n%>\n</code></pre>\n      </div>\n<p>폼 헬퍼의 구조가 레일즈의 <code>form_for</code> 헬퍼와는 사뭇 다르다. 간단하게 차이점을 이야기하자면 하나미의 <code>form_for</code> 는 레일즈의 <code>form_tag</code> 헬퍼에 가깝다고 생각하면 된다. <a href="http://hanamirb.org/guides/helpers/forms/#technical-notes">하나미 가이드에 따르면</a> <code>form_for do |f|</code> 형식으로 작성하는 것은 올바른 ERB 템플릿이 아니며, 하나미의 폼 헬퍼는 템플릿 엔진에 의존하지 않고 사용할 수 있도록(어느 템플릿 엔진을 사용하던 같은 루비 코드를 사용하도록) 구성되어 있다.</p>\n<p><code>routes.books_path</code> 는 라우팅 헬퍼이며 상기 라우팅 구조에 있는 이름을 사용하여 <code>routes</code> 뒤에 메서드 형식으로 붙여주면 자동으로 경로를 연결해준다.</p>\n<p>책을 생성하기 위한 <code>create</code> 액션은 다음과 같이 작성한다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/web/controllers/books/create.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Books</span>\n  <span class="token keyword">class</span> <span class="token class-name">Create</span>\n    include <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    expose <span class="token symbol">:book</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      <span class="token variable">@book</span> <span class="token operator">=</span> <span class="token constant">BookRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:book</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n      redirect_to routes<span class="token punctuation">.</span>books_path\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>이후 생성된 폼에 새로운 책을 등록해보니 문제없이 책이 생성되었다.</p>\n<h3 id="유효성-검사"><a href="#%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%82%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>유효성 검사</h3>\n<p>하나미는 유효성 검사를 모델이 아닌 컨트롤러 액션에서 처리한다. 물론 엔티티 클래스에 유효성 검사를 정의할 수 있지만, 유효성 검사는 입력 이후 가장 가까운 단계에서 이루어질 것을 권장하고 있다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/web/controllers/books/create.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Controllers</span><span class="token punctuation">:</span><span class="token symbol">:Books</span>\n  <span class="token keyword">class</span> <span class="token class-name">Create</span>\n    include <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Action</span>\n\n    expose <span class="token symbol">:book</span>\n\n    params <span class="token keyword">do</span>\n      <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:book</span><span class="token punctuation">)</span><span class="token punctuation">.</span>schema <span class="token keyword">do</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:title</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n        <span class="token function">required</span><span class="token punctuation">(</span><span class="token symbol">:author</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token symbol">:str?</span><span class="token punctuation">)</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n\n    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n      <span class="token keyword">if</span> params<span class="token punctuation">.</span>valid<span class="token operator">?</span>\n        <span class="token variable">@book</span> <span class="token operator">=</span> <span class="token constant">BookRepository</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:book</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n        redirect_to routes<span class="token punctuation">.</span>books_path\n      <span class="token keyword">else</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">422</span>\n      <span class="token keyword">end</span>\n    <span class="token keyword">end</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p><code>params</code> 로 시작하는 유효성 검사는 엔티티를 정의해놓은 것 같은 역할을 할 수 있겠다. 자세한 내용은 <a href="http://hanamirb.org/guides/actions/parameters/">가이드</a>를 참고하면 손쉽게 작성할 수 있다.</p>\n<p>만약 패러매터가 유효하지 않다면 HTTP 상태 코드 422(Unprocessable Entity)를 리턴하고, 그에 알맞는 뷰를 다시 표현해 주어야 한다. 현재 <code>create</code> 액션에는 아무런 템플릿도 작성되어있지 않고, 실제로는 <code>new</code> 템플릿을 그대로 사용하면 되기 때문에 뷰 파일에 알맞는 템플릿을 정의해주면 된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code><span class="token comment"># apps/web/views/books/create.rb</span>\n<span class="token keyword">module</span> <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:Views</span><span class="token punctuation">:</span><span class="token symbol">:Books</span>\n  <span class="token keyword">class</span> <span class="token class-name">Create</span>\n    include <span class="token constant">Web</span><span class="token punctuation">:</span><span class="token symbol">:View</span>\n    template <span class="token string">\'books/new\'</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>지금까지 하나미를 통해 간단한 웹 애플리케이션을 개발하는 과정을 살펴보았다. 아주 기초적인 부분만 설명하였지만, 가이드를 살펴보고 하나미의 기능에 조금 더 익숙해진 뒤에는 github에 올라와 있는 몇몇 프로젝트 소스를 살펴보면서 하나미를 파악해보는 것을 추천한다.</p>\n<p>개인적으로 <a href="https://github.com/bruz/bookshelf-delivery-example">이 Github 저장소</a>를 방문해 보는 것을 추천한다. 하나미의 컨테이너 구조 및 컨트롤러 액션과 비지니스 로직을 구분하는 예를 잘 보여준 코드로 구성되어있다.(<code>lib</code> 폴더 안에 있는 <code>interactors</code> 폴더에 주목하라)</p>\n<p>본 포스팅에 사용된 코드는 <a href="https://github.com/emaren84/hanami-introduction">여기서</a> 확인해 볼 수 있다.</p>\n<h2 id="결론"><a href="#%EA%B2%B0%EB%A1%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결론</h2>\n<p>루비는 일반적 용도의 언어로써 충분히 완성도가 있는 언어이지만 상대적으로 다양한 분야에서 사용되는 파이썬에 비해 어느샌가 웹 개발에만 쓰이는 언어라는 선입견이 심어지게 되었다. 그리고 이러한 선입견의 중심엔 레일즈가 있다.</p>\n<p>레일즈가 등장하고 루비라는 언어가 크게 알려지는 데 기여한 것은 사실이다. 하지만 이 세상에 특정 문제 해결을 위한 단 하나의 정답은 거의 없다. 루비라는 언어 자체도 하나의 문제를 해결 하는데 다양한 방법을 제시하는 언어이기도 하다.</p>\n<p>하나미의 등장도 이런 맥락에서 바라볼 수 있다. 단순히 레일즈만이 루비로 웹 애플리케이션을 만드는 최고의 방법이 아니며, 하나미를 잘 활용하면 레일즈에 비해 유지보수가 쉽고, 더 성능이 좋은 웹 애플리케이션을 작성할 수도 있을 것이다.</p>\n<p>물론 하나미는 나온지 얼마 되지 않은 프레임워크이고, 기능 구현이 레일즈에 비해 상대적으로 부족한 점도 있다. <strong>특히 문서화가 되어있지 않아 소스 코드를 이리저리 살펴보아야 하는 부분들이 아직 많이 있다는 점이 아쉽다.</strong> 하지만 충분한 발전 가능성을 지니고 있고, 진정 루비라는 언어로 프로그래밍을 하는 재미를 주는 것이 매력적이기 때문에 루비 언어 자체를 좋아하는 사람들이라면 한번 사용해 볼 것을 추천한다.</p>\n<p>하나미의 정보를 더 얻고자 하는 분들에게는 다음의 링크를 살펴보면 된다.</p>\n<ul>\n<li><a href="http://hanamirb.org/guides/">하나미 공식 가이드</a> + <a href="https://github.com/hanami/hanami">소스 코드</a></li>\n<li><a href="https://gitter.im/hanami/chat">하나미 Gitter 채팅방</a></li>\n<li><a href="https://github.com/davydovanton/awesome-hanami">유용한 젬 및 링크 공유</a></li>\n</ul>',
id:"/Users/rinae/Dev/blog/src/pages/posts/2016-12-03-hanami-introduction/index.md absPath of file >>> MarkdownRemark",frontmatter:{date:"2016-12-03",path:"/posts/hanami-introduction",title:"레일즈(Ruby on Rails)와는 또 다른 루비 웹 프레임워크, Hanami(하나미)",tags:["Ruby","Rails","Hanami"],category:"Hanami"}}],tagName:"Hanami"}}}});
//# sourceMappingURL=path---tags-hanami-5579558088e90d9e21c7.js.map